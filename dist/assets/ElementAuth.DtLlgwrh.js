import{j as e,h as _,P as k,T as d,i as m,q as p,o as v,A as S,l as j}from"./vendor-mui.08p3AH88.js";import{e as E,u as T,r as n}from"./vendor-router.BRqU_Zs2.js";import"./vendor-react.DF-_cTkv.js";const C=()=>{const{token:i}=E(),x=T(),[g,a]=n.useState("\u041F\u043E\u0434\u0433\u043E\u0442\u043E\u0432\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438..."),[u,o]=n.useState(""),[f,c]=n.useState(!0),[r,b]=n.useState(null),[h,w]=n.useState(0);n.useEffect(()=>{l();const t=setTimeout(()=>y(),500);return()=>clearTimeout(t)},[i]);const l=async()=>{try{const t=await fetch("/api/auth/status"),s=await t.json();b(s),s.external_socket_connected||a("\u041E\u0436\u0438\u0434\u0430\u043D\u0438\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F \u043A \u0441\u0435\u0440\u0432\u0435\u0440\u0443 Element...")}catch{}},y=async()=>{w(t=>t+1),a("\u041F\u043E\u043F\u044B\u0442\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438...");try{const t=await fetch(`/api/auth_elem/${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({connect_key:i})});if(!t.ok)throw new Error(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ${t.status}`);const s=await t.json();s.status==="success"&&s.redirect?(a("\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F \u0443\u0441\u043F\u0435\u0448\u043D\u0430. \u041F\u0435\u0440\u0435\u043D\u0430\u043F\u0440\u0430\u0432\u043B\u044F\u0435\u043C..."),s.elem_connected&&(localStorage.setItem("elem_connected","true"),window.dispatchEvent(new StorageEvent("storage",{key:"elem_connected",newValue:"true"}))),x(s.redirect)):s.status==="error"&&s.message.includes("\u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D")?(o(s.message),a("\u041F\u0440\u043E\u0431\u043B\u0435\u043C\u0430 \u0441 \u0441\u0435\u0440\u0432\u0438\u0441\u043E\u043C \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438"),c(!1),await l()):(o(s.message||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430"),a("\u041E\u0448\u0438\u0431\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438"),c(!1))}catch(t){o(`\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0432\u044F\u0437\u0438: ${t.message}`),a("\u041E\u0448\u0438\u0431\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438"),c(!1),await l()}};return e.jsx(_,{maxWidth:"sm",sx:{mt:8},children:e.jsxs(k,{elevation:3,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",borderRadius:2,background:"rgba(30, 30, 30, 0.8)",backdropFilter:"blur(10px)"},children:[e.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{color:"primary.main"},children:"\u0410\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F \u0447\u0435\u0440\u0435\u0437 Element"}),r&&e.jsxs(m,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsx(p,{label:r.external_socket_connected?"\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u0430\u043A\u0442\u0438\u0432\u043D\u043E":"\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442",color:r.external_socket_connected?"success":"error",size:"small"}),r.using_proxy&&e.jsx(p,{label:`${r.proxy_type||""} \u043F\u0440\u043E\u043A\u0441\u0438`,color:"info",size:"small"})]}),f?e.jsxs(m,{sx:{textAlign:"center",my:4},children:[e.jsx(v,{size:60,thickness:4,sx:{mb:3}}),e.jsx(d,{variant:"body1",color:"text.secondary",children:g}),h>1&&e.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["\u041F\u043E\u043F\u044B\u0442\u043A\u0430 ",h,"..."]})]}):e.jsxs(m,{sx:{width:"100%",mt:2},children:[u&&e.jsx(S,{severity:"error",sx:{mb:3},children:u}),e.jsx(j,{variant:"contained",color:"primary",fullWidth:!0,onClick:()=>{o(""),c(!0),y()},sx:{mt:2},children:"\u041F\u043E\u043F\u0440\u043E\u0431\u043E\u0432\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430"}),e.jsx(j,{variant:"outlined",fullWidth:!0,onClick:()=>x("/login"),sx:{mt:2},children:"\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u043D\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 \u0432\u0445\u043E\u0434\u0430"})]})]})})};export{C as default};
