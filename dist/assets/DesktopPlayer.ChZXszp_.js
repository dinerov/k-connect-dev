import{b as ye,j as e,s as S,i as m,T as W,af as ve,A as ke,P as je,w as Ce,z as O}from"./vendor-mui.08p3AH88.js";import{r as t,a as Te}from"./vendor-router.BRqU_Zs2.js";import{f as G,I as N,a as V,b as H,c as J,d as K,e as Se,g as ze,h as Me,i as Pe,j as Ee,k as Le,l as Ae,m as Re,n as Ie,F as We}from"./MobilePlayer.Dn8-ai5r.js";import{T as Fe,u as De}from"./index.CdVNWeFt.js";import{e as _e}from"./imageUtils.BkCfy0de.js";const $e=S(je)(({theme:n,covercolor:o})=>({position:"fixed",bottom:20,left:"60%",transform:"translateX(-50%)",width:"85%",maxWidth:1100,minWidth:580,zIndex:n.zIndex.appBar-1,backgroundColor:o?`rgba(${o}, 0.22)`:"rgba(10, 10, 10, 0.3)",backdropFilter:"blur(35px)",boxShadow:"0 4px 25px rgba(0, 0, 0, 0.2)",borderRadius:16,padding:n.spacing(.8),border:"1px solid rgba(255, 255, 255, 0.06)",display:"flex",alignItems:"center",overflow:"hidden","&.hidden":{display:"none !important",opacity:0,pointerEvents:"none",visibility:"hidden"},"&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:o?`radial-gradient(circle at center, rgba(${o}, 0.3) 0%, rgba(10, 10, 10, 0.1) 70%)`:"none",opacity:.6,pointerEvents:"none"},"@media (max-width: 900px)":{width:"85%",minWidth:"auto"}})),Q=S(W,{shouldForwardProp:n=>n!=="isactive"})(({isactive:n})=>({whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block",position:"relative",animation:n==="true"?"marquee 15s linear infinite":"none",animationDelay:"1.5s","@keyframes marquee":{"0%":{transform:"translateX(0%)"},"100%":{transform:"translateX(-100%)"}},"&::after":{content:n==="true"?"attr(data-text)":"none",position:"absolute",whiteSpace:"nowrap",left:"100%",paddingLeft:"20px"}})),Be=S(O)(({theme:n,covercolor:o})=>({color:o?`rgba(${o}, 1)`:n.palette.primary.main,height:3,"& .MuiSlider-thumb":{width:0,height:0,opacity:0,transition:"0.2s cubic-bezier(.47,1.64,.41,.8)"},"&:hover .MuiSlider-thumb, &.Mui-active .MuiSlider-thumb":{width:10,height:10,opacity:1},"& .MuiSlider-rail":{opacity:.3,height:3},"& .MuiSlider-track":{height:3}})),Ue=S(O)(({theme:n,covercolor:o})=>({color:o?`rgba(${o}, 1)`:n.palette.primary.main,width:80,height:3,"& .MuiSlider-thumb":{width:8,height:8,"&:hover, &.Mui-focusVisible":{boxShadow:"none"}},"& .MuiSlider-rail":{opacity:.3}})),d=t.memo(({icon:n,onClick:o,ariaLabel:b,color:z="white",active:M=!1,activeColor:P=null})=>e.jsx(Ce,{onClick:o,"aria-label":b,sx:{color:M?P||"primary.main":z,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:n})),qe=_e,Xe=t.memo(()=>{ye();const{themeSettings:n}=t.useContext(Fe),{currentTrack:o,isPlaying:b,togglePlay:z,nextTrack:M,prevTrack:P,likeTrack:F,currentTime:Oe,duration:s,seekTo:w,volume:x,setVolume:D,isMuted:y,toggleMute:Y,getCurrentTimeRaw:E,getDurationRaw:c,audioRef:l}=De(),[Z,p]=t.useState(0),[h,L]=t.useState(!1),[v,_]=t.useState(!1),[k,ee]=t.useState("off"),[te,ie]=t.useState(!1),[f,re]=t.useState(null),[$,B]=t.useState(!1),[oe,ae]=t.useState(!1),[ne,se]=t.useState(!1),[A,R]=t.useState({open:!1,message:"",severity:"success"}),j=t.useRef(null),C=t.useRef(null),T=t.useRef(null);t.useRef(0);const I=t.useRef(0),le=t.useMemo(()=>{try{const i=document.getElementById("global-player-current-time");if(i&&i.textContent)return i.textContent;if(typeof E=="function"){const r=E();return G(typeof r=="number"?r:0)}return"0:00"}catch{return"0:00"}},[E]),ce=t.useMemo(()=>{try{const i=document.getElementById("global-player-duration");if(i&&i.textContent)return i.textContent;if(typeof c=="function"){const r=c();return G(typeof r=="number"?r:0)}return"0:00"}catch{return"0:00"}},[c]);if(t.useEffect(()=>{let i=!0;const r=()=>{try{if(!i)return;const u=document.getElementById("desktop-current-time"),g=document.getElementById("desktop-duration");u&&window.audioTiming&&window.audioTiming.formattedCurrentTime&&(u.textContent=window.audioTiming.formattedCurrentTime),g&&window.audioTiming&&window.audioTiming.formattedDuration&&(g.textContent=window.audioTiming.formattedDuration),!h&&window.audioTiming&&typeof window.audioTiming.progress=="number"&&(p(window.audioTiming.progress),I.current=window.audioTiming.progress),i&&requestAnimationFrame(r)}catch{i&&requestAnimationFrame(r)}},a=requestAnimationFrame(r);return()=>{i=!1,cancelAnimationFrame(a)}},[h]),t.useEffect(()=>{},[]),t.useEffect(()=>{C.current&&ae(C.current.scrollWidth>C.current.clientWidth),T.current&&se(T.current.scrollWidth>T.current.clientWidth)},[o]),t.useEffect(()=>{o?.cover_path&&qe(o.cover_path||"/static/uploads/system/album_placeholder.jpg",i=>{re(i)})},[o]),t.useEffect(()=>{const i=r=>{!h&&r.detail&&r.detail.progressPercent&&(p(r.detail.progressPercent),I.current=r.detail.progressPercent)};return document.addEventListener("audioProgressUpdate",i),window.currentAudioProgress===void 0||h||(p(window.currentAudioProgress),I.current=window.currentAudioProgress),()=>{document.removeEventListener("audioProgressUpdate",i)}},[h]),!o)return null;const U=t.useCallback(()=>{L(!0)},[]),ue=t.useCallback((i,r)=>{p(r)},[]),de=t.useCallback((i,r)=>{try{let a=0;if(typeof c=="function"){const u=c();typeof u=="number"&&u>0?a=u:typeof s=="number"&&s>0&&(a=s)}else typeof s=="number"&&s>0?a=s:l&&l.current&&l.current.duration&&(a=l.current.duration);a>0&&w(r*a/100),L(!1)}catch{L(!1)}},[w,c,s,l]),me=t.useCallback(i=>{try{if(j.current){let r=0;if(typeof c=="function"){const a=c();typeof a=="number"&&a>0?r=a:typeof s=="number"&&s>0&&(r=s)}else typeof s=="number"&&s>0?r=s:l&&l.current&&l.current.duration&&(r=l.current.duration);if(r>0){const a=j.current.getBoundingClientRect(),u=(i.clientX-a.left)/a.width*100,g=Math.min(Math.max(u,0),100);p(g),w(g*r/100)}}}catch{}},[j,w,c,s,l]),xe=t.useCallback(i=>{if(i&&i.stopPropagation(),o?.id)try{const r=i.currentTarget;r.style.transform="scale(1.3)",setTimeout(()=>{r.style.transform="scale(1)"},150),F(o.id).then(a=>{}).catch(a=>{})}catch{}},[o,F]),pe=t.useCallback(()=>{if(!o)return;const i=`${window.location.origin}/music/track/${o.id}`;he(i)},[o]),he=t.useCallback(i=>{navigator.clipboard.writeText(i).then(()=>{R({open:!0,message:"\u0421\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0442\u0440\u0435\u043A \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430",severity:"success"})}).catch(r=>{R({open:!0,message:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u0441\u044B\u043B\u043A\u0443",severity:"error"})})},[]),q=t.useCallback((i,r)=>{r!=="clickaway"&&R(a=>({...a,open:!1}))},[]),fe=t.useCallback((i,r)=>{D(r/100)},[D]),ge=t.useCallback(()=>{ee(i=>i==="off"?"all":i==="all"?"one":"off")},[]),be=t.useCallback(()=>{ie(i=>!i)},[]),X=t.useCallback(()=>{_(!0)},[]),we=t.useCallback(()=>{_(!1)},[]);return t.useMemo(()=>y||x===0?e.jsx(N,{size:20}):x<.5?e.jsx(V,{size:20}):e.jsx(H,{size:20}),[y,x]),t.useMemo(()=>k==="one"?e.jsx(J,{size:20}):e.jsx(K,{size:20}),[k]),e.jsxs(Te.Fragment,{children:[e.jsxs($e,{elevation:0,covercolor:f,onMouseEnter:()=>B(!0),onMouseLeave:()=>B(!1),sx:{display:v?"none":"flex"},className:v?"hidden":"",children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",width:"25%",cursor:"pointer"},onClick:X,children:[e.jsx(m,{component:"img",src:o?.cover_path||"/static/uploads/system/album_placeholder.jpg",alt:o?.title||"",sx:{width:52,height:52,borderRadius:1.5,objectFit:"cover",border:"1px solid rgba(255, 255, 255, 0.1)",marginRight:1.5,transition:"all 0.3s ease","&:hover":{boxShadow:"0 0 15px rgba(255, 255, 255, 0.1)"}}}),e.jsxs(m,{sx:{overflow:"hidden",maxWidth:"70%"},children:[e.jsx(Q,{variant:"body1",ref:C,fontWeight:"medium",isactive:oe&&$?"true":"false","data-text":o?.title||"Unknown Title",sx:{fontSize:"0.95rem",color:"white"},children:o?.title||"Unknown Title"}),e.jsx(Q,{variant:"body2",ref:T,isactive:ne&&$?"true":"false","data-text":o?.artist||"Unknown Artist",sx:{fontSize:"0.8rem",opacity:.7,color:"white"},children:o?.artist||"Unknown Artist"})]})]}),e.jsxs(m,{sx:{display:"flex",flexDirection:"column",flexGrow:1,mx:2},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"center",mb:.8},children:[e.jsx(d,{icon:e.jsx(Se,{size:20}),onClick:be,ariaLabel:"Toggle shuffle",active:te}),e.jsx(d,{icon:e.jsx(ze,{size:20}),onClick:P,ariaLabel:"Previous track"}),e.jsx(d,{icon:b?e.jsx(Me,{size:24}):e.jsx(Pe,{size:24}),onClick:z,ariaLabel:b?"Pause":"Play",active:!0,activeColor:f?`rgba(${f}, 1)`:null}),e.jsx(d,{icon:e.jsx(Ee,{size:20}),onClick:M,ariaLabel:"Next track"}),e.jsx(d,{icon:k==="one"?e.jsx(J,{size:20}):e.jsx(K,{size:20}),onClick:ge,ariaLabel:"Toggle repeat mode",active:k!=="off"})]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",px:1},children:[e.jsx(W,{id:"desktop-current-time",variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)",mr:1,minWidth:35,textAlign:"center"},children:le}),e.jsx(m,{ref:j,onClick:me,sx:{flexGrow:1},children:e.jsx(Be,{covercolor:f,value:Z,onChange:ue,onMouseDown:U,onChangeCommitted:de,onTouchStart:U,"aria-labelledby":"track-progress-slider",step:.01})}),e.jsx(W,{id:"desktop-duration",variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)",ml:1,minWidth:35,textAlign:"center"},children:ce})]})]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"25%"},children:[e.jsx(d,{icon:o?.is_liked?e.jsx(Le,{size:20}):e.jsx(Ae,{size:20}),onClick:xe,ariaLabel:"Toggle like",active:o?.is_liked,activeColor:"error.main"}),e.jsx(d,{icon:e.jsx(Re,{size:20}),onClick:pe,ariaLabel:"Share track"}),e.jsx(d,{icon:y?e.jsx(N,{size:20}):x<.5?e.jsx(V,{size:20}):e.jsx(H,{size:20}),onClick:Y,ariaLabel:"Toggle mute"}),e.jsx(Ue,{covercolor:f,value:y?0:100*x,onChange:fe,"aria-labelledby":"volume-slider",sx:{mx:1}}),e.jsx(d,{icon:e.jsx(Ie,{size:20}),onClick:X,ariaLabel:"Open fullscreen player"})]})]}),e.jsx(We,{open:v,onClose:we}),e.jsx(ve,{open:A.open&&!v,autoHideDuration:3e3,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ke,{onClose:q,severity:A.severity,sx:{width:"100%"},children:A.message})})]})});export{Xe as D};
