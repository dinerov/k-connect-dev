import{r as xt,a as ut,b as gt,g as ht,j as e,D as ke,ab as bt,ac as ft,w as S,T as d,i as n,K as yt,h as jt,A as We,m as Se,o as ce,k as Z,L as vt,af as wt,l as fe,a6 as kt,a8 as Ae,R as Fe,U as Me,s as P,C as Pe}from"./vendor-mui.08p3AH88.js";import{e as St,r as l,u as Le,a as Ct,L as J}from"./vendor-router.BRqU_Zs2.js";import{r as It,A as Be,m as Rt,S as zt,b as He,F as Ee}from"./index.CdVNWeFt.js";import{a as C}from"./vendor.CL98q8z6.js";import{P as _t,F as Ue}from"./Post.MP7_w9C7.js";import{A as Xe}from"./ArrowBack.DeCcUwS3.js";import{g as Tt}from"./vendor-react.DF-_cTkv.js";import{S as Ne}from"./Send.DjUSpM3V.js";import{C as me}from"./Close.BG2YHWMj.js";import{D as ye}from"./Delete.C47j6PO2.js";import{M as Ve}from"./MoreVert.C0-1U5Ci.js";import{R as Ce}from"./Reply.De_n_WzJ.js";import{S as $t,C as qe}from"./SimpleImageViewer.DCWkQqHX.js";import{Z as Ge}from"./ZoomIn.B2AGiqFq.js";import{b as Ke}from"./dateUtils.JaLtthGQ.js";import"./TransferMenu.2g5UFehs.js";import{V as Ze}from"./index.CJUnh1z7.js";import"./Link.BmVIpf9S.js";import"./Share.BKyVThZF.js";import"./imageUtils.BkCfy0de.js";import"./MusicNote.D4Jp3FIY.js";import"./PlayArrow.GqmCGL4o.js";import"./Pause.r8mC42rq.js";import"./Visibility.Bq_lujd_.js";import"./Edit.6-hI7nty.js";import"./Photo.tXKr-C4h.js";import"./thumbnails.CEJMDkxh.js";import"./History.BL_2VNvs.js";import"./Save.D4JlNQm5.js";import"./Person.B_G_dVGx.js";var Je,xe={};function Dt(){if(Je)return xe;Je=1;var t=xt();Object.defineProperty(xe,"__esModule",{value:!0}),xe.default=void 0;var v=t(It()),b=ut();return xe.default=(0,v.default)((0,b.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),xe}const Qe=Tt(Dt()),Q=(t,v,b)=>{if(!v||!t){const R=window.location.pathname;return localStorage.setItem("redirect_after_login",R),b("/login",{state:{from:R}}),!1}return!0};P(n)(({theme:t})=>({"& p":{margin:t.spacing(1,0)},"& h1, & h2, & h3, & h4, & h5, & h6":{marginTop:t.spacing(2),marginBottom:t.spacing(1),fontWeight:600},"& a":{color:t.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},"& ul, & ol":{marginLeft:t.spacing(2)},"& code":{fontFamily:"monospace",backgroundColor:t.palette.action.hover,padding:t.spacing(.3,.6),borderRadius:3},"& pre":{backgroundColor:t.palette.grey[900],color:t.palette.common.white,padding:t.spacing(1.5),borderRadius:t.shape.borderRadius,overflowX:"auto","& code":{backgroundColor:"transparent",padding:0}}})),P(Pe)(({theme:t})=>({marginBottom:t.spacing(2),borderRadius:t.spacing(1)})),P(Pe)(({theme:t})=>({marginBottom:t.spacing(3),borderRadius:t.spacing(1)})),P(Se)(({theme:t})=>({marginTop:t.spacing(2),marginBottom:t.spacing(2)})),P(n)(({theme:t})=>({marginBottom:t.spacing(2),padding:t.spacing(2),borderRadius:t.shape.borderRadius,backgroundColor:"rgba(255, 255, 255, 0.03)"})),P(n)(({theme:t})=>({marginLeft:t.spacing(6),marginTop:t.spacing(1),padding:t.spacing(2),borderRadius:t.shape.borderRadius,backgroundColor:"rgba(255, 255, 255, 0.02)"})),P(n)(({theme:t})=>({position:"relative",marginTop:t.spacing(2),borderRadius:t.shape.borderRadius,overflow:"hidden",backgroundColor:"rgba(0, 0, 0, 0.2)"})),P(S)(({theme:t})=>({position:"absolute",top:8,right:8,backgroundColor:"rgba(0, 0, 0, 0.5)",color:t.palette.common.white,padding:t.spacing(.5),"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}}));const $=t=>t?t.includes("/static/uploads/")&&t.indexOf("/static/uploads/")!==t.lastIndexOf("/static/uploads/")?t.substring(t.lastIndexOf("/static/uploads/")):t:null,Ot=({comment:t,onLike:v,onLikeReply:b,onReply:R,isReplyFormOpen:z,activeCommentId:x,replyText:H,onReplyTextChange:D,onReplySubmit:y,replyingToReply:E,setReplyingToReply:F,setReplyFormOpen:O,setActiveComment:U,onDeleteComment:X,onDeleteReply:Y,isSubmittingComment:N,waitUntil:ee,handleReplyImageChange:V,currentLightboxImage:ue,setCurrentLightboxImage:L,replyFileInputRef:B,handleRemoveReplyImage:je,replyImage:te,replyImagePreview:re,setReplyImage:se,setLightboxOpen:W})=>{const{user:u,isAuthenticated:Ie}=l.useContext(Be);Le();const[j,c]=l.useState(null),[ve,we]=l.useState(!1),[ae,oe]=l.useState({}),[ie,q]=l.useState({}),ge=()=>{c(null)},ne=u&&(t.user_id===u.id||u.is_admin);return u&&(t.user_id,u.id),e.jsxs(n,{sx:{mb:1.5},children:[e.jsxs(n,{id:`comment-${t.id}`,sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",mb:.5,px:.5},children:[e.jsx(Z,{src:t.user.photo&&t.user.photo!=="avatar.png"?`/static/uploads/avatar/${t.user.id}/${t.user.photo}`:"/static/uploads/avatar/system/avatar.png",alt:t.user.name,component:J,to:`/profile/${t.user.username}`,sx:{width:40,height:40,border:"1px solid rgba(140, 82, 255, 0.15)",mr:1,transition:"all 0.2s ease","&:hover":{borderColor:"primary.main",transform:"scale(1.05)"}},onError:o=>{o.currentTarget&&o.currentTarget.setAttribute&&o.currentTarget.setAttribute("src","/static/uploads/avatar/system/avatar.png")}}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",maxWidth:"calc(100% - 40px)"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsxs(d,{component:J,to:`/profile/${t.user.username}`,sx:{textDecoration:"none",color:"text.primary","&:hover":{color:"primary.main"},display:"flex",alignItems:"center",fontSize:"0.8rem",mr:.75},children:[t.user.name,t.user.verification&&t.user.verification.status>0&&e.jsx(Ze,{status:t.user.verification.status,size:"small"}),t.user.achievement&&e.jsx(n,{component:"img",sx:{width:12,height:12,ml:.5},src:`/static/images/bages/${t.user.achievement.image_path}`,alt:t.user.achievement.bage,onError:o=>{o.target.style.display="none"}})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.6rem"},children:Ke(t.timestamp)})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",bgcolor:"rgba(45, 45, 50, 0.5)",p:1.25,borderRadius:"18px",borderTopLeftRadius:"4px",maxWidth:"100%",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},children:[e.jsx(d,{variant:"body2",sx:{color:"text.primary",fontSize:"0.85rem",lineHeight:1.3,width:"100%",whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"break-word"},children:t.content}),t.image&&e.jsx(n,{sx:{mt:1,width:"100%"},children:e.jsxs(n,{sx:{position:"relative",borderRadius:"12px",overflow:"hidden",cursor:"pointer",width:"100%","&:hover":{"& .zoom-icon":{opacity:1}}},onClick:o=>{if(o&&o.stopPropagation(),t.image){const le=$(t.image);L(le),W(!0)}},children:[ve?e.jsx(n,{sx:{backgroundColor:"rgba(244, 67, 54, 0.1)",border:"1px solid rgba(244, 67, 54, 0.3)",borderRadius:"8px",padding:"8px",color:"#f44336",fontSize:"0.7rem",textAlign:"center"},children:e.jsx(d,{sx:{fontWeight:"bold",mb:.25,fontSize:"0.65rem"},children:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043C\u0435\u0434\u0438\u0430"})}):e.jsx("img",{src:$(t.image),alt:"Comment",style:{width:"100%",maxHeight:"160px",borderRadius:"10px",objectFit:"cover"},onError:()=>{if(t.image&&t.image.includes("/static/uploads/")&&t.image.indexOf("/static/uploads/")!==t.image.lastIndexOf("/static/uploads/")){const o=t.image.substring(t.image.lastIndexOf("/static/uploads/"));return t.image=o,void we(!1)}we(!0)}}),!ve&&e.jsx(n,{className:"zoom-icon",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"rgba(0, 0, 0, 0.5)",color:"white",borderRadius:"50%",width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",opacity:0,transition:"opacity 0.2s ease",cursor:"pointer"},children:e.jsx(Ge,{sx:{fontSize:"0.9rem"}})})]})})]}),e.jsxs(n,{sx:{display:"flex",mt:.5,alignItems:"center",ml:1},children:[e.jsxs(n,{onClick:()=>v(t.id),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 4px",borderRadius:"12px",transition:"all 0.15s ease",mr:1.5,"&:hover":{backgroundColor:"rgba(140, 82, 255, 0.08)",transform:"scale(1.05)"}},children:[t.user_liked?e.jsx(Ee,{sx:{color:"#8c52ff",fontSize:12}}):e.jsx(Ue,{sx:{color:"#757575",fontSize:12}}),e.jsx(d,{variant:"caption",sx:{ml:.5,color:t.user_liked?"#8c52ff":"text.secondary",fontSize:"0.75rem"},children:t.likes_count})]}),e.jsxs(n,{onClick:()=>{ge(),O(!0),U(t),F(null)},sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 4px",borderRadius:"12px",color:"text.secondary",transition:"all 0.15s ease","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)",color:"text.primary",transform:"scale(1.05)"}},children:[e.jsx(Ce,{sx:{fontSize:12,transform:"scaleX(-1)"}}),e.jsx(d,{variant:"caption",sx:{ml:.5,fontSize:"0.65rem"},children:"\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C"})]}),ne&&e.jsx(S,{size:"small",onClick:o=>{o.stopPropagation(),c(o.currentTarget),c({element:o.currentTarget,replyId:null,commentId:t.id})},sx:{p:.25,ml:"auto",color:"text.secondary","&:hover":{color:"text.primary"}},children:e.jsx(Ve,{sx:{fontSize:"0.85rem"}})}),e.jsx(kt,{anchorEl:j?j.element:null,open:!!j,onClose:()=>c(null),PaperProps:{sx:{backgroundColor:"#1a1a1a",minWidth:120,boxShadow:"0 3px 8px rgba(0, 0, 0, 0.3)",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.05)"}},children:j&&j.replyId?e.jsxs(Ae,{onClick:()=>{c(null),Y(j.commentId,j.replyId)},sx:{py:1,fontSize:"0.8rem","&:hover":{backgroundColor:"rgba(244, 67, 54, 0.08)"}},children:[e.jsx(Fe,{sx:{minWidth:36},children:e.jsx(ye,{sx:{color:"#f44336",fontSize:"0.9rem"}})}),e.jsx(Me,{primary:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043E\u0442\u0432\u0435\u0442",primaryTypographyProps:{sx:{color:"#f44336",fontSize:"0.8rem"}}})]}):e.jsxs(Ae,{onClick:()=>{c(null),X(t.id)},sx:{py:1,fontSize:"0.8rem","&:hover":{backgroundColor:"rgba(244, 67, 54, 0.08)"}},children:[e.jsx(Fe,{sx:{minWidth:36},children:e.jsx(ye,{sx:{color:"#f44336",fontSize:"0.9rem"}})}),e.jsx(Me,{primary:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",primaryTypographyProps:{sx:{color:"#f44336",fontSize:"0.8rem"}}})]})})]})]})]}),t.replies&&t.replies.length>0&&e.jsx(n,{sx:{mt:.5,pl:{xs:3,sm:4}},children:t.replies.map(o=>{const le=u&&(o.user_id===u.id||u.is_admin);return e.jsx(n,{sx:{mb:1,display:"flex",flexDirection:"column",alignItems:"flex-start"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",width:"100%"},children:[e.jsx(Z,{src:o.user.photo&&o.user.photo!=="avatar.png"?`/static/uploads/avatar/${o.user.id}/${o.user.photo}`:"/static/uploads/avatar/system/avatar.png",alt:o.user.name,component:J,to:`/profile/${o.user.username}`,sx:{width:35,height:35,mr:1,transition:"all 0.2s ease","&:hover":{transform:"scale(1.05)"}},onError:m=>{m.currentTarget&&m.currentTarget.setAttribute&&m.currentTarget.setAttribute("src","/static/uploads/avatar/system/avatar.png")}}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",maxWidth:"calc(100% - 30px)"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsxs(d,{component:J,to:`/profile/${o.user.username}`,sx:{textDecoration:"none",color:"text.primary","&:hover":{color:"primary.main"},display:"flex",alignItems:"center",fontSize:"0.8rem",mr:.75},children:[o.user.name,o.user.verification&&o.user.verification.status>0&&e.jsx(Ze,{status:o.user.verification.status,size:"small"})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.6rem"},children:Ke(o.timestamp)})]}),o.parent_reply_id&&!o.parent_reply&&e.jsxs(n,{sx:{bgcolor:"rgba(255, 255, 255, 0.03)",borderRadius:"8px",p:1,mb:.75,borderLeft:"2px solid rgba(140, 82, 255, 0.5)",width:"100%"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Z,{src:t.user.photo&&t.user.photo!=="avatar.png"?`/static/uploads/avatar/${t.user.id}/${t.user.photo}`:"/static/uploads/avatar/system/avatar.png",alt:t.user.name,sx:{width:16,height:16},onError:m=>{m.currentTarget&&m.currentTarget.setAttribute&&m.currentTarget.setAttribute("src","/static/uploads/avatar/system/avatar.png")}}),e.jsx(d,{variant:"caption",sx:{fontWeight:"bold",color:"text.primary",fontSize:"0.65rem"},children:t.user.name})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",mt:.25,fontSize:"0.65rem",lineHeight:1.3,whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"break-word"},children:t.content})]}),o.parent_reply_id&&o.parent_reply&&e.jsxs(n,{sx:{bgcolor:"rgba(255, 255, 255, 0.03)",borderRadius:"8px",p:1,mb:.75,borderLeft:"2px solid rgba(140, 82, 255, 0.5)",width:"100%"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Z,{src:o.parent_reply.user.photo&&o.parent_reply.user.photo!=="avatar.png"?`/static/uploads/avatar/${o.parent_reply.user.id}/${o.parent_reply.user.photo}`:"/static/uploads/avatar/system/avatar.png",alt:o.parent_reply.user.name,sx:{width:16,height:16},onError:m=>{m.currentTarget&&m.currentTarget.setAttribute&&m.currentTarget.setAttribute("src","/static/uploads/avatar/system/avatar.png")}}),e.jsx(d,{variant:"caption",sx:{fontWeight:"bold",color:"text.primary",fontSize:"0.65rem"},children:o.parent_reply.user.name})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",mt:.25,fontSize:"0.65rem",lineHeight:1.3,whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"break-word"},children:o.parent_reply.content})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",bgcolor:"rgba(45, 45, 50, 0.5)",p:1.25,borderRadius:"18px",borderTopLeftRadius:"4px",maxWidth:"100%",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},children:[e.jsx(d,{variant:"body2",sx:{color:"text.primary",fontSize:"0.85rem",lineHeight:1.3,width:"100%",whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"break-word"},children:o.content}),o.image?e.jsx(n,{sx:{mt:1,width:"100%"},children:e.jsxs(n,{sx:{position:"relative",borderRadius:"12px",overflow:"hidden",cursor:"pointer",width:"100%","&:hover":{"& .zoom-icon":{opacity:1}}},onClick:m=>{ae[o.id]||(m.stopPropagation(),W(!0),L($(ie[o.id]||o.image)))},children:[ae[o.id]?e.jsx(n,{sx:{backgroundColor:"rgba(244, 67, 54, 0.1)",border:"1px solid rgba(244, 67, 54, 0.3)",borderRadius:"8px",padding:"8px",color:"#f44336",fontSize:"0.7rem",textAlign:"center"},children:e.jsx(d,{sx:{fontWeight:"bold",mb:.25,fontSize:"0.65rem"},children:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043C\u0435\u0434\u0438\u0430"})}):e.jsx("img",{src:$(ie[o.id]||o.image),alt:"Reply",style:{width:"100%",maxHeight:"160px",borderRadius:"10px",objectFit:"cover"},onError:()=>((m,_)=>{if(_&&_.includes("/static/uploads/")&&_.indexOf("/static/uploads/")!==_.lastIndexOf("/static/uploads/")){const h=_.substring(_.lastIndexOf("/static/uploads/"));return void q(M=>({...M,[m]:h}))}const de=(h=>{if(!h)return null;if(h.includes("_fallback")){if(h.includes("_fallback1"))return h.replace("_fallback1","").replace("/static/uploads/replies/","/static/uploads/images/replies/")+"_fallback2";if(h.includes("_fallback2"))return`/static/uploads/reply/${h.replace("_fallback2","").split("/").pop()}_fallback3`}else{if(h.includes("/static/uploads/reply/"))return h.replace("/static/uploads/reply/","/static/uploads/replies/")+"_fallback1";if(!h.startsWith("/"))return"/"+h+"_fallback2"}return null})(_);de?q(h=>({...h,[m]:de})):oe(h=>({...h,[m]:!0}))})(o.id,ie[o.id]||o.image)}),!ae[o.id]&&e.jsx(n,{className:"zoom-icon",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"rgba(0, 0, 0, 0.5)",color:"white",borderRadius:"50%",width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",opacity:0,transition:"opacity 0.2s ease",cursor:"pointer"},children:e.jsx(Ge,{sx:{fontSize:"0.9rem"}})})]})}):null]}),e.jsxs(n,{sx:{display:"flex",mt:.5,alignItems:"center",ml:1},children:[e.jsxs(n,{onClick:()=>b(t.id,o.id),sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 4px",borderRadius:"12px",transition:"all 0.15s ease",mr:1.5,"&:hover":{backgroundColor:"rgba(140, 82, 255, 0.08)",transform:"scale(1.05)"}},children:[o.user_liked?e.jsx(Ee,{sx:{color:"#8c52ff",fontSize:12}}):e.jsx(Ue,{sx:{color:"#757575",fontSize:12}}),e.jsx(d,{variant:"caption",sx:{ml:.5,color:o.user_liked?"#8c52ff":"text.secondary",fontSize:"0.75rem"},children:o.likes_count})]}),e.jsxs(n,{onClick:()=>{ge(),O(!0),U(t),F(o)},sx:{display:"flex",alignItems:"center",cursor:"pointer",p:"2px 4px",borderRadius:"12px",color:"text.secondary",transition:"all 0.15s ease","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)",color:"text.primary",transform:"scale(1.05)"}},children:[e.jsx(Ce,{sx:{fontSize:12,transform:"scaleX(-1)"}}),e.jsx(d,{variant:"caption",sx:{ml:.5,fontSize:"0.65rem"},children:"\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C"})]}),le&&e.jsx(S,{size:"small",onClick:m=>{m.stopPropagation(),c(m.currentTarget),c({element:m.currentTarget,replyId:o.id,commentId:t.id})},sx:{p:.25,ml:"auto",color:"text.secondary","&:hover":{color:"text.primary"}},children:e.jsx(Ve,{sx:{fontSize:"0.85rem"}})})]})]})]})},o.id)})})]}),z&&x===t.id&&e.jsxs(n,{sx:{mt:1,ml:{xs:.5,sm:4},pl:{xs:.5,sm:2},pr:{xs:.5,sm:0},position:"relative"},children:[E||!u?.id||t.user_id!==u?.id?e.jsx(n,{sx:{display:"flex",alignItems:"center",mb:1,pl:.5},children:e.jsxs(n,{sx:{bgcolor:"rgba(140, 82, 255, 0.08)",borderRadius:"8px",py:.75,px:1,fontSize:"0.7rem",color:"primary.main",lineHeight:1.2,display:"flex",alignItems:"center",maxWidth:"100%"},children:[e.jsx(Ce,{sx:{fontSize:14,mr:.5,transform:"scaleX(-1)"}}),e.jsxs(n,{component:"span",sx:{display:"inline-flex",fontWeight:"medium",whiteSpace:"nowrap"},children:["\u041E\u0442\u0432\u0435\u0442 \u0434\u043B\u044F ",E?E.user.name:t.user.name]}),e.jsx(S,{size:"small",onClick:()=>{F(null)},sx:{p:.25,ml:.5,color:"text.secondary","&:hover":{color:"text.primary"}},children:e.jsx(me,{sx:{fontSize:"0.7rem"}})})]})}):null,e.jsx(Se,{fullWidth:!0,size:"small",placeholder:"\u041D\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u043E\u0442\u0432\u0435\u0442...",value:H,onChange:o=>D(o.target.value),disabled:N||Date.now()<ee,InputProps:{startAdornment:e.jsx(n,{component:"span",sx:{mr:.75},children:e.jsx(Z,{src:u?.photo&&u.photo!=="avatar.png"?`/static/uploads/avatar/${u.id}/${u.photo}`:"/static/uploads/avatar/system/avatar.png",alt:u?.name,sx:{width:30,height:30}})}),endAdornment:e.jsxs(n,{sx:{display:"flex",gap:.5},children:[e.jsx("input",{ref:B,type:"file",accept:"image/*",style:{display:"none"},onChange:V,disabled:N||Date.now()<ee}),e.jsx(S,{size:"small",onClick:()=>B.current.click(),disabled:N||Date.now()<ee,sx:{padding:"4px"},children:e.jsx(Qe,{fontSize:"small",sx:{fontSize:"1.1rem"}})}),e.jsx(S,{size:"small",color:"primary",onClick:()=>y(t.id,E?.id),disabled:!H.trim()&&!te||N||Date.now()<ee,sx:{padding:"4px"},children:N?e.jsx(ce,{size:16,color:"inherit"}):e.jsx(Ne,{fontSize:"small",sx:{fontSize:"1.1rem"}})}),e.jsx(S,{size:"small",onClick:()=>{O(!1),U(null),F(null),setReplyText(""),se(null),setReplyImagePreview("")},sx:{color:"text.secondary",padding:"4px"},children:e.jsx(me,{fontSize:"small",sx:{fontSize:"0.9rem"}})})]}),sx:{bgcolor:"rgba(28, 28, 32, 0.3)",backdropFilter:"blur(5px)",borderRadius:"30px",border:"1px solid rgba(255, 255, 255, 0.05)","& .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(140, 82, 255, 0.2)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(140, 82, 255, 0.4)"},"& input":{padding:"12px 5px",fontSize:"0.9rem"}}}}),re&&e.jsxs(n,{sx:{mt:1,position:"relative",borderRadius:"16px",overflow:"hidden"},children:[e.jsx("img",{src:re,alt:"Preview",style:{width:"100%",maxHeight:"120px",objectFit:"cover"}}),e.jsx(S,{size:"small",onClick:je,sx:{position:"absolute",top:6,right:6,bgcolor:"rgba(0, 0, 0, 0.6)",padding:"3px","&:hover":{bgcolor:"rgba(0, 0, 0, 0.8)"}},children:e.jsx(me,{fontSize:"small",sx:{fontSize:"0.8rem",color:"white"}})})]})]})]})},Wt=Ct.forwardRef(function(t,v){return e.jsx(yt,{direction:"up",ref:v,...t})}),At=({isOverlay:t=!1})=>{const{postId:v}=St(),{user:b,isAuthenticated:R}=l.useContext(Be),z=Le(),[x,H]=l.useState(null),[D,y]=l.useState([]),[E,F]=l.useState(!0),[O,U]=l.useState(""),[X,Y]=l.useState(""),[N,ee]=l.useState(null),[V,ue]=l.useState(null),[L,B]=l.useState(null),[je,te]=l.useState(""),[re,se]=l.useState(""),W=l.useRef(null),u=l.useRef(null),Ie=l.useRef(null),[j,c]=l.useState({open:!1,message:"",severity:"success"}),[ve,we]=l.useState(null),[ae,oe]=l.useState(!1),[ie,q]=l.useState(null),[ge,ne]=l.useState(null),[o,le]=l.useState(0),[m,_]=l.useState(""),[de,h]=l.useState(!1),[M,he]=l.useState(!1),[Re,k]=l.useState(""),[ze,_e]=l.useState(0),[A,be]=l.useState(0),[T,G]=l.useState({open:!1,deleting:!1,deleted:!1,commentId:null}),[I,K]=l.useState({open:!1,deleting:!1,deleted:!1,commentId:null,replyId:null}),{overlayOpen:Ft,closePostDetail:Ye}=Rt(),et=gt(),Te=ht(et.breakpoints.down("md")),$e=l.useRef(!1);l.useEffect(()=>{(async()=>{try{F(!0);const a=await C.get(`/api/posts/${v}`);if(H(a.data.post),a.data.comments&&a.data.comments.length>0){const r=a.data.comments.map(i=>(i.image&&(i.image=$(i.image)),i.replies&&i.replies.length>0&&(i.replies=i.replies.map(s=>(s.image&&(s.image=$(s.image)),s))),i));y(r)}else y([]);a.data.comments&&a.data.comments.some(r=>r.replies&&r.replies.some(i=>i.image)),a.data.comments&&a.data.comments.flatMap(r=>r.replies||[]).find(r=>r.image),a.data.comments&&a.data.comments.reduce((r,i)=>r+(i.replies?i.replies.length:0),0),F(!1),$e.current||(tt(v),$e.current=!0)}catch{F(!1)}})()},[v,z]);const tt=async a=>{try{const r=`post_viewed_${a}`;if(sessionStorage.getItem(r))return;sessionStorage.setItem(r,"true");const i=await C.post(`/api/posts/${a}/view`);i.data&&i.data.success&&H(s=>s?{...s,views_count:i.data.views_count}:null)}catch{const i=async(s=2)=>{if(!(s<=0))try{const p=await C.post(`/api/posts/${a}/view`);p.data&&p.data.success&&H(g=>g?{...g,views_count:p.data.views_count}:null)}catch{setTimeout(()=>i(s-1),1e3)}};setTimeout(()=>i(),1e3)}},rt=a=>{const r=a.target.files[0];if(r&&r.type.startsWith("image/")){ue(r);const i=new FileReader;i.onloadend=()=>{typeof i.result=="string"&&se(i.result)},i.readAsDataURL(r)}},st=()=>{ue(null),se(""),W.current&&(W.current.value="")},at=a=>{const r=a.target.files[0];if(r&&r.type.startsWith("image/")){B(r);const i=new FileReader;i.onloadend=()=>{typeof i.result=="string"&&te(i.result)},i.readAsDataURL(r)}},ot=()=>{B(null),te(""),u.current&&(u.current.value="")},it=async()=>{if(!O.trim()&&!V||!Q(b,R,z))return;const a=Date.now();if(a<A){const r=Math.ceil((A-a)/1e3);return k(`\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435 ${r} \u0441\u0435\u043A. \u043F\u0435\u0440\u0435\u0434 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u043E\u0439 \u043D\u043E\u0432\u043E\u0433\u043E \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F`),void c({open:!0,message:`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0447\u0430\u0441\u0442\u0430\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432. \u041F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435 ${r} \u0441\u0435\u043A.`,severity:"warning"})}if(a-ze<3e3)return k("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043D\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0447\u0430\u0441\u0442\u043E"),void c({open:!0,message:"\u041D\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0447\u0430\u0441\u0442\u043E",severity:"warning"});try{let r;if(he(!0),k(""),V){const s=new FormData;s.append("content",O.trim()),s.append("image",V),r=await C.post(`/api/posts/${v}/comments`,s,{headers:{"Content-Type":"multipart/form-data"}})}else r=await C.post(`/api/posts/${v}/comments`,{content:O.trim()},{headers:{"Content-Type":"application/json"}});const i=r.data.comment;i&&i.image&&(i.image=$(i.image)),y(s=>[i,...s]),U(""),ue(null),se(""),W.current&&(W.current.value=""),c({open:!0,message:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D",severity:"success"}),_e(Date.now())}catch(r){if(r.response&&r.response.status===429){const i=r.response.data.rate_limit;let s="\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043B\u0438\u043C\u0438\u0442 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432. ";if(i&&i.reset){const p=new Date(1e3*i.reset),g=new Date,f=Math.round((p-g)/1e3);s+=f>60?`\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0447\u0435\u0440\u0435\u0437 ${Math.floor(f/60)} \u043C\u0438\u043D. ${f%60} \u0441\u0435\u043A.`:`\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0447\u0435\u0440\u0435\u0437 ${f} \u0441\u0435\u043A.`,be(g.getTime()+1e3*f)}else s+="\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u043F\u044B\u0442\u043A\u0443 \u043F\u043E\u0437\u0436\u0435.",be(Date.now()+3e4);k(s),c({open:!0,message:s,severity:"error"})}else r.response&&r.response.data&&r.response.data.error?(k(r.response.data.error),c({open:!0,message:r.response.data.error,severity:"error"})):(k("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0438 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F"),c({open:!0,message:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0438 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F",severity:"error"}))}finally{he(!1)}},nt=async(a,r=null)=>{if(!X.trim()&&!L||!Q(b,R,z))return;const i=Date.now();if(i<A){const s=Math.ceil((A-i)/1e3);return k(`\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435 ${s} \u0441\u0435\u043A. \u043F\u0435\u0440\u0435\u0434 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u043E\u0439 \u043D\u043E\u0432\u043E\u0433\u043E \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F`),void c({open:!0,message:`\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u0447\u0430\u0441\u0442\u0430\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432. \u041F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435 ${s} \u0441\u0435\u043A.`,severity:"warning"})}if(i-ze<3e3)return k("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043D\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0447\u0430\u0441\u0442\u043E"),void c({open:!0,message:"\u041D\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0447\u0430\u0441\u0442\u043E",severity:"warning"});try{let s;if(he(!0),k(""),L){const p=new FormData;p.append("content",X.trim()),p.append("image",L),r&&p.append("parent_reply_id",r),s=await C.post(`/api/comments/${a}/replies`,p,{headers:{"Content-Type":"multipart/form-data"}})}else s=await C.post(`/api/comments/${a}/replies`,{content:X.trim(),parent_reply_id:r},{headers:{"Content-Type":"application/json"}});s.data.reply&&s.data.reply.image&&(s.data.reply.image=$(s.data.reply.image)),s.data.reply,y(p=>p.map(g=>g.id===a?{...g,replies:[...g.replies||[],s.data.reply]}:g)),Y(""),oe(!1),q(null),ne(null),B(null),te(""),u.current&&(u.current.value=""),c({open:!0,message:"\u041E\u0442\u0432\u0435\u0442 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D",severity:"success"}),_e(Date.now())}catch(s){if(s.response&&s.response.status===429){const p=s.response.data.rate_limit;let g="\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043B\u0438\u043C\u0438\u0442 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432. ";if(p&&p.reset){const f=new Date(1e3*p.reset),w=new Date,pe=Math.round((f-w)/1e3);g+=pe>60?`\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0447\u0435\u0440\u0435\u0437 ${Math.floor(pe/60)} \u043C\u0438\u043D. ${pe%60} \u0441\u0435\u043A.`:`\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043C\u043E\u0436\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0447\u0435\u0440\u0435\u0437 ${pe} \u0441\u0435\u043A.`,be(w.getTime()+1e3*pe)}else g+="\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u043F\u044B\u0442\u043A\u0443 \u043F\u043E\u0437\u0436\u0435.",be(Date.now()+3e4);k(g),c({open:!0,message:g,severity:"error"})}else s.response&&s.response.data&&s.response.data.error?(k(s.response.data.error),c({open:!0,message:s.response.data.error,severity:"error"})):(k("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0438 \u043E\u0442\u0432\u0435\u0442\u0430"),c({open:!0,message:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0438 \u043E\u0442\u0432\u0435\u0442\u0430",severity:"error"}))}finally{he(!1)}},lt=async a=>{if(Q(b,R,z))try{y(i=>i.map(s=>s.id===a?{...s,user_liked:!s.user_liked,likes_count:s.user_liked?Math.max(0,s.likes_count-1):s.likes_count+1}:s));const r=await C.post(`/api/comments/${a}/like`);y(i=>i.map(s=>s.id===a?{...s,user_liked:r.data.liked,likes_count:r.data.likes_count}:s))}catch{y(i=>[...i])}},dt=a=>{Q(b,R,z)&&G({open:!0,deleting:!1,deleted:!1,commentId:a})},pt=async()=>{try{G(r=>({...r,deleting:!0}));const a=JSON.parse(JSON.stringify(D.filter(r=>r.id!==T.commentId)));y(a),G(r=>({...r,deleted:!0,deleting:!1})),await C.post(`/api/comments/${T.commentId}/delete`),setTimeout(()=>{G(r=>({...r,open:!1}))},1500)}catch{c({open:!0,message:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F",severity:"error"})}},ct=(a,r)=>{Q(b,R,z)&&K({open:!0,deleting:!1,deleted:!1,commentId:a,replyId:r})},mt=async()=>{try{K(r=>({...r,deleting:!0}));const a=D.map(r=>r.id!==I.commentId?{...r}:{...r,replies:r.replies.filter(i=>i.id!==I.replyId)});y(a),K(r=>({...r,deleted:!0,deleting:!1})),await C.post(`/api/replies/${I.replyId}/delete`),setTimeout(()=>{K(r=>({...r,open:!1}))},1500)}catch{c({open:!0,message:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u043E\u0442\u0432\u0435\u0442\u0430",severity:"error"});try{const r=await C.get(`/api/posts/${v}`);if(r.data.comments){const i=r.data.comments.map(s=>(s.image&&(s.image=$(s.image)),s.replies&&s.replies.length>0&&(s.replies=s.replies.map(p=>(p.image&&(p.image=$(p.image)),p))),s));y(i)}}catch{}}},De=()=>{Ye()},Oe=()=>e.jsxs(jt,{maxWidth:"md",sx:{pt:2,pb:10,px:{xs:0,sm:0}},children:[de&&e.jsx($t,{isOpen:de,onClose:()=>{h(!1),_(null)},images:m?[m]:x?.images||[],initialIndex:0}),x&&e.jsx(zt,{title:`${x.user?.name||"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C"} - ${x.content.substring(0,60)}${x.content.length>60?"...":""}`,description:x.content.substring(0,160),image:x.images&&Array.isArray(x.images)&&x.images.length>0?typeof x.images[0]=="string"&&x.images[0].startsWith("http")?x.images[0]:`/static/uploads/posts/${x.images[0]}`:null,type:"article",meta:{author:x.user?.name,publishedTime:x.created_at,modifiedTime:x.updated_at}}),!t&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:{xs:2,sm:3},px:{xs:2,sm:0}},children:[e.jsx(S,{component:J,to:"/",sx:{mr:1},"aria-label":"\u041D\u0430\u0437\u0430\u0434",children:e.jsx(Xe,{})}),e.jsx(d,{variant:"h5",sx:{fontSize:{xs:"1.2rem",sm:"1.5rem"}},children:"\u041F\u043E\u0441\u0442"})]}),x&&e.jsx(_t,{post:x,onDelete:()=>z("/"),onOpenLightbox:a=>{if(h(!0),Array.isArray(x.images)){const r=x.images.indexOf(a);r!==-1&&le(r)}}}),e.jsxs(n,{sx:{px:{xs:2,sm:0},mb:2},children:[e.jsx(d,{variant:"h6",sx:{mb:{xs:2,sm:2.5},display:"flex",alignItems:"center",justifyContent:"space-between",fontWeight:600,color:"text.primary",fontSize:{xs:"0.95rem",sm:"1.1rem"},letterSpacing:"0.01em"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.75},children:[e.jsx(qe,{sx:{fontSize:{xs:18,sm:20}}}),"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 (",x?.total_comments_count||(D?D.length:0),")"]})}),b?e.jsxs(n,{sx:{mb:3},children:[Re&&e.jsx(We,{severity:"error",sx:{mb:2},onClose:()=>k(""),children:Re}),e.jsx(Se,{ref:Ie,fullWidth:!0,size:"small",placeholder:"\u041D\u0430\u043F\u0438\u0441\u0430\u0442\u044C \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439...",value:O,onChange:a=>U(a.target.value),disabled:M||Date.now()<A,InputProps:{startAdornment:e.jsx(n,{component:"span",sx:{mr:.75},children:e.jsx(Z,{src:b?.photo&&b.photo!=="avatar.png"?`/static/uploads/avatar/${b.id}/${b.photo}`:"/static/uploads/avatar/system/avatar.png",alt:b?.name,sx:{width:30,height:30}})}),endAdornment:e.jsxs(n,{sx:{display:"flex",gap:.5},children:[e.jsx("input",{ref:W,type:"file",accept:"image/*",style:{display:"none"},onChange:rt,disabled:M||Date.now()<A}),e.jsx(S,{size:"small",onClick:()=>W.current.click(),disabled:M||Date.now()<A,sx:{padding:"4px"},children:e.jsx(Qe,{fontSize:"small",sx:{fontSize:"1.1rem"}})}),e.jsx(S,{size:"small",color:"primary",onClick:it,disabled:!O.trim()&&!V||M||Date.now()<A,sx:{padding:"4px"},children:M?e.jsx(ce,{size:16,color:"inherit"}):e.jsx(Ne,{fontSize:"small",sx:{fontSize:"1.1rem"}})})]}),sx:{bgcolor:"rgba(28, 28, 32, 0.3)",backdropFilter:"blur(5px)",borderRadius:"30px",border:"1px solid rgba(255, 255, 255, 0.05)","& .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(140, 82, 255, 0.2)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(140, 82, 255, 0.4)"},"& input":{padding:"12px 5px",fontSize:"0.9rem"}}}}),re&&e.jsxs(n,{sx:{mt:1,position:"relative",borderRadius:"16px",overflow:"hidden"},children:[e.jsx("img",{src:re,alt:"Preview",style:{width:"100%",maxHeight:"150px",objectFit:"cover",borderRadius:"12px"}}),e.jsx(S,{size:"small",onClick:st,sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(0, 0, 0, 0.6)",padding:"3px","&:hover":{bgcolor:"rgba(0, 0, 0, 0.8)"}},children:e.jsx(me,{fontSize:"small",sx:{fontSize:"0.8rem",color:"white"}})})]})]}):e.jsx(n,{sx:{mb:3},children:e.jsxs(d,{variant:"body2",color:"text.secondary",align:"center",sx:{py:2,bgcolor:"rgba(28, 28, 32, 0.3)",borderRadius:"14px",border:"1px solid rgba(255, 255, 255, 0.03)"},children:[e.jsx(vt,{component:J,to:"/login",sx:{color:"primary.main",textDecoration:"none",fontWeight:"bold","&:hover":{textDecoration:"underline"}},children:"\u0412\u043E\u0439\u0434\u0438\u0442\u0435"}),", \u0447\u0442\u043E\u0431\u044B \u043E\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439"]})}),E?e.jsx(n,{sx:{display:"flex",justifyContent:"center",my:{xs:2,sm:3}},children:e.jsx(ce,{size:30,thickness:4})}):D&&D.length>0?e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:{xs:.5,sm:.5}},children:D.map(a=>e.jsx(Ot,{comment:a,onLike:lt,onLikeReply:r=>(async(i,s)=>{if(Q(b,R,z))try{y(g=>g.map(f=>f.id===i?{...f,replies:f.replies.map(w=>w.id===s?{...w,user_liked:!w.user_liked,likes_count:w.user_liked?Math.max(0,w.likes_count-1):w.likes_count+1}:w)}:f));const p=await C.post(`/api/replies/${s}/like`);y(g=>g.map(f=>f.id===i?{...f,replies:f.replies.map(w=>w.id===s?{...w,user_liked:p.data.liked,likes_count:p.data.likes_count}:w)}:f))}catch{y(g=>[...g])}})(a.id,r),onReply:(r,i)=>{q(i?{id:i}:r),oe(!0),Y(""),ne(r.id!==a.id?r:null)},isReplyFormOpen:ae,activeCommentId:ie?.id,replyText:X,onReplyTextChange:Y,onReplySubmit:nt,replyingToReply:ge,setReplyingToReply:ne,setReplyFormOpen:oe,setActiveComment:q,onDeleteComment:dt,onDeleteReply:ct,isSubmittingComment:M,waitUntil:A,handleReplyImageChange:at,currentLightboxImage:m,setCurrentLightboxImage:_,replyFileInputRef:u,handleRemoveReplyImage:ot,replyImage:L,replyImagePreview:je,setReplyImage:B,setLightboxOpen:h},a.id))}):e.jsxs(n,{sx:{p:{xs:3,sm:4},textAlign:"center",bgcolor:"rgba(28, 28, 32, 0.3)",borderRadius:"20px",border:"1px dashed rgba(255, 255, 255, 0.08)",backdropFilter:"blur(10px)"},children:[e.jsx(qe,{sx:{fontSize:{xs:28,sm:32},color:"text.secondary",mb:{xs:1,sm:1.5},opacity:.5}}),e.jsx(d,{variant:"body1",color:"text.secondary",sx:{fontSize:{xs:"0.85rem",sm:"0.9rem"}},children:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442. \u0411\u0443\u0434\u044C\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u043C!"})]})]}),e.jsx(wt,{open:j.open,autoHideDuration:4e3,onClose:()=>c(a=>({...a,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(We,{onClose:()=>c(a=>({...a,open:!1})),severity:j.severity==="success"||j.severity==="error"||j.severity==="warning"||j.severity==="info"?j.severity:"success",variant:"filled",children:j.message})}),e.jsx(ke,{open:T.open,onClose:()=>!T.deleting&&!T.deleted&&G(a=>({...a,open:!1})),PaperProps:{sx:{bgcolor:"rgba(32, 32, 36, 0.8)",backdropFilter:"blur(20px)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.2)",width:"100%",maxWidth:"400px",borderRadius:"16px",border:"1px solid rgba(100, 90, 140, 0.1)","&:before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"16px",background:"linear-gradient(145deg, rgba(30, 30, 30, 0.6), rgba(20, 20, 20, 0.75))",backdropFilter:"blur(30px)",zIndex:-1}}},children:e.jsx(n,{sx:{p:3},children:T.deleted?e.jsx(e.Fragment,{children:e.jsxs(n,{sx:{textAlign:"center",py:2},children:[e.jsx(He,{sx:{fontSize:56,color:"#4CAF50",mb:2}}),e.jsx(d,{variant:"h6",sx:{mb:1,color:"white"},children:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u0443\u0434\u0430\u043B\u0435\u043D"}),e.jsx(d,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u0431\u044B\u043B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"h6",sx:{mb:2,color:"#f44336",fontWeight:"medium",display:"flex",alignItems:"center"},children:[e.jsx(ye,{sx:{mr:1}})," \u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F"]}),e.jsx(d,{sx:{mb:3,color:"rgba(255, 255, 255, 0.7)"},children:"\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439? \u042D\u0442\u043E \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043D\u0435\u043B\u044C\u0437\u044F \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C."}),e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(fe,{onClick:()=>G(a=>({...a,open:!1})),disabled:T.deleting,sx:{borderRadius:"10px",color:"rgba(255, 255, 255, 0.7)",px:2,"&:hover":{bgcolor:"rgba(255, 255, 255, 0.08)",color:"rgba(255, 255, 255, 0.9)"}},children:"\u041E\u0442\u043C\u0435\u043D\u0430"}),e.jsx(fe,{onClick:pt,disabled:T.deleting,variant:"contained",color:"error",sx:{borderRadius:"10px",boxShadow:"none",px:2},endIcon:T.deleting?e.jsx(ce,{size:16,color:"inherit"}):null,children:T.deleting?"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435...":"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"})]})]})})}),e.jsx(ke,{open:I.open,onClose:()=>!I.deleting&&!I.deleted&&K(a=>({...a,open:!1})),PaperProps:{sx:{bgcolor:"rgba(32, 32, 36, 0.8)",backdropFilter:"blur(20px)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.2)",width:"100%",maxWidth:"400px",borderRadius:"16px",border:"1px solid rgba(100, 90, 140, 0.1)","&:before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"16px",background:"linear-gradient(145deg, rgba(30, 30, 30, 0.6), rgba(20, 20, 20, 0.75))",backdropFilter:"blur(30px)",zIndex:-1}}},children:e.jsx(n,{sx:{p:3},children:I.deleted?e.jsx(e.Fragment,{children:e.jsxs(n,{sx:{textAlign:"center",py:2},children:[e.jsx(He,{sx:{fontSize:56,color:"#4CAF50",mb:2}}),e.jsx(d,{variant:"h6",sx:{mb:1,color:"white"},children:"\u041E\u0442\u0432\u0435\u0442 \u0443\u0434\u0430\u043B\u0435\u043D"}),e.jsx(d,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"\u041E\u0442\u0432\u0435\u0442 \u0431\u044B\u043B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"h6",sx:{mb:2,color:"#f44336",fontWeight:"medium",display:"flex",alignItems:"center"},children:[e.jsx(ye,{sx:{mr:1}})," \u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u043E\u0442\u0432\u0435\u0442\u0430"]}),e.jsx(d,{sx:{mb:3,color:"rgba(255, 255, 255, 0.7)"},children:"\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u043E\u0442\u0432\u0435\u0442? \u042D\u0442\u043E \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043D\u0435\u043B\u044C\u0437\u044F \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C."}),e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(fe,{onClick:()=>K(a=>({...a,open:!1})),disabled:I.deleting,sx:{borderRadius:"10px",color:"rgba(255, 255, 255, 0.7)",px:2,"&:hover":{bgcolor:"rgba(255, 255, 255, 0.08)",color:"rgba(255, 255, 255, 0.9)"}},children:"\u041E\u0442\u043C\u0435\u043D\u0430"}),e.jsx(fe,{onClick:mt,disabled:I.deleting,variant:"contained",color:"error",sx:{borderRadius:"10px",boxShadow:"none",px:2},endIcon:I.deleting?e.jsx(ce,{size:16,color:"inherit"}):null,children:I.deleting?"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435...":"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"})]})]})})})]});return t?e.jsxs(ke,{fullScreen:Te,open:!0,onClose:De,TransitionComponent:Wt,keepMounted:!1,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.95)",backgroundImage:"none"}},PaperProps:{sx:{bgcolor:"#0a0a0a",backgroundImage:"none",maxWidth:"100%",maxHeight:"100%",borderRadius:{xs:0,sm:2}}},sx:{"& .MuiDialog-paper":{width:{sm:"100%",md:"90%",lg:"55%"},height:{xs:"100%",sm:"90vh"},maxWidth:1e3,m:{xs:0,sm:2},backgroundColor:"#0a0a0a",backgroundImage:"none !important"},"& .MuiBackdrop-root":{backgroundColor:"#000000 !important",backgroundImage:"none !important",opacity:"0.95 !important"},"& .MuiModal-backdrop":{backgroundColor:"#000000 !important",backgroundImage:"none !important"}},children:[e.jsx(bt,{sx:{position:"relative",backgroundColor:"#0a0a0a",backgroundImage:"none",boxShadow:"none",borderBottom:"1px solid",borderColor:"rgba(255, 255, 255, 0.1)"},children:e.jsxs(ft,{children:[e.jsx(S,{edge:"start",color:"inherit",onClick:De,"aria-label":"close",children:Te?e.jsx(Xe,{}):e.jsx(me,{})}),e.jsx(d,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"\u041F\u043E\u0441\u0442"})]})}),e.jsx(n,{sx:{overflow:"auto",height:"100%",px:0,backgroundColor:"#0a0a0a",backgroundImage:"none"},children:Oe()})]}):Oe()};export{At as default};
