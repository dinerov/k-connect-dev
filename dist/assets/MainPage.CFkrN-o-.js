import{j as e,a0 as ke,s as j,p as Se,k as X,i as o,T as h,w as Q,a8 as Ce,C as Z,a6 as ze,r as Re,a as _e,h as We,P as ie,l as O,o as ne,V as Ie,b as Ae,A as le,af as pe,D as De,ag as Pe,ah as Fe,aj as Te}from"./vendor-mui.08p3AH88.js";import{u as ee,r as s,a as xe}from"./vendor-router.BRqU_Zs2.js";import{A as re,k as ge,R as $e,F as Ee,r as Be,i as W,P as Me,D as Oe}from"./index.CdVNWeFt.js";import{C as de}from"./Close.BG2YHWMj.js";import{R as he,P as He}from"./Post.MP7_w9C7.js";import{a as Le}from"./vendor.CL98q8z6.js";import{b as me}from"./dateUtils.JaLtthGQ.js";import{M as Ue}from"./MoreVert.C0-1U5Ci.js";import{C as Ge,S as Ve}from"./SimpleImageViewer.DCWkQqHX.js";import{M as te}from"./MusicNote.D4Jp3FIY.js";import{P as ue}from"./PlayArrow.GqmCGL4o.js";import{P as ce}from"./Pause.r8mC42rq.js";import"./TransferMenu.2g5UFehs.js";import{V as be}from"./index.CJUnh1z7.js";import{P as Xe,I as fe,M as Ye}from"./PostSkeleton.NxbnrqQw.js";import{g as Je}from"./vendor-react.DF-_cTkv.js";import{U as Ne,a as Qe}from"./UpdateService.CDVnacP6.js";import"./Link.BmVIpf9S.js";import"./Delete.C47j6PO2.js";import"./Share.BKyVThZF.js";import"./imageUtils.BkCfy0de.js";import"./Visibility.Bq_lujd_.js";import"./Edit.6-hI7nty.js";import"./Photo.tXKr-C4h.js";import"./thumbnails.CEJMDkxh.js";import"./History.BL_2VNvs.js";import"./Save.D4JlNQm5.js";import"./Person.B_G_dVGx.js";import"./Send.DjUSpM3V.js";import"./NewReleases.BImcOub6.js";import"./CheckCircleOutline.BwTcCiBO.js";import"./BugReport.CJI6Qv1X.js";import"./Update.8QfFEnRq.js";import"./ArrowForward.BKNSZeDS.js";const qe=j(Z)(({theme:r,background:p})=>({marginBottom:"4px",borderRadius:"12px",backgroundColor:"#1E1E1E",backgroundImage:p?`linear-gradient(rgba(120, 100, 160, 0.03), rgba(20, 20, 20, 0.95)), url(${p})`:"linear-gradient(145deg, rgba(30, 30, 30, 0.97), rgba(26, 26, 26, 0.99))",backgroundSize:"cover",backgroundPosition:"center",backgroundBlendMode:"overlay",backdropFilter:"blur(15px)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",position:"relative",overflow:"visible",cursor:"pointer",transition:"opacity 0.3s ease","&:before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"12px",background:"rgba(100, 90, 140, 0.02)",backdropFilter:"blur(10px)",zIndex:0}})),Ke=j(o)(({theme:r})=>({position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"12px",background:"linear-gradient(145deg, rgba(30, 30, 30, 0.9), rgba(26, 26, 26, 0.97))",backdropFilter:"blur(15px)",zIndex:0})),Ze=j(o)(({theme:r})=>({padding:r.spacing(2),borderRadius:"8px",backgroundColor:"rgba(42, 42, 42, 0.8)",backdropFilter:"blur(5px)",marginTop:r.spacing(2),border:"1px solid rgba(255, 255, 255, 0.05)"})),ye=j(o)(({theme:r})=>({display:"flex",alignItems:"center",marginBottom:r.spacing(1),position:"relative",zIndex:1})),je=j(o)(({theme:r})=>({position:"relative",zIndex:1,"& p":{margin:0,marginBottom:r.spacing(1),wordBreak:"break-word"},"& p:last-child":{marginBottom:0},"& img":{maxWidth:"100%",borderRadius:"8px",marginTop:r.spacing(1),marginBottom:r.spacing(1)},"& a":{color:r.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},"& h1, & h2, & h3, & h4, & h5, & h6":{marginTop:r.spacing(2),marginBottom:r.spacing(1)},"& ul, & ol":{paddingLeft:r.spacing(2)}})),er=j(ze)(({theme:r})=>({"& .MuiPaper-root":{backgroundColor:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.05)",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.2)","& .MuiMenuItem-root":{"&:hover":{backgroundColor:"rgba(100, 90, 140, 0.1)"}}}})),rr=j(o)(({theme:r})=>({display:"flex",alignItems:"center",padding:r.spacing(1,1.5),borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 0.07)",marginBottom:r.spacing(1),marginTop:r.spacing(1),border:"1px solid rgba(255, 255, 255, 0.07)",transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)",transform:"translateY(-2px)",boxShadow:"0 3px 6px rgba(0, 0, 0, 0.15)"}})),tr=({repost:r,onDelete:p,onOpenLightbox:g})=>{const m=ee(),{user:y}=s.useContext(re),{playTrack:R,currentTrack:x,isPlaying:f,togglePlay:u}=s.useContext(ge),[F,_]=s.useState(null),[P,I]=s.useState(!1),T=s.useRef(null),[S,A]=s.useState([]),d=r.original_post,b=[];d.images&&Array.isArray(d.images)?b.push(...d.images):d.image&&b.push(d.image),xe.useEffect(()=>{if(d.music)try{const c=typeof d.music=="string"?JSON.parse(d.music):d.music;A(Array.isArray(c)?c:[])}catch{A([])}else A([])},[d]);const C=()=>{_(null)},w=r.user?.avatar_url||null;return e.jsx(ke,{in:!P,timeout:300,children:e.jsxs(qe,{ref:T,onClick:c=>{c.target.closest("button")||c.target.closest(".MuiIconButton-root")||m(`/post/${d.id}`)},background:w,sx:{opacity:P?0:1,transform:P?"translateY(10px)":"none"},children:[e.jsx(Ke,{}),e.jsxs(Se,{sx:{position:"relative",zIndex:1},children:[e.jsxs(ye,{children:[e.jsx(X,{src:r.user.avatar_url,alt:r.user.name,sx:{width:40,height:40,mr:1.5}}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(h,{variant:"body1",sx:{fontWeight:"medium",mr:.5},children:r.user.name}),e.jsx(be,{status:r.user.verification,size:"small"}),e.jsxs(h,{variant:"body2",color:"text.secondary",sx:{ml:.5},children:["@",r.user.username]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx($e,{fontSize:"small",sx:{color:"text.secondary",mr:.5}}),e.jsxs(h,{variant:"body2",color:"text.secondary",children:["\u041F\u043E\u0434\u0435\u043B\u0438\u043B\u0441\u044F \u043F\u043E\u0441\u0442\u043E\u043C \u2022 ",me(r.timestamp)]})]})]}),y&&y.id===r.user.id&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:"small",onClick:c=>{c.stopPropagation(),_(c.currentTarget)},sx:{ml:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:e.jsx(Ue,{fontSize:"small"})}),e.jsx(er,{anchorEl:F,open:!!F,onClose:C,onClick:c=>c.stopPropagation(),children:e.jsx(Ce,{onClick:async()=>{C(),I(!0);try{const c=await Le.delete(`/api/reposts/${r.id}`);c.data&&c.data.success&&setTimeout(()=>{p&&p(`repost-${r.id}`)},300)}catch{I(!1)}},children:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0440\u0435\u043F\u043E\u0441\u0442"})})]})]}),r.repost_text&&e.jsx(je,{sx:{mb:2},children:e.jsx(h,{variant:"body1",sx:{mb:1.5,fontSize:"0.95rem",lineHeight:1.5},children:e.jsx(he,{transformLinkUri:null,children:r.repost_text})})}),e.jsxs(Ze,{children:[e.jsxs(ye,{children:[e.jsx(X,{src:d.user.avatar_url,alt:d.user.name,sx:{width:32,height:32,mr:1}}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(h,{variant:"body2",sx:{fontWeight:"medium",mr:.5},children:d.user.name}),e.jsx(be,{status:d.user.verification,size:"small"}),e.jsxs(h,{variant:"caption",color:"text.secondary",sx:{ml:.5},children:["@",d.user.username]})]}),e.jsx(h,{variant:"caption",color:"text.secondary",children:me(d.timestamp)})]})]}),e.jsx(je,{children:e.jsx(h,{variant:"body1",sx:{fontSize:"0.9rem",lineHeight:1.5,color:"rgba(255, 255, 255, 0.8)"},children:e.jsx(he,{transformLinkUri:null,children:d.content})})}),S.length>0&&e.jsxs(o,{sx:{mt:1,mb:1},children:[S.slice(0,2).map((c,D)=>e.jsxs(rr,{onClick:k=>((L,$)=>{$.stopPropagation(),x&&x.id===L.id?u():R(L)})(c,k),sx:{cursor:"pointer"},children:[e.jsxs(o,{sx:{width:28,height:28,borderRadius:"6px",overflow:"hidden",position:"relative",mr:1.5,flexShrink:0,bgcolor:"rgba(0, 0, 0, 0.2)",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("img",{src:c.cover_path?c.cover_path.startsWith("/static/")?c.cover_path:c.cover_path.startsWith("static/")?`/${c.cover_path}`:c.cover_path.startsWith("http")?c.cover_path:`/static/music/${c.cover_path}`:"/uploads/system/album_placeholder.jpg",alt:c.title,style:{width:"100%",height:"100%",objectFit:"cover"},onError:k=>{k.target.src="/uploads/system/album_placeholder.jpg"}}),e.jsx(o,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(145deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.3))",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(te,{sx:{fontSize:14,color:"rgba(255, 255, 255, 0.9)",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}})})]}),e.jsxs(o,{sx:{flex:1,minWidth:0},children:[e.jsx(h,{variant:"caption",noWrap:!0,sx:{fontWeight:"medium",color:x&&x.id===c.id?"primary.main":"inherit",fontSize:"0.8rem",letterSpacing:"0.2px",display:"block"},children:c.title}),e.jsx(h,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{display:"block",fontSize:"0.7rem"},children:c.artist})]}),x&&x.id===c.id&&(f?e.jsx(ce,{color:"primary",fontSize:"small",sx:{ml:1,animation:"pulse 1.5s infinite ease-in-out","@keyframes pulse":{"0%":{opacity:.7,transform:"scale(1)"},"50%":{opacity:1,transform:"scale(1.1)"},"100%":{opacity:.7,transform:"scale(1)"}}}}):e.jsx(ue,{color:"primary",fontSize:"small",sx:{ml:1}}))]},`track-${D}`)),S.length>2&&e.jsxs(h,{variant:"caption",color:"text.secondary",sx:{display:"block",textAlign:"right",mt:.5,fontStyle:"italic",fontSize:"0.75rem",opacity:.8},children:["+ \u0435\u0449\u0435 ",S.length-2," \u0442\u0440\u0435\u043A(\u043E\u0432)"]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",mt:1.5,opacity:.9},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mr:2},children:[e.jsx(Ee,{sx:{fontSize:16,mr:.5,color:"#e57373"}}),e.jsx(h,{variant:"caption",color:"text.secondary",children:d.likes_count||0})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ge,{sx:{fontSize:16,mr:.5}}),e.jsx(h,{variant:"caption",color:"text.secondary",children:d.comments_count||0})]}),S.length>0&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",ml:2},children:[e.jsx(te,{sx:{fontSize:16,mr:.5}}),e.jsx(h,{variant:"caption",color:"text.secondary",children:S.length})]})]})]})]})]})})},ar=({loading:r,children:p,skeletonCount:g=1,height:m="100px",sx:y={},showSkeleton:R=!1})=>e.jsx(o,{sx:{position:"relative",...y},children:p});var ve,q={};function or(){if(ve)return q;ve=1;var r=Re();Object.defineProperty(q,"__esModule",{value:!0}),q.default=void 0;var p=r(Be()),g=_e();return q.default=(0,p.default)((0,g.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer"),q}const sr=Je(or());j(Z)(({theme:r})=>({marginBottom:10,borderRadius:"10px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",background:"#1A1A1A",cursor:"pointer"}));const we=j(Z)(({theme:r})=>({borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",background:r.palette.background.paper,border:r.palette.mode==="dark"?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)"}));j(Z)(({theme:r})=>({marginBottom:r.spacing(1.5),borderRadius:"12px",background:"#1d1d1d",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.12)",border:"1px solid rgba(255, 255, 255, 0.03)"})),j(O)(({theme:r,following:p})=>({borderRadius:"10px",textTransform:"none",fontWeight:"medium",minWidth:"80px",padding:r.spacing(.5,1.5),fontSize:"0.75rem",backgroundColor:p?"transparent":r.palette.primary.main,borderColor:p?r.palette.divider:r.palette.primary.main,color:p?r.palette.text.primary:r.palette.primary.contrastText,"&:hover":{backgroundColor:p?"rgba(255, 255, 255, 0.05)":r.palette.primary.dark}})),j(o)(({theme:r})=>({position:"sticky",top:80,width:"100%",[r.breakpoints.down("md")]:{position:"static",marginTop:r.spacing(2)}})),j(o)(({theme:r})=>({"& p":{margin:r.spacing(1,0),lineHeight:1.6},"& h1, & h2, & h3, & h4, & h5, & h6":{marginTop:r.spacing(2),marginBottom:r.spacing(1),fontWeight:600},"& a":{color:r.palette.primary.main,textDecoration:"none","&:hover":{textDecoration:"underline"}},"& ul, & ol":{marginLeft:r.spacing(2)},"& code":{fontFamily:"monospace",backgroundColor:r.palette.action.hover,padding:r.spacing(.3,.6),borderRadius:3},"& pre":{backgroundColor:r.palette.grey[900],color:r.palette.common.white,padding:r.spacing(1.5),borderRadius:r.shape.borderRadius,overflowX:"auto","& code":{backgroundColor:"transparent",padding:0}}}));const ir=j(Te)(({theme:r})=>({width:"100%",borderRadius:"10px",backgroundColor:"rgba(255, 255, 255, 0.05)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.07)"},"& .MuiInputBase-input":{padding:"8px"}})),nr=j(o)(({theme:r})=>({display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:r.spacing(1)}));j(o)(({theme:r})=>({position:"relative",marginTop:r.spacing(2),borderRadius:"10px",overflow:"hidden",backgroundColor:"rgba(0, 0, 0, 0.2)"})),j(Q)(({theme:r})=>({position:"absolute",top:8,right:8,backgroundColor:"rgba(0, 0, 0, 0.5)",color:r.palette.common.white,padding:r.spacing(.5),"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}}));const lr=j(o)(({theme:r})=>({display:"flex",flexDirection:"column",gap:r.spacing(),width:"100%",maxWidth:"100%",overflow:{xs:"hidden",md:"visible"},[r.breakpoints.up("md")]:{flexDirection:"row"},[r.breakpoints.down("sm")]:{gap:r.spacing(1)}})),dr=j(o)(({theme:r})=>({width:"100%",display:"flex",flexDirection:"column",gap:"5px",[r.breakpoints.up("md")]:{width:"68%"},[r.breakpoints.down("sm")]:{gap:"5px"}})),cr=j(o)(({theme:r})=>({width:"100%",display:"flex",flexDirection:"column",gap:r.spacing(2),[r.breakpoints.up("md")]:{width:"32%"},[r.breakpoints.down("sm")]:{gap:r.spacing(1)}})),pr=()=>{const[r,p]=s.useState([]),[g,m]=s.useState(!0),y=ee(),R=Ae();return s.useEffect(()=>{const x=async()=>{try{m(!0);const u=await W.get("/api/users/online?limit=1200");Array.isArray(u.data)?p(u.data):u.data&&Array.isArray(u.data.users)?p(u.data.users):p([])}catch{p([])}finally{m(!1)}};x();const f=setInterval(x,6e4);return()=>clearInterval(f)},[]),g?e.jsxs(we,{sx:{p:1,minHeight:56,display:"flex",alignItems:"center"},children:[e.jsx(ne,{size:18,sx:{mr:1}}),e.jsx(h,{variant:"body2",sx:{fontSize:"0.95rem"},children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430..."})]}):r.length===0?null:e.jsx(we,{sx:{p:1,minHeight:56,display:"flex",alignItems:"center",overflowX:"auto"},children:e.jsxs(o,{sx:{display:"flex",flexWrap:"nowrap",gap:1,overflowX:"auto",pb:0,"&::-webkit-scrollbar":{height:"0px",display:"none"},msOverflowStyle:"none",scrollbarWidth:"none"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5,px:1,py:.5,borderRadius:"12px",backgroundColor:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.2)",minWidth:"fit-content",height:36,mr:.5},children:[e.jsx(o,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"#4caf50",boxShadow:"0 0 8px rgba(76, 175, 80, 0.5)"}}),e.jsxs(h,{variant:"body2",sx:{fontSize:"0.75rem",fontWeight:500,color:"#4caf50"},children:[r.length," \u043E\u043D\u043B\u0430\u0439\u043D"]})]}),r.map(x=>e.jsxs(o,{sx:{position:"relative",cursor:"pointer",mx:.25},onClick:()=>{return f=x.username,void y(`/profile/${f}`);var f},children:[e.jsx(X,{src:x.photo,alt:x.username,sx:{width:36,height:36,border:`2px solid ${R.palette.background.paper}`,boxSizing:"border-box",background:"#222"},onError:f=>{const u=f.target;u&&u.src!==void 0&&(u.src="/static/uploads/system/avatar.png")}}),e.jsx(o,{sx:{position:"absolute",bottom:2,right:2,width:9,height:9,borderRadius:"50%",backgroundColor:"#4caf50",border:`1.5px solid ${R.palette.background.paper}`,boxSizing:"border-box"}})]},x.id))]})})},xr=({user:r})=>{const[p,g]=s.useState(r.is_following||!1),{user:m}=s.useContext(re),y=ee(),R=m&&m.account_type==="channel";return e.jsx(o,{onClick:()=>{y(`/profile/${r.username}`)},sx:{cursor:"pointer",py:2,px:2.5,transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.03)"}},children:e.jsx(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(X,{src:r.photo?r.photo.startsWith("/")||r.photo.startsWith("http")?r.photo:`/static/uploads/avatar/${r.id}/${r.photo}`:"/static/uploads/system/avatar.png",alt:r.name||r.username,sx:{width:42,height:42,mr:1.5,border:"2px solid rgba(208, 188, 255, 0.3)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},onError:x=>{const f=x.target;f&&f.src!==void 0&&(f.src="/static/uploads/avatar/system/avatar.png")}}),e.jsxs(o,{sx:{minWidth:0,flex:1},children:[e.jsx(h,{variant:"body2",fontWeight:"500",noWrap:!0,sx:{color:x=>x.palette.text.primary,letterSpacing:"0.1px"},children:r.name||r.username}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.75},children:[e.jsxs(h,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{fontSize:"0.75rem",color:"#a0a0a0"},children:["@",r.username]}),r.is_verified&&e.jsx(o,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:12,height:12,bgcolor:"#8470FF",borderRadius:"50%",fontSize:"0.6rem",color:"white",fontWeight:"bold"},children:"\u2713"})]})]}),!R&&e.jsx(O,{variant:p?"text":"contained",size:"small",onClick:async x=>{x.stopPropagation();try{g(!p);const f=await W.post("/api/profile/follow",{followed_id:r.id});f.data&&f.data.success&&g(f.data.is_following)}catch{g(p)}},sx:{minWidth:"auto",height:32,borderRadius:"16px",textTransform:"none",px:2,ml:1,fontSize:"0.75rem",fontWeight:500,...p&&{color:"#a0a0a0",border:"1px solid rgba(255, 255, 255, 0.12)","&:hover":{backgroundColor:"rgba(255, 0, 0, 0.04)",color:"#ff5252",borderColor:"rgba(255, 82, 82, 0.2)"}}},children:p?"\u041E\u0442\u043F\u0438\u0441\u0430\u0442\u044C\u0441\u044F":"\u041F\u043E\u0434\u043F\u0438\u0441\u0430\u0442\u044C\u0441\u044F"})]})})})},gr=({onPostCreated:r})=>{const{user:p}=s.useContext(re),{playTrack:g,currentTrack:m,isPlaying:y,togglePlay:R}=s.useContext(ge),[x,f]=s.useState(""),[u,F]=s.useState([]),[_,P]=s.useState(""),[I,T]=s.useState([]),[S,A]=s.useState(!1),[d,b]=s.useState(""),C=s.useRef(null),[w,c]=s.useState(!1),[D,k]=s.useState({open:!1,message:""}),[L,$]=s.useState(!1),[v,U]=s.useState([]),[G,V]=s.useState({open:!1,message:"",severity:"error"}),[K,Y]=s.useState({open:!1,message:"",timeRemaining:0}),[ae,J]=s.useState(!1),[oe,E]=s.useState("");s.useEffect(()=>{d&&b("")},[x,u,v,d]);const H=s.useRef(0),N=a=>{if(!a.length)return;let t=!1;if(Array.from(a).forEach(n=>{const z=n.type.startsWith("video/"),B=n.type.startsWith("image/");z&&n.size>157286400&&(E("\u0420\u0430\u0437\u043C\u0435\u0440 \u0432\u0438\u0434\u0435\u043E \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0435\u0442 \u043B\u0438\u043C\u0438\u0442 \u0432 150\u041C\u0411"),J(!0),t=!0),B&&n.size>52428800&&(E("\u0420\u0430\u0437\u043C\u0435\u0440 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0435\u0442 \u043B\u0438\u043C\u0438\u0442 \u0432 50\u041C\u0411"),J(!0),t=!0)}),t)return void(C.current&&(C.current.value=""));const l=Array.from(a).filter(n=>n.type.startsWith("image/")),i=Array.from(a).filter(n=>n.type.startsWith("video/"));if(l.length!==0||i.length!==0)if(_==="video"&&l.length>0)k({open:!0,message:"\u041D\u0435\u043B\u044C\u0437\u044F \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0444\u043E\u0442\u043E \u0438 \u0432\u0438\u0434\u0435\u043E \u043E\u0434\u043D\u043E\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E"});else if(_==="image"&&i.length>0)k({open:!0,message:"\u041D\u0435\u043B\u044C\u0437\u044F \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0444\u043E\u0442\u043E \u0438 \u0432\u0438\u0434\u0435\u043E \u043E\u0434\u043D\u043E\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E"});else{if(i.length>0){F([i[0]]),P("video");const n=new FileReader;return n.onloadend=()=>{T([n.result])},void n.readAsDataURL(i[0])}if(l.length>0){F(z=>[...z,...l]),P("image");const n=[];l.forEach(z=>{const B=new FileReader;B.onloadend=()=>{n.push(B.result),n.length===l.length&&T(M=>[...M,...n])},B.readAsDataURL(z)})}}else k({open:!0,message:"\u041F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F \u0442\u043E\u043B\u044C\u043A\u043E \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u0438 \u0432\u0438\u0434\u0435\u043E"})};return p?e.jsxs(ie,{elevation:0,sx:{p:2,borderRadius:1,backgroundColor:a=>a.palette.background.paper,position:"relative",overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[d&&e.jsx(le,{severity:"error",sx:{mb:2},onClose:()=>b(""),children:d}),e.jsx(pe,{open:G.open,autoHideDuration:6e3,onClose:()=>V(a=>({...a,open:!1})),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(le,{onClose:()=>V(a=>({...a,open:!1})),severity:G.severity,sx:{width:"100%"},children:G.message})}),e.jsx(De,{open:K.open,onClose:()=>Y(a=>({...a,open:!1})),"aria-labelledby":"rate-limit-dialog-title","aria-describedby":"rate-limit-dialog-description",PaperProps:{sx:{backgroundColor:"#1A1A1A",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",border:"1px solid rgba(255, 255, 255, 0.1)",maxWidth:"400px",width:"100%"}},children:e.jsxs(o,{sx:{p:3},children:[e.jsxs(h,{id:"rate-limit-dialog-title",variant:"h6",component:"h2",sx:{mb:2,color:"#D0BCFF",fontWeight:"medium",display:"flex",alignItems:"center"},children:[e.jsx(sr,{sx:{mr:1}})," \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435"]}),e.jsx(h,{id:"rate-limit-dialog-description",sx:{mb:3,color:"text.secondary"},children:K.message}),e.jsx(o,{sx:{textAlign:"right"},children:e.jsx(O,{onClick:()=>Y(a=>({...a,open:!1})),variant:"contained",sx:{borderRadius:"24px",textTransform:"none",fontWeight:500,padding:"6px 16px"},children:"\u041F\u043E\u043D\u044F\u0442\u043D\u043E"})})]})}),e.jsx(pe,{open:D.open,autoHideDuration:3e3,onClose:()=>k({...D,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(le,{onClose:()=>k({...D,open:!1}),severity:"warning",sx:{width:"100%"},children:D.message})}),e.jsx(Oe,{open:ae,message:oe,shortMessage:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0430\u0437\u043C\u0435\u0440\u0430 \u0444\u0430\u0439\u043B\u0430",notificationType:"error",animationType:"pill",autoHideDuration:5e3,onClose:()=>J(!1)}),e.jsx(o,{component:"form",onSubmit:a=>{a.preventDefault(),(async()=>{if(x.trim()||u.length!==0||v.length!==0)try{A(!0),b("");const t=new FormData;if(t.append("content",x.trim()),_==="image"?u.forEach((i,n)=>{t.append(`images[${n}]`,i)}):_==="video"&&t.append("video",u[0]),v.length>0){const i=v.map(n=>({id:n.id,title:n.title,artist:n.artist,duration:n.duration,file_path:n.file_path,cover_path:n.cover_path}));t.append("music",JSON.stringify(i))}const l=await W.post("/api/posts",t,{headers:{"Content-Type":"multipart/form-data"}});f(""),F([]),T([]),P(""),U([]),b(""),C.current&&(C.current.value=""),r&&r(l.data.post)}catch(t){if(t.response&&t.response.status===429){const l=t.response.data.rate_limit;let i="\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043B\u0438\u043C\u0438\u0442 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438 \u043F\u043E\u0441\u0442\u043E\u0432. ",n=0;if(l&&l.reset){const z=new Date(1e3*l.reset),B=new Date,M=Math.round((z-B)/1e3);n=M,i+=M>60?`\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439 \u043F\u043E\u0441\u0442 \u043C\u043E\u0436\u043D\u043E \u043E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C \u0447\u0435\u0440\u0435\u0437 ${Math.floor(M/60)} \u043C\u0438\u043D. ${M%60} \u0441\u0435\u043A.`:`\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439 \u043F\u043E\u0441\u0442 \u043C\u043E\u0436\u043D\u043E \u043E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C \u0447\u0435\u0440\u0435\u0437 ${M} \u0441\u0435\u043A.`}else i+="\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u043F\u044B\u0442\u043A\u0443 \u043F\u043E\u0437\u0436\u0435.",n=60;b(i),V({open:!0,message:i,severity:"warning"}),Y({open:!0,message:i,timeRemaining:n})}else t.response&&t.response.data&&t.response.data.error?(b(t.response.data.error),V({open:!0,message:t.response.data.error,severity:"error"})):(b("\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u043F\u043E\u0441\u0442\u0430. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437."),V({open:!0,message:"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u043F\u043E\u0441\u0442\u0430. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.",severity:"error"}))}finally{A(!1)}})()},sx:{position:"relative",zIndex:1},onDragEnter:a=>{a.preventDefault(),a.stopPropagation(),H.current+=1,H.current===1&&c(!0)},onDragOver:a=>{a.preventDefault(),a.stopPropagation()},onDragLeave:a=>{a.preventDefault(),a.stopPropagation(),H.current-=1,H.current===0&&c(!1)},onDrop:a=>{a.preventDefault(),a.stopPropagation(),H.current=0,c(!1);const t=Array.from(a.dataTransfer.files);t.length>0&&N(t)},children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",position:"relative",borderRadius:"12px",border:w?"2px dashed #D0BCFF":"none",backgroundColor:w?"rgba(208, 188, 255, 0.05)":"transparent",padding:w?1:0,transition:"all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)"},children:[w&&e.jsxs(o,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",backgroundColor:"rgba(26, 26, 26, 0.7)",borderRadius:"12px",zIndex:10,opacity:w?1:0,transition:"opacity 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)"},children:[e.jsx(fe,{sx:{fontSize:40,color:"#D0BCFF",mb:1,filter:"drop-shadow(0 0 8px rgba(208, 188, 255, 0.6))"}}),e.jsx(h,{variant:"body1",color:"primary",sx:{fontWeight:"medium",textShadow:"0 1px 3px rgba(0,0,0,0.3)"},children:"\u041F\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0444\u0430\u0439\u043B\u044B \u0441\u044E\u0434\u0430"})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",mb:0},children:[e.jsx(X,{src:p.photo?`/static/uploads/avatar/${p.id}/${p.photo}`:void 0,alt:p.name,sx:{mr:1.5,width:42,height:42,border:"2px solid #D0BCFF"}}),e.jsx(ir,{placeholder:"\u0427\u0442\u043E \u0443 \u0432\u0430\u0441 \u043D\u043E\u0432\u043E\u0433\u043E?",multiline:!0,maxRows:6,value:x,onChange:a=>f(a.target.value),onPaste:a=>{const t=a.clipboardData;if(t.items){const l=Array.from(t.items).filter(i=>i.type.indexOf("image")!==-1);if(l.length>0){if(a.preventDefault(),_==="video")return void k({open:!0,message:"\u041D\u0435\u043B\u044C\u0437\u044F \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0444\u043E\u0442\u043E \u0438 \u0432\u0438\u0434\u0435\u043E \u043E\u0434\u043D\u043E\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E"});const i=l.map(n=>n.getAsFile());N(i)}}},fullWidth:!0})]}),I.length>0&&e.jsx(o,{sx:{position:"relative",mb:2},children:e.jsxs(o,{sx:{position:"relative",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)",backgroundColor:"rgba(0, 0, 0, 0.2)"},children:[_==="image"?e.jsx(Pe,{sx:{width:"100%",height:"auto",maxHeight:500,margin:0,padding:1},cols:I.length>3?3:I.length,rowHeight:164,gap:8,children:I.map((a,t)=>e.jsxs(Fe,{sx:{position:"relative",borderRadius:"8px",overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx("img",{src:a,alt:`Preview ${t+1}`,style:{objectFit:"cover",height:"100%",width:"100%",borderRadius:"8px"}}),e.jsx(Q,{onClick:()=>{F(l=>l.filter((i,n)=>n!==t)),T(l=>l.filter((i,n)=>n!==t)),I.length===1&&P("")},sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"4px","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"},backdropFilter:"blur(4px)"},children:e.jsx(de,{fontSize:"small"})})]},t))}):e.jsx("video",{src:I[0],controls:!0,style:{width:"100%",maxHeight:"300px",borderRadius:"12px"}}),_==="video"&&e.jsx(Q,{onClick:()=>{F([]),T([]),P(""),U([]),b(""),C.current&&(C.current.value="")},sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"},padding:"8px",backdropFilter:"blur(4px)"},children:e.jsx(de,{fontSize:"small"})})]})}),v.length>0&&e.jsx(o,{sx:{mt:2,mb:2},children:v.map(a=>e.jsxs(o,{sx:{display:"flex",alignItems:"center",py:1,px:1.5,mb:1,borderRadius:"10px",bgcolor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",cursor:"pointer",transition:"all 0.2s ease"},onClick:t=>((l,i)=>{i&&i.stopPropagation(),m&&m.id===l.id?R():g(l)})(a,t),children:[e.jsxs(o,{sx:{width:32,height:32,borderRadius:"6px",overflow:"hidden",mr:1.5,position:"relative",bgcolor:"rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.2)"},children:[e.jsx("img",{src:a.cover_path?a.cover_path.startsWith("/static/")?a.cover_path:a.cover_path.startsWith("static/")?`/${a.cover_path}`:a.cover_path.startsWith("http")?a.cover_path:`/static/music/${a.cover_path}`:"/uploads/system/album_placeholder.jpg",alt:a.title,style:{width:"100%",height:"100%",objectFit:"cover"},onError:t=>{t.target.src="/uploads/system/album_placeholder.jpg"}}),e.jsx(o,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(145deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.3))",display:"flex",alignItems:"center",justifyContent:"center"},children:m&&m.id===a.id&&y?e.jsx(ce,{sx:{color:"white",fontSize:16}}):e.jsx(te,{sx:{fontSize:14,color:"rgba(255, 255, 255, 0.9)",filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.3))"}})})]}),e.jsxs(o,{sx:{flexGrow:1,overflow:"hidden"},children:[e.jsx(h,{variant:"body2",sx:{fontWeight:m&&m.id===a.id?"medium":"normal",color:m&&m.id===a.id?"primary.main":"text.primary",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"0.85rem"},children:a.title}),e.jsx(h,{variant:"caption",color:"text.secondary",sx:{display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"0.75rem"},children:a.artist})]}),m&&m.id===a.id?y?e.jsx(ce,{color:"primary",fontSize:"small",sx:{mr:1,fontSize:16}}):e.jsx(ue,{color:"primary",fontSize:"small",sx:{mr:1,fontSize:16}}):null,e.jsx(Q,{size:"small",onClick:t=>{var l;t.stopPropagation(),l=a.id,U(i=>i.filter(n=>n.id!==l))},sx:{ml:"auto",bgcolor:"rgba(0, 0, 0, 0.2)","&:hover":{bgcolor:"rgba(0, 0, 0, 0.3)"},padding:"4px"},children:e.jsx(de,{fontSize:"small",sx:{fontSize:16}})})]},a.id))}),e.jsxs(nr,{children:[e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx("input",{ref:C,type:"file",accept:"image/*,video/*",multiple:!0,onChange:a=>{a.preventDefault();const t=Array.from(a.target.files);t.length>0&&N(t)},style:{display:"none"},id:"media-upload-main"}),e.jsx(O,{startIcon:e.jsx(fe,{}),sx:{color:u.length>0?"primary.main":"text.secondary",borderRadius:"24px",textTransform:"none",fontSize:"0.875rem",fontWeight:500,padding:"6px 12px",border:u.length>0?"1px solid rgba(208, 188, 255, 0.5)":"1px solid rgba(255, 255, 255, 0.12)","&:hover":{backgroundColor:"rgba(208, 188, 255, 0.08)",borderColor:"rgba(208, 188, 255, 0.4)"}},size:"small",onClick:()=>C.current?.click(),children:u.length?`\u0424\u0430\u0439\u043B\u044B (${u.length})`:"\u041C\u0435\u0434\u0438\u0430"}),e.jsx(O,{onClick:()=>$(!0),startIcon:e.jsx(te,{}),sx:{color:v.length>0?"primary.main":"text.secondary",borderRadius:"24px",textTransform:"none",fontSize:"0.875rem",fontWeight:500,padding:"6px 12px",border:v.length>0?"1px solid rgba(208, 188, 255, 0.5)":"1px solid rgba(255, 255, 255, 0.12)","&:hover":{backgroundColor:"rgba(208, 188, 255, 0.08)",borderColor:"rgba(208, 188, 255, 0.4)"}},size:"small",children:v.length?`\u041C\u0443\u0437\u044B\u043A\u0430 (${v.length})`:"\u041C\u0443\u0437\u044B\u043A\u0430"})]}),e.jsx(O,{variant:"contained",type:"submit",disabled:S||!x.trim()&&u.length===0&&v.length===0,endIcon:S?e.jsx(ne,{size:16,color:"inherit"}):null,sx:{borderRadius:"24px",textTransform:"none",fontWeight:500,padding:"6px 16px"},children:"\u041E\u043F\u0443\u0431\u043B\u0438\u043A\u043E\u0432\u0430\u0442\u044C"})]}),e.jsx(Ye,{open:L,onClose:()=>$(!1),onSelectTracks:a=>{U(a)},maxTracks:3})]})})]}):null},hr=xe.memo(()=>{const{user:r}=s.useContext(re),[p,g]=s.useState([]),[m,y]=s.useState(!0),[R,x]=s.useState([]),[f,u]=s.useState(!0),[F,_]=s.useState([]),[P,I]=s.useState(!0),[T,S]=s.useState(1),[A,d]=s.useState(!0),[b,C]=s.useState("all"),[w,c]=s.useState(0),D=s.useRef(!0),k=s.useRef(!1),L=ee(),$=s.useRef(!1),v=s.useRef(null),[U,G]=s.useState(!1),[V,K]=s.useState(""),[Y,ae]=s.useState(0),[J,oe]=s.useState([]),[E,H]=s.useState(null);s.useEffect(()=>{const t=new IntersectionObserver(l=>{const[i]=l;!i.isIntersecting||!A||m||$.current||k.current||N()},{root:null,rootMargin:"0px",threshold:.1});return v.current&&t.observe(v.current),()=>{v.current&&t.unobserve(v.current)}},[A,m,p.length,b]),s.useEffect(()=>{D.current&&(async()=>{try{y(!0),g([]);const t={page:1,per_page:20,sort:b,include_all:b==="all"},l=w+1;c(l);const i=await W.get("/api/posts/feed",{params:t});if(w!==l-1)return;i.data&&Array.isArray(i.data.posts)?(g(i.data.posts),d(i.data.has_next===!0),S(2)):(g([]),d(!1))}catch{g([]),d(!1)}finally{y(!1),D.current=!1}})()},[]),s.useEffect(()=>{D.current||(k.current=!0,(async()=>{try{y(!0),g([]);const t={page:1,per_page:20,sort:b,include_all:b==="all"},l=w+1;let i;c(l);try{i=await W.get("/api/posts/feed",{params:t})}catch(n){if(b==="recommended")return d(!1),g([]),y(!1),void(k.current=!1);throw n}if(w!==l-1)return;i.data&&Array.isArray(i.data.posts)?(g(i.data.posts),d(i.data.has_next===!0),S(2)):(g([]),d(!1))}catch{g([]),d(!1)}finally{y(!1),k.current=!1}})())},[b]),s.useEffect(()=>{D.current&&(async()=>{try{if(u(!0),R.length>0)return void u(!1);try{const t=await W.get("/api/users/recent-channels",{timeout:5e3});Array.isArray(t.data)?x(t.data||[]):x([])}catch{x([])}}finally{u(!1)}})()},[]),s.useEffect(()=>{(async()=>{try{I(!0);const t=await W.get("/api/badges/trending");t.data&&Array.isArray(t.data.badges)?_(t.data.badges):_([])}catch{_([])}finally{I(!1)}})()},[]);const N=async()=>{if(!m&&A&&!k.current&&!$.current)try{$.current=!0,y(!0);const t=T,l={page:t,per_page:10,sort:b,include_all:b==="all"},i=w+1;c(i),S(t+1);const n=await W.get("/api/posts/feed",{params:l});if(w!==i-1)return;n.data&&Array.isArray(n.data.posts)?(g(z=>{const B=new Set(z.map(se=>se.id)),M=n.data.posts.filter(se=>!B.has(se.id));return[...z,...M]}),d(n.data.has_next===!0&&n.data.posts.length>0)):d(!1)}catch{d(!1)}finally{y(!1),$.current=!1}},a=(t,l,i)=>{K(t),oe(Array.isArray(l)?l:[t]),ae(i||0),G(!0)};return s.useEffect(()=>{const t=Ne.getLatestUpdate();H(t)},[]),e.jsxs(We,{maxWidth:"lg",sx:{mt:2,mb:0,px:{xs:.5,sm:0},width:"100%",maxWidth:"100%",overflow:{xs:"hidden",md:"visible"},pb:{xs:"100px",sm:0}},children:[e.jsxs(lr,{children:[e.jsxs(dr,{children:[e.jsx(pr,{}),e.jsx(gr,{onPostCreated:(t,l=null)=>{W.cache&&(W.cache.clearPostsCache(),W.cache.clearByUrlPrefix("/api/posts/feed"),W.cache.clearByUrlPrefix("/api/profile/pinned_post")),l?g(i=>i.filter(n=>n.id!==l)):t?g(i=>[t,...i]):(g([]),S(1),(async()=>{try{y(!0);const i={page:1,per_page:20,sort:b,include_all:b==="all"},n=w+1;c(n);const z=await W.get("/api/posts/feed",{params:i,forceRefresh:!0});if(w!==n-1)return;z.data&&Array.isArray(z.data.posts)?(g(z.data.posts),d(z.data.has_next===!0),S(2)):(g([]),d(!1))}catch{g([]),d(!1)}finally{y(!1)}})())}}),e.jsxs(ie,{sx:{p:1,display:"flex",justifyContent:"space-between",mb:0,borderRadius:"12px",backgroundColor:t=>t.palette.mode==="dark"?"#1E1E1E":t.palette.background.paper,backgroundImage:"unset",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(O,{variant:b==="all"?"contained":"text",onClick:()=>C("all"),sx:{flex:1,mx:.5},children:"\u0412\u0441\u0435"}),e.jsx(O,{variant:b==="following"?"contained":"text",onClick:()=>C("following"),sx:{flex:1,mx:.5},children:"\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0438"}),e.jsx(O,{variant:b==="recommended"?"contained":"text",onClick:()=>C("recommended"),sx:{flex:1,mx:.5},children:"\u0420\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0430\u0446\u0438\u0438"})]}),e.jsx(o,{sx:{mt:0},children:m&&p.length===0?e.jsx(e.Fragment,{children:[...Array(5)].map((t,l)=>e.jsx(Xe,{},l))}):p.length>0?e.jsxs(o,{sx:{mt:0},children:[p.map(t=>t.is_repost?e.jsx(tr,{post:t},t.id):e.jsx(He,{post:t,showPostDetails:!1,onOpenLightbox:a},t.id)),A&&e.jsx(o,{ref:v,sx:{textAlign:"center",py:2,opacity:m?1:0,transition:"opacity 0.3s ease"},children:m&&e.jsx(ne,{size:30,sx:{color:"primary.main"}})}),!A&&e.jsx(o,{sx:{textAlign:"center",py:3,opacity:.7},children:e.jsx(h,{variant:"body2",color:"text.secondary",children:"\u0412\u044B \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0435\u043B\u0438 \u0432\u0441\u0435 \u043F\u043E\u0441\u0442\u044B"})})]}):e.jsx(o,{sx:{textAlign:"center",py:4,mt:2},children:e.jsx(h,{color:"text.secondary",children:"\u041D\u0435\u0442 \u043F\u043E\u0441\u0442\u043E\u0432 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F. \u041F\u043E\u0434\u043F\u0438\u0448\u0438\u0442\u0435\u0441\u044C \u043D\u0430 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439, \u0447\u0442\u043E\u0431\u044B \u0432\u0438\u0434\u0435\u0442\u044C \u0438\u0445 \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438 \u0432 \u043B\u0435\u043D\u0442\u0435."})})})]}),e.jsxs(cr,{children:[e.jsx(o,{component:ie,sx:{p:0,borderRadius:"12px",mb:-.625,background:t=>t.palette.mode==="dark"?"linear-gradient(145deg, #222222, #1c1c1c)":t.palette.background.paper,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",border:t=>"1px solid "+(t.palette.mode==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)"),overflow:"hidden",display:{xs:"none",sm:"block"}},children:f?e.jsx(o,{sx:{display:"flex",justifyContent:"center",py:3,px:2},children:e.jsxs(ar,{height:170,width:"100%",speed:2,backgroundColor:"#292929",foregroundColor:"#333333",children:[e.jsx("rect",{x:"0",y:"0",rx:"8",ry:"8",width:"100%",height:"50"}),e.jsx("rect",{x:"0",y:"60",rx:"8",ry:"8",width:"100%",height:"50"}),e.jsx("rect",{x:"0",y:"120",rx:"8",ry:"8",width:"100%",height:"50"})]})}):R.length===0?e.jsxs(o,{sx:{textAlign:"center",py:3,px:2,background:"linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.03))"},children:[e.jsx(X,{sx:{width:50,height:50,mx:"auto",mb:2,bgcolor:"rgba(208, 188, 255, 0.1)",border:"1px solid rgba(208, 188, 255, 0.25)"},children:e.jsx(Me,{sx:{color:"#D0BCFF",fontSize:26}})}),e.jsx(h,{variant:"body2",sx:{fontWeight:500,color:t=>t.palette.text.secondary},children:"\u041D\u0435\u0442 \u0430\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u043A\u0430\u043D\u0430\u043B\u043E\u0432"}),e.jsx(h,{variant:"caption",sx:{display:"block",mt:1,maxWidth:"80%",mx:"auto",color:t=>t.palette.text.disabled},children:"\u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u0439 \u043A\u0430\u043D\u0430\u043B \u0438\u043B\u0438 \u043F\u043E\u0434\u043F\u0438\u0448\u0438\u0442\u0435\u0441\u044C \u043D\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0435 \u043A\u0430\u043D\u0430\u043B\u044B"})]}):e.jsx(o,{children:R.map((t,l)=>e.jsxs(o,{children:[e.jsx(xr,{user:t}),l<R.length-1&&e.jsx(Ie,{sx:{opacity:.1,mx:2}})]},t.id))})}),E&&e.jsx(o,{sx:{mb:2,display:{xs:"none",sm:"block"},"&:hover":{"& > *":{transform:"translateY(-2px)"},cursor:"pointer"}},onClick:()=>L("/updates"),children:e.jsx(Qe,{version:E.version,date:E.date,title:E.title,updates:E.updates,fixes:E.fixes,hideHeader:!0})})]})]}),e.jsx(Ve,{isOpen:U,onClose:()=>{G(!1)},images:J,initialIndex:Y})]})});export{hr as default};
