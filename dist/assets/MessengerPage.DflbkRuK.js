import{r as xe,a as pe,j as e,w as R,i as D,o as Fe,D as Ee,E as Le,T as Y,H as We,aF as He,J as Ae,l as V,af as it,A as lt,aM as ot,k as $e,a6 as ct,a8 as Oe,ak as dt,m as Pe,O as Ve,Q as Xe,a7 as Ye,U as Ke,bc as ut,b as mt,g as ht,n as xt,b0 as pt}from"./vendor-mui.08p3AH88.js";import{r as s,a as Me,u as gt}from"./vendor-router.BRqU_Zs2.js";import{r as ge,o as fe,A as ft,S as jt,p as bt}from"./index.CdVNWeFt.js";import{g as je}from"./vendor-react.DF-_cTkv.js";import{A as yt}from"./ArrowBack.DeCcUwS3.js";import{C as vt}from"./Clear.ONWxSfjH.js";import{S as Ct}from"./Send.DjUSpM3V.js";import{P as kt}from"./Photo.tXKr-C4h.js";import{C as Be}from"./Close.BG2YHWMj.js";import{R as _t}from"./Reply.De_n_WzJ.js";import{D as Ze}from"./Delete.C47j6PO2.js";import{D as St}from"./Done.DH0PNvDW.js";import{D as wt}from"./DoneAll.CiznCgP9.js";import{Z as Nt}from"./ZoomIn.B2AGiqFq.js";import{f as $t,a as te}from"./vendor.CL98q8z6.js";import{r as Mt}from"./ru.CTk8yEGX.js";import{P as zt}from"./Person.B_G_dVGx.js";import{M as Tt}from"./MoreVert.C0-1U5Ci.js";import{E as Dt}from"./Edit.6-hI7nty.js";import{A as It}from"./Add.BKfOzMjp.js";var Ge,be={};function Rt(){if(Ge)return be;Ge=1;var a=xe();Object.defineProperty(be,"__esModule",{value:!0}),be.default=void 0;var l=a(ge()),h=pe();return be.default=(0,l.default)((0,h.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),be}const Ft=je(Rt()),Et=s.memo(({chat:a,isActive:l,unreadCount:h,onClick:j,currentUserId:t,onlineUsers:m})=>{const{getUserInfo:b}=fe(),[y,w]=s.useState(null),[g,C]=s.useState(!1),n=s.useMemo(()=>a.is_group?null:a.members&&Array.isArray(a.members)&&a.members.length!==0?a.members.find(i=>{const d=i.user_id||i.id||i.user&&i.user.id;return d&&d!==t}):null,[a,t]);s.useEffect(()=>{!a.is_group&&n&&(async()=>{const i=n.user_id||n.id||n.user&&n.user.id;if(i&&!g&&!y){C(!0);try{const d=await b(i);d&&w(d)}catch{}finally{C(!1)}}})()},[a,n,b,g,y]);const _=s.useMemo(()=>{if(a.is_group)return a.title||"\u0413\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u0447\u0430\u0442";if(!n)return`\u0427\u0430\u0442 ${a.id}`;const i=n.user_id||n.id||n.user&&n.user.id;if(y)return y.name||y.username||`\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C #${i}`;const d=n.name||n.user&&n.user.name||n.username||n.user&&n.user.username;return d&&d!=="\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C"?d:g?"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430...":`\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C #${i}`},[a,n,y,g]),x=s.useMemo(()=>{if(a.is_group||!n)return!1;const i=n.user_id||n.id||n.user&&n.user.id;return!!i&&!!m[i]},[a,n,m]),k=s.useMemo(()=>{const i=a.last_message;if(!i)return"";let d="";if(i.sender_id===t)d="\u0412\u044B";else if(a.is_group)if(n&&i.sender_id===(n.user_id||n.id))d=y?.name||n.name||"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A";else{const $=a.members?.find(M=>(M.user_id||M.id)===i.sender_id);d=$?$.name||$.user&&$.user.name||i.sender_name||"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A":i.sender_name||"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A"}else d="";const c=a.is_group&&i.sender_id!==t?`${d}: `:"";switch(i.message_type){case"text":return`${c}${i.content}`;case"photo":return`${c}\u{1F4F7} \u0424\u043E\u0442\u043E`;case"video":return`${c}\u{1F3AC} \u0412\u0438\u0434\u0435\u043E`;case"audio":return`${c}\u{1F3B5} \u0410\u0443\u0434\u0438\u043E`;case"file":return`${c}\u{1F4CE} \u0424\u0430\u0439\u043B: ${i.original_filename||"\u0444\u0430\u0439\u043B"}`;default:return`${c}\u041D\u043E\u0432\u043E\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435`}},[a,t,n,y]),I=s.useMemo(()=>{const i=a.last_message;if(!i)return"";try{if(typeof i.created_at=="string"&&/^\d{1,2}:\d{2}$/.test(i.created_at)||typeof i.created_at=="string"&&/^\d{1,2}\s+\w+$/.test(i.created_at))return i.created_at;const d=i.created_at instanceof Date?i.created_at:new Date(i.created_at);if(isNaN(d.getTime()))return typeof i.created_at=="string"?i.created_at:"";const c=new Date,$=d.toLocaleDateString(),M=c.toLocaleDateString(),T=new Date(c);T.setDate(c.getDate()-1);const A=T.toLocaleDateString();return $===M?d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):$===A?"\u0412\u0447\u0435\u0440\u0430":d.toLocaleDateString([],{day:"2-digit",month:"2-digit"})}catch{return typeof i.created_at=="string"?i.created_at:""}},[a]),U=_?.[0]?.toUpperCase()||"?";return e.jsxs("div",{className:`chat-item ${l?"active":""} ${h>0?"unread":""}`,onClick:j,children:[e.jsxs("div",{className:"chat-avatar-container",children:[e.jsx("div",{className:"chat-avatar",children:a.avatar?e.jsx("img",{src:a.avatar,alt:_,style:{objectFit:"cover",...a.avatar.toLowerCase().endsWith(".gif")&&{objectFit:"contain",background:"transparent"}}}):e.jsx("div",{className:"avatar-placeholder",children:U})}),x&&e.jsx("span",{className:"online-indicator",style:{position:"absolute",bottom:"2px",right:"2px",width:"12px",height:"12px",borderRadius:"50%",backgroundColor:"#4CAF50",border:"2px solid var(--background-color, #1A1A1A)",zIndex:2}})]}),e.jsxs("div",{className:"chat-info",children:[e.jsxs("div",{className:"chat-title-row",children:[e.jsxs("h4",{className:"chat-title",children:[_,a.encrypted&&e.jsx("span",{className:"encrypted-badge",children:"\u{1F512}"})]}),e.jsx("span",{className:"chat-time",children:I})]}),e.jsxs("div",{className:"chat-preview-row",children:[e.jsx("p",{className:"last-message",children:k}),h>0&&e.jsx("span",{className:"unread-counter",children:h})]})]})]})}),Lt=({onClose:a})=>{const{searchUsers:l,createPersonalChat:h,setActiveChat:j,getChatDetails:t}=fe(),[m,b]=s.useState(""),[y,w]=s.useState([]),[g,C]=s.useState(!1),[n,_]=s.useState(null),[x,k]=s.useState(!1),I=s.useRef(null);s.useEffect(()=>{if(!(m.trim().length<2))return I.current&&clearTimeout(I.current),I.current=setTimeout(async()=>{C(!0),_(null);try{const i=await l(m);w(i)}catch{_("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u0438\u0441\u043A\u0430 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439")}finally{C(!1)}},300),()=>{I.current&&clearTimeout(I.current)};w([])},[m,l]);const U=s.useCallback(async(i,d=null)=>{if(!x)try{let c;k(!0),d?c=(await t(d))?.id||null:c=await h(i),c&&(j(c),a())}catch{_("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0447\u0430\u0442")}finally{k(!1)}},[h,j,a,t,x]);return e.jsxs("div",{className:"search-users",children:[e.jsx("div",{className:"search-header",children:e.jsx("h3",{children:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439"})}),e.jsxs("div",{className:"search-input-container",children:[e.jsx("input",{type:"text",className:"search-input",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F \u0438\u043B\u0438 \u043B\u043E\u0433\u0438\u043D...",value:m,onChange:i=>b(i.target.value),autoFocus:!0}),m&&e.jsx("button",{className:"clear-search",onClick:()=>b(""),children:"\xD7"})]}),g?e.jsx("div",{className:"search-loading",children:"\u041F\u043E\u0438\u0441\u043A..."}):n?e.jsx("div",{className:"search-error",children:n}):y.length===0?m.trim().length>=2?e.jsx("div",{className:"search-empty",children:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B"}):e.jsx("div",{className:"search-hint",children:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u0430\u043F\u0440\u043E\u0441 \u0434\u043B\u044F \u043F\u043E\u0438\u0441\u043A\u0430 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439"}):e.jsx("div",{className:"search-results",children:y.map(i=>e.jsxs("div",{className:"search-user-item",children:[e.jsx("div",{className:"user-avatar",children:i.name?.[0]?.toUpperCase()||i.username?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:i.name}),e.jsxs("div",{className:"user-username",children:["@",i.username]})]}),e.jsx("button",{className:"start-chat-btn",onClick:()=>U(i.id,i.existing_chat_id),disabled:x,children:i.has_chat?"\u041E\u0442\u043A\u0440\u044B\u0442\u044C":"\u041D\u0430\u043F\u0438\u0441\u0430\u0442\u044C"})]},i.id))})]})};var Je,ye={};function Wt(){if(Je)return ye;Je=1;var a=xe();Object.defineProperty(ye,"__esModule",{value:!0}),ye.default=void 0;var l=a(ge()),h=pe();return ye.default=(0,l.default)([(0,h.jsx)("circle",{cx:"10",cy:"8",r:"4"},"0"),(0,h.jsx)("path",{d:"M10.35 14.01C7.62 13.91 2 15.27 2 18v2h9.54c-2.47-2.76-1.23-5.89-1.19-5.99m9.08 4.01c.36-.59.57-1.28.57-2.02 0-2.21-1.79-4-4-4s-4 1.79-4 4 1.79 4 4 4c.74 0 1.43-.22 2.02-.57L20.59 22 22 20.59zM16 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"},"1")],"PersonSearch"),ye}const At=je(Wt()),Pt=s.memo(({onSelectChat:a})=>{const{chats:l,loading:h,activeChat:j,setActiveChat:t,unreadCounts:m,refreshChats:b,onlineUsers:y,user:w}=fe(),[g,C]=s.useState(!1),[n,_]=s.useState(""),[x,k]=s.useState([]),I=s.useRef(!1);s.useEffect(()=>{if(!I.current){I.current=!0,b();const c=()=>{document.visibilityState==="visible"&&b()};document.addEventListener("visibilitychange",c);const $=setInterval(()=>{document.visibilityState==="visible"&&b()},3e4);return()=>{clearInterval($),document.removeEventListener("visibilitychange",c)}}},[b]),s.useEffect(()=>{if(!n.trim())return void k(l);const c=n.toLowerCase(),$=l.filter(M=>{if(M.title&&M.title.toLowerCase().includes(c))return!0;if(!M.is_group&&M.members){const T=M.members.find(A=>A.user_id!==w?.id);if(T&&(T.name&&T.name.toLowerCase().includes(c)||T.username&&T.username.toLowerCase().includes(c)))return!0}return!!(M.last_message&&M.last_message.message_type==="text"&&M.last_message.content&&M.last_message.content.toLowerCase().includes(c))});k($)},[n,l,w]);const U=s.useCallback(()=>{C(c=>!c),g&&_("")},[g]),i=s.useCallback(c=>{t(c),a&&a()},[t,a]),d=s.useCallback(()=>{b()},[b]);return e.jsxs("div",{className:"chat-list",children:[e.jsxs("div",{className:"chat-list-header",children:[e.jsx("h2",{children:"\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"}),e.jsxs("div",{className:"header-actions",children:[e.jsx(R,{size:"small",color:g?"primary":"default",onClick:U,title:g?"\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u043A \u0447\u0430\u0442\u0430\u043C":"\u041D\u0430\u0439\u0442\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",children:g?e.jsx(yt,{}):e.jsx(At,{})}),e.jsx(R,{size:"small",onClick:d,title:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u0447\u0430\u0442\u043E\u0432",children:e.jsx(Ft,{})})]})]}),g?e.jsx(Lt,{onClose:U}):e.jsxs("div",{className:"chat-search",children:[e.jsx("input",{type:"text",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F\u043C...",value:n,onChange:c=>_(c.target.value)}),n&&e.jsx(R,{size:"small",onClick:()=>_(""),sx:{padding:"4px"},title:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u043F\u043E\u0438\u0441\u043A",children:e.jsx(vt,{fontSize:"small"})})]}),!g&&(h?e.jsx("div",{className:"chat-list-loading",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0447\u0430\u0442\u043E\u0432..."}):x.length===0?e.jsx("div",{className:"chat-list-empty",children:n?"\u041D\u0435\u0442 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432 \u043F\u043E \u0432\u0430\u0448\u0435\u043C\u0443 \u0437\u0430\u043F\u0440\u043E\u0441\u0443":"\u0423 \u0432\u0430\u0441 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442 \u0447\u0430\u0442\u043E\u0432. \u041D\u0430\u0439\u0434\u0438\u0442\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F, \u0447\u0442\u043E\u0431\u044B \u043D\u0430\u0447\u0430\u0442\u044C \u0431\u0435\u0441\u0435\u0434\u0443."}):e.jsx("div",{className:"chat-list-items",children:x.map(c=>e.jsx(Et,{chat:c,isActive:j?.id===c.id,unreadCount:m[c.id]||0,onClick:()=>i(c.id),currentUserId:w?.id,onlineUsers:y},c.id))}))]})}),Bt=Me.memo(({onSendMessage:a,onTyping:l,onFileUpload:h,replyTo:j,onCancelReply:t})=>{const[m,b]=s.useState(""),[y,w]=s.useState(!1),[g,C]=s.useState(null),n=s.useRef(null),_=s.useRef(null);s.useEffect(()=>()=>{g&&(clearTimeout(g),l(!1))},[g,l]),s.useEffect(()=>{j&&_.current&&_.current.focus()},[j]);const x=s.useCallback(()=>{if(!m.trim()&&!y)return;const d=m;b(" "),setTimeout(()=>{b(""),_.current&&_.current.focus(),a(d)},10),g&&(clearTimeout(g),C(null)),l(!1)},[m,a,g,l,y]),k=s.useCallback(d=>{d.key!=="Enter"||d.shiftKey||(d.preventDefault(),x())},[x]),I=s.useCallback(d=>{const c=d.target.value;if(b(c),c.trim()&&!g){l(!0);const $=setTimeout(()=>{l(!1),C(null)},3e3);C($)}else if(!c.trim()&&g)clearTimeout(g),l(!1),C(null);else if(g){clearTimeout(g);const $=setTimeout(()=>{l(!1),C(null)},3e3);C($)}},[l,g]),U=s.useCallback(()=>{n.current&&(n.current.setAttribute("data-upload-type","photo"),n.current.click())},[]),i=s.useCallback(d=>{const c=d.target.files[0];c&&(c.size>52428800?alert("\u0424\u0430\u0439\u043B \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0431\u043E\u043B\u044C\u0448\u043E\u0439. \u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440: 50MB"):c.type.split("/")[0]==="image"?(w(!0),h(c,"photo").finally(()=>{w(!1),n.current&&(n.current.value="")})):alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435"))},[h]);return e.jsxs(D,{sx:{borderTop:"1px solid #2C2C2C",padding:"8px",backgroundColor:"#121212",display:"flex",flexDirection:"column",position:"relative"},children:[(()=>{if(!j)return null;let d="";return d=j.message_type==="text"?j.content.length>30?j.content.substring(0,30)+"...":j.content:j.message_type==="photo"?"\u{1F4F7} \u0424\u043E\u0442\u043E":j.message_type==="video"?"\u{1F3AC} \u0412\u0438\u0434\u0435\u043E":j.message_type==="audio"?"\u{1F3B5} \u0410\u0443\u0434\u0438\u043E":"\u{1F4CE} \u0424\u0430\u0439\u043B",e.jsxs(D,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",marginBottom:"4px",borderRadius:"12px 12px 0 0",backgroundColor:"#252525",borderLeft:"2px solid #D0BCFF"},children:[e.jsxs("div",{className:"reply-text",style:{color:"#d8d8d8"},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"bold",color:"#D0BCFF"},children:j.sender_name}),e.jsx("div",{style:{fontSize:"13px"},children:d})]}),e.jsx(R,{size:"small",onClick:t,sx:{color:"#6b6b6b",padding:"4px"},children:e.jsx(Be,{fontSize:"small"})})]})})(),e.jsxs(D,{sx:{display:"flex",alignItems:"center",backgroundColor:"#1C1C1C",borderRadius:"18px",padding:"0 4px"},children:[e.jsx(R,{size:"small",onClick:U,sx:{color:"#D0BCFF",padding:"8px","&:hover":{color:"#D0BCFF"}},children:e.jsx(kt,{fontSize:"small"})}),e.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:i,style:{display:"none"}}),e.jsx("textarea",{ref:_,value:m,onChange:I,onKeyDown:k,placeholder:"\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435...",disabled:y,style:{border:"none",backgroundColor:"transparent",color:"#ffffff",resize:"none",outline:"none",margin:"0",flex:1,minHeight:"20px",maxHeight:"80px",fontSize:"14px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',alignContent:"center"}}),e.jsx(R,{size:"small",onClick:x,disabled:!m.trim()&&!y,sx:{color:m.trim()?"#D0BCFF":"#3a3a3a",padding:"8px","&:hover":{color:m.trim()?"#D0BCFF":"#3a3a3a"}},children:y?e.jsx(Fe,{size:18,color:"inherit"}):e.jsx(Ct,{fontSize:"small"})})]})]})});var Qe,ve={};function Ut(){if(Qe)return ve;Qe=1;var a=xe();Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=void 0;var l=a(ge()),h=pe();return ve.default=(0,l.default)((0,h.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),ve}const Ht=je(Ut());var qe,Ce={};function Ot(){if(qe)return Ce;qe=1;var a=xe();Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.default=void 0;var l=a(ge()),h=pe();return Ce.default=(0,l.default)((0,h.jsx)("path",{d:"M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47M6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47m1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93"}),"RotateLeft"),Ce}const Vt=je(Ot());var et,ke={};function Xt(){if(et)return ke;et=1;var a=xe();Object.defineProperty(ke,"__esModule",{value:!0}),ke.default=void 0;var l=a(ge()),h=pe();return ke.default=(0,l.default)((0,h.jsx)("path",{d:"M15.55 5.55 11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03m3.89-2.42 1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48"}),"RotateRight"),ke}const Yt=je(Xt()),Kt=({src:a,onClose:l})=>{const[h,j]=s.useState(1),[t,m]=s.useState(0),[b,y]=s.useState(!1),[w,g]=s.useState({x:0,y:0}),[C,n]=s.useState({x:0,y:0});s.useEffect(()=>{const x=k=>{k.key==="Escape"&&l()};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[l]);const _=()=>{y(!1)};return e.jsxs("div",{className:"simple-image-viewer-overlay",onClick:l,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,cursor:b?"grabbing":"grab"},children:[e.jsx("img",{src:a,alt:"\u041F\u0440\u043E\u0441\u043C\u043E\u0442\u0440",onMouseDown:x=>{h<=1||(y(!0),n({x:x.clientX-w.x,y:x.clientY-w.y}))},onMouseMove:x=>{b&&g({x:x.clientX-C.x,y:x.clientY-C.y})},onMouseUp:_,onMouseLeave:_,onTouchStart:x=>{h<=1||(y(!0),n({x:x.touches[0].clientX-w.x,y:x.touches[0].clientY-w.y}))},onTouchMove:x=>{b&&g({x:x.touches[0].clientX-C.x,y:x.touches[0].clientY-C.y})},onTouchEnd:()=>{y(!1)},onDoubleClick:()=>{j(1),m(0),g({x:0,y:0})},onClick:x=>x.stopPropagation(),style:{maxWidth:"90%",maxHeight:"90%",objectFit:"contain",transform:`scale(${h}) rotate(${t}deg) translate(${w.x/h}px, ${w.y/h}px)`,transition:b?"none":"transform 0.2s ease",cursor:b?"grabbing":"grab"}}),e.jsxs("div",{className:"image-viewer-controls",onClick:x=>x.stopPropagation(),style:{position:"absolute",bottom:"20px",display:"flex",gap:"10px",background:"rgba(0, 0, 0, 0.6)",padding:"8px",borderRadius:"24px",backdropFilter:"blur(8px)"},children:[e.jsx(R,{onClick:()=>j(x=>Math.min(x+.25,3)),size:"small",sx:{color:"white"},children:e.jsx(Nt,{})}),e.jsx(R,{onClick:()=>j(x=>Math.max(x-.25,.5)),size:"small",sx:{color:"white"},children:e.jsx(Ht,{})}),e.jsx(R,{onClick:()=>m(x=>x-90),size:"small",sx:{color:"white"},children:e.jsx(Vt,{})}),e.jsx(R,{onClick:()=>m(x=>x+90),size:"small",sx:{color:"white"},children:e.jsx(Yt,{})})]}),e.jsx(R,{sx:{position:"absolute",top:"20px",right:"20px",color:"white",backgroundColor:"rgba(0, 0, 0, 0.6)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.8)"}},onClick:l,children:e.jsx(Be,{})})]})},Zt=s.memo(({userIds:a=[],chatMembers:l=[]})=>{if(!a.length)return null;const h=a.map(t=>{const m=l.find(b=>b.user_id===parseInt(t));return m?.name||m?.username||"\u041A\u0442\u043E-\u0442\u043E"});let j="";return h.length===1?j=`${h[0]} \u043F\u0435\u0447\u0430\u0442\u0430\u0435\u0442...`:h.length===2?j=`${h[0]} \u0438 ${h[1]} \u043F\u0435\u0447\u0430\u0442\u0430\u044E\u0442...`:h.length>2&&(j=`${h.length} \u0447\u0435\u043B\u043E\u0432\u0435\u043A \u043F\u0435\u0447\u0430\u0442\u0430\u044E\u0442...`),e.jsxs("div",{className:"typing-indicator",children:[e.jsxs("div",{className:"typing-animation",children:[e.jsx("span",{className:"dot"}),e.jsx("span",{className:"dot"}),e.jsx("span",{className:"dot"})]}),e.jsx("span",{className:"typing-text",children:j})]})}),Gt=s.memo(({message:a,isCurrentUser:l,decryptedContent:h,onReply:j,replyMessage:t,chatMembers:m=[],showDateSeparator:b=!1,dateSeparatorText:y=""})=>{const[w,g]=s.useState(!1),{getFileUrl:C,avatarCache:n,getAvatarUrl:_,deleteMessage:x}=fe(),[k,I]=s.useState(!1),[U,i]=s.useState(null),[d,c]=s.useState(null),[$,M]=s.useState(!1),[T,A]=s.useState(!1),[se,P]=s.useState(null),F=s.useRef(null),J=s.useRef(null);s.useEffect(()=>{J.current=document.querySelector(".messages-list")},[]);const re=()=>{M(!1)},ae=()=>{P(null)},G=s.useCallback(o=>{if(!m.length)return{name:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C",avatar:null};if(a.sender?.avatar)return{name:a.sender.name||a.sender.username||"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C",avatar:a.sender.avatar};const p=m.find(N=>(N.user_id||N.id)===o);if(!p)return{name:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C",avatar:null};let z=null;if(n&&n[o])z=n[o];else if(p.avatar||p.photo)if(_)z=_(o,p.avatar||p.photo);else{const N=p.avatar||p.photo;z=N?.startsWith("/static/")?N:`/static/uploads/avatar/${o}/${N}`}return{name:p.name||p.username||"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C",avatar:z}},[m,a.sender,n,_]),ce=s.useCallback(o=>G(o).name,[G]),ie=s.useCallback(o=>G(o).avatar,[G]),K=o=>{try{if(typeof o=="string"&&(/^\d{1,2}:\d{2}$/.test(o)||/^\d{1,2}\s+\w+$/.test(o)))return o;const p=o instanceof Date?o:new Date(o);if(isNaN(p.getTime()))return typeof o=="string"?o:"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E";const z=new Date;if(p.toLocaleDateString()===z.toLocaleDateString())return p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const N=new Date(z);return N.setDate(z.getDate()-7),p>N?$t(p,{addSuffix:!0,locale:Mt}):p.toLocaleString([],{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return typeof o=="string"?o:"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E"}},Q=o=>{if(!o)return"";if(o===0)return"0 Byte";const p=parseInt(Math.floor(Math.log(o)/Math.log(1024)));return Math.round(o/Math.pow(1024,p),2)+" "+["Bytes","KB","MB","GB"][p]},H=()=>{if(!l)return null;const o=a.read_by&&a.read_by.length>0||a.read_count&&a.read_count>0;return e.jsx("span",{className:"read-status "+(o?"read":"unread"),style:{display:"inline-flex",alignItems:"center",height:"12px"},children:o?e.jsx(wt,{sx:{fontSize:14}}):e.jsx(St,{sx:{fontSize:14}})})},X=ie(a.sender_id),le=m&&m.length>2;return e.jsxs(e.Fragment,{children:[b&&e.jsx("div",{className:"date-separator",children:e.jsx("span",{children:y})}),e.jsx("div",{ref:F,className:`message-item ${l?"my-message":"their-message"} ${T?"deleting":""}`,style:{transition:"opacity 0.3s ease, transform 0.3s ease, max-height 0.3s ease, margin 0.3s ease, padding 0.3s ease",opacity:T?0:1,transform:T?"scale(0.8)":"scale(1)",position:"relative"},onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsxs("div",{className:"message-container",children:[!l&&le&&e.jsx("div",{className:"message-avatar",children:X?e.jsx("img",{src:X,alt:a.sender_name||"Avatar"}):e.jsx("div",{className:"avatar-placeholder",children:(a.sender_name?.charAt(0)||"U").toUpperCase()})}),e.jsxs("div",{className:"message-content",children:[!l&&le&&e.jsx("div",{className:"message-sender",children:a.sender_name||ce(a.sender_id)}),a.reply_to_id&&(()=>{if(!t)return null;const o=ce(t.sender_id);let p="";switch(t.message_type){case"text":p=t.content.length>30?t.content.substring(0,15)+"...":t.content;break;case"photo":p="\u{1F4F7} \u0424\u043E\u0442\u043E";break;case"video":p="\u{1F3AC} \u0412\u0438\u0434\u0435\u043E";break;case"audio":p="\u{1F3B5} \u0410\u0443\u0434\u0438\u043E";break;default:p="\u{1F4CE} \u0424\u0430\u0439\u043B"}return e.jsxs("div",{className:"replied-message",children:[e.jsx("span",{className:"reply-sender",children:o}),e.jsx("span",{className:"reply-content",children:p})]})})(),e.jsx("div",{className:"message-bubble",children:(()=>{const o=e.jsxs("span",{className:"message-time-inline",children:[K(a.created_at),H()]});switch(a.message_type){case"text":const p=h.length>30;return e.jsxs("div",{className:"message-text-container",style:{flexDirection:p?"column":"row",alignItems:"flex-end",flexWrap:"nowrap",justifyContent:"space-between"},children:[e.jsx("p",{className:"message-text",style:{whiteSpace:"pre-wrap",wordBreak:"break-all",overflowWrap:"break-word",display:p?"block":"inline",textAlign:"left",width:p?"100%":"auto",marginRight:p?"0":"8px"},children:h}),o]});case"photo":const z=a.photo_url||C(a.chat_id,a.content);return a.mime_type==="image/gif"||a.content&&a.content.toLowerCase().endsWith(".gif"),e.jsxs("div",{className:"message-content-wrapper",children:[e.jsx("div",{className:"message-photo",onClick:E=>E.stopPropagation(),children:e.jsx("img",{src:z,alt:"\u0424\u043E\u0442\u043E",loading:"lazy",onClick:E=>((ne,oe)=>{ne.stopPropagation(),i(oe),I(!0)})(E,z),style:{objectFit:"contain",maxWidth:"100%",imageRendering:"auto",cursor:"pointer",position:"relative",zIndex:5}})}),e.jsxs("span",{className:"message-time-inline",style:{alignSelf:"flex-end"},children:[K(a.created_at),H()]})]});case"video":const N=C(a.chat_id,a.content);return e.jsxs("div",{className:"message-content-wrapper",children:[e.jsx("div",{className:"message-video",children:e.jsx("video",{controls:!0,preload:"metadata",src:N})}),e.jsxs("span",{className:"message-time-inline",style:{alignSelf:"flex-end"},children:[K(a.created_at),H()]})]});case"audio":const L=C(a.chat_id,a.content);return e.jsxs("div",{className:"message-content-wrapper",children:[e.jsx("div",{className:"message-audio",children:e.jsx("audio",{controls:!0,preload:"metadata",src:L})}),e.jsxs("span",{className:"message-time-inline",style:{alignSelf:"flex-end"},children:[K(a.created_at),H()]})]});case"file":const O=C(a.chat_id,a.content);return e.jsxs("div",{className:"message-content-wrapper",children:[e.jsx("div",{className:"message-file",children:e.jsxs("a",{href:O,target:"_blank",rel:"noopener noreferrer",className:"file-link",children:[e.jsx("span",{className:"file-icon",children:"\u{1F4C4}"}),e.jsxs("span",{className:"file-details",children:[e.jsx("span",{className:"file-name",children:a.original_filename}),e.jsx("span",{className:"file-size",children:Q(a.file_size)})]})]})}),e.jsxs("span",{className:"message-time-inline",style:{alignSelf:"flex-end"},children:[K(a.created_at),H()]})]});default:return e.jsxs("div",{className:"message-text-container",children:[e.jsx("p",{className:"message-text",children:"\u041D\u0435\u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043C\u044B\u0439 \u0442\u0438\u043F \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"}),o]})}})()})]}),e.jsxs("div",{className:"message-actions "+(w?"visible":""),onClick:o=>o.stopPropagation(),children:[e.jsx(R,{size:"small",onClick:o=>{o.stopPropagation(),j&&j(a)},className:"action-button reply-button",children:e.jsx(_t,{fontSize:"small"})}),l&&e.jsx(R,{size:"small",onClick:o=>{o.stopPropagation(),(p=>{p.stopPropagation(),c(null),M(!0)})(o)},className:"action-button delete-button",children:e.jsx(Ze,{fontSize:"small"})})]})]})}),e.jsxs(Ee,{open:$,onClose:re,PaperProps:{sx:{borderRadius:"16px",bgcolor:"background.paper",backgroundImage:"linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))",boxShadow:"0 8px 20px rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.12)",overflow:"hidden",maxWidth:"360px",width:"90%"}},children:[e.jsx(Le,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.08)",py:2,px:3},children:e.jsx(Y,{variant:"h6",component:"div",sx:{fontWeight:600,color:"primary.main"},children:"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"})}),e.jsxs(We,{sx:{py:3,px:3},children:[e.jsx(He,{sx:{color:"text.primary",mb:1},children:"\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435?"}),e.jsx(He,{sx:{color:"text.secondary",fontSize:"0.875rem"},children:"\u042D\u0442\u043E \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043D\u0435\u043B\u044C\u0437\u044F \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C."})]}),e.jsxs(Ae,{sx:{px:2,py:2,borderTop:"1px solid rgba(255, 255, 255, 0.08)",justifyContent:"space-between"},children:[e.jsx(V,{onClick:re,variant:"outlined",sx:{borderRadius:"20px",px:2,fontSize:"0.875rem",textTransform:"none",fontWeight:500},children:"\u041E\u0442\u043C\u0435\u043D\u0430"}),e.jsx(V,{onClick:async()=>{if(a&&a.id){A(!0),M(!1);const o=J.current,p=o?.scrollTop,z=o?.scrollHeight;try{const N=await x(a.id);N&&N.success?F.current&&(F.current.classList.add("deleting"),setTimeout(()=>{F.current&&(F.current.style.opacity="0",F.current.style.transform="scale(0.8)",F.current.style.maxHeight="0",F.current.style.marginTop="0",F.current.style.marginBottom="0",F.current.style.padding="0",setTimeout(()=>{if(o){const L=o.scrollHeight,O=z-L;O>0&&p?o.scrollTop=p-O:p&&(o.scrollTop=p)}},50))},50)):(P(N?.error||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"),A(!1))}catch{P("\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"),A(!1)}}},color:"error",variant:"contained",sx:{borderRadius:"20px",px:2,fontSize:"0.875rem",textTransform:"none",fontWeight:500,boxShadow:"0 4px 12px rgba(211, 47, 47, 0.25)"},autoFocus:!0,children:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"})]})]}),k&&U&&e.jsx(Kt,{src:U,onClose:()=>{I(!1)}}),e.jsx(it,{open:!!se,autoHideDuration:6e3,onClose:ae,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(lt,{onClose:ae,severity:"error",sx:{width:"100%",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",borderRadius:"12px",border:"1px solid rgba(211, 47, 47, 0.2)"},children:se})})]})}),Jt=()=>e.jsxs("div",{className:"moderator-banner",children:[e.jsxs("div",{className:"moderator-banner-content",children:[e.jsx("i",{className:"fas fa-shield-alt mr-2"}),e.jsxs("span",{children:[e.jsx("strong",{children:"\u0412\u043D\u0438\u043C\u0430\u043D\u0438\u0435!"})," \u0412\u044B \u043E\u0431\u0449\u0430\u0435\u0442\u0435\u0441\u044C \u0441 \u043C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440\u043E\u043C \u043F\u043B\u0430\u0442\u0444\u043E\u0440\u043C\u044B. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0431\u0443\u0434\u044C\u0442\u0435 \u0432\u0435\u0436\u043B\u0438\u0432\u044B \u0438 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B. \u041C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440 \u043F\u043E\u043C\u043E\u0436\u0435\u0442 \u0440\u0435\u0448\u0438\u0442\u044C \u0432\u0430\u0448\u0438 \u0432\u043E\u043F\u0440\u043E\u0441\u044B \u0438\u043B\u0438 \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u044B."]})]}),e.jsx("style",{jsx:!0,children:`
        .moderator-banner {
          background-color:rgb(26 26 26);
          border-left: 4px solidrgb(131, 59, 246);
          padding: 10px 15px;
          margin-bottom: 15px;
          border-radius: 4px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
          position: sticky;
          top: -16px;
          z-index: 100;
        }
        .moderator-banner-content {
          display: flex;
          align-items: center;
          font-size: 14px;
          color:rgb(167, 109, 187);
        }
        .moderator-banner-content i {
          font-size: 18px;
          color:rgba(178, 59, 246, 0.83);
          margin-right: 8px;
        }
      `})]}),tt=s.memo(({backAction:a,isMobile:l,currentChat:h,setCurrentChat:j})=>{const{activeChat:t,messages:m,loadMessages:b,hasMoreMessages:y,loadingMessages:w,typingUsers:g,sendTextMessage:C,sendTypingIndicator:n,decryptMessage:_,uploadFile:x,user:k,onlineUsers:I,deleteChat:U}=fe(),i=gt(),[d,c]=s.useState(null),$=s.useRef(null),M=s.useRef(null),T=s.useRef(null),[A,se]=s.useState(!0),[P,F]=s.useState(!0),J=s.useRef(null),re=s.useRef(null),[ae,G]=s.useState(null),[ce,ie]=s.useState(!1),[K,Q]=s.useState(!1),[H,X]=s.useState(!1),[le,o]=s.useState(!1),[p,z]=s.useState(""),N="https://k-connect.ru/apiMes",L="https://k-connect.ru",O=()=>{G(null)};s.useEffect(()=>{t?.id&&(J.current=t.id)},[t]),s.useEffect(()=>{let r=!0;if(t?.id&&(!m[t.id]||m[t.id].length===0)){const u=setTimeout(()=>{r&&J.current===t.id&&(b(t.id),t.is_group&&setTimeout(()=>{!r||J.current!==t.id||m[t.id]&&m[t.id].length!==0||b(t.id)},1500))},100);return()=>{r=!1,clearTimeout(u)}}return()=>{r=!1}},[t,b,m]),s.useEffect(()=>{if(t&&m[t.id]){const r=m[t.id].hasModeratorMessages;if(r!==void 0)Q(r);else{const u=m[t.id].some(v=>v.is_from_moderator||t.members&&t.members.some(S=>S.id===v.sender_id&&S.is_moderator));Q(u)}}else Q(!1)},[t,m]);const E=s.useCallback((r=!1)=>{$.current&&$.current.scrollIntoView({behavior:r?"smooth":"auto",block:"end"})},[]);s.useEffect(()=>{t&&m[t.id]&&P&&setTimeout(()=>{E()},100)},[t,m,E,P]),s.useEffect(()=>{t&&m[t.id]&&setTimeout(()=>{E(),F(!0)},100)},[t?.id]);const ne=s.useCallback(()=>{if(T.current){const{scrollHeight:r,scrollTop:u,clientHeight:v}=T.current,S=Math.abs(r-u-v)<50;se(S),S&&!P?F(!0):!S&&P&&F(!1)}},[P]),oe=s.useCallback(()=>{let r=!1;return()=>{r||(ne(),r=!0,setTimeout(()=>{r=!1},200))}},[ne]);s.useEffect(()=>{const r=T.current,u=oe();if(r)return r.addEventListener("scroll",u),()=>r.removeEventListener("scroll",u)},[oe]);const f=t&&y&&Object.prototype.hasOwnProperty.call(y,t.id)&&y[t.id];(({target:r,onIntersect:u,threshold:v=.1,rootMargin:S="0px",enabled:B=!0,debounceTime:he=300})=>{const ee=s.useRef(null);s.useEffect(()=>{if(!B||!r.current)return;const Ne=new IntersectionObserver(Re=>{const[nt]=Re;nt.isIntersecting&&(ee.current&&clearTimeout(ee.current),ee.current=setTimeout(()=>{u(),ee.current=null},he))},{threshold:v,rootMargin:S});return Ne.observe(r.current),()=>{ee.current&&clearTimeout(ee.current),Ne.disconnect()}},[r,B,v,S,u,he])})({target:M,onIntersect:()=>{if(t&&f&&!w){const r=T.current;if(r){const u=r.scrollHeight,v=r.scrollTop;b(t.id).then(()=>{setTimeout(()=>{if(r){const S=r.scrollHeight-u;r.scrollTop=v+S}},100)})}else b(t.id)}},enabled:!!t&&f&&!w,threshold:.5,rootMargin:"100px"});const W=s.useCallback(async r=>{if(t&&r.trim())try{const u=d?d.id:null;await C(t.id,r,u),c(null),setTimeout(()=>E(!0),100)}catch{}},[t,d,C,E]),de=s.useCallback(async(r,u)=>{if(t&&r)try{const v=d?d.id:null;await x(t.id,r,u,v),c(null),setTimeout(()=>E(!0),100)}catch{}},[t,d,x,E]),ue=s.useCallback(r=>{if(t)if(r){const u=new Date().getTime();u-(re.current||0)>2e3&&(n(t.id,r),re.current=u)}else n(t.id,r)},[t,n]),st=s.useCallback(()=>{if(!t||!g[t.id])return null;const r=Object.keys(g[t.id]);return r.length===0?null:e.jsx(Zt,{userIds:r,chatMembers:t.members})},[t,g]),me=s.useCallback(()=>{if(!t)return"\u0427\u0430\u0442";if(t.is_group||t.chat_type==="group")return t.title||"\u0413\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u0447\u0430\u0442";{const r=t.members?.find(u=>{const v=u.user_id||u.id,S=v?String(v):null,B=k?.id?String(k.id):null;return S&&B&&S!==B});return r?r.name||r.username||t.title||"\u041B\u0438\u0447\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043F\u0438\u0441\u043A\u0430":t.title||"\u041B\u0438\u0447\u043D\u0430\u044F \u043F\u0435\u0440\u0435\u043F\u0438\u0441\u043A\u0430"}},[t,k]),_e=s.useCallback(()=>{if(!t)return null;if(t.is_group||t.chat_type==="group")return t.avatar||null;{const r=t.members?.find(u=>{const v=u.user_id||u.id,S=v?String(v):null,B=k?.id?String(k.id):null;return S&&B&&S!==B});if(r){const u=r.user_id||r.id,v=r.photo||r.avatar;return!v||!u||typeof v!="string"||v.startsWith("/")||v.startsWith("http")||v.startsWith("/static/")?r.avatar||r.photo||null:`/static/uploads/avatar/${u}/${v}`}return t.avatar||null}},[t,k]),Ue=s.useCallback(()=>me()?.[0]?.toUpperCase()||"?",[me]),ze=t&&m[t.id]||[],rt=Me.useMemo(()=>t?ze.map(r=>e.jsx(Gt,{message:r,isCurrentUser:r.sender_id===k?.id,decryptedContent:t?.encrypted?_(r,t.id):r.content,onReply:()=>c(r),replyMessage:r.reply_to_id?ze.find(u=>u.id===r.reply_to_id):null,chatMembers:t?.members},r.id)):[],[ze,k,t,_,c]),Z=s.useMemo(()=>t&&!t.is_group&&t.members?t.members.find(r=>{const u=r.user_id||r.id,v=u?String(u):null,S=k?.id?String(k.id):null;return v&&S&&v!==S}):null,[t,k]),q=s.useMemo(()=>{if(!Z)return!1;if(Z.gender)return Z.gender==="female";const r=Z.name||"";return r.endsWith("\u0430")||r.endsWith("\u044F")},[Z]),at=s.useMemo(()=>Z?I[Z.user_id||Z.id]?"\u0412 \u0441\u0435\u0442\u0438":Z.last_active?(r=>{if(!r)return"\u041D\u0435 \u0432 \u0441\u0435\u0442\u0438";try{if(typeof r=="string"&&/^\d{1,2}:\d{2}$/.test(r)){const Ne={month:"long",day:"numeric"},Re=new Date().toLocaleDateString("ru-RU",Ne);return`\u0411\u044B\u043B${q?"\u0430":""} \u0432 \u0441\u0435\u0442\u0438 ${Re} \u0432 ${r}`}if(typeof r=="string"&&/^\d{1,2}\s+\w+$/.test(r))return`\u0411\u044B\u043B${q?"\u0430":""} \u0432 \u0441\u0435\u0442\u0438 ${r}`;const u=r instanceof Date?r:new Date(r);if(isNaN(u.getTime()))return typeof r=="string"?`\u0411\u044B\u043B${q?"\u0430":""} \u0432 \u0441\u0435\u0442\u0438 ${r}`:"\u041D\u0435 \u0432 \u0441\u0435\u0442\u0438";const v=new Date-u,S=Math.floor(v/6e4),B=Math.floor(S/60),he=Math.floor(B/24);if(S<1)return"\u0412 \u0441\u0435\u0442\u0438";if(S<60)return`\u0411\u044B\u043B${q?"\u0430":""} \u0432 \u0441\u0435\u0442\u0438 ${S} \u043C\u0438\u043D. \u043D\u0430\u0437\u0430\u0434`;if(B<24)return`\u0411\u044B\u043B${q?"\u0430":""} \u0432 \u0441\u0435\u0442\u0438 ${B} \u0447. \u043D\u0430\u0437\u0430\u0434`;if(he<7)return`\u0411\u044B\u043B${q?"\u0430":""} \u0432 \u0441\u0435\u0442\u0438 ${he} \u0434\u043D. \u043D\u0430\u0437\u0430\u0434`;const ee={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return`\u0411\u044B\u043B${q?"\u0430":""} \u0432 \u0441\u0435\u0442\u0438 ${u.toLocaleString("ru-RU",ee)}`}catch{return typeof r=="string"?`\u0411\u044B\u043B${q?"\u0430":""} \u0432 \u0441\u0435\u0442\u0438 ${r}`:"\u041D\u0435 \u0432 \u0441\u0435\u0442\u0438"}})(Z.last_active):"\u041D\u0435 \u0432 \u0441\u0435\u0442\u0438":"\u041D\u0435 \u0432 \u0441\u0435\u0442\u0438",[Z,I]),Te=t&&t.members&&k&&t.members.some(r=>r.user_id===k.id&&r.role==="admin"),[De,Ie]=s.useState(""),[Se,we]=s.useState(!1);return s.useEffect(()=>{H&&t?.title&&(Ie(t.title),we(!1))},[H,t?.title]),t?e.jsxs(D,{sx:{display:"flex",flexDirection:"column",height:"100%",bgcolor:"background.paper"},children:[e.jsxs(D,{sx:{display:"flex",alignItems:"center",p:2,borderBottom:"1px solid",borderColor:"divider",bgcolor:"background.paper"},children:[l&&e.jsx(R,{onClick:a,sx:{mr:2},children:e.jsx(ot,{})}),e.jsx($e,{src:_e()?`${L}${_e()}`:void 0,alt:me(),sx:{width:40,height:40,mr:2,cursor:"pointer"},onClick:()=>{t?.is_group&&X(!0)},children:Ue()}),e.jsxs(D,{sx:{flex:1},children:[e.jsx(Y,{variant:"subtitle1",noWrap:!0,children:me()}),!t.is_group&&t.chat_type!=="group"&&e.jsx(Y,{variant:"caption",color:"text.secondary",children:at}),t.is_group&&e.jsxs(Y,{variant:"caption",color:"text.secondary",children:[t.members?.length||0," \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u0432"]}),t.encrypted&&e.jsx(Y,{variant:"caption",color:"text.secondary",children:"\u{1F512}"})]}),e.jsx(R,{onClick:r=>{G(r.currentTarget)},children:e.jsx(Tt,{})}),e.jsxs(ct,{anchorEl:ae,open:!!ae,onClose:O,PaperProps:{sx:{backgroundColor:"rgba(10, 10, 10, 0.75)",color:"#fff",boxShadow:"0 8px 32px 0 rgba(0,0,0,0.37)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",borderRadius:l?0:3,border:"1px solid rgba(40,40,40,0.5)",minWidth:180,p:.5}},children:[!t?.is_group&&e.jsxs(Oe,{onClick:()=>{if(!t||t.is_group)return;const r=t.members?.find(u=>(u.user_id||u.id)!==k?.id);r&&i(`/profile/${r.username}`),O()},children:[e.jsx(zt,{fontSize:"small",style:{marginRight:"8px"}}),"\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F"]}),e.jsxs(Oe,{onClick:()=>{O(),ie(!0)},children:[e.jsx(Ze,{fontSize:"small",style:{marginRight:"8px"}}),"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0442"]})]})]}),e.jsxs(Ee,{fullScreen:l,open:H,onClose:()=>X(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"rgba(10, 10, 10, 0.75)",color:"#fff",boxShadow:"0 8px 32px 0 rgba(0,0,0,0.37)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",borderRadius:l?0:3,border:"1px solid rgba(40,40,40,0.5)"}},children:[e.jsx(Le,{sx:{bgcolor:"transparent",color:"#fff"},children:e.jsxs(D,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(Y,{variant:"h6",children:"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u0433\u0440\u0443\u043F\u043F\u0435"}),e.jsx(R,{onClick:()=>X(!1),children:e.jsx(dt,{})})]})}),e.jsxs(We,{sx:{bgcolor:"transparent",color:"#fff"},children:[e.jsxs(D,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,my:2},children:[e.jsx($e,{src:_e()?`${L}${_e()}`:void 0,alt:me(),sx:{width:100,height:100,cursor:"pointer"},onClick:()=>document.getElementById("groupAvatarInput").click(),children:Ue()}),e.jsx("input",{type:"file",id:"groupAvatarInput",accept:"image/*",style:{display:"none"},onChange:async r=>{const u=r.target.files[0];if(!u)return;const v=new FormData;v.append("avatar",u);try{const S=await te.post(`${N}/messenger/chats/${t.id}/update`,v,{headers:{"Content-Type":"multipart/form-data"}});S.data.success&&(j(B=>({...B,avatar:S.data.avatar})),z("\u0410\u0432\u0430\u0442\u0430\u0440 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D"),o(!0))}catch{z("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0430\u0432\u0430\u0442\u0430\u0440\u0430"),o(!0)}}}),e.jsx(Pe,{fullWidth:!0,label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0433\u0440\u0443\u043F\u043F\u044B",value:Se?De:t?.title||"",onChange:r=>Ie(r.target.value),variant:"outlined",disabled:!Te||!Se,InputProps:{endAdornment:Te&&!Se?e.jsx(R,{size:"small",onClick:()=>we(!0),children:e.jsx(Dt,{fontSize:"small"})}):null}}),Te&&Se&&e.jsxs(D,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(V,{variant:"contained",size:"small",onClick:async()=>{await(async r=>{try{(await te.post(`${N}/messenger/chats/${t.id}/update`,{title:r})).data.success&&(j(u=>({...u,title:r})),z("\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u043E"),o(!0))}catch{z("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F"),o(!0)}})(De),we(!1)},disabled:!De.trim(),children:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"}),e.jsx(V,{size:"small",onClick:()=>{Ie(t.title),we(!1)},children:"\u041E\u0442\u043C\u0435\u043D\u0430"})]})]}),e.jsx(Y,{variant:"h6",sx:{mt:2,mb:1},children:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u0438"}),e.jsx(Ve,{children:t?.members?.map(r=>e.jsxs(Xe,{children:[e.jsx(Ye,{children:e.jsx($e,{src:r.avatar?`${L}${r.avatar}`:void 0,children:r.name?.[0]})}),e.jsx(Ke,{primary:r.name||r.username||`\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C #${r.user_id}`,secondary:r.role==="admin"?"\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440":"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A"})]},r.user_id))})]}),e.jsxs(Ae,{children:[e.jsx(V,{onClick:()=>X(!1),children:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"}),e.jsx(V,{onClick:()=>{(async()=>{try{const r=await te.post(`${N}/messenger/chats/${t.id}/invite`);if(r.data.success){const u=`${window.location.origin}/messenger/join/${r.data.invite_link}`;await navigator.clipboard.writeText(u),z("\u0421\u0441\u044B\u043B\u043A\u0430 \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430"),o(!0)}}catch{z("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u0438 \u0441\u0441\u044B\u043B\u043A\u0438"),o(!0)}})(),X(!1)},startIcon:e.jsx(ut,{}),children:"\u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u0441\u044B\u043B\u043A\u0443"})]})]}),e.jsxs(D,{sx:{flex:1,overflow:"auto",p:2,display:"flex",flexDirection:"column",gap:1},children:[(t?.chat_type==="personal"&&t?.members?.some(r=>r.id!==k?.id&&r.is_moderator)||K)&&e.jsx(Jt,{}),f&&e.jsx("div",{ref:M,className:"load-more-trigger",children:w&&e.jsxs("div",{className:"loading-more",children:[e.jsx("div",{className:"loading-spinner-small"}),e.jsx("span",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0438\u0441\u0442\u043E\u0440\u0438\u0438..."})]})}),e.jsx("div",{className:"messages-list",children:rt}),st(),e.jsx("div",{ref:$})]}),A?null:e.jsx("button",{className:"scroll-to-bottom",onClick:()=>{F(!0),E(!0)},children:"\u2193"}),e.jsx(Bt,{onSendMessage:W,onTyping:ue,onFileUpload:de,replyTo:d,onCancelReply:()=>c(null)})]}):e.jsx("div",{className:"chat-window chat-window-empty",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0447\u0430\u0442 \u0438\u043B\u0438 \u043D\u0430\u0447\u043D\u0438\u0442\u0435 \u043D\u043E\u0432\u044B\u0439"}),e.jsx("p",{children:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0439 \u0447\u0430\u0442 \u0441\u043B\u0435\u0432\u0430 \u0438\u043B\u0438 \u0441\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043D\u043E\u0432\u044B\u0439, \u0447\u0442\u043E\u0431\u044B \u043D\u0430\u0447\u0430\u0442\u044C \u043E\u0431\u0449\u0435\u043D\u0438\u0435"})]})})}),Qt=()=>{const a=mt(),l=s.useContext(ft),h=ht(a.breakpoints.down("sm")),[j,t]=Me.useState(!0),[m,b]=Me.useState(!1),[y,w]=s.useState(null),[g,C]=s.useState(!1),[n,_]=s.useState(null),[x,k]=s.useState(null),[I,U]=s.useState(!1),[i,d]=s.useState(!1),[c,$]=s.useState(""),[M,T]=s.useState(!1),[A,se]=s.useState(""),[P,F]=s.useState([]),[J,re]=s.useState([]),[ae,G]=s.useState([]),[ce,ie]=s.useState(!1),[K,Q]=s.useState("followers"),H=n&&n.members&&l.user&&n.members.some(f=>f.user_id===l.user.id&&f.role==="admin"),[X,le]=s.useState(""),[o,p]=s.useState(!1),z=f=>{const W=`; ${document.cookie}`.split(`; ${f}=`);return W.length===2?W.pop().split(";").shift():null},N=z("session_key")||z("jwt")||z("token"),L=localStorage.getItem("token")||N,O=l.sessionKey||l.session_key||localStorage.getItem("session_key")||N||y||L,E="https://k-connect.ru/apiMes",ne="https://k-connect.ru/api";s.useEffect(()=>{M&&l.user&&(ie(!0),Promise.all([te.get(`${ne}/users/${l.user.username}/followers`),te.get(`${ne}/users/${l.user.username}/following`)]).then(([f,W])=>{re(f.data.followers||[]),G(W.data.following||[])}).catch(f=>{}).finally(()=>{ie(!1)}))},[M,l.user]),s.useEffect(()=>{!O&&l.isAuthenticated&&l.user&&!g&&(C(!0),(async()=>{try{const f=await te.get(`${E}/auth/get-session-key`,{withCredentials:!0,headers:{Authorization:`Bearer ${L}`,"Cache-Control":"no-cache"}});f.data?.session_key&&(localStorage.setItem("session_key",f.data.session_key),w(f.data.session_key))}catch{L&&!localStorage.getItem("session_key")&&(localStorage.setItem("session_key",L),w(L))}finally{C(!1)}})())},[l.isAuthenticated,l.user,L,O,g,E]),s.useEffect(()=>{N&&!localStorage.getItem("session_key")&&localStorage.setItem("session_key",N)},[N]);const oe=l.user?.type==="channel";return s.useEffect(()=>{},[l,O,N,L,y,E]),l.loading||g?e.jsx(D,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"70vh"},children:e.jsx(Fe,{})}):oe?e.jsxs(D,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"70vh"},children:[e.jsx(Y,{variant:"h6",color:"error",gutterBottom:!0,children:"\u0424\u0443\u043D\u043A\u0446\u0438\u044F \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0430"}),e.jsx(Y,{variant:"body1",children:"\u041A\u0430\u043D\u0430\u043B\u044B \u043D\u0435 \u043C\u043E\u0433\u0443\u0442 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u043C\u0435\u0441\u0441\u0435\u043D\u0434\u0436\u0435\u0440. \u041C\u0435\u0441\u0441\u0435\u043D\u0434\u0436\u0435\u0440 \u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D \u0442\u043E\u043B\u044C\u043A\u043E \u0434\u043B\u044F \u043E\u0431\u044B\u0447\u043D\u044B\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439."})]}):O?e.jsxs(D,{sx:{mt:2.5},children:[e.jsx(jt,{title:"\u041C\u0435\u0441\u0441\u0435\u043D\u0434\u0436\u0435\u0440",description:"\u041E\u0431\u043C\u0435\u043D \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F\u043C\u0438 \u0438 \u0447\u0430\u0442\u044B \u043D\u0430 \u043F\u043B\u0430\u0442\u0444\u043E\u0440\u043C\u0435 \u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442"}),e.jsx(bt,{children:e.jsxs(D,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},height:{xs:"calc(100vh - 120px)",md:"calc(100vh - 104px)"},maxWidth:"1400px",mx:"auto",mt:1,mb:2,overflow:"hidden",bgcolor:"content.main",borderRadius:2,position:"relative"},children:[e.jsxs(D,{sx:{width:{xs:"100%",md:"350px"},borderRight:{md:`1px solid ${a.palette.divider}`},display:h&&!j?"none":"block",height:"100%",overflow:"hidden"},children:[e.jsx(D,{sx:{p:2,display:"flex",justifyContent:"center"},children:e.jsx(V,{variant:"contained",startIcon:e.jsx(It,{}),onClick:()=>T(!0),fullWidth:!0,children:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u0443"})}),e.jsx(Pt,{onSelectChat:()=>{h&&(b(!0),setTimeout(()=>{t(!1)},50))}})]}),h?e.jsx(D,{id:"mobile-chat-container",className:"messenger-main "+(m?"slide-in":"slide-out"),sx:{display:"block",transform:m?"translateX(0%) !important":"translateX(100%) !important",transition:"transform 0.3s ease-in-out",position:"fixed",top:0,left:0,right:0,bottom:0,width:"100%",height:"100vh",zIndex:1300,backgroundColor:a.palette.background.paper,overflowX:"hidden",maxWidth:"100vw",WebkitOverflowScrolling:"touch",touchAction:"manipulation"},children:e.jsx(tt,{backAction:()=>{h&&(b(!1),setTimeout(()=>{t(!0)},300))},isMobile:h})}):e.jsx(D,{sx:{flex:1,display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:e.jsx(tt,{})})]})}),e.jsxs(Ee,{open:M,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"rgba(10, 10, 10, 0.75)",color:"#fff",boxShadow:"0 8px 32px 0 rgba(0,0,0,0.37)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",borderRadius:h?0:3,border:"1px solid rgba(40,40,40,0.5)"}},children:[e.jsxs(Le,{sx:{bgcolor:"transparent",color:"#fff"},children:["\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u0443",e.jsx(R,{"aria-label":"close",onClick:()=>T(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx(Be,{})})]}),e.jsxs(We,{sx:{bgcolor:"transparent",color:"#fff"},children:[e.jsx(Pe,{autoFocus:!0,margin:"dense",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0433\u0440\u0443\u043F\u043F\u044B",fullWidth:!0,value:A,onChange:f=>se(f.target.value),sx:{mb:2}}),e.jsxs(D,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:[e.jsx(V,{color:K==="followers"?"primary":"inherit",onClick:()=>Q("followers"),children:"\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0438"}),e.jsx(V,{color:K==="following"?"primary":"inherit",onClick:()=>Q("following"),children:"\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0438"})]}),ce?e.jsx(D,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(Fe,{})}):e.jsx(Ve,{sx:{maxHeight:400,overflow:"auto"},children:(K==="followers"?J:ae).map(f=>e.jsxs(Xe,{secondaryAction:e.jsx(xt,{edge:"end",checked:P.some(W=>W.id===f.id),onChange:()=>(W=>{F(de=>de.some(ue=>ue.id===W.id)?de.filter(ue=>ue.id!==W.id):[...de,W])})(f)}),children:[e.jsx(Ye,{children:e.jsx($e,{src:f.photo?`https://k-connect.ru/static/uploads/avatar/${f.id}/${f.photo}`:void 0,alt:f.name,children:f.name?.[0]})}),e.jsx(Ke,{primary:f.name||f.username,secondary:f.username})]},f.id))})]}),e.jsxs(Ae,{children:[e.jsx(V,{onClick:()=>T(!1),children:"\u041E\u0442\u043C\u0435\u043D\u0430"}),e.jsx(V,{onClick:async()=>{if(A.trim()&&P.length!==0)try{(await te.post(`${E}/messenger/chats/group`,{title:A,member_ids:P.map(f=>f.id),is_group:!0})).data.success&&(T(!1),se(""),F([]),window.location.reload())}catch{}},variant:"contained",disabled:!A.trim()||P.length===0,children:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C"})]})]}),n&&n.is_group&&e.jsx(D,{sx:{display:"flex",alignItems:"center",gap:1},children:o?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{value:X,onChange:f=>le(f.target.value),size:"small",disabled:!H}),e.jsx(V,{onClick:async()=>{await(async f=>{try{(await te.post(`${E}/messenger/chats/${n.id}/update`,{title:f})).data.success&&(_(W=>({...W,title:f})),$("\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0433\u0440\u0443\u043F\u043F\u044B \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u043E"),d(!0))}catch{$("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F"),d(!0)}})(X),p(!1)},disabled:!H||!X.trim(),size:"small",variant:"contained",children:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"}),e.jsx(V,{onClick:()=>p(!1),size:"small",children:"\u041E\u0442\u043C\u0435\u043D\u0430"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{variant:"h6",children:n.title}),H&&e.jsx(R,{size:"small",onClick:()=>{le(n.title),p(!0)},children:e.jsx(pt,{fontSize:"small"})})]})})]}):e.jsxs(D,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"70vh"},children:[e.jsx(Y,{variant:"h6",gutterBottom:!0,children:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438"}),e.jsx(Y,{variant:"body1",mb:2,children:"\u0414\u043B\u044F \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u043C\u0435\u0441\u0441\u0435\u043D\u0434\u0436\u0435\u0440\u0443 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u043E\u0432\u0430\u0442\u044C\u0441\u044F"})]})};export{Qt as default};
