const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Login.C_21mygB.js","./vendor-mui.08p3AH88.js","./vendor-react.DF-_cTkv.js","./vendor-router.BRqU_Zs2.js","./vendor.CL98q8z6.js","./Register.BZF1FJFm.js","./ForgotPassword.DVOENv1e.js","./ResetPassword.C3Fw6vA0.js","./Visibility.Bq_lujd_.js","./VisibilityOff.qSdmZWpe.js","./RegisterProfile.iKcZnDDT.js","./EmailConfirmation.DZwrRAlG.js","./ElementAuth.DtLlgwrh.js","./MainLayout.D0Ngvinf.js","./AccountCircle.C55a0IjL.js","./Settings.DGZpUNrl.js","./PlayArrow.GqmCGL4o.js","./Pause.r8mC42rq.js","./VolumeOff.CdPtQMO_.js","./Add.BKfOzMjp.js","./Clear.ONWxSfjH.js","./thumbnails.CEJMDkxh.js","./thumbnails.BgFELHGC.css","./balls.C0g-ojbU.js","./Close.BG2YHWMj.js","./DoneAll.CiznCgP9.js","./dateUtils.JaLtthGQ.js","./ExpandMore.Ch98balh.js","./ExpandLess.DNDWbxvJ.js","./TransferMenu.2g5UFehs.js","./History.BL_2VNvs.js","./Delete.C47j6PO2.js","./Save.D4JlNQm5.js","./MoreVert.C0-1U5Ci.js","./Person.B_G_dVGx.js","./Send.DjUSpM3V.js","./MobilePlayer.Dn8-ai5r.js","./KeyboardArrowDown.Cwa-wUfu.js","./MusicNote.D4Jp3FIY.js","./Edit.6-hI7nty.js","./QueueMusic.Dom8AGTx.js","./imageUtils.BkCfy0de.js","./MobilePlayer.BhVrL05o.css","./DesktopPlayer.ChZXszp_.js","./ProfilePage.DzabE94M.js","./index.CJUnh1z7.js","./PersonRemove.3f-UhM3t.js","./Cake.Ds5sEyJA.js","./Link.BmVIpf9S.js","./PostSkeleton.NxbnrqQw.js","./Diamond.CBNwN0TB.js","./Chat.cmss1gek.js","./Block.CDlxe_qq.js","./Post.MP7_w9C7.js","./SimpleImageViewer.DCWkQqHX.js","./Share.BKyVThZF.js","./Photo.tXKr-C4h.js","./Post.CqLg182r.css","./ProfilePage.CvF2r7w6.css","./MainPage.CFkrN-o-.js","./UpdateService.CDVnacP6.js","./NewReleases.BImcOub6.js","./CheckCircleOutline.BwTcCiBO.js","./BugReport.CJI6Qv1X.js","./Update.8QfFEnRq.js","./ArrowForward.BKNSZeDS.js","./PostDetailPage.DXoXnl_Z.js","./ArrowBack.DeCcUwS3.js","./Reply.De_n_WzJ.js","./ZoomIn.B2AGiqFq.js","./SettingsPage.Djo7_KbD.js","./notistack.esm.BoLx6yWs.js","./AttachMoney.CLjR6rlb.js","./AccountBalanceWallet.DfnSQtMa.js","./Badge.Dv8azNVM.js","./ShoppingCart.BDp27tTE.js","./SupportAgent.D8YXuy4j.js","./PhotoCamera.GVaun1S8.js","./Telegram.dTatVh8b.js","./Check.8Oxd4z3r.js","./Security.Cr7xxssj.js","./VerifiedUser.CnoA7dRM.js","./WarningAmber.ahx4NMS2.js","./Storefront.C18hyH4H.js","./Shield.D0EJ_IOk.js","./NotificationsPage.CuuEHV3z.js","./SearchPage.BEXiq8eS.js","./ThumbUpOutlined.Dgqwey59.js","./MusicPage.C1dJ9gmr.js","./ArtistPage.BmCMwOEq.js","./MessengerPage.DflbkRuK.js","./Done.DH0PNvDW.js","./ru.CTk8yEGX.js","./MessengerPage.BHrEwZfg.css","./SubscriptionsPage.hkTBGGan.js","./BugReportPage.BbCbZ6CD.js","./LeaderboardPage.Cz1qhngq.js","./RulesPage.DYdgIFLt.js","./Rule.BDhRoJWU.js","./Group.M4Axy7KD.js","./PrivacyPolicyPage.BL9f_KuI.js","./TermsOfServicePage.zJ2CfL3c.js","./MorePage.C-AR8doZ.js","./NotFound.BKexQ4wF.js","./AdminPage.AIuATBTk.js","./VpnKey.CiWBcDiF.js","./People.xr_JbldX.js","./Key.B17fLC_C.js","./ContentCopy.BChjYHZa.js","./ModeratorPage.B2uVA173.js","./CreditCard.CQyECVCQ.js","./UpdatesPage.C8GFTzId.js","./SharePreviewTest.DCb1dVxj.js","./BadgeShopPage.DhWOYfWF.js","./BalancePage.DDRAK5Kp.js","./Timeline.GD_rQ3dF.js","./Tag.-0_LtIDs.js","./TouchApp.DGDvsy05.js","./SportsEsports.C6PbSIRD.js","./UsernameAuctionPage.BY72N8hL.js","./SimpleApiDocsPage.DtOlNVoS.js","./Code.DKOPHCGV.js","./SubPlanes.Dck8yoIN.js","./TestNotifications.D04rk8X2.js","./MiniGamesPage.Cy23NCxr.js","./CupsGamePage.hBzk0GX9.js","./LuckyNumberGame.vqu-YAZs.js","./ClickerPage.VO5eP5pM.js","./BlackjackPage.CbNrywfg.js","./AboutPage.BZBVvc1B.js"])))=>i.map(i=>d[i]);
var Fi=Object.defineProperty;var zi=(dt,Ge,kt)=>Ge in dt?Fi(dt,Ge,{enumerable:!0,configurable:!0,writable:!0,value:kt}):dt[Ge]=kt;var lt=(dt,Ge,kt)=>zi(dt,typeof Ge!="symbol"?Ge+"":Ge,kt);import{c as Di,j as n,u as Li,r as Ie,a as Te,b as ot,d as we,P as jt,B as Ni,e as ir,f as Et,s as xe,C as an,g as on,h as sn,i as V,T as oe,A as $i,k as $o,l as Ke,m as Cr,F as Wo,n as Bo,o as ht,p as Wi,q as Ho,t as Bi,v as Hi,I as Vo,G as mt,w as Vi,x as qi,S as It,y as Tt,z as Ui,D as Ji,E as Ki,H as Gi,J as Yi,K as Zi,L as Qi,M as Xi,N as cn,O as Sr,Q as ft,R as gt,U as xt,V as ln,W as dn,X as un,Y as pn,Z as ec,_ as qo,$ as Uo}from"./vendor-mui.08p3AH88.js";import{a as We,r as d,u as _t,d as yt,e as tc,f as cr,g as q,N as ie,B as rc,__tla as nc}from"./vendor-router.BRqU_Zs2.js";import{a as ac,b as oc,g as ke,r as sc}from"./vendor-react.DF-_cTkv.js";import{a as G,H as ic,m as lr,b as cc}from"./vendor.CL98q8z6.js";let nt,hn,mn,fn,gn,xn,Ze,yn,vn,Er,bn,wn,dr,At,jn,Mt,_n,kn,Cn,Sn,En,In,Tn,vt,Jo,Ir,An,Ko,Mn,Go,Yo,Pn,je,On,Rn,lc=Promise.all([(()=>{try{return nc}catch{}})()]).then(async()=>{(function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0})}function e(r){if(r.ep)return;r.ep=!0;const a=function(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}(r);fetch(r.href,a)}})();var dt,Ge={},kt=function(){if(dt)return Ge;dt=1;var t=ac();return Ge.createRoot=t.createRoot,Ge.hydrateRoot=t.hydrateRoot,Ge}();typeof window<"u"&&(window.createSvgIcon=function(t,e){if(typeof t=="string"){const a=We.forwardRef((i,o)=>We.createElement("img",{src:t,alt:e||"Icon",ref:o,...i}));return a.displayName=e||"SvgIcon",a}const r=We.forwardRef((a,i)=>t?We.createElement(t,{...a,ref:i}):null);return r.displayName=e||t&&t.displayName||"SvgIcon",r}),typeof window<"u"&&(window.createSvgIcon=function(t,e){return Di(d.createElement("path",{d:t}),e)});let Qe,Tr,ur,pr,Ar,Mr,X,Fn,Pr,Pt,hr,mr;Qe="assets",Tr=6048e5,ur=()=>new Promise((t,e)=>{if(!window.indexedDB)return void e(new Error("IndexedDB \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043E\u043C"));const r=indexedDB.open("k-connect-assets-cache",1);r.onerror=a=>{e(a.target.error)},r.onupgradeneeded=a=>{const i=a.target.result;i.objectStoreNames.contains(Qe)||i.createObjectStore(Qe,{keyPath:"url"}).createIndex("timestamp","timestamp",{unique:!1})},r.onsuccess=a=>{t(a.target.result)}}),pr=t=>typeof t=="string"&&t.includes("/assets/"),Ar=async t=>{if(!pr(t))return null;try{const e=await ur(),r=e.transaction(Qe,"readonly").objectStore(Qe);return new Promise(a=>{const i=r.get(t);i.onsuccess=()=>{const o=i.result;if(!o)return void a(null);if(Date.now()-o.timestamp>Tr)return e.transaction(Qe,"readwrite").objectStore(Qe).delete(t),void a(null);const s=new Response(o.data,{status:o.status,statusText:o.statusText,headers:o.headers});a(s)},i.onerror=o=>{a(null)}})}catch{return null}},Mr={},X=function(t,e,r){let a=Promise.resolve();if(e&&e.length>0){let o=function(x){return Promise.all(x.map(b=>Promise.resolve(b).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};const s=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),u=l?.nonce||l?.getAttribute("nonce");a=o(e.map(x=>{if(x=function(_,C){return new URL(_,C).href}(x,r),x in Mr)return;Mr[x]=!0;const b=x.endsWith(".css"),v=b?'[rel="stylesheet"]':"";if(r)for(let _=s.length-1;_>=0;_--){const C=s[_];if(C.href===x&&(!b||C.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${x}"]${v}`))return;const j=document.createElement("link");return j.rel=b?"stylesheet":"modulepreload",b||(j.as="script"),j.crossOrigin="",j.href=x,u&&j.setAttribute("nonce",u),document.head.appendChild(j),b?new Promise((_,C)=>{j.addEventListener("load",_),j.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${x}`)))}):void 0}))}function i(o){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o}return a.then(o=>{for(const s of o||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})},Mn={getProfile:async t=>{try{const e=t?`/api/profile/${t}`:"/api/profile";return(await G.get(e)).data}catch(e){throw e}},getSettings:async()=>{try{const t=await G.get("/api/profile/settings");return t.data.success&&t.data.settings&&localStorage.setItem("theme_settings",JSON.stringify(t.data.settings)),t.data}catch(t){throw t}},updateSettings:async t=>{try{return(await G.post("/api/profile/settings",t,{headers:{"Content-Type":"application/json"}})).data}catch(e){throw e}},updateName:async t=>{try{const e=new FormData;return e.append("name",t),(await G.post("/api/profile/update-name",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw e}},updateUsername:async t=>{try{const e=new FormData;return e.append("username",t),(await G.post("/api/profile/update-username",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw e}},updateAbout:async t=>{try{const e=new FormData;return e.append("about",t),(await G.post("/api/profile/update-about",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw e}},uploadAvatar:async t=>{try{const e=new FormData;return e.append("avatar",t),(await G.post("/api/profile/upload-avatar",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw e}},uploadBanner:async t=>{try{const e=new FormData;return e.append("banner",t),(await G.post("/api/profile/upload-banner",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){throw e}},updateSocial:async(t,e)=>{try{const r=new FormData;return r.append("name",t),r.append("link",e),(await G.post("/api/profile/update-social",r)).data}catch(r){throw r}},deleteSocial:async t=>{try{const e=new FormData;return e.append("name",t),(await G.post("/api/profile/delete-social",e)).data}catch(e){throw e}},addSocial:async(t,e)=>{try{const r=new FormData;return r.append("name",t),r.append("link",e),(await G.post("/api/profile/update-social",r)).data}catch(r){throw r}},followUser:async t=>{try{return(await G.post("/api/profile/follow",{followed_id:t})).data}catch(e){throw e}},unfollowUser:async t=>{try{return(await G.post("/api/profile/follow",{followed_id:t})).data}catch(e){throw e}},checkFollowing:async t=>{try{return(await G.get(`/api/profile/${t}`)).data.is_following}catch{return!1}}},Mt={login:async t=>{try{const{usernameOrEmail:e,password:r}=t,a=await G.post("/api/auth/login",{username:e,password:r},{withCredentials:!0,headers:{"Content-Type":"application/json"}});return a.data&&a.data.success?(a.data.token&&localStorage.setItem("token",a.data.token),{success:!0,user:a.data.user||null,token:a.data.token||null}):{success:!1,error:a.data.error||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u0445\u043E\u0434\u0435"}}catch(e){return{success:!1,error:e.response?.data?.message||e.response?.data?.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u0445\u043E\u0434\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u0443"}}},register:async(t,e,r)=>{try{const a={username:t,email:e,password:r};return(await G.post("/api/auth/register",a,{headers:{"Content-Type":"application/json"}})).data}catch(a){throw a.response,a}},checkAuth:async()=>{try{try{const t=await G.get("/api/auth/check",{withCredentials:!0,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});return t.data&&t.data.sessionExists&&!t.data.user&&(t.data.hasSession=!0),window._lastAuthCheckResponse=t,t}catch(t){if(t.response&&t.response.status===404){const e=await G.get("/api/check-auth",{withCredentials:!0,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});return e.data&&e.data.sessionExists&&!e.data.user&&(e.data.hasSession=!0),window._lastAuthCheckResponse=e,e}throw t}}catch(t){const e={data:{isAuthenticated:!1,user:null,error:t.response?.data?.error||t.message}};return window._lastAuthCheckResponse=e,e}},logout:async()=>{try{const t=await G.post("/api/auth/logout",{},{withCredentials:!0,headers:{"Content-Type":"application/json"}});return localStorage.removeItem("token"),t.data}catch(t){throw localStorage.removeItem("token"),t}},registerProfile:async t=>{try{return(await G.post("/api/auth/register-profile",t,{withCredentials:!0,headers:{"Content-Type":t instanceof FormData?"multipart/form-data":"application/json"}})).data}catch(e){throw e.response,e}}},nt=d.createContext({user:null,isAuthenticated:!1,loading:!0,checkAuth:()=>{},login:()=>{},logout:()=>{},setUser:()=>{}}),Jo=()=>d.useContext(nt),Fn=({children:t})=>{const e=JSON.parse(localStorage.getItem("k-connect-auth-state")||"null"),r=JSON.parse(localStorage.getItem("k-connect-user")||"null"),[a,i]=d.useState(r),[o,s]=d.useState(!!e),[l,u]=d.useState(!e),[x,b]=d.useState(null),[v,j]=d.useState(e?.lastCheck||0),_=_t(),C=d.useContext(At)||{},P=(E,A)=>{E?(localStorage.setItem("k-connect-auth-state",JSON.stringify({isAuthenticated:E,lastCheck:Date.now()})),A&&localStorage.setItem("k-connect-user",JSON.stringify(A))):(localStorage.removeItem("k-connect-auth-state"),localStorage.removeItem("k-connect-user"))},D=d.useCallback(async(E=!1)=>{try{const A=Date.now();if(!E&&o&&a&&A-v<18e5||window._authCheckInProgress)return a;window._authCheckInProgress=!0,u(!0);const S=await Mt.checkAuth();if(S&&S.data){if(S.data.isAuthenticated&&S.data.user){const M=S.data.user;return i(M),s(!0),j(A),P(!0,M),window._authCheckInProgress=!1,M}if(S.data.needsProfileSetup||S.data.hasSession)return i(null),s(!0),P(!0,null),window.location.pathname.includes("/register/profile")||_("/register/profile",{replace:!0}),window._authCheckInProgress=!1,null;{i(null),s(!1),P(!1),window._authCheckInProgress=!1;const M=["/login","/register","/auth_elem","/rules","/privacy-policy","/terms-of-service","/about","/bugs","/post","/profile"].some($=>window.location.pathname.includes($));E&&!M&&_("/login",{replace:!0})}}else i(null),s(!1),P(!1),window._authCheckInProgress=!1;return null}catch{i(null),s(!1),P(!1),window._authCheckInProgress=!1}finally{u(!1),window._authCheckInProgress=!1}},[v,a,_,o]),I=d.useCallback(async E=>{try{u(!0),b(null);const A=await Mt.login(E);if(A.success)return i(A.user),s(!0),P(!0,A.user),C&&C.loadThemeSettings&&C.loadThemeSettings(),E.preventRedirect||(window.location.href="/"),{success:!0,user:A.user};{if(A.ban_info)return b({message:"\u0410\u043A\u043A\u0430\u0443\u043D\u0442 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D",ban_info:A.ban_info}),{success:!1,error:"\u0410\u043A\u043A\u0430\u0443\u043D\u0442 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D",ban_info:A.ban_info};const S=A.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u0445\u043E\u0434\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u0443";return b({message:S}),{success:!1,error:S}}}catch(A){if(A.response?.data?.ban_info){const M=A.response.data.ban_info;return b({message:"\u0410\u043A\u043A\u0430\u0443\u043D\u0442 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D",ban_info:M}),{success:!1,error:"\u0410\u043A\u043A\u0430\u0443\u043D\u0442 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D",ban_info:M}}const S=A.response?.data?.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u0445\u043E\u0434\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u0443";return b({message:S}),{success:!1,error:S}}finally{u(!1)}},[_,C]),w=d.useCallback(async()=>{try{u(!0),await Mt.logout(),localStorage.removeItem("token"),P(!1),i(null),s(!1),j(0),C&&C.loadThemeSettings&&C.loadThemeSettings(!0),_("/login",{replace:!0})}catch{localStorage.removeItem("token"),P(!1),i(null),s(!1)}finally{u(!1)}},[_,C]);d.useEffect(()=>{(async()=>{if(e&&r)i(r),s(!0),u(!1),setTimeout(()=>{D(!1).catch(function(){})},1e3);else try{await D(!1)}catch{}finally{u(!1)}})()},[]),d.useEffect(()=>{window._authCheckInProgress=!1;const E=G.interceptors.response.use(A=>A,A=>{if(A.response&&A.response.status===401&&o){i(null),s(!1),P(!1);const S=window.location.pathname;["/login","/register","/rules","/about","/privacy-policy","/terms-of-service","/bugs"].some(M=>S.includes(M))||_("/login",{replace:!0})}return Promise.reject(A)});return()=>{G.interceptors.response.eject(E)}},[o,_]),d.useEffect(()=>{o&&a&&P(!0,a)},[o,l,a]);const O={user:a,isAuthenticated:o,loading:l,error:x,login:I,logout:w,checkAuth:D,registerProfile:async E=>{try{u(!0);const A=await Mt.registerProfile(E);if(A.success&&A.user)return i(A.user),s(!0),P(!0,A.user),_("/",{replace:!0}),{success:!0};{const S=A.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043F\u0440\u043E\u0444\u0438\u043B\u044F";return b({message:S}),{success:!1,error:S}}}catch(A){const S=A.response?.data?.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043F\u0440\u043E\u0444\u0438\u043B\u044F";return b({message:S}),{success:!1,error:S}}finally{u(!1)}},setUser:i};return n.jsx(nt.Provider,{value:O,children:t})},Pr=Object.freeze({left:0,top:0,width:16,height:16}),Pt=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),hr=Object.freeze({...Pr,...Pt}),mr=Object.freeze({...hr,body:"",hidden:!1});function zn(t,e){const r=function(a,i){const o={};!a.hFlip!=!i.hFlip&&(o.hFlip=!0),!a.vFlip!=!i.vFlip&&(o.vFlip=!0);const s=((a.rotate||0)+(i.rotate||0))%4;return s&&(o.rotate=s),o}(t,e);for(const a in mr)a in Pt?a in t&&!(a in r)&&(r[a]=Pt[a]):a in e?r[a]=e[a]:a in t&&(r[a]=t[a]);return r}function Zo(t,e,r){const a=t.icons,i=t.aliases||Object.create(null);let o={};function s(l){o=zn(a[l]||i[l],o)}return s(e),r.forEach(s),zn(t,o)}function Dn(t,e){const r=[];if(typeof t!="object"||typeof t.icons!="object")return r;t.not_found instanceof Array&&t.not_found.forEach(i=>{e(i,null),r.push(i)});const a=function(i){const o=i.icons,s=i.aliases||Object.create(null),l=Object.create(null);return Object.keys(o).concat(Object.keys(s)).forEach(function u(x){if(o[x])return l[x]=[];if(!(x in l)){l[x]=null;const b=s[x]&&s[x].parent,v=b&&u(b);v&&(l[x]=[b].concat(v))}return l[x]}),l}(t);for(const i in a){const o=a[i];o&&(e(i,Zo(t,i,o)),r.push(i))}return r}const Qo={provider:"",aliases:{},not_found:{},...Pr};function Or(t,e){for(const r in e)if(r in t&&typeof t[r]!=typeof e[r])return!1;return!0}function Ln(t){if(typeof t!="object"||t===null)return null;const e=t;if(typeof e.prefix!="string"||!t.icons||typeof t.icons!="object"||!Or(t,Qo))return null;const r=e.icons;for(const i in r){const o=r[i];if(!i||typeof o.body!="string"||!Or(o,mr))return null}const a=e.aliases||Object.create(null);for(const i in a){const o=a[i],s=o.parent;if(!i||typeof s!="string"||!r[s]&&!a[s]||!Or(o,mr))return null}return e}const Nn=/^[a-z0-9]+(-[a-z0-9]+)*$/,fr=(t,e,r,a="")=>{const i=t.split(":");if(t.slice(0,1)==="@"){if(i.length<2||i.length>3)return null;a=i.shift().slice(1)}if(i.length>3||!i.length)return null;if(i.length>1){const l=i.pop(),u=i.pop(),x={provider:i.length>0?i[0]:a,prefix:u,name:l};return e&&!gr(x)?null:x}const o=i[0],s=o.split("-");if(s.length>1){const l={provider:a,prefix:s.shift(),name:s.join("-")};return e&&!gr(l)?null:l}if(r&&a===""){const l={provider:a,prefix:"",name:o};return e&&!gr(l,r)?null:l}return null},gr=(t,e)=>!!t&&!(!(e&&t.prefix===""||t.prefix)||!t.name),$n=Object.create(null);function Ct(t,e){const r=$n[t]||($n[t]=Object.create(null));return r[e]||(r[e]=function(a,i){return{provider:a,prefix:i,icons:Object.create(null),missing:new Set}}(t,e))}function Wn(t,e){return Ln(e)?Dn(e,(r,a)=>{a?t.icons[r]=a:t.missing.add(r)}):[]}let Ot=!1;function Bn(t){return typeof t=="boolean"&&(Ot=t),Ot}function Hn(t){const e=typeof t=="string"?fr(t,!0,Ot):t;if(e){const r=Ct(e.provider,e.prefix),a=e.name;return r.icons[a]||(r.missing.has(a)?null:void 0)}}const Vn=Object.freeze({width:null,height:null}),qn=Object.freeze({...Vn,...Pt}),Xo=/(-?[0-9.]*[0-9]+[0-9.]*)/g,es=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function Un(t,e,r){if(e===1)return t;if(r=r||100,typeof t=="number")return Math.ceil(t*e*r)/r;if(typeof t!="string")return t;const a=t.split(Xo);if(a===null||!a.length)return t;const i=[];let o=a.shift(),s=es.test(o);for(;;){if(s){const l=parseFloat(o);isNaN(l)?i.push(o):i.push(Math.ceil(l*e*r)/r)}else i.push(o);if(o=a.shift(),o===void 0)return i.join("");s=!s}}const ts=/\sid="(\S+)"/g,rs="IconifyId"+Date.now().toString(16)+(16777216*Math.random()|0).toString(16);let ns=0;function as(t,e=rs){const r=[];let a;for(;a=ts.exec(t);)r.push(a[1]);if(!r.length)return t;const i="suffix"+(16777216*Math.random()|Date.now()).toString(16);return r.forEach(o=>{const s=typeof e=="function"?e(o):e+(ns++).toString(),l=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");t=t.replace(new RegExp('([#;"])('+l+')([")]|\\.[a-z])',"g"),"$1"+s+i+"$3")}),t=t.replace(new RegExp(i,"g"),"")}const Rr=Object.create(null);function Fr(t){return Rr[t]||Rr[""]}function zr(t){let e;if(typeof t.resources=="string")e=[t.resources];else if(e=t.resources,!(e instanceof Array&&e.length))return null;return{resources:e,path:t.path||"/",maxURL:t.maxURL||500,rotate:t.rotate||750,timeout:t.timeout||5e3,random:t.random===!0,index:t.index||0,dataAfterTimeout:t.dataAfterTimeout!==!1}}const Dr=Object.create(null),xr=["https://api.simplesvg.com","https://api.unisvg.com"],Lr=[];for(;xr.length>0;)xr.length===1||Math.random()>.5?Lr.push(xr.shift()):Lr.push(xr.pop());function os(t,e){const r=zr(e);return r!==null&&(Dr[t]=r,!0)}function Nr(t){return Dr[t]}Dr[""]=zr({resources:["https://api.iconify.design"].concat(Lr)});let Jn=(()=>{let t;try{if(t=fetch,typeof t=="function")return t}catch{}})();const ss={prepare:(t,e,r)=>{const a=[],i=function(u,x){const b=Nr(u);if(!b)return 0;let v;if(b.maxURL){let j=0;b.resources.forEach(C=>{j=Math.max(j,C.length)});const _=x+".json?icons=";v=b.maxURL-j-b.path.length-_.length}else v=0;return v}(t,e),o="icons";let s={type:o,provider:t,prefix:e,icons:[]},l=0;return r.forEach((u,x)=>{l+=u.length+1,l>=i&&x>0&&(a.push(s),s={type:o,provider:t,prefix:e,icons:[]},l=u.length),s.icons.push(u)}),a.push(s),a},send:(t,e,r)=>{if(!Jn)return void r("abort",424);let a=function(o){if(typeof o=="string"){const s=Nr(o);if(s)return s.path}return"/"}(e.provider);switch(e.type){case"icons":{const o=e.prefix,s=e.icons.join(",");a+=o+".json?"+new URLSearchParams({icons:s}).toString();break}case"custom":{const o=e.uri;a+=o.slice(0,1)==="/"?o.slice(1):o;break}default:return void r("abort",400)}let i=503;Jn(t+a).then(o=>{const s=o.status;if(s===200)return i=501,o.json();setTimeout(()=>{r(function(l){return l===404}(s)?"abort":"next",s)})}).then(o=>{setTimeout(typeof o=="object"&&o!==null?()=>{r("success",o)}:()=>{o===404?r("abort",o):r("next",i)})}).catch(()=>{r("next",i)})}};function Kn(t,e){t.forEach(r=>{const a=r.loaderCallbacks;a&&(r.loaderCallbacks=a.filter(i=>i.id!==e))})}let is=0;var cs={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function Gn(t){const e={...cs,...t};let r=[];function a(){r=r.filter(o=>o().status==="pending")}return{query:function(o,s,l){const u=function(x,b,v,j){const _=x.resources.length,C=x.random?Math.floor(Math.random()*_):x.index;let P;if(x.random){let R=x.resources.slice(0);for(P=[];R.length>1;){const J=Math.floor(Math.random()*R.length);P.push(R[J]),R=R.slice(0,J).concat(R.slice(J+1))}P=P.concat(R)}else P=x.resources.slice(C).concat(x.resources.slice(0,C));const D=Date.now();let I,w="pending",O=0,E=null,A=[],S=[];function M(){E&&(clearTimeout(E),E=null)}function $(){w==="pending"&&(w="aborted"),M(),A.forEach(R=>{R.status==="pending"&&(R.status="aborted")}),A=[]}function Y(R,J){J&&(S=[]),typeof R=="function"&&S.push(R)}function U(){w="failed",S.forEach(R=>{R(void 0,I)})}function K(){A.forEach(R=>{R.status==="pending"&&(R.status="aborted")}),A=[]}return typeof j=="function"&&S.push(j),setTimeout(function R(){if(w!=="pending")return;M();const J=P.shift();if(J===void 0)return A.length?void(E=setTimeout(()=>{M(),w==="pending"&&(K(),U())},x.timeout)):void U();const H={status:"pending",resource:J,callback:(se,W)=>{(function(B,ce,N){const le=ce!=="success";switch(A=A.filter(pe=>pe!==B),w){case"pending":break;case"failed":if(le||!x.dataAfterTimeout)return;break;default:return}if(ce==="abort")return I=N,void U();if(le)return I=N,void(A.length||(P.length?R():U()));if(M(),K(),!x.random){const pe=x.resources.indexOf(B.resource);pe!==-1&&pe!==x.index&&(x.index=pe)}w="completed",S.forEach(pe=>{pe(N)})})(H,se,W)}};A.push(H),O++,E=setTimeout(R,x.rotate),v(J,b,H.callback)}),function(){return{startTime:D,payload:b,status:w,queriesSent:O,queriesPending:A.length,subscribe:Y,abort:$}}}(e,o,s,(x,b)=>{a(),l&&l(x,b)});return r.push(u),u},find:function(o){return r.find(s=>o(s))||null},setIndex:o=>{e.index=o},getIndex:()=>e.index,cleanup:a}}function ls(){}const $r=Object.create(null);function Yn(){}function Rt(t,e,r){function a(){const i=t.pendingIcons;e.forEach(o=>{i&&i.delete(o),t.icons[o]||t.missing.add(o)})}if(r&&typeof r=="object")try{if(!Wn(t,r).length)return void a()}catch{}a(),function(i){i.iconsLoaderFlag||(i.iconsLoaderFlag=!0,setTimeout(()=>{i.iconsLoaderFlag=!1,function(o){o.pendingCallbacksFlag||(o.pendingCallbacksFlag=!0,setTimeout(()=>{o.pendingCallbacksFlag=!1;const s=o.loaderCallbacks?o.loaderCallbacks.slice(0):[];if(!s.length)return;let l=!1;const u=o.provider,x=o.prefix;s.forEach(b=>{const v=b.icons,j=v.pending.length;v.pending=v.pending.filter(_=>{if(_.prefix!==x)return!0;const C=_.name;if(o.icons[C])v.loaded.push({provider:u,prefix:x,name:C});else{if(!o.missing.has(C))return l=!0,!0;v.missing.push({provider:u,prefix:x,name:C})}return!1}),v.pending.length!==j&&(l||Kn([o],b.id),b.callback(v.loaded.slice(0),v.missing.slice(0),v.pending.slice(0),b.abort))})}))}(i)}))}(t)}function Zn(t,e){t instanceof Promise?t.then(r=>{e(r)}).catch(()=>{e(null)}):e(t)}function ds(t,e){t.iconsToLoad?t.iconsToLoad=t.iconsToLoad.concat(e).sort():t.iconsToLoad=e,t.iconsQueueFlag||(t.iconsQueueFlag=!0,setTimeout(()=>{t.iconsQueueFlag=!1;const{provider:r,prefix:a}=t,i=t.iconsToLoad;if(delete t.iconsToLoad,!i||!i.length)return;const o=t.loadIcon;if(t.loadIcons&&(i.length>1||!o))return void Zn(t.loadIcons(i,a,r),x=>{Rt(t,i,x)});if(o)return void i.forEach(x=>{Zn(o(x,a,r),b=>{Rt(t,[x],b?{prefix:a,icons:{[x]:b}}:null)})});const{valid:s,invalid:l}=function(x){const b=[],v=[];return x.forEach(j=>{(j.match(Nn)?b:v).push(j)}),{valid:b,invalid:v}}(i);if(l.length&&Rt(t,l,null),!s.length)return;const u=a.match(Nn)?Fr(r):null;u?u.prepare(r,a,s).forEach(x=>{(function(b,v,j){let _,C;if(typeof b=="string"){const P=Fr(b);if(!P)return j(void 0,424),ls;C=P.send;const D=function(I){if(!$r[I]){const w=Nr(I);if(!w)return;const O={config:w,redundancy:Gn(w)};$r[I]=O}return $r[I]}(b);D&&(_=D.redundancy)}else{const P=zr(b);if(P){_=Gn(P);const D=Fr(b.resources?b.resources[0]:"");D&&(C=D.send)}}_&&C?_.query(v,C,j)().abort:j(void 0,424)})(r,x,b=>{Rt(t,x.icons,b)})}):Rt(t,s,null)}))}const us=/[\s,]+/;function ps(t,e){e.split(us).forEach(r=>{switch(r.trim()){case"horizontal":t.hFlip=!0;break;case"vertical":t.vFlip=!0}})}function hs(t,e=0){const r=t.replace(/^-?[0-9.]*/,"");function a(i){for(;i<0;)i+=4;return i%4}if(r===""){const i=parseInt(t);return isNaN(i)?0:a(i)}if(r!==t){let i=0;switch(r){case"%":i=25;break;case"deg":i=90}if(i){let o=parseFloat(t.slice(0,t.length-r.length));return isNaN(o)?0:(o/=i,o%1==0?a(o):0)}}return e}let Ft;function ms(t){return Ft===void 0&&function(){try{Ft=window.trustedTypes.createPolicy("iconify",{createHTML:e=>e})}catch{Ft=null}}(),Ft?Ft.createHTML(t):t}const Qn={...qn,inline:!1},fs={xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},gs={display:"inline-block"},Wr={backgroundColor:"currentColor"},Xn={backgroundColor:"transparent"},ea={Image:"var(--svg)",Repeat:"no-repeat",Size:"100% 100%"},ta={WebkitMask:Wr,mask:Wr,background:Xn};for(const t in ta){const e=ta[t];for(const r in ea)e[t+r]=ea[r]}const xs={...Qn,inline:!0};function ra(t){return t+(t.match(/^[-0-9.]+$/)?"px":"")}var na;if(Bn(!0),na=ss,Rr[""]=na,typeof document<"u"&&typeof window<"u"){const t=window;if(t.IconifyPreload!==void 0){const e=t.IconifyPreload;typeof e=="object"&&e!==null&&(e instanceof Array?e:[e]).forEach(r=>{try{typeof r!="object"||r===null||r instanceof Array||typeof r.icons!="object"||typeof r.prefix!="string"||function(a,i){if(typeof a!="object")return!1;if(typeof i!="string"&&(i=a.provider||""),Ot&&!i&&!a.prefix){let s=!1;return Ln(a)&&(a.prefix="",Dn(a,(l,u)=>{(function(x,b){const v=fr(x,!0,Ot);if(!v)return!1;const j=Ct(v.provider,v.prefix);return b?function(_,C,P){try{if(typeof P.body=="string")return _.icons[C]={...P},!0}catch{}return!1}(j,v.name,b):(j.missing.add(v.name),!0)})(l,u)&&(s=!0)})),s}const o=a.prefix;gr({prefix:o,name:"a"})&&Wn(Ct(i,o),a)}(r)}catch{}})}if(t.IconifyProviders!==void 0){const e=t.IconifyProviders;if(typeof e=="object"&&e!==null)for(let r in e)try{const a=e[r];if(typeof a!="object"||!a||a.resources===void 0)continue;os(r,a)}catch{}}}function aa(t){const[e,r]=d.useState(!!t.ssr),[a,i]=d.useState({}),[o,s]=d.useState(function(j){if(j){const _=t.icon;if(typeof _=="object")return{name:"",data:_};const C=Hn(_);if(C)return{name:_,data:C}}return{name:""}}(!!t.ssr));function l(){const j=a.callback;j&&(j(),i({}))}function u(j){if(JSON.stringify(o)!==JSON.stringify(j))return l(),s(j),!0}function x(){var j;const _=t.icon;if(typeof _=="object")return void u({name:"",data:_});const C=Hn(_);if(u({name:_,data:C}))if(C===void 0){const P=((D,I)=>{const w=function(M){const $={loaded:[],missing:[],pending:[]},Y=Object.create(null);M.sort((K,R)=>K.provider!==R.provider?K.provider.localeCompare(R.provider):K.prefix!==R.prefix?K.prefix.localeCompare(R.prefix):K.name.localeCompare(R.name));let U={provider:"",prefix:"",name:""};return M.forEach(K=>{if(U.name===K.name&&U.prefix===K.prefix&&U.provider===K.provider)return;U=K;const R=K.provider,J=K.prefix,H=K.name,se=Y[R]||(Y[R]=Object.create(null)),W=se[J]||(se[J]=Ct(R,J));let B;B=H in W.icons?$.loaded:J===""||W.missing.has(H)?$.missing:$.pending;const ce={provider:R,prefix:J,name:H};B.push(ce)}),$}(function(M,$=!0,Y=!1){const U=[];return M.forEach(K=>{const R=typeof K=="string"?fr(K,$,Y):K;R&&U.push(R)}),U}(D,!0,Bn()));if(!w.pending.length){let M=!0;return I&&setTimeout(()=>{M&&I(w.loaded,w.missing,w.pending,Yn)}),()=>{M=!1}}const O=Object.create(null),E=[];let A,S;return w.pending.forEach(M=>{const{provider:$,prefix:Y}=M;if(Y===S&&$===A)return;A=$,S=Y,E.push(Ct($,Y));const U=O[$]||(O[$]=Object.create(null));U[Y]||(U[Y]=[])}),w.pending.forEach(M=>{const{provider:$,prefix:Y,name:U}=M,K=Ct($,Y),R=K.pendingIcons||(K.pendingIcons=new Set);R.has(U)||(R.add(U),O[$][Y].push(U))}),E.forEach(M=>{const $=O[M.provider][M.prefix];$.length&&ds(M,$)}),I?function(M,$,Y){const U=is++,K=Kn.bind(null,Y,U);if(!$.pending.length)return K;const R={id:U,icons:$,callback:M,abort:K};return Y.forEach(J=>{(J.loaderCallbacks||(J.loaderCallbacks=[])).push(R)}),K}(I,w,E):Yn})([_],x);i({callback:P})}else C&&((j=t.onLoad)===null||j===void 0||j.call(t,_))}d.useEffect(()=>(r(!0),l),[]),d.useEffect(()=>{e&&x()},[t.icon,e]);const{name:b,data:v}=o;return v?((j,_,C)=>{const P=_.inline?xs:Qn,D=function(J,H){const se={...J};for(const W in H){const B=H[W],ce=typeof B;W in Vn?(B===null||B&&(ce==="string"||ce==="number"))&&(se[W]=B):ce===typeof se[W]&&(se[W]=W==="rotate"?B%4:B)}return se}(P,_),I=_.mode||"svg",w={},O=_.style||{},E={...I==="svg"?fs:{}};if(C){const J=fr(C,!1,!0);if(J){const H=["iconify"],se=["provider","prefix"];for(const W of se)J[W]&&H.push("iconify--"+J[W]);E.className=H.join(" ")}}for(let J in _){const H=_[J];if(H!==void 0)switch(J){case"icon":case"style":case"children":case"onLoad":case"mode":case"ssr":break;case"_ref":E.ref=H;break;case"className":E[J]=(E[J]?E[J]+" ":"")+H;break;case"inline":case"hFlip":case"vFlip":D[J]=H===!0||H==="true"||H===1;break;case"flip":typeof H=="string"&&ps(D,H);break;case"color":w.color=H;break;case"rotate":typeof H=="string"?D[J]=hs(H):typeof H=="number"&&(D[J]=H);break;case"ariaHidden":case"aria-hidden":H!==!0&&H!=="true"&&delete E["aria-hidden"];break;default:P[J]===void 0&&(E[J]=H)}}const A=function(J,H){const se={...hr,...J},W={...qn,...H},B={left:se.left,top:se.top,width:se.width,height:se.height};let ce=se.body;[se,W].forEach(re=>{const ye=[],me=re.hFlip,fe=re.vFlip;let ue,Ce=re.rotate;switch(me?fe?Ce+=2:(ye.push("translate("+(B.width+B.left).toString()+" "+(0-B.top).toString()+")"),ye.push("scale(-1 1)"),B.top=B.left=0):fe&&(ye.push("translate("+(0-B.left).toString()+" "+(B.height+B.top).toString()+")"),ye.push("scale(1 -1)"),B.top=B.left=0),Ce<0&&(Ce-=4*Math.floor(Ce/4)),Ce%=4,Ce){case 1:ue=B.height/2+B.top,ye.unshift("rotate(90 "+ue.toString()+" "+ue.toString()+")");break;case 2:ye.unshift("rotate(180 "+(B.width/2+B.left).toString()+" "+(B.height/2+B.top).toString()+")");break;case 3:ue=B.width/2+B.left,ye.unshift("rotate(-90 "+ue.toString()+" "+ue.toString()+")")}Ce%2==1&&(B.left!==B.top&&(ue=B.left,B.left=B.top,B.top=ue),B.width!==B.height&&(ue=B.width,B.width=B.height,B.height=ue)),ye.length&&(ce=function(qe,Ae){const De=function(Pe,Se="defs"){let Me="";const et=Pe.indexOf("<"+Se);for(;et>=0;){const ze=Pe.indexOf(">",et),Le=Pe.indexOf("</"+Se);if(ze===-1||Le===-1)break;const ge=Pe.indexOf(">",Le);if(ge===-1)break;Me+=Pe.slice(ze+1,Le).trim(),Pe=Pe.slice(0,et).trim()+Pe.slice(ge+1)}return{defs:Me,content:Pe}}(qe);return _e=De.defs,Ue=Ae+De.content+"</g>",_e?"<defs>"+_e+"</defs>"+Ue:Ue;var _e,Ue}(ce,'<g transform="'+ye.join(" ")+'">'))});const N=W.width,le=W.height,pe=B.width,he=B.height;let L,te;N===null?(te=le===null?"1em":le==="auto"?he:le,L=Un(te,pe/he)):(L=N==="auto"?pe:N,te=le===null?Un(L,he/pe):le==="auto"?he:le);const ne={},de=(re,ye)=>{(me=>me==="unset"||me==="undefined"||me==="none")(ye)||(ne[re]=ye.toString())};de("width",L),de("height",te);const F=[B.left,B.top,pe,he];return ne.viewBox=F.join(" "),{attributes:ne,viewBox:F,body:ce}}(j,D),S=A.attributes;if(D.inline&&(w.verticalAlign="-0.125em"),I==="svg"){E.style={...w,...O},Object.assign(E,S);let J=0,H=_.id;return typeof H=="string"&&(H=H.replace(/-/g,"_")),E.dangerouslySetInnerHTML={__html:ms(as(A.body,H?()=>H+"ID"+J++:"iconifyReact"))},d.createElement("svg",E)}const{body:M,width:$,height:Y}=j,U=I==="mask"||I!=="bg"&&M.indexOf("currentColor")!==-1,K=function(J,H){let se=J.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const W in H)se+=" "+W+'="'+H[W]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+se+">"+J+"</svg>"}(M,{...S,width:$+"",height:Y+""});var R;return E.style={...w,"--svg":(R=K,'url("'+function(J){return"data:image/svg+xml,"+function(H){return H.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}(J)}(R)+'")'),width:ra(S.width),height:ra(S.height),...gs,...U?Wr:Xn,...O},d.createElement("span",E)})({...hr,...v},t,b):t.children?t.children:t.fallback?t.fallback:d.createElement("span",{})}Ze=d.forwardRef((t,e)=>aa({...t,_ref:e})),d.forwardRef((t,e)=>aa({inline:!0,...t,_ref:e}));var oa={};const ys=oc(Li);var sa;je=function(){return sa||(sa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return e.createSvgIcon}});var e=ys}(oa)),oa};var ia,zt={};function vs(){if(ia)return zt;ia=1;var t=Ie();Object.defineProperty(zt,"__esModule",{value:!0}),zt.default=void 0;var e=t(je()),r=Te();return zt.default=(0,e.default)((0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),zt}let ca,la,yr;Tn=ke(vs()),ca=({user:t})=>{const e=_t(),r=yt(),[a,i]=d.useState(!0),{themeSettings:o}=d.useContext(At),s=ot();if(d.useEffect(()=>{const j=_=>{const{isInChat:C}=_.detail;i(!C)};return document.addEventListener("messenger-layout-change",j),()=>{document.removeEventListener("messenger-layout-change",j)}},[]),r.pathname.startsWith("/messenger")&&!a)return null;const l=["/login","/register","/register/profile","/confirm-email"].some(j=>r.pathname.startsWith(j)),u=r.pathname.startsWith("/settings"),x=r.pathname.startsWith("/badge-shop");if(l||u||x||r.pathname.startsWith("/clicker"))return null;const b=s.palette.mode==="light"?we(s.palette.divider,.1):s.palette.mode==="contrast"?we(s.palette.common.white,.15):we(s.palette.common.white,.1),v=s.palette.mode==="light"?we(s.palette.text.primary,.7):s.palette.mode==="contrast"?we(s.palette.common.white,.9):"rgb(214 209 227 / 77%)";return n.jsx(jt,{id:"app-bottom-navigation",sx:{position:"fixed",bottom:0,left:0,right:0,display:{xs:"block",md:"none"},zIndex:1e3,borderTop:`1px solid ${b}`,background:"rgba(255, 255, 255, 0.03)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",boxShadow:"0 5px 15px rgba(0, 0, 0, 0.2)"},elevation:0,children:n.jsxs(Ni,{value:(()=>{const j=r.pathname;return j==="/"||j==="/feed"||j==="/main"?0:j==="/music"?1:j.startsWith("/messenger")?2:j.startsWith("/profile")?3:j==="/more"&&4})(),onChange:(j,_)=>{switch(_){case 0:e("/");break;case 1:e("/music");break;case 2:e("/messenger");break;case 3:e(t?`/profile/${t.username}`:"/login");break;case 4:e("/more")}},sx:{bgcolor:"transparent",height:75,display:"flex",justifyContent:"center",alignItems:"flex-start",marginTop:"10px","& .MuiBottomNavigationAction-root":{color:v,"&.Mui-selected":{color:o.primaryColor||s.palette.primary.main}}},children:[n.jsx(ir,{label:"\u041B\u0435\u043D\u0442\u0430",icon:n.jsx(Ze,{icon:"solar:home-bold",width:"28",height:"28"}),sx:{minWidth:"auto","& .MuiBottomNavigationAction-label":{fontSize:"0.8rem"}}}),n.jsx(ir,{label:"\u041C\u0443\u0437\u044B\u043A\u0430",icon:n.jsx(Ze,{icon:"solar:music-notes-bold",width:"28",height:"28"}),sx:{minWidth:"auto","& .MuiBottomNavigationAction-label":{fontSize:"0.8rem"}}}),n.jsx(ir,{label:"\u041C\u0435\u0441\u0441\u0435\u043D\u0434\u0436\u0435\u0440",icon:n.jsx(Ze,{icon:"solar:chat-round-dots-bold",width:"28",height:"28"}),sx:{minWidth:"auto","& .MuiBottomNavigationAction-label":{fontSize:"0.8rem"}}}),n.jsx(ir,{label:"\u041F\u0440\u043E\u0444\u0438\u043B\u044C",icon:n.jsx(Ze,{icon:"solar:user-bold",width:"28",height:"28"}),sx:{minWidth:"auto","& .MuiBottomNavigationAction-label":{fontSize:"0.8rem"}}}),n.jsx(ir,{label:"\u0415\u0449\u0435",icon:n.jsx(Ze,{icon:"solar:widget-2-bold",width:"28",height:"28",sx:{transform:"scale(1.1)",filter:"drop-shadow(0px 1px 1px rgba(0,0,0,0.2))"}}),sx:{minWidth:"auto","& .MuiBottomNavigationAction-label":{fontSize:"0.8rem"}}})]})})},Ir=d.createContext({tracks:[],popularTracks:[],likedTracks:[],newTracks:[],randomTracks:[],currentTrack:null,isPlaying:!1,volume:.5,isMuted:!1,currentTime:0,duration:0,isLoading:!0,audioRef:null,hasMoreTracks:!1,hasMoreByType:{},currentSection:"all",isTrackLoading:!1,setCurrentTrack:()=>{},setCurrentSection:()=>{},setRandomTracks:()=>{},playTrack:()=>{},togglePlay:()=>{},nextTrack:()=>{},prevTrack:()=>{},setVolume:()=>{},toggleMute:()=>{},seekTo:()=>{},likeTrack:()=>{},uploadTrack:()=>{},loadMoreTracks:()=>Promise.resolve(),resetPagination:()=>{},enableCrossfade:!0,searchResults:[],isSearching:!1,searchTracks:()=>Promise.resolve([]),getCurrentTimeRaw:()=>0,getDurationRaw:()=>0,playlistTracks:{},setPlaylistTracks:()=>{}}),la=({children:t})=>{const[e,r]=d.useState([]),[a,i]=d.useState([]),[o,s]=d.useState([]),[l,u]=d.useState([]),[x,b]=d.useState([]),[v,j]=d.useState(null),[_,C]=d.useState(!1),[P,D]=d.useState(.5),[I,w]=d.useState(!1),[O,E]=d.useState(0),[A,S]=d.useState(0),[M,$]=d.useState(!0),[Y,U]=d.useState(!0),[K,R]=d.useState({}),[J,H]=d.useState(1),[se,W]=d.useState({all:1,popular:1,liked:1,new:1,random:1}),[B,ce]=d.useState(!0),[N,le]=d.useState("all"),[pe,he]=d.useState([]),[L,te]=d.useState(!1),[ne,de]=d.useState(!1),F=d.useRef(new Audio),re=d.useRef(new Audio),ye=d.useRef(!0),me=d.useRef(null),fe=d.useRef(!0),ue=d.useRef(!1),[Ce,qe]=d.useState(!1),Ae=d.useRef({}),De=d.useRef(0),_e=d.useRef(0),Ue=d.useRef(null),Pe=d.useRef(0),Se=d.useRef(null),Me=d.useRef(!1),et=d.useRef(!1),[ze,Le]=d.useState({});d.useEffect(()=>{let c=!0;return(async()=>{if(fe.current!==!1||!(N==="all"&&e.length>0||N==="liked"&&o.length>0||N==="popular"&&a.length>0||N==="new"&&l.length>0||N==="random"&&x.length>0)){if(N==="liked"&&et.current&&Se.current){const f=Date.now()-Se.current;if(o.length===0&&f<9e5||o.length>0&&f<3e5)return}fe.current=!0,$(!0);try{let f="/api/music",h={page:1,per_page:50};if(N==="liked"){if(f="/api/music/liked",Me.current)return fe.current=!1,void $(!1);Me.current=!0;try{const g=await G.get(f,{params:{...h,_t:Date.now()},headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"},withCredentials:!0});if(!c)return Me.current=!1,void(fe.current=!1);if(g.data&&g.data.tracks){const p=g.data.tracks;s(p),U(p.length>=50),R(k=>({...k,liked:p.length>=50})),Se.current=Date.now(),et.current=!0}else s([]),U(!1),R(p=>({...p,liked:!1})),Se.current=Date.now(),et.current=!0}catch{}finally{Me.current=!1,fe.current=!1,$(!1)}return}N==="popular"?h.sort="popular":N==="new"?h.sort="date":N==="random"&&(h.random=!0,h.nocache=Math.random());const y=await G.get(f,{params:h});if(!c)return;if(y.data&&y.data.tracks){const g=y.data.tracks;if(g.length>0&&(_||v)){const p=Math.min(3,g.length);Promise.all(g.slice(0,p).map(async k=>{try{const T=await ge(k.id);T&&(k.lyricsData=T)}catch{}})).catch(k=>{})}if(N==="all")r(g),U(g.length>=50),R(p=>({...p,all:g.length>=50}));else if(N==="popular")i(g),U(g.length>=50),R(p=>({...p,popular:g.length>=50}));else if(N==="new")u(g),U(g.length>=50),R(p=>({...p,new:g.length>=50}));else if(N==="random"){const p=[...g].sort(()=>Math.random()-.5);b(p),U(g.length>=50),R(k=>({...k,random:g.length>=50}))}setTimeout(()=>{g.length>=50&&K[N]!==!1&&Oe(N).catch(p=>{})},2e3)}fe.current=!1,$(!1)}catch{c&&($(!1),fe.current=!1),N==="liked"&&(Me.current=!1)}}})(),()=>{c=!1}},[N,K,e.length,o.length,a.length,l.length,x.length]),d.useEffect(()=>{let c=!0;const f=()=>{if(c){const g=F.current;De.current=g.currentTime,_e.current=g.duration,"mediaSession"in navigator&&g.duration&&navigator.mediaSession.setPositionState({duration:g.duration,position:g.currentTime,playbackRate:g.playbackRate});const p=Date.now();if(p-Pe.current>1e3&&(E(g.currentTime),S(g.duration),Pe.current=p),B&&_&&g.duration>0){const k=g.duration-g.currentTime;k<=3&&k>0&&!me.current&&be().then(T=>{if(T){re.current.src=T.file_path,re.current.volume=0;const z=re.current.play();z!==void 0&&z.catch(Ee=>{});const Q=setInterval(()=>{F.current.paused===!1?(F.current.volume>.1?F.current.volume-=.1:F.current.volume=0,re.current.volume<P-.1?re.current.volume+=.1:(re.current.volume=P,F.current.pause(),clearInterval(Q),[F.current,re.current]=[re.current,F.current],j(T),me.current=null)):clearInterval(Q)},100);me.current=Q}}),k<=10&&k>3&&be().then(T=>{T&&re.current&&(re.current.src=T.file_path,re.current.load())})}}},h=()=>{if(c)if(B&&me.current){clearInterval(me.current),me.current=null,F.current.pause();const g=F.current;F.current=re.current,re.current=g,be().then(p=>{p&&(j(p),localStorage.setItem("currentTrack",JSON.stringify(p)))}).catch(p=>{Je()})}else Je()},y=F.current;return y.addEventListener("timeupdate",f),y.addEventListener("ended",h),y.addEventListener("loadedmetadata",f),()=>{c=!1,y.removeEventListener("timeupdate",f),y.removeEventListener("ended",h),y.removeEventListener("loadedmetadata",f),Ue.current&&(clearTimeout(Ue.current),Ue.current=null),me.current&&(clearInterval(me.current),me.current=null)}},[B,_,P,v,e,o,a,l,x]);const ge=async c=>{try{const f=await fetch(`/api/music/${c}/lyrics`);return f.ok?await f.json():null}catch{return null}},it=(c,f=N)=>{if(!ne){de(!0);try{if(me.current&&(clearTimeout(me.current),me.current=null),v&&c.id===v.id)return Re(),void de(!1);c.lyricsData||ge(c.id).then(p=>{p&&(c.lyricsData=p,v&&c.id===v.id&&j({...c}))}).catch(p=>{}),F.current.pause(),re.current.pause(),F.current.src="",re.current.src="",j(c),le(f),E(0),S(0);try{localStorage.setItem("currentTrack",JSON.stringify(c)),localStorage.setItem("currentSection",f)}catch{}F.current=new Audio;const h=()=>{de(!1),F.current.volume=I?0:P;const p=F.current.play();p!==void 0&&p.then(()=>{C(!0);try{G.post(`/api/music/${c.id}/play`,{},{withCredentials:!0}).catch(k=>{}),G.post("/api/user/now-playing",{track_id:c.id,artist:c.artist,title:c.title},{withCredentials:!0}).catch(k=>{})}catch{}}).catch(k=>{C(!1),de(!1)})},y=()=>{},g=p=>{de(!1)};return F.current.addEventListener("canplaythrough",h,{once:!0}),F.current.addEventListener("loadstart",y),F.current.addEventListener("error",g),F.current.src=c.file_path,F.current.load(),()=>{F.current.removeEventListener("canplaythrough",h),F.current.removeEventListener("loadstart",y),F.current.removeEventListener("error",g)}}catch{de(!1)}}},Re=()=>{if(!ne)try{const c=F.current;if(!c.src){if(!v)return;c.src=v.file_path,c.load()}if(_)c.pause(),C(!1);else{const f=c.play();f!==void 0&&f.then(()=>{C(!0),v&&G.post("/api/user/now-playing",{track_id:v.id,artist:v.artist,title:v.title},{withCredentials:!0}).catch(h=>{})}).catch(h=>{C(!1)})}}catch{}},Je=async()=>{if(!ne){de(!0);try{const c=await be();c?it(c,N):de(!1)}catch{de(!1)}}},Ne=async()=>{if(!ne){de(!0);try{if(O<3){const c=await Fe();c?it(c,N):(F.current.currentTime=0,de(!1))}else F.current.currentTime=0,de(!1)}catch{de(!1)}}},be=async()=>{try{if(!v)return null;if(N&&N.startsWith("playlist_")){const h=ze[N]||[];if(h.length===0)return null;const y=h.findIndex(g=>g.id===v.id);return y===-1?h[0]:y<h.length-1?h[y+1]:h[0]}let c;switch(N){case"popular":c=a;break;case"liked":c=o;break;case"new":c=l;break;case"random":c=x;break;case"search":c=pe;break;default:c=e}if(!c||c.length===0)return null;const f=c.findIndex(h=>h.id===v.id);if(f===-1)return c[0];if((f>=c.length-3||(f+1)%15>=12||(f+1)%15==0)&&K[N]&&Oe(N),f<c.length-1)return c[f+1];if(K[N]&&await Oe(N)){let h;switch(N){case"popular":h=a;break;case"liked":h=o;break;case"new":h=l;break;case"random":h=x;break;case"search":h=pe;break;default:h=e}if(h.length>c.length)return h[c.length]}return c[0]}catch{return null}},Fe=async()=>{try{if(!v)return null;if(N&&N.startsWith("playlist_")){const h=ze[N]||[];if(h.length===0)return null;const y=h.findIndex(g=>g.id===v.id);return y===-1?h[h.length-1]:y>0?h[y-1]:h[h.length-1]}let c;switch(N){case"popular":c=a;break;case"liked":c=o;break;case"new":c=l;break;case"random":c=x;break;case"search":c=pe;break;default:c=e}if(!c||c.length===0)return null;const f=c.findIndex(h=>h.id===v.id);return f===-1?c[c.length-1]:((f<=2||f%15<=2||f%15==14)&&K[N]&&Oe(N),f>0?c[f-1]:c[c.length-1])}catch{return null}};d.useEffect(()=>{const c=F.current,f=async()=>{if(!me.current)try{const h=await be();h&&it(h,N)}catch{}};return c.addEventListener("ended",f),()=>{c.removeEventListener("ended",f)}},[v,N]);const Ye=c=>{F.current&&(F.current.currentTime=c,E(c),De.current=c)};d.useEffect(()=>{if(v&&"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:v.title,artist:v.artist,album:v.album||"",artwork:[{src:v.cover_path||"/uploads/system/album_placeholder.jpg",sizes:"512x512",type:"image/jpeg"}]}),navigator.mediaSession.playbackState=_?"playing":"paused",navigator.mediaSession.setActionHandler("play",Re),navigator.mediaSession.setActionHandler("pause",Re),navigator.mediaSession.setActionHandler("nexttrack",Je),navigator.mediaSession.setActionHandler("previoustrack",Ne),navigator.mediaSession.setActionHandler("seekto",c=>{c.seekTime&&Ye(c.seekTime)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&(navigator.mediaSession.playbackState=_?"playing":"paused")}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)){const c=F.current,f=()=>{navigator.mediaSession.playbackState="playing",navigator.mediaSession.metadata=navigator.mediaSession.metadata},h=()=>{navigator.mediaSession.playbackState="paused",navigator.mediaSession.metadata=navigator.mediaSession.metadata};return c.addEventListener("play",f),c.addEventListener("pause",h),()=>{c.removeEventListener("play",f),c.removeEventListener("pause",h)}}},[v,_]);const Oe=d.useCallback(async(c="all")=>{if(ue.current||K[c]===!1||se[c]===1&&(c==="all"&&e.length===0||c==="liked"&&o.length===0||c==="random"&&x.length===0||c==="popular"&&a.length===0||c==="new"&&l.length===0))return!1;ue.current=!0,qe(!0);try{let f,h=se[c]+1,y="/api/music",g={page:h,per_page:50};if(c==="liked"){y="/api/music/liked",g={page:h,per_page:50};const T={params:g,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"},withCredentials:!0};f=await G.get(y,T)}else c==="popular"?g.sort="popular":c==="new"?g.sort="date":c==="random"&&(g.random=!0,g.nocache=Math.random());await new Promise(T=>setTimeout(T,300)),c!=="liked"&&(f=await G.get(y,{params:g}));let p=[],k=!1;if(f&&f.data&&f.data.tracks){if(p=f.data.tracks,k=p.length>=50,f.data.has_more!==void 0?k=f.data.has_more:f.data.pages!==void 0&&(k=h<f.data.pages),p.length>0){const T=Math.min(2,p.length);Promise.all(p.slice(0,T).map(async z=>{if(!z.lyricsData)try{const Q=await ge(z.id);Q&&(z.lyricsData=Q)}catch{}})).catch(z=>{})}}else f&&Array.isArray(f.data)&&(p=f.data,k=p.length>=50);if(p.length===0&&(k=!1),c==="all")r(T=>[...T,...p]);else if(c==="liked")f&&f.data&&f.data.tracks?s(T=>[...T,...f.data.tracks]):s(T=>[...T,...p]);else if(c==="popular")i(T=>[...T,...p]);else if(c==="new")u(T=>[...T,...p]);else if(c==="random"){const T=[...p].sort(()=>Math.random()-.5);b(z=>[...z,...T])}return W(T=>({...T,[c]:h})),R(T=>({...T,[c]:k})),N===c&&U(k),k&&setTimeout(()=>{at(h+1,c)},1e3),!0}catch(f){return f.response&&f.response.status===404&&(R(h=>({...h,[c]:!1})),N===c&&U(!1)),!1}finally{ue.current=!1,qe(!1)}},[se,K,e.length,o.length,x.length,a.length,l.length,N]),at=d.useCallback(async(c,f="all")=>{try{const h=Date.now();if(h-(Ae.current?.[f]||0)<3e4)return;if(Ae.current={...Ae.current||{},[f]:h},f==="liked"){let p="/api/music/liked",k={page:c,per_page:50};try{await G.get(p,{params:k,headers:{"Cache-Control":"max-age=300"}})}catch{}return}let y="/api/music",g={page:c,per_page:50};f==="popular"?g.sort="popular":f==="new"?g.sort="date":f==="random"&&(g.random=!0),await G.get(y,{params:g,headers:{"Cache-Control":"max-age=300"}})}catch{}},[]),tt=d.useCallback(async(c,f=!1)=>(W(h=>({...h,[c]:1})),new Promise(async(h,y)=>{try{let g="/api/music",p={page:1,per_page:50};if(c==="liked"){g="/api/music/liked";try{const T={params:p,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"},withCredentials:!0},z=await G.get(g,T);if(z.data&&z.data.tracks){const Q=z.data.tracks,Ee=Q.length>=p.per_page;return s(Q),R(ae=>({...ae,liked:Ee})),N==="liked"&&U(Ee),void h(!0)}return s([]),R(Q=>({...Q,liked:!1})),N==="liked"&&U(!1),void h(!1)}catch(T){return R(z=>({...z,liked:!1})),N==="liked"&&U(!1),void y(T)}}else c==="popular"?p.sort="popular":c==="new"&&(p.sort="date");f&&(p.random=!0,p.nocache=Math.random());const k=await G.get(g,{params:p});if(k.data&&k.data.tracks){const T=k.data.tracks;c==="all"?(r(T),U(T.length>=50),R(z=>({...z,all:T.length>=50}))):c==="liked"?(s(T),U(T.length>=50),R(z=>({...z,liked:T.length>=50}))):c==="popular"?(i(T),U(T.length>=50),R(z=>({...z,popular:T.length>=50}))):c==="new"&&(u(T),U(T.length>=50),R(z=>({...z,new:T.length>=50}))),h(!0)}else y(new Error("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0442\u0440\u0435\u043A\u0438"))}catch(g){y(g)}})),[]);d.useEffect(()=>{if(ye.current){try{const c=localStorage.getItem("currentTrack"),f=localStorage.getItem("currentSection")||"all";if(c){const h=JSON.parse(c);j(h),le(f),F.current.src=h.file_path,F.current.volume=P,C(!1)}}catch{}ye.current=!1}},[P]),d.useEffect(()=>{let c=null,f=Date.now();const h=()=>{const y=Date.now();y-f>15e3&&(f=y,G.post("/api/user/clear-now-playing",{},{withCredentials:!0}).then(g=>{}).catch(g=>{}))};return(_&&v||!_&&v)&&(c&&clearTimeout(c),c=setTimeout(()=>{h()},3e5)),()=>{c&&clearTimeout(c),h()}},[_,v]);const wt=d.useCallback(()=>{const c=F.current;return c&&!isNaN(c.currentTime)?c.currentTime:De.current||0},[]),rt=d.useCallback(()=>{const c=F.current;return c&&!isNaN(c.duration)?c.duration:_e.current||0},[]),pt=d.useCallback((c,f)=>{Le(h=>({...h,[f]:c}))},[]),m={tracks:e,popularTracks:a,likedTracks:o,newTracks:l,randomTracks:x,currentTrack:v,isPlaying:_,volume:P,isMuted:I,currentTime:O,duration:A,isLoading:M,audioRef:F,hasMoreTracks:Y,hasMoreByType:K,currentSection:N,isTrackLoading:ne,setCurrentTrack:j,setCurrentSection:le,setRandomTracks:b,playTrack:it,togglePlay:Re,nextTrack:Je,prevTrack:Ne,setVolume:c=>{D(c),F.current.volume=c,w(c===0)},toggleMute:()=>{I?(F.current.volume=P,w(!1)):(F.current.volume=0,w(!0))},seekTo:Ye,likeTrack:async c=>{try{const f=v&&v.id===c?v:e.find(y=>y.id===c)||a.find(y=>y.id===c)||l.find(y=>y.id===c)||x.find(y=>y.id===c)||o.find(y=>y.id===c);if(f){const y=!f.is_liked;v&&v.id===c&&j({...v,is_liked:y,likes_count:y?(v.likes_count||0)+1:Math.max(0,(v.likes_count||0)-1)});const g=p=>p.map(k=>k.id===c?{...k,is_liked:y,likes_count:y?(k.likes_count||0)+1:Math.max(0,(k.likes_count||0)-1)}:k);if(r(g(e)),i(g(a)),u(g(l)),b(g(x)),y){if(o.findIndex(p=>p.id===c)===-1){const p={...f,is_liked:!0};s([p,...o])}}else s(o.filter(p=>p.id!==c))}const h=await G.post(`/api/music/${c}/like`,{},{headers:{"Content-Type":"application/json"},withCredentials:!0});if(h.data.success){const y=h.data.is_liked;if(f&&f.is_liked!==y){const g=p=>p.map(k=>k.id===c?{...k,is_liked:y,likes_count:y?(k.likes_count||0)+1:Math.max(0,(k.likes_count||0)-1)}:k);if(r(g(e)),i(g(a)),u(g(l)),b(g(x)),y){if(o.findIndex(p=>p.id===c)===-1){const p=e.find(k=>k.id===c)||a.find(k=>k.id===c)||l.find(k=>k.id===c)||x.find(k=>k.id===c);if(p){const k={...p,is_liked:!0};s([k,...o])}}}else s(o.filter(p=>p.id!==c))}return Se.current=Date.now(),{success:!0,is_liked:y}}if(f){const y=f.is_liked,g=p=>p.map(k=>k.id===c?{...k,is_liked:y,likes_count:y?k.likes_count||0:Math.max(0,k.likes_count||0)}:k);r(g(e)),i(g(a)),u(g(l)),b(g(x)),v&&v.id===c&&j({...v,is_liked:y})}return{success:!1,message:h.data.message}}catch{return v&&v.id===c&&j({...v}),{success:!1,message:"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 \u043B\u0430\u0439\u043A\u0430"}}},uploadTrack:async(c,f)=>{try{const h=new FormData;h.append("audio",c),f&&(h.append("title",f.title||""),h.append("artist",f.artist||""),h.append("album",f.album||""));try{const g=()=>new Promise((k,T)=>{window.jsmediatags!==void 0?window.jsmediatags.read(c,{onSuccess:function(z){const Q=z.tags||{},Ee=Q.title||"",ae=Q.artist||"",Z=Q.album||"";let ee=null;if(Q.picture){const{data:ve,format:$e}=Q.picture,ct=ve.reduce((nn,Ri)=>nn+String.fromCharCode(Ri),"");ee=`data:${$e};base64,${window.btoa(ct)}`}k({title:Ee||f?.title||"",artist:ae||f?.artist||"",album:Z||f?.album||"",pictureData:ee})},onError:function(z){k(null)}}):k(null)}),p=await g();if(p&&(p.title&&h.append("title",p.title),p.artist&&h.append("artist",p.artist),p.album&&h.append("album",p.album),p.pictureData)){const k=await fetch(p.pictureData),T=await k.blob(),z=new File([T],"cover.jpg",{type:T.type});h.append("cover",z)}}catch{}const y=await G.post("/api/music/upload",h,{headers:{"Content-Type":"multipart/form-data"}});if(y.data.success){const g=[y.data.track,...e];r(g);const p=[y.data.track,...l].slice(0,10);return u(p),y.data.track}return null}catch{return null}},loadMoreTracks:Oe,resetPagination:tt,enableCrossfade:B,setEnableCrossfade:ce,searchResults:pe,isSearching:L,searchTracks:async c=>{if(!c||c.trim()==="")return he([]),[];try{te(!0);const f=(await G.get("/api/music/search",{params:{query:c.trim()},timeout:1e4,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}})).data,h=Array.isArray(f)?f.map(y=>({...y,is_liked:typeof y.is_liked=="boolean"?y.is_liked:!!o.find(g=>g.id===y.id),file_path:y.file_path||"/static/uploads/system/audio_placeholder.mp3",cover_path:y.cover_path||"/static/uploads/system/album_placeholder.jpg"})):[];return he(h),h}catch(f){return f.response?f.response.status:f.request,[]}finally{te(!1)}},getCurrentTimeRaw:wt,getDurationRaw:rt,playlistTracks:ze,setPlaylistTracks:pt};return n.jsx(Ir.Provider,{value:m,children:t})},Rn=()=>d.useContext(Ir),yr="https://k-connect.ru",dr=({title:t="\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442",description:e="\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442 - \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0441\u0435\u0442\u044C \u043E\u0442 \u043D\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043C\u043E\u0433\u043E \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A\u0430",image:r="/icon-512.png",url:a=typeof window<"u"?window.location.href:"https://k-connect.ru",type:i="website",meta:o={}})=>{const s=a.startsWith("http")?a:`${yr}${a.startsWith("/")?a:`/${a}`}`,l=(u=>{if(!u)return`${yr}/icon-512.png`;if(u.startsWith("http")||u.startsWith("//"))return u;let x=u;if(u.includes("//")){const b=u.split("//");x=b[b.length-1],x.startsWith("/")&&(x=x.substring(1))}return`${yr}${x.startsWith("/")?"":"/"}${x}`})(r);return n.jsxs(ic,{prioritizeSeoTags:!0,encodeSpecialCharacters:!1,defer:!1,children:[n.jsx("title",{children:t}),n.jsx("meta",{name:"description",content:e}),n.jsx("link",{rel:"canonical",href:s}),n.jsx("meta",{name:"robots",content:"index, follow"}),n.jsx("meta",{name:"googlebot",content:"index, follow"}),n.jsx("meta",{name:"google",content:"notranslate"}),o.googleVerification&&n.jsx("meta",{name:"google-site-verification",content:o.googleVerification}),o.yandexVerification&&n.jsx("meta",{name:"yandex-verification",content:o.yandexVerification}),n.jsx("meta",{property:"og:title",content:t}),n.jsx("meta",{property:"og:description",content:e}),n.jsx("meta",{property:"og:image",content:l}),n.jsx("meta",{property:"og:url",content:s}),n.jsx("meta",{property:"og:type",content:i}),n.jsx("meta",{property:"og:site_name",content:"\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442"}),n.jsx("meta",{property:"og:locale",content:"ru_RU"}),n.jsx("meta",{property:"og:image:width",content:"1200"}),n.jsx("meta",{property:"og:image:height",content:"630"}),n.jsx("meta",{property:"og:image:alt",content:t}),n.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),n.jsx("meta",{name:"twitter:title",content:t}),n.jsx("meta",{name:"twitter:description",content:e}),n.jsx("meta",{name:"twitter:image",content:l}),o.keywords&&n.jsx("meta",{name:"keywords",content:o.keywords}),o.author&&n.jsx("meta",{name:"author",content:o.author}),o.viewport&&n.jsx("meta",{name:"viewport",content:o.viewport||"width=device-width, initial-scale=1, maximum-scale=5"}),i==="article"&&o.publishedTime&&n.jsx("meta",{property:"article:published_time",content:o.publishedTime}),i==="article"&&o.author&&n.jsx("meta",{property:"article:author",content:o.author}),i==="article"&&n.jsx("script",{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"Article",headline:t,description:e,image:l,author:o.author||"\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442",datePublished:o.publishedTime||new Date().toISOString(),url:s})})]})},dr.propTypes={title:Et.string,description:Et.string,image:Et.string,url:Et.string,type:Et.string,meta:Et.object};let Br,da;Br=d.createContext(),da=({children:t})=>{const[e,r]=d.useState(!1),[a,i]=d.useState(null),[o,s]=d.useState(null),l=yt(),u=_t();return d.useEffect(()=>{const x=l.pathname.match(/\/post\/(\d+)/);if(x&&x[1]){const b=x[1];i(b),!e&&l.state?.background&&r(!0)}else e&&(r(!1),i(null))},[l,e]),n.jsx(Br.Provider,{value:{overlayOpen:e,currentPostId:a,backgroundLocation:o,openPostDetail:(x,b)=>!(!b||!(b.ctrlKey||b.metaKey||b.shiftKey||b.altKey))||(b&&(b.preventDefault(),b.stopPropagation()),i(x),s(l),r(!0),u(`/post/${x}`,{state:{background:l},replace:!1}),!1),closePostDetail:()=>{r(!1),o?u(o.pathname+o.search,{replace:!0}):u("/"),i(null),s(null)}},children:t})},Ko=()=>d.useContext(Br);var ua,Dt={};function bs(){if(ua)return Dt;ua=1;var t=Ie();Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.default=void 0;var e=t(je()),r=Te();return Dt.default=(0,e.default)((0,r.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Dt}hn=ke(bs()),xe(lr.create(an))(({theme:t})=>({backgroundColor:t.palette.background.paper,borderRadius:2*t.shape.borderRadius,padding:t.spacing(4),width:"100%",maxWidth:450,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.25)",position:"relative",overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.05)","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"4px",background:"linear-gradient(90deg, var(--primary-dark) 0%, var(--primary) 100%)"},[t.breakpoints.down("sm")]:{padding:t.spacing(3),maxWidth:"100%"}}));const ws=()=>{const t=ot(),e=on(t.breakpoints.down("sm")),r=_t();yt();const{user:a,setUser:i}=d.useContext(nt),[o,s]=d.useState({name:"",interests:"",about:"",agree_terms:!1,agree_privacy:!1}),[l,u]=d.useState(null),[x,b]=d.useState(null),[v,j]=d.useState(!1),[_,C]=d.useState("");d.useEffect(()=>{a||r("/login",{replace:!0})},[a,r]);const P=D=>{const{name:I,value:w,checked:O}=D.target,E=I==="agree_terms"||I==="agree_privacy"?O:w;s(A=>({...A,[I]:E})),C("")};return n.jsxs(sn,{disableGutters:!0,maxWidth:!1,sx:{display:"flex",minHeight:"100vh",width:"100%",overflow:"hidden",position:"relative"},children:[!e&&n.jsxs(V,{sx:{flex:"0 0 45%",background:"linear-gradient(135deg, rgba(20, 20, 30, 1) 0%, rgba(40, 40, 60, 0.95) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",p:6},children:[n.jsx(V,{sx:{position:"absolute",width:"200%",height:"200%",top:"-50%",left:"-50%",background:"radial-gradient(circle, rgba(208, 188, 255, 0.05) 0%, rgba(208, 188, 255, 0) 70%)",zIndex:0}}),n.jsx(lr.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.7,delay:.2},style:{position:"relative",zIndex:1},children:n.jsx("img",{src:"/static/icons/clear-logonew.svg",alt:"\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442 \u041B\u043E\u0433\u043E",style:{width:180,marginBottom:40}})}),n.jsxs(lr.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.5},style:{position:"relative",zIndex:1,textAlign:"center"},children:[n.jsxs(oe,{variant:"h3",sx:{fontWeight:700,mb:2},children:[n.jsx("span",{style:{color:"#D0BCFF"},children:"\u041A"}),"-\u041A\u041E\u041D\u041D\u0415\u041A\u0422"]}),n.jsx(oe,{variant:"h6",color:"text.secondary",sx:{maxWidth:400},children:"\u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0441\u0432\u043E\u0439 \u043A\u0430\u043D\u0430\u043B \u0438 \u0434\u0435\u043B\u0438\u0442\u0435\u0441\u044C \u043A\u043E\u043D\u0442\u0435\u043D\u0442\u043E\u043C \u0441 \u0441\u043E\u043E\u0431\u0449\u0435\u0441\u0442\u0432\u043E\u043C"})]}),n.jsx(V,{sx:{position:"absolute",bottom:40,left:0,right:0,display:"flex",justifyContent:"center",gap:2},children:[...Array(3)].map((D,I)=>n.jsx(lr.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.4,delay:.8+.2*I},children:n.jsx(V,{sx:{width:12+4*I,height:12+4*I,borderRadius:"50%",background:`rgba(208, 188, 255, ${.6-.15*I})`}})},I))})]}),n.jsx(V,{sx:{flex:e?1:"0 0 55%",display:"flex",alignItems:"center",justifyContent:"center",p:0,background:e?"linear-gradient(135deg, rgba(20, 20, 30, 1) 0%, rgba(40, 40, 60, 0.95) 100%)":"transparent"},children:n.jsxs(lr.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5},style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:e?"16px":"40px"},children:[e&&n.jsxs(V,{sx:{position:"absolute",top:"24px",left:0,width:"100%",textAlign:"center"},children:[n.jsx("img",{src:"/static/icons/clear-logonew.svg",alt:"\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442 \u041B\u043E\u0433\u043E",style:{width:80,marginBottom:12}}),n.jsxs(oe,{variant:"h5",component:"h1",sx:{fontWeight:700},children:[n.jsx("span",{style:{color:"#D0BCFF"},children:"\u041A"}),"-\u041A\u041E\u041D\u041D\u0415\u041A\u0422"]})]}),n.jsxs(jt,{elevation:e?0:6,sx:{p:e?3:4,width:"100%",maxWidth:"480px",borderRadius:4,background:e?"transparent":"rgba(30, 30, 40, 0.85)",backdropFilter:"blur(10px)",border:e?"none":"1px solid rgba(255, 255, 255, 0.1)",mt:e?"140px":0,overflowY:"auto",maxHeight:e?"calc(100vh - 200px)":"fit-content",minHeight:e?"auto":"0",display:"flex",flexDirection:"column"},children:[n.jsx(oe,{variant:"h5",component:"h2",sx:{mb:1,fontWeight:600},children:"\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043A\u0430\u043D\u0430\u043B\u0430"}),n.jsx(oe,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044E \u043E \u0432\u0430\u0448\u0435\u043C \u043D\u043E\u0432\u043E\u043C \u043A\u0430\u043D\u0430\u043B\u0435"}),_&&n.jsx($i,{severity:"error",sx:{mb:3,borderRadius:2,"& .MuiAlert-icon":{alignItems:"center"}},children:_}),n.jsxs("form",{onSubmit:async D=>{if(D.preventDefault(),o.name?o.agree_terms&&o.agree_privacy||(C("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0441\u043E\u0433\u043B\u0430\u0441\u0438\u0442\u044C\u0441\u044F \u0441 \u043F\u0440\u0430\u0432\u0438\u043B\u0430\u043C\u0438 \u0438 \u043F\u043E\u043B\u0438\u0442\u0438\u043A\u043E\u0439 \u043A\u043E\u043D\u0444\u0438\u0434\u0435\u043D\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u0438"),0):(C("\u0418\u043C\u044F \u043A\u0430\u043D\u0430\u043B\u0430 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C"),0)){j(!0),C("");try{const I=new FormData;Object.keys(o).forEach(E=>{I.append(E,o[E])}),I.append("account_type","channel"),I.append("main_account_id",a.id),l&&I.append("photo",l);const w=await fetch("/api/users/create-channel",{method:"POST",body:I,credentials:"include"}),O=await w.json();w.ok&&O.success?r("/channel-dashboard",{replace:!0}):C(O.error||"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u043A\u0430\u043D\u0430\u043B\u0430")}catch{C("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u043A\u0430\u043D\u0430\u043B\u0430. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u043E\u0437\u0436\u0435.")}finally{j(!1)}}},style:{width:"100%"},children:[n.jsxs(V,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[n.jsx($o,{src:x,sx:{width:100,height:100,mb:2,border:"2px solid #D0BCFF"}}),n.jsxs(Ke,{variant:"outlined",component:"label",startIcon:n.jsx(hn,{}),sx:{borderColor:"#D0BCFF",color:"#D0BCFF",borderRadius:2,"&:hover":{borderColor:"#B69DF8",backgroundColor:"rgba(208, 188, 255, 0.04)"}},children:["\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0430\u0432\u0430\u0442\u0430\u0440 \u043A\u0430\u043D\u0430\u043B\u0430",n.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:D=>{const I=D.target.files[0];I&&(I.size>5242880?C("\u0420\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 \u043D\u0435 \u0434\u043E\u043B\u0436\u0435\u043D \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0442\u044C 5MB"):I.type.startsWith("image/")?(u(I),b(URL.createObjectURL(I)),C(null)):C("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435"))}})]})]}),n.jsx(Cr,{margin:"normal",required:!0,fullWidth:!0,id:"name",label:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u0430\u043D\u0430\u043B\u0430",name:"name",autoFocus:!0,value:o.name,onChange:P,variant:"outlined",sx:{mb:2.5,"& .MuiOutlinedInput-root":{borderRadius:2}}}),n.jsx(Cr,{margin:"normal",fullWidth:!0,id:"interests",label:"\u0422\u0435\u043C\u0430\u0442\u0438\u043A\u0430 \u043A\u0430\u043D\u0430\u043B\u0430",name:"interests",value:o.interests,onChange:P,variant:"outlined",placeholder:"\u041C\u0443\u0437\u044B\u043A\u0430, \u0441\u043F\u043E\u0440\u0442, \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435...",sx:{mb:2.5,"& .MuiOutlinedInput-root":{borderRadius:2}}}),n.jsx(Cr,{margin:"normal",fullWidth:!0,id:"about",label:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043A\u0430\u043D\u0430\u043B\u0430",name:"about",value:o.about,onChange:P,variant:"outlined",multiline:!0,rows:3,placeholder:"\u0420\u0430\u0441\u0441\u043A\u0430\u0436\u0438\u0442\u0435 \u043E \u0441\u0432\u043E\u0435\u043C \u043A\u0430\u043D\u0430\u043B\u0435...",sx:{mb:3,"& .MuiOutlinedInput-root":{borderRadius:2}}}),n.jsx(oe,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"\u041F\u0440\u0430\u0432\u043E\u0432\u044B\u0435 \u0441\u043E\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u044F"}),n.jsx(Wo,{control:n.jsx(Bo,{name:"agree_terms",checked:o.agree_terms,onChange:P,color:"primary",required:!0,sx:{color:"#D0BCFF","&.Mui-checked":{color:"#D0BCFF"}}}),label:n.jsxs(oe,{variant:"body2",children:["\u042F \u043F\u0440\u0438\u043D\u0438\u043C\u0430\u044E"," ",n.jsx(Ke,{href:"/terms-of-service",target:"_blank",sx:{color:"#D0BCFF",p:0,minWidth:"auto",fontWeight:"normal",textTransform:"none",fontSize:"inherit","&:hover":{background:"transparent",textDecoration:"underline"}},children:"\u041F\u0440\u0430\u0432\u0438\u043B\u0430 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u044F"})]}),sx:{mb:1}}),n.jsx(Wo,{control:n.jsx(Bo,{name:"agree_privacy",checked:o.agree_privacy,onChange:P,color:"primary",required:!0,sx:{color:"#D0BCFF","&.Mui-checked":{color:"#D0BCFF"}}}),label:n.jsxs(oe,{variant:"body2",children:["\u042F \u0441\u043E\u0433\u043B\u0430\u0441\u0435\u043D \u0441"," ",n.jsx(Ke,{href:"/privacy",target:"_blank",sx:{color:"#D0BCFF",p:0,minWidth:"auto",fontWeight:"normal",textTransform:"none",fontSize:"inherit","&:hover":{background:"transparent",textDecoration:"underline"}},children:"\u041F\u043E\u043B\u0438\u0442\u0438\u043A\u043E\u0439 \u043A\u043E\u043D\u0444\u0438\u0434\u0435\u043D\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0441\u0442\u0438"})]}),sx:{mb:3}}),n.jsx(Ke,{type:"submit",fullWidth:!0,variant:"contained",size:"large",sx:{py:1.5,borderRadius:2,fontSize:"1rem",textTransform:"none",background:"linear-gradient(90deg, #B69DF8 0%, #D0BCFF 100%)",boxShadow:"0 4px 12px rgba(182, 157, 248, 0.3)","&:hover":{background:"linear-gradient(90deg, #D0BCFF 0%, #E9DDFF 100%)",boxShadow:"0 6px 16px rgba(182, 157, 248, 0.4)"},mb:2},disabled:v,children:v?n.jsx(ht,{size:24,color:"inherit"}):"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u0430\u043D\u0430\u043B"})]})]})]})})]})},js=d.createContext(null),Hr={didCatch:!1,error:null};let pa=class extends d.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Hr}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var e,r,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];(e=(r=this.props).onReset)===null||e===void 0||e.call(r,{args:i,reason:"imperative-api"}),this.setState(Hr)}}componentDidCatch(t,e){var r,a;(r=(a=this.props).onError)===null||r===void 0||r.call(a,t,e)}componentDidUpdate(t,e){const{didCatch:r}=this.state,{resetKeys:a}=this.props;var i,o;r&&e.error!==null&&function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return s.length!==l.length||s.some((u,x)=>!Object.is(u,l[x]))}(t.resetKeys,a)&&((i=(o=this.props).onReset)===null||i===void 0||i.call(o,{next:a,prev:t.resetKeys,reason:"keys"}),this.setState(Hr))}render(){const{children:t,fallbackRender:e,FallbackComponent:r,fallback:a}=this.props,{didCatch:i,error:o}=this.state;let s=t;if(i){const l={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof e=="function")s=e(l);else if(r)s=d.createElement(r,l);else{if(a===void 0)throw o;s=a}}return d.createElement(js.Provider,{value:{didCatch:i,error:o,resetErrorBoundary:this.resetErrorBoundary}},s)}};const _s={width:24,height:24,body:'<g fill="currentColor"><circle cx="12" cy="6" r="4"/><path fill-rule="evenodd" d="M16.5 22c-1.65 0-2.475 0-2.987-.513C13 20.975 13 20.15 13 18.5c0-1.65 0-2.475.513-2.987C14.025 15 14.85 15 16.5 15c1.65 0 2.475 0 2.987.513C20 16.025 20 16.85 20 18.5c0 1.65 0 2.475-.513 2.987C18.975 22 18.15 22 16.5 22Zm.583-5.056a.583.583 0 1 0-1.166 0v.973h-.973a.583.583 0 1 0 0 1.166h.973v.973a.583.583 0 1 0 1.166 0v-.973h.973a.583.583 0 1 0 0-1.166h-.973v-.973Z" clip-rule="evenodd"/><path d="M15.678 13.503c-.473.005-.914.023-1.298.074c-.643.087-1.347.293-1.928.875c-.582.581-.788 1.285-.874 1.928c-.078.578-.078 1.284-.078 2.034v.172c0 .75 0 1.456.078 2.034c.06.451.18.932.447 1.38H12c-8 0-8-2.015-8-4.5S7.582 13 12 13c1.326 0 2.577.181 3.678.503Z"/></g>'},ks={width:24,height:24,body:'<g fill="currentColor"><path d="M16 6a4 4 0 1 1-8 0a4 4 0 0 1 8 0Zm-.322 7.503c-.473.005-.914.023-1.298.074c-.643.087-1.347.293-1.928.875c-.582.581-.788 1.285-.874 1.928c-.078.578-.078 1.284-.078 2.034v.172c0 .75 0 1.456.078 2.034c.06.451.18.932.447 1.38H12c-8 0-8-2.015-8-4.5S7.582 13 12 13c1.326 0 2.577.181 3.678.503Z"/><path fill-rule="evenodd" d="M16.5 22c-1.65 0-2.475 0-2.987-.513C13 20.975 13 20.15 13 18.5c0-1.65 0-2.475.513-2.987C14.025 15 14.85 15 16.5 15c1.65 0 2.475 0 2.987.513C20 16.025 20 16.85 20 18.5c0 1.65 0 2.475-.513 2.987C18.975 22 18.15 22 16.5 22Zm1.968-4.254a.583.583 0 1 0-.825-.825l-1.92 1.92l-.366-.365a.583.583 0 1 0-.825.825l.778.778a.583.583 0 0 0 .825 0l2.333-2.333Z" clip-rule="evenodd"/></g>'};var ha,Lt={};function Cs(){if(ha)return Lt;ha=1;var t=Ie();Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var e=t(je()),r=Te();return Lt.default=(0,e.default)((0,r.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd"),Lt}bn=ke(Cs());var ma,Nt={};function Ss(){if(ma)return Nt;ma=1;var t=Ie();Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.default=void 0;var e=t(je()),r=Te();return Nt.default=(0,e.default)((0,r.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29M20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3"}),"Groups"),Nt}Pn=ke(Ss());var fa,$t={};function Es(){if(fa)return $t;fa=1;var t=Ie();Object.defineProperty($t,"__esModule",{value:!0}),$t.default=void 0;var e=t(je()),r=Te();return $t.default=(0,e.default)((0,r.jsx)("path",{d:"M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAlt"),$t}const Is=ke(Es());var ga,Wt={};function Ts(){if(ga)return Wt;ga=1;var t=Ie();Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.default=void 0;var e=t(je()),r=Te();return Wt.default=(0,e.default)((0,r.jsx)("path",{d:"m1 3.54 1.53 1.53C1.65 5.28 1 6.06 1 7v12c0 1.1.9 2 2 2h15.46l2 2 1.26-1.27L2.27 2.27zM3 19V7h1.46l12 12zM21 5h-7.58l3.29-3.3L16 1l-4 4-4-4-.7.7L10.58 5H7.52l2 2H21v11.48l1.65 1.65c.22-.32.35-.71.35-1.13V7c0-1.11-.89-2-2-2"}),"TvOff"),Wt}const As=ke(Ts()),Ms=xe(jt)(({theme:t})=>({padding:t.spacing(4),textAlign:"center",borderRadius:16,background:"linear-gradient(145deg, #222222, #1c1c1c)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.05)"})),Ps=({message:t="\u041A\u0430\u043D\u0430\u043B\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B"})=>n.jsx(Ms,{children:n.jsxs(V,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:4},children:[n.jsx(As,{sx:{fontSize:70,color:"rgba(255, 255, 255, 0.2)",mb:2}}),n.jsx(oe,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:t}),n.jsx(oe,{variant:"body2",color:"text.disabled",sx:{maxWidth:400},children:"\u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u043F\u043E\u0438\u0441\u043A\u0430 \u0438\u043B\u0438 \u0432\u0435\u0440\u043D\u0438\u0442\u0435\u0441\u044C \u043F\u043E\u0437\u0436\u0435, \u043A\u043E\u0433\u0434\u0430 \u043F\u043E\u044F\u0432\u044F\u0442\u0441\u044F \u043D\u043E\u0432\u044B\u0435 \u043A\u0430\u043D\u0430\u043B\u044B"})]})}),Os=xe(sn)(({theme:t})=>({paddingTop:t.spacing(2),paddingBottom:t.spacing(10),[t.breakpoints.down("sm")]:{paddingTop:t.spacing(1),paddingBottom:t.spacing(8)}})),Rs=xe(V)(({theme:t})=>({marginBottom:t.spacing(3),display:"flex",flexDirection:"column",[t.breakpoints.down("sm")]:{marginBottom:t.spacing(2)}})),Fs=xe(jt)(({theme:t})=>({padding:t.spacing(2,2.5),marginBottom:t.spacing(3),borderRadius:16,background:"linear-gradient(145deg, #222222, #1c1c1c)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.05)",[t.breakpoints.down("sm")]:{padding:t.spacing(1.5,2),marginBottom:t.spacing(2)}})),zs=xe(Cr)(({theme:t,themecolor:e})=>({"& .MuiOutlinedInput-root":{backgroundColor:"rgba(0, 0, 0, 0.2)",borderRadius:"12px","& fieldset":{borderColor:"rgba(255, 255, 255, 0.1)"},"&:hover fieldset":{borderColor:we(e||t.palette.primary.main,.5)},"&.Mui-focused fieldset":{borderColor:e||t.palette.primary.main,borderWidth:"2px"}},"& .MuiInputBase-input":{padding:t.spacing(1.5,2)}})),xa=xe(V)(({theme:t})=>({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:t.spacing(2),[t.breakpoints.down("sm")]:{marginBottom:t.spacing(1.5)}})),Ds=xe(an)(({theme:t})=>({borderRadius:16,overflow:"hidden",background:"linear-gradient(145deg, #222222, #1c1c1c)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.05)",transition:"all 0.3s ease",height:"100%",display:"flex",flexDirection:"column","&:hover":{transform:"translateY(-5px)",boxShadow:"0 6px 25px rgba(0, 0, 0, 0.18)"}})),Ls=xe(Wi)(({theme:t})=>({padding:t.spacing(2),flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"space-between","&:last-child":{paddingBottom:t.spacing(2)},[t.breakpoints.down("sm")]:{padding:t.spacing(1.5)}})),Ns=xe($o)(({theme:t})=>({width:80,height:80,margin:"0 auto",marginTop:t.spacing(2),marginBottom:t.spacing(1),border:"2px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.2)",[t.breakpoints.down("sm")]:{width:50,height:50}})),$s=xe(oe)(({theme:t})=>({fontWeight:600,marginBottom:t.spacing(.5),textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical"})),Ws=xe(oe)(({theme:t})=>({color:"rgba(255, 255, 255, 0.6)",marginBottom:t.spacing(1.5),textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical"})),Bs=xe(oe)(({theme:t})=>({color:"rgba(255, 255, 255, 0.8)",marginBottom:t.spacing(1.5),overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",minHeight:"2.5rem",maxHeight:"2.5rem",flexGrow:0})),Hs=xe(Ho)(({theme:t,isFollowing:e,themecolor:r})=>({borderRadius:"8px",fontWeight:500,background:e?"rgba(255, 255, 255, 0.1)":`linear-gradient(135deg, ${r||t.palette.primary.main}, ${we(r||t.palette.primary.main,.7)})`,color:e?"rgba(255, 255, 255, 0.9)":"#fff",border:e?"1px solid rgba(255, 255, 255, 0.15)":"none","&:hover":{background:e?"rgba(255, 255, 255, 0.15)":`linear-gradient(135deg, ${r||t.palette.primary.main}, ${we(r||t.palette.primary.main,.8)})`},[t.breakpoints.down("sm")]:{"& .MuiChip-label":{padding:"0 6px",fontSize:"0.65rem"},"& .MuiChip-icon":{marginLeft:4}}})),Vr=xe(Bi)(({theme:t})=>({borderRadius:"8px",minHeight:"38px",padding:"6px 12px",textTransform:"none",fontWeight:500,fontSize:"0.9rem",minWidth:0,marginRight:t.spacing(1),color:"rgba(255, 255, 255, 0.7)","&.Mui-selected":{color:"#fff",fontWeight:600},[t.breakpoints.down("sm")]:{fontSize:"0.8rem",padding:"5px 10px"}})),Vs=xe(Hi)(({theme:t,themecolor:e})=>({minHeight:"38px","& .MuiTabs-indicator":{height:3,borderTopLeftRadius:3,borderTopRightRadius:3,backgroundColor:e||t.palette.primary.main},"& .MuiTabs-flexContainer":{gap:t.spacing(1)}})),qs=xe(Ke)(({theme:t,themecolor:e})=>({borderRadius:"12px",padding:t.spacing(1,3),marginTop:t.spacing(2),textTransform:"none",fontWeight:600,background:`linear-gradient(135deg, ${e||t.palette.primary.main}, ${we(e||t.palette.primary.main,.8)})`,color:"#fff","&:hover":{background:`linear-gradient(135deg, ${e||t.palette.primary.main}, ${we(e||t.palette.primary.main,.9)})`}})),Us=()=>(ot(),n.jsx(an,{sx:{borderRadius:4,overflow:"hidden",background:"linear-gradient(145deg, #222222, #1c1c1c)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.05)",height:"100%",display:"flex",flexDirection:"column",p:2},children:n.jsxs(V,{sx:{display:"flex",flexDirection:"column",alignItems:"center",height:"100%",justifyContent:"space-between"},children:[n.jsx(It,{variant:"circular",width:80,height:80,sx:{mb:2,bgcolor:"rgba(255, 255, 255, 0.1)",[t=>t.breakpoints.down("sm")]:{width:50,height:50}}}),n.jsx(It,{variant:"text",width:"80%",height:24,sx:{mb:1,bgcolor:"rgba(255, 255, 255, 0.1)"}}),n.jsx(It,{variant:"text",width:"60%",height:20,sx:{mb:2,bgcolor:"rgba(255, 255, 255, 0.1)"}}),n.jsx(It,{variant:"rectangular",width:"100%",height:40,sx:{mb:2,bgcolor:"rgba(255, 255, 255, 0.1)"}}),n.jsxs(V,{sx:{display:"flex",justifyContent:"space-between",width:"100%",mt:"auto"},children:[n.jsx(It,{variant:"rectangular",width:"30%",height:22,sx:{borderRadius:"6px",bgcolor:"rgba(255, 255, 255, 0.1)"}}),n.jsx(It,{variant:"rectangular",width:"40%",height:32,sx:{borderRadius:"8px",bgcolor:"rgba(255, 255, 255, 0.1)"}})]})]})})),Js=()=>{const{themeSettings:t}=d.useContext(At),{user:e}=d.useContext(nt),r=ot(),a=_t(),i=yt();on(r.breakpoints.down("sm"));const o=new URLSearchParams(i.search),s=o.get("q")||"",l=o.get("tab")||"recent",[u,x]=d.useState(l),[b,v]=d.useState(s),[j,_]=d.useState(!1),[C,P]=d.useState([]),[D,I]=d.useState([]),[w,O]=d.useState([]),[E,A]=d.useState(!0),[S,M]=d.useState(!1),[$,Y]=d.useState(!1),[U,K]=d.useState(1),[R,J]=d.useState(0),[H,se]=d.useState(!0),[W,B]=d.useState([]),[ce,N]=d.useState(!0),le=t?.primaryColor||r.palette.primary.main,pe=(L,te=b)=>{const ne=new URLSearchParams;return L&&ne.set("tab",L),te&&ne.set("q",te),`/channels?${ne.toString()}`};d.useEffect(()=>{(async()=>{try{const L=await G.get("/api/search/channels",{params:{sort:"popular",with_description:"true",per_page:4}});L.data&&Array.isArray(L.data.channels)&&I(L.data.channels)}catch{}})()},[]),d.useEffect(()=>{(async()=>{try{const L=await G.get("/api/search/channels",{params:{with_description:"true",per_page:4}});L.data&&Array.isArray(L.data.channels)&&O(L.data.channels)}catch{}})()},[]),d.useEffect(()=>{(async()=>{A(!0);try{const L=await G.get("/api/search/channels",{params:{q:b,sort:u,page:1,per_page:12,with_description:H?"true":"false"}});L.data&&(P(L.data.channels||[]),Y(L.data.has_next||!1),J(L.data.total||0))}catch{}finally{A(!1),_(!1)}})()},[u,b,H]);const he=L=>{return n.jsx(Ds,{children:n.jsx(qi,{onClick:()=>{return ne=L.username,void a(`/profile/${ne}`);var ne},children:n.jsxs(V,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[n.jsx(Ns,{src:L.photo,alt:L.name,onError:ne=>{ne.target.onerror=null,ne.target.src="/static/uploads/avatar/system/avatar.png"}}),n.jsxs(Ls,{children:[n.jsxs(V,{children:[n.jsxs($s,{variant:"h6",children:[L.name,L.is_verified&&n.jsx(V,{component:"span",sx:{ml:.5,color:"primary.main",display:"inline-flex",alignItems:"center"},children:n.jsx(Ze,{icon:"solar:verified-check-bold",width:"16",height:"16"})})]}),n.jsxs(Ws,{variant:"body2",children:["@",L.username]}),n.jsx(Bs,{variant:"body2",children:L.about||"\u041D\u0435\u0442 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u044F"})]}),n.jsxs(V,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:"auto"},children:[n.jsx(Ho,{size:"small",icon:n.jsx(Ze,{icon:"solar:users-group-rounded-bold",width:14,height:14}),label:(te=L.followers_count||0,te>=1e6?(te/1e6).toFixed(1).replace(/\.0$/,"")+"M":te>=1e3?(te/1e3).toFixed(1).replace(/\.0$/,"")+"K":te.toString()),sx:{bgcolor:"rgba(255, 255, 255, 0.08)",color:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",height:"22px","& .MuiChip-label":{px:1,fontSize:"0.7rem",fontWeight:500}}}),n.jsx(Hs,{size:"small",label:L.is_following?"\u0412\u044B \u043F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u044B":"\u041F\u043E\u0434\u043F\u0438\u0441\u0430\u0442\u044C\u0441\u044F",isFollowing:L.is_following,themecolor:le,onClick:ne=>{ne.stopPropagation(),(async(de,F)=>{if(e)try{const re=C.map(fe=>fe.id===de?{...fe,is_following:!F}:fe);P(re);const ye=D.map(fe=>fe.id===de?{...fe,is_following:!F}:fe);I(ye);const me=w.map(fe=>fe.id===de?{...fe,is_following:!F}:fe);O(me),F?await G.post("/api/profile/unfollow",{followed_id:de}):await G.post("/api/profile/follow",{followed_id:de})}catch{const ye=C.map(ue=>ue.id===de?{...ue,is_following:F}:ue);P(ye);const me=D.map(ue=>ue.id===de?{...ue,is_following:F}:ue);I(me);const fe=w.map(ue=>ue.id===de?{...ue,is_following:F}:ue);O(fe)}else a("/login")})(L.id,L.is_following)},icon:L.is_following?n.jsx(Ze,{icon:ks,width:"16",height:"16"}):n.jsx(Ze,{icon:_s,width:"16",height:"16"})})]})]})]})})},L.id);var te};return d.useEffect(()=>{(async()=>{if(e){N(!0);try{const L=await G.get("/api/users/my-channels");L.data&&Array.isArray(L.data.channels)&&B(L.data.channels)}catch{}finally{N(!1)}}else N(!1)})()},[e]),n.jsxs(Os,{maxWidth:"lg",children:[n.jsxs(Rs,{children:[n.jsxs(oe,{variant:"h4",sx:{mb:.5,fontWeight:700,display:"flex",alignItems:"center",gap:1},children:[n.jsx(Pn,{sx:{fontSize:28}}),"\u041A\u0430\u043D\u0430\u043B\u044B"]}),n.jsx(oe,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)",maxWidth:600},children:"\u0421\u043B\u0435\u0434\u0438\u0442\u0435 \u0437\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F\u043C\u0438 \u0432\u0430\u0448\u0438\u0445 \u043B\u044E\u0431\u0438\u043C\u044B\u0445 \u043A\u0430\u043D\u0430\u043B\u043E\u0432 \u0438 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0439\u0442\u0435 \u043D\u043E\u0432\u044B\u0439 \u043A\u043E\u043D\u0442\u0435\u043D\u0442"})]}),n.jsx(Fs,{children:n.jsx("form",{onSubmit:L=>{L.preventDefault(),K(1),P([]),_(!0),A(!0),a(pe(u,b),{replace:!0})},children:n.jsx(zs,{fullWidth:!0,variant:"outlined",placeholder:"\u041D\u0430\u0439\u0442\u0438 \u043A\u0430\u043D\u0430\u043B\u044B...",value:b,onChange:L=>v(L.target.value),themecolor:le,InputProps:{startAdornment:n.jsx(Vo,{position:"start",children:n.jsx(Tn,{sx:{color:"rgba(255, 255, 255, 0.7)"}})}),endAdornment:j&&n.jsx(Vo,{position:"end",children:n.jsx(ht,{size:20})})}})})}),!b&&D.length>0&&n.jsxs(V,{sx:{mb:4},children:[n.jsx(xa,{children:n.jsx(oe,{variant:"h5",sx:{fontWeight:700},children:"\u041F\u043E\u043F\u0443\u043B\u044F\u0440\u043D\u044B\u0435 \u043A\u0430\u043D\u0430\u043B\u044B"})}),n.jsx(mt,{container:!0,spacing:2,children:D.map(L=>n.jsx(mt,{item:!0,xs:6,sm:4,md:3,children:he(L)},L.id))})]}),!b&&w.length>0&&n.jsxs(V,{sx:{mb:4},children:[n.jsx(xa,{children:n.jsx(oe,{variant:"h5",sx:{fontWeight:700},children:"\u041E\u0442\u0431\u043E\u0440\u043D\u044B\u0435 \u043A\u0430\u043D\u0430\u043B\u044B"})}),n.jsx(mt,{container:!0,spacing:2,children:w.map(L=>n.jsx(mt,{item:!0,xs:6,sm:4,md:3,children:he(L)},L.id))})]}),n.jsxs(V,{sx:{mb:3},children:[n.jsx(V,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:n.jsxs(Vs,{value:u,onChange:(L,te)=>{x(te),K(1),P([]),A(!0),a(pe(te),{replace:!0})},"aria-label":"channel tabs",variant:"scrollable",scrollButtons:"auto",themecolor:le,children:[n.jsx(Vr,{label:"\u041D\u0435\u0434\u0430\u0432\u043D\u0438\u0435",value:"recent"}),n.jsx(Vr,{label:"\u041F\u043E\u043F\u0443\u043B\u044F\u0440\u043D\u044B\u0435",value:"popular"}),b&&n.jsx(Vr,{label:`\u041F\u043E\u0438\u0441\u043A: ${b}`,value:"search",disabled:!0})]})}),n.jsxs(V,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[n.jsx(oe,{variant:"body2",color:"text.secondary",children:j?n.jsxs(V,{sx:{display:"flex",alignItems:"center"},children:[n.jsx(ht,{size:16,sx:{mr:1}}),"\u041F\u043E\u0438\u0441\u043A..."]}):R>0?`\u041D\u0430\u0439\u0434\u0435\u043D\u043E ${R} \u043A\u0430\u043D\u0430\u043B\u043E\u0432`:!E&&"\u041D\u0435\u0442 \u043A\u0430\u043D\u0430\u043B\u043E\u0432"}),n.jsx(V,{sx:{display:"flex",alignItems:"center"},children:n.jsx(Vi,{size:"small",onClick:()=>se(!H),sx:{color:H?"primary.main":"text.secondary",ml:1},"aria-label":"Toggle filtering",title:H?"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0432\u0441\u0435 \u043A\u0430\u043D\u0430\u043B\u044B":"\u0422\u043E\u043B\u044C\u043A\u043E \u0441 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435\u043C",children:n.jsx(Is,{fontSize:"small"})})})]}),n.jsx(mt,{container:!0,spacing:2,children:E?Array.from(new Array(12)).map((L,te)=>n.jsx(mt,{item:!0,xs:6,sm:4,md:3,children:n.jsx(Us,{})},te)):C.length>0?C.map(L=>n.jsx(mt,{item:!0,xs:6,sm:4,md:3,children:he(L)},L.id)):!E&&n.jsx(mt,{item:!0,xs:12,children:n.jsx(Ps,{message:b?`\u041A\u0430\u043D\u0430\u043B\u044B \u043F\u043E \u0437\u0430\u043F\u0440\u043E\u0441\u0443 "${b}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B`:"\u041A\u0430\u043D\u0430\u043B\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B"})})}),!E&&C.length>0&&$&&n.jsx(V,{sx:{display:"flex",justifyContent:"center",mt:3},children:n.jsx(qs,{variant:"contained",onClick:async()=>{if(S||!$)return;M(!0);const L=U+1;try{const te=await G.get("/api/search/channels",{params:{q:b,sort:u,page:L,per_page:12,with_description:H?"true":"false"}});te.data&&(P(ne=>[...ne,...te.data.channels||[]]),Y(te.data.has_next||!1),K(L))}catch{}finally{M(!1)}},disabled:S,themecolor:le,startIcon:S&&n.jsx(ht,{size:20,color:"inherit"}),children:S?"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430...":"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0435\u0449\u0435"})})]}),n.jsx(V,{sx:{height:"60px",width:"100%"}})]})};window.audioTiming={currentTime:0,duration:0,progress:0,formattedCurrentTime:"0:00",formattedDuration:"0:00",audioRef:null,lastUpdate:0};const Ks=d.memo(()=>{const{audioRef:t,currentTrack:e,getCurrentTimeRaw:r,getDurationRaw:a,isPlaying:i,setCurrentTime:o,setDuration:s}=Rn(),l=u=>isNaN(u)||u===1/0?"0:00":`${Math.floor(u/60)}:${Math.floor(u%60).toString().padStart(2,"0")}`;return d.useRef(null),d.useRef(null),d.useRef(null),d.useEffect(()=>{window.audioTiming.audioRef=t.current;const u=()=>{if(!t.current)return;const v=performance.now(),j=t.current.currentTime||0,_=t.current.duration||0;(i||v-window.audioTiming.lastUpdate>200)&&(window.audioTiming.currentTime=j,window.audioTiming.duration=_,window.audioTiming.progress=_>0?j/_*100:0,window.audioTiming.formattedCurrentTime=l(j),window.audioTiming.formattedDuration=l(_),window.audioTiming.lastUpdate=v,typeof o=="function"&&o(j),typeof s=="function"&&s(_))};let x;const b=()=>{u(),x=requestAnimationFrame(b)};return t.current&&(x=requestAnimationFrame(b),t.current.addEventListener("timeupdate",u),t.current.addEventListener("seeking",u),t.current.addEventListener("seeked",u),t.current.addEventListener("play",u),t.current.addEventListener("pause",u)),()=>{x&&cancelAnimationFrame(x),t.current&&(t.current.removeEventListener("timeupdate",u),t.current.removeEventListener("seeking",u),t.current.removeEventListener("seeked",u),t.current.removeEventListener("play",u),t.current.removeEventListener("pause",u))}},[t,o,s,i]),null});var ya,Bt={};function Gs(){if(ya)return Bt;ya=1;var t=Ie();Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.default=void 0;var e=t(je()),r=Te();return Bt.default=(0,e.default)((0,r.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M7.5 18c-.83 0-1.5-.67-1.5-1.5S6.67 15 7.5 15s1.5.67 1.5 1.5S8.33 18 7.5 18m0-9C6.67 9 6 8.33 6 7.5S6.67 6 7.5 6 9 6.67 9 7.5 8.33 9 7.5 9m4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m0-9c-.83 0-1.5-.67-1.5-1.5S15.67 6 16.5 6s1.5.67 1.5 1.5S17.33 9 16.5 9"}),"Casino"),Bt}On=ke(Gs());var va,ba,Ht,ut,Ys=function(){if(ba)return va;ba=1;var t={linear:function(e,r,a,i){return(a-r)*e/i+r},easeInQuad:function(e,r,a,i){return(a-r)*(e/=i)*e+r},easeOutQuad:function(e,r,a,i){return-(a-r)*(e/=i)*(e-2)+r},easeInOutQuad:function(e,r,a,i){var o=a-r;return(e/=i/2)<1?o/2*e*e+r:-o/2*(--e*(e-2)-1)+r},easeInCubic:function(e,r,a,i){return(a-r)*(e/=i)*e*e+r},easeOutCubic:function(e,r,a,i){return(a-r)*((e=e/i-1)*e*e+1)+r},easeInOutCubic:function(e,r,a,i){var o=a-r;return(e/=i/2)<1?o/2*e*e*e+r:o/2*((e-=2)*e*e+2)+r},easeInQuart:function(e,r,a,i){return(a-r)*(e/=i)*e*e*e+r},easeOutQuart:function(e,r,a,i){return-(a-r)*((e=e/i-1)*e*e*e-1)+r},easeInOutQuart:function(e,r,a,i){var o=a-r;return(e/=i/2)<1?o/2*e*e*e*e+r:-o/2*((e-=2)*e*e*e-2)+r},easeInQuint:function(e,r,a,i){return(a-r)*(e/=i)*e*e*e*e+r},easeOutQuint:function(e,r,a,i){return(a-r)*((e=e/i-1)*e*e*e*e+1)+r},easeInOutQuint:function(e,r,a,i){var o=a-r;return(e/=i/2)<1?o/2*e*e*e*e*e+r:o/2*((e-=2)*e*e*e*e+2)+r},easeInSine:function(e,r,a,i){var o=a-r;return-o*Math.cos(e/i*(Math.PI/2))+o+r},easeOutSine:function(e,r,a,i){return(a-r)*Math.sin(e/i*(Math.PI/2))+r},easeInOutSine:function(e,r,a,i){return-(a-r)/2*(Math.cos(Math.PI*e/i)-1)+r},easeInExpo:function(e,r,a,i){return e==0?r:(a-r)*Math.pow(2,10*(e/i-1))+r},easeOutExpo:function(e,r,a,i){var o=a-r;return e==i?r+o:o*(1-Math.pow(2,-10*e/i))+r},easeInOutExpo:function(e,r,a,i){var o=a-r;return e===0?r:e===i?r+o:(e/=i/2)<1?o/2*Math.pow(2,10*(e-1))+r:o/2*(2-Math.pow(2,-10*--e))+r},easeInCirc:function(e,r,a,i){return-(a-r)*(Math.sqrt(1-(e/=i)*e)-1)+r},easeOutCirc:function(e,r,a,i){return(a-r)*Math.sqrt(1-(e=e/i-1)*e)+r},easeInOutCirc:function(e,r,a,i){var o=a-r;return(e/=i/2)<1?-o/2*(Math.sqrt(1-e*e)-1)+r:o/2*(Math.sqrt(1-(e-=2)*e)+1)+r},easeInElastic:function(e,r,a,i){var o,s,l,u=a-r;return l=1.70158,e===0?r:(e/=i)===1?r+u:((s=0)||(s=.3*i),(o=u)<Math.abs(u)?(o=u,l=s/4):l=s/(2*Math.PI)*Math.asin(u/o),-o*Math.pow(2,10*(e-=1))*Math.sin((e*i-l)*(2*Math.PI)/s)+r)},easeOutElastic:function(e,r,a,i){var o,s,l,u=a-r;return l=1.70158,e===0?r:(e/=i)===1?r+u:((s=0)||(s=.3*i),(o=u)<Math.abs(u)?(o=u,l=s/4):l=s/(2*Math.PI)*Math.asin(u/o),o*Math.pow(2,-10*e)*Math.sin((e*i-l)*(2*Math.PI)/s)+u+r)},easeInOutElastic:function(e,r,a,i){var o,s,l,u=a-r;return l=1.70158,e===0?r:(e/=i/2)==2?r+u:((s=0)||(s=i*(.3*1.5)),(o=u)<Math.abs(u)?(o=u,l=s/4):l=s/(2*Math.PI)*Math.asin(u/o),e<1?o*Math.pow(2,10*(e-=1))*Math.sin((e*i-l)*(2*Math.PI)/s)*-.5+r:o*Math.pow(2,-10*(e-=1))*Math.sin((e*i-l)*(2*Math.PI)/s)*.5+u+r)},easeInBack:function(e,r,a,i,o){return o===void 0&&(o=1.70158),(a-r)*(e/=i)*e*((o+1)*e-o)+r},easeOutBack:function(e,r,a,i,o){return o===void 0&&(o=1.70158),(a-r)*((e=e/i-1)*e*((o+1)*e+o)+1)+r},easeInOutBack:function(e,r,a,i,o){var s=a-r;return o===void 0&&(o=1.70158),(e/=i/2)<1?s/2*(e*e*((1+(o*=1.525))*e-o))+r:s/2*((e-=2)*e*((1+(o*=1.525))*e+o)+2)+r},easeInBounce:function(e,r,a,i){var o=a-r;return o-t.easeOutBounce(i-e,0,o,i)+r},easeOutBounce:function(e,r,a,i){var o=a-r;return(e/=i)<1/2.75?o*(7.5625*e*e)+r:e<2/2.75?o*(7.5625*(e-=1.5/2.75)*e+.75)+r:e<2.5/2.75?o*(7.5625*(e-=2.25/2.75)*e+.9375)+r:o*(7.5625*(e-=2.625/2.75)*e+.984375)+r},easeInOutBounce:function(e,r,a,i){var o=a-r;return e<i/2?.5*t.easeInBounce(2*e,0,o,i)+r:.5*t.easeOutBounce(2*e-i,0,o,i)+.5*o+r}};return va=t}();function Be(t,e){return t+Math.random()*(e-t)}(function(t){t[t.Circle=0]="Circle",t[t.Square=1]="Square",t[t.Strip=2]="Strip"})(Ht||(Ht={})),function(t){t[t.Positive=1]="Positive",t[t.Negative=-1]="Negative"}(ut||(ut={}));const Zs=1e3/60;class Qs{constructor(e,r,a,i){this.getOptions=r;const{colors:o,initialVelocityX:s,initialVelocityY:l}=this.getOptions();this.context=e,this.x=a,this.y=i,this.w=Be(5,20),this.h=Be(5,20),this.radius=Be(5,10),this.vx=typeof s=="number"?Be(-s,s):Be(s.min,s.max),this.vy=typeof l=="number"?Be(-l,0):Be(l.min,l.max),this.shape=Math.floor(0+3*Math.random()),this.angle=Be(0,360)*Math.PI/180,this.angularSpin=Be(-.2,.2),this.color=o[Math.floor(Math.random()*o.length)],this.rotateY=Be(0,1),this.rotationDirection=Be(0,1)?ut.Positive:ut.Negative}update(e){const{gravity:r,wind:a,friction:i,opacity:o,drawShape:s}=this.getOptions(),l=e/Zs;this.x+=this.vx*l,this.y+=this.vy*l,this.vy+=r*l,this.vx+=a*l,this.vx*=i**l,this.vy*=i**l,this.rotateY>=1&&this.rotationDirection===ut.Positive?this.rotationDirection=ut.Negative:this.rotateY<=-1&&this.rotationDirection===ut.Negative&&(this.rotationDirection=ut.Positive);const u=.1*this.rotationDirection*l;if(this.rotateY+=u,this.angle+=this.angularSpin,this.context.save(),this.context.translate(this.x,this.y),this.context.rotate(this.angle),this.context.scale(1,this.rotateY),this.context.rotate(this.angle),this.context.beginPath(),this.context.fillStyle=this.color,this.context.strokeStyle=this.color,this.context.globalAlpha=o,this.context.lineCap="round",this.context.lineWidth=2,s&&typeof s=="function")s.call(this,this.context);else switch(this.shape){case Ht.Circle:this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill();break;case Ht.Square:this.context.fillRect(-this.w/2,-this.h/2,this.w,this.h);break;case Ht.Strip:this.context.fillRect(-this.w/6,-this.h/2,this.w/3,this.h)}this.context.closePath(),this.context.restore()}}class Xs{constructor(e,r){this.x=0,this.y=0,this.w=0,this.h=0,this.lastNumberOfPieces=0,this.tweenProgress=0,this.tweenFrom=0,this.particles=[],this.particlesGenerated=0,this.removeParticleAt=i=>{this.particles.splice(i,1)},this.getParticle=()=>{const i=Be(this.x,this.w+this.x),o=Be(this.y,this.h+this.y);return new Qs(this.context,this.getOptions,i,o)},this.animate=i=>{const{canvas:o,context:s,particlesGenerated:l,lastNumberOfPieces:u}=this,{run:x,recycle:b,numberOfPieces:v,debug:j,tweenFunction:_,tweenDuration:C}=this.getOptions();if(!x)return!1;const P=this.particles.length,D=b?P:l;if(D<v){u!==v&&(this.tweenProgress=0,this.tweenFrom=D,this.lastNumberOfPieces=v),this.tweenProgress=Math.min(C,Math.max(0,this.tweenProgress+i));const I=_(this.tweenProgress,this.tweenFrom,v,C),w=Math.round(I-D);for(let O=0;O<w;O++)this.particles.push(this.getParticle());this.particlesGenerated+=w}j&&(s.font="12px sans-serif",s.fillStyle="#333",s.textAlign="right",s.fillText(`Particles: ${P}`,o.width-10,o.height-20));for(let I=this.particles.length-1;I>=0;I--){const w=this.particles[I];w.update(i),(w.y>o.height||w.y<-100||w.x>o.width+100||w.x<-100)&&(b&&D<=v?this.particles[I]=this.getParticle():this.removeParticleAt(I))}return P>0||D<v},this.canvas=e;const a=this.canvas.getContext("2d");if(!a)throw new Error("Could not get canvas context");this.context=a,this.getOptions=r}}const qr={width:typeof window<"u"?window.innerWidth:300,height:typeof window<"u"?window.innerHeight:200,numberOfPieces:200,friction:.99,wind:0,gravity:.1,initialVelocityX:4,initialVelocityY:10,colors:["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548"],opacity:1,debug:!1,tweenFunction:Ys.easeInOutQuad,tweenDuration:5e3,recycle:!0,run:!0};class ei{constructor(e,r){this.lastFrameTime=0,this.setOptionsWithDefaults=i=>{const o={confettiSource:{x:0,y:0,w:this.canvas.width,h:0}};this._options={...o,...qr,...i},Object.assign(this,i.confettiSource)},this.update=(i=0)=>{const{options:{run:o,onConfettiComplete:s,frameRate:l},canvas:u,context:x}=this,b=Math.min(i-this.lastFrameTime,50);l&&b<1e3/l?this.rafId=requestAnimationFrame(this.update):(this.lastFrameTime=i-(l?b%l:0),o&&(x.fillStyle="white",x.clearRect(0,0,u.width,u.height)),this.generator.animate(b)?this.rafId=requestAnimationFrame(this.update):(s&&typeof s=="function"&&this.generator.particlesGenerated>0&&s.call(this,this),this._options.run=!1))},this.reset=()=>{this.generator&&this.generator.particlesGenerated>0&&(this.generator.particlesGenerated=0,this.generator.particles=[],this.generator.lastNumberOfPieces=0)},this.stop=()=>{this.options={run:!1},this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=void 0)},this.canvas=e;const a=this.canvas.getContext("2d");if(!a)throw new Error("Could not get canvas context");this.context=a,this.generator=new Xs(this.canvas,()=>this.options),this.options=r,this.update()}get options(){return this._options}set options(e){const r=this._options?.run,a=this._options?.recycle;this.setOptionsWithDefaults(e),this.generator&&(Object.assign(this.generator,this.options.confettiSource),typeof e.recycle=="boolean"&&e.recycle&&a===!1&&(this.generator.lastNumberOfPieces=this.generator.particles.length)),typeof e.run=="boolean"&&e.run&&r===!1&&this.update()}}const ti=We.createRef();class Ur extends We.Component{constructor(e){super(e),this.canvas=We.createRef(),this.canvas=e.canvasRef||ti}componentDidMount(){if(this.canvas.current){const e=Jr(this.props)[0];this.confetti=new ei(this.canvas.current,e)}}componentDidUpdate(){const e=Jr(this.props)[0];this.confetti&&(this.confetti.options=e)}componentWillUnmount(){this.confetti&&this.confetti.stop(),this.confetti=void 0}render(){const[e,r]=Jr(this.props),a={zIndex:2,position:"absolute",pointerEvents:"none",top:0,left:0,bottom:0,right:0,...r.style};return n.jsx("canvas",{width:e.width,height:e.height,ref:this.canvas,...r,style:a})}}function Jr(t){const e={},r={},a=[...Object.keys(qr),"confettiSource","drawShape","onConfettiComplete","frameRate"],i=["canvasRef"];for(const o in t){const s=t[o];a.includes(o)?e[o]=s:i.includes(o)?i[o]=s:r[o]=s}return[e,r,{}]}Ur.defaultProps={...qr},Ur.displayName="ReactConfetti";const ri=We.forwardRef((t,e)=>n.jsx(Ur,{canvasRef:e,...t}));var wa,ja,_a={exports:{}},ni=wa?_a.exports:(wa=1,ja=t=>(()=>{var e={"./src/components/PrizesWrapper/PrizesWrapper.css":(o,s,l)=>{l.r(s)},"./src/components/Wrapper/Wrapper.css":(o,s,l)=>{l.r(s)},"./src/designs/Regular/Regular.css":(o,s,l)=>{l.r(s)},"./src/components/PrizesWrapper/PrizesWrapper.tsx":(o,s,l)=>{l.r(s),l.d(s,{default:()=>j});var u=l("react"),x=l.n(u),b=l("./src/context/RouletteContext.tsx"),v=l("./src/utills/index.ts");l("./src/components/PrizesWrapper/PrizesWrapper.css");const j=function(_){var C=_.children,P=_.className,D=_.tagName,I=D===void 0?"div":D,w=_.style,O=(0,u.useContext)(b.default),E=O.type,A=O.options,S=O.start,M=O.prizeListClassName,$=A.withoutAnimation!==!0&&S!==!0,Y=(0,v.classNames)("roulette-pro-prize-list",{"with-animation":$},[E],M,P);return x().createElement(I,{className:Y,style:w},C)}},"./src/components/PrizesWrapper/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/components/PrizesWrapper/PrizesWrapper.tsx").default},"./src/components/Roulette/Roulette.tsx":(o,s,l)=>{l.r(s),l.d(s,{default:()=>D});var u=l("react"),x=l.n(u),b=l("./src/designs/Regular/index.ts"),v=l("./src/context/RouletteContext.tsx"),j=l("./src/components/Wrapper/index.ts"),_=l("./src/components/PrizesWrapper/index.ts"),C=l("./src/utills/index.ts"),P=l("./src/hooks/index.ts");const D=function(I){var w,O,E,A=I.topChildren,S=I.bottomChildren,M=I.designPlugin,$=I.prizeItemRenderFunction,Y=I.prizes,U=I.defaultDesignOptions,K=U===void 0?{}:U,R=I.start,J=I.prizeIndex,H=I.spinningTime,se=H===void 0?10:H,W=I.transitionFunction,B=W===void 0?"cubic-bezier(0.0125, 0.1, 0.1, 1)":W,ce=I.onPrizeDefined,N=ce===void 0?function(){}:ce,le=I.classes,pe=I.soundWhileSpinning,he=I.options,L=he===void 0?{}:he,te=I.type,ne=te===void 0?"horizontal":te,de=(0,u.useState)(0),F=de[0],re=de[1],ye=(0,u.useRef)(),me=(0,P.useAudio)(pe??""),fe=me.start,ue=me.stop,Ce=L.stopInCenter,qe=(0,b.default)(K)({type:ne}),Ae=typeof M!="function"?qe:M({type:ne}),De=Ae.prizeItemWidth,_e=Ae.prizeItemHeight;(0,u.useEffect)(function(){if(ye){var be=function(){var Fe=ye.current.getBoundingClientRect(),Ye=Fe.width,Oe=Fe.height;switch(ne){case"horizontal":return re(Ye);case"vertical":return re(Oe)}};return be(),window.addEventListener("resize",be),function(){window.removeEventListener("resize",be)}}},[ye,ne]),(0,u.useEffect)(function(){if(R){pe&&fe();var be=setTimeout(function(){N(),pe&&ue()},1e3*se);return function(){clearTimeout(be),pe&&ue()}}},[R,se]);var Ue,Pe,Se,Me=(0,u.useMemo)(function(){var be=ne==="horizontal"?De:_e;return(0,C.getPrizeOffset)(be,J,F/2)+(Ce===!0?0:(0,C.getPrizeAdditionalOffset)(be))},[ne,J,De,_e,F,Ce]),et=(Se=function(){switch(ne){case"horizontal":return"left";case"vertical":return"top";default:throw new Error("Type is unknown")}}(),R===!1?((Ue={})[Se]="0",Ue.willChange=Se,Ue):((Pe={transition:"all ".concat(se,"s ").concat(B," 0s")})[Se]="-".concat(Me,"px"),Pe)),ze=(0,u.useCallback)(function(){return typeof $=="function"?$:typeof Ae.prizeItemRenderFunction=="function"?Ae.prizeItemRenderFunction:qe.prizeItemRenderFunction},[qe.prizeItemRenderFunction,Ae.prizeItemRenderFunction,$]),Le=(0,u.useMemo)(function(){var be,Fe=ze(),Ye=(0,C.classNames)(le?.prizeItem,(be=Ae.classes)===null||be===void 0?void 0:be.prizeItem);return Y.map(function(Oe){return x().createElement("li",{key:Oe.id,className:Ye},Fe(Oe))})},[Y,ze,le?.prizeItem,(w=Ae.classes)===null||w===void 0?void 0:w.prizeItem]);(0,u.useEffect)(function(){var be,Fe,Ye,Oe;if(Le.length!==0){for(var at=-1,tt=-1,wt=function(){at=-1,tt=-1},rt=0;rt<Le.length;rt+=1){var pt=(Oe=(Ye=(Fe=(be=Le[rt])===null||be===void 0?void 0:be.props)===null||Fe===void 0?void 0:Fe.children)===null||Ye===void 0?void 0:Ye.props)===null||Oe===void 0?void 0:Oe.style,m=pt?.width,c=pt?.height;if(at!==-1||tt!==-1){if(at!==m||tt!==c)break}else at=m,tt=c}return wt(),function(){wt()}}},[Le,De,_e]);var ge=(0,C.classNames)(le?.wrapper,(O=Ae.classes)===null||O===void 0?void 0:O.wrapper),it=(0,C.classNames)(le?.prizeListWrapper,(E=Ae.classes)===null||E===void 0?void 0:E.prizeListWrapper),Re=(0,u.useMemo)(function(){return{options:L,start:R,wrapperClassName:ge,prizeListClassName:it,type:ne}},[L,R,ne,it,ge]),Je=x().createElement(u.Fragment,null,Ae.topChildren,A),Ne=x().createElement(u.Fragment,null,Ae.bottomChildren,S);return x().createElement(v.default.Provider,{value:Re},x().createElement(j.default,{ref:ye},Je,x().createElement(_.default,{tagName:"ul",style:et},Le),Ne))}},"./src/components/Roulette/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/components/Roulette/Roulette.tsx").default},"./src/components/Wrapper/Wrapper.tsx":(o,s,l)=>{l.r(s),l.d(s,{default:()=>_});var u=l("react"),x=l.n(u),b=l("./src/utills/index.ts"),v=l("./src/context/RouletteContext.tsx");l("./src/components/Wrapper/Wrapper.css");var j=(0,u.forwardRef)(function(C,P){var D=C.children,I=C.className,w=(0,u.useContext)(v.default),O=(0,b.classNames)("roulette-pro-wrapper",w.wrapperClassName,I);return x().createElement("div",{className:O,ref:P},D)});j.displayName="Wrapper";const _=j},"./src/components/Wrapper/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/components/Wrapper/Wrapper.tsx").default},"./src/context/RouletteContext.tsx":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=(0,l("react").createContext)({})},"./src/designs/Regular/Regular.tsx":(o,s,l)=>{l.r(s),l.d(s,{default:()=>v});var u=l("react"),x=l.n(u);l("./src/designs/Regular/Regular.css");var b=function(j){var _=j.type;return j.hideCenterDelimiter!==!0?x().createElement("div",{"data-testid":"design-top",className:"roulette-pro-regular-design-top ".concat(_)}):null};const v=function(j){var _=j.prizesWithText,C=j.hideCenterDelimiter;return function(P){var D=P.type,I=_===!0?234:D==="vertical"?172:174,w="roulette-pro-regular-design-prize-item-".concat(D);return{topChildren:x().createElement(b,{type:D,hideCenterDelimiter:C}),bottomChildren:null,prizeItemWidth:205,prizeItemHeight:I,prizeItemRenderFunction:function(O){var E=O.image,A=O.text,S=_===!0&&A!==void 0;return x().createElement("div",{className:"roulette-pro-regular-prize-item",style:{width:205,height:I}},x().createElement("div",{className:S===!0?"roulette-pro-regular-prize-item-wrapper":"roulette-pro-regular-prize-item-wrapper center"},x().createElement("div",{className:"roulette-pro-regular-image-wrapper"},x().createElement("img",{className:"roulette-pro-regular-prize-item-image",src:E,alt:S===!0?"prize item ".concat(A):"prize item"})),S===!0&&x().createElement("p",{className:"roulette-pro-regular-prize-item-text"},A)))},classes:{prizeItem:w}}}}},"./src/designs/Regular/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/designs/Regular/Regular.tsx").default},"./src/hooks/index.ts":(o,s,l)=>{l.r(s),l.d(s,{useAudio:()=>u.default});var u=l("./src/hooks/useAudio/index.ts")},"./src/hooks/useAudio/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/hooks/useAudio/useAudio.ts").default},"./src/hooks/useAudio/useAudio.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>x});var u=l("react");const x=function(b){var v=(0,u.useState)(null),j=v[0],_=v[1],C=(0,u.useState)(!1),P=C[0],D=C[1];(0,u.useEffect)(function(){typeof window<"u"&&typeof Audio<"u"&&b&&_(new Audio(b))},[b]);var I=(0,u.useCallback)(function(){j&&(j.play(),D(!0))},[j]),w=(0,u.useCallback)(function(){j&&(j.pause(),j.currentTime=0,D(!1))},[j]);return(0,u.useEffect)(function(){return function(){D(!1)}},[]),(0,u.useEffect)(function(){if(j){var O=function(){w()};return j.addEventListener("ended",O),function(){j.removeEventListener("ended",O)}}},[j,w]),{isPlaying:P,start:I,stop:w}}},"./src/utills/classNames/classNames.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>b});var u=function(v){return Array.isArray(v)},x=function(v){return v!==null&&u(v)===!1&&typeof v=="object"};const b=function(){for(var v=[],j=0;j<arguments.length;j++)v[j]=arguments[j];for(var _="",C=function(A,S){var M=function($){return typeof $=="boolean"}(A);A&&M!==!0&&(_+="".concat(S!==void 0?S:A," "))},P=function(A){var S=Object.entries(A),M=function(Y){return Y.toString!==Object.prototype.toString}(A);if(S.forEach(function(Y){var U=Y[0],K=Y[1];if(K){var R=function(se){return typeof se=="function"}(K),J=U==="toString";if(R!==!0||J!==!1)J===!1&&(_+="".concat(U," "));else{var H=K();C(H,U)}}}),M===!0){var $=A.toString();C($)}},D=function(A){A.forEach(function(S){if(S&&typeof S!="boolean"){var M=u(S),$=x(S);return M===!0?D(S):$===!0?P(S):void(_+="".concat(S," "))}})},I=0;I<v.length;I+=1){var w=v[I],O=x(w),E=u(w);O!==!0?E!==!0?C(w):D(w):P(w)}return _.trim()}},"./src/utills/classNames/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/utills/classNames/classNames.ts").default},"./src/utills/getPrizeAdditionalOffset/getPrizeAdditionalOffset.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>x});var u=l("./src/utills/getRandomIntInRange/index.ts");const x=function(b){var v=b/2;return(0,u.default)(1-v,v-1)}},"./src/utills/getPrizeAdditionalOffset/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/utills/getPrizeAdditionalOffset/getPrizeAdditionalOffset.ts").default},"./src/utills/getPrizeOffset/getPrizeOffset.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=function(x,b,v){return x*b-(v-x/2)}},"./src/utills/getPrizeOffset/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/utills/getPrizeOffset/getPrizeOffset.ts").default},"./src/utills/getRandomIntInRange/getRandomIntInRange.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=function(x,b){var v=Math.ceil(x),j=Math.floor(b);return Math.floor(Math.random()*(j-v+1)+v)}},"./src/utills/getRandomIntInRange/index.ts":(o,s,l)=>{l.r(s),l.d(s,{default:()=>u});const u=l("./src/utills/getRandomIntInRange/getRandomIntInRange.ts").default},"./src/utills/index.ts":(o,s,l)=>{l.r(s),l.d(s,{classNames:()=>v.default,getPrizeAdditionalOffset:()=>b.default,getPrizeOffset:()=>u.default,getRandomIntInRange:()=>x.default});var u=l("./src/utills/getPrizeOffset/index.ts"),x=l("./src/utills/getRandomIntInRange/index.ts"),b=l("./src/utills/getPrizeAdditionalOffset/index.ts"),v=l("./src/utills/classNames/index.ts")},react:o=>{o.exports=t}},r={};function a(o){var s=r[o];if(s!==void 0)return s.exports;var l=r[o]={exports:{}};return e[o](l,l.exports,a),l.exports}a.n=o=>{var s=o&&o.__esModule?()=>o.default:()=>o;return a.d(s,{a:s}),s},a.d=(o,s)=>{for(var l in s)a.o(s,l)&&!a.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:s[l]})},a.o=(o,s)=>Object.prototype.hasOwnProperty.call(o,s),a.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var i={};return(()=>{a.r(i),a.d(i,{default:()=>o});const o=a("./src/components/Roulette/index.ts").default})(),i})(),_a.exports=ja(sc()));const ai=ke(ni),oi={balls:"/static/icons/balls.png",noballs:"/static/icons/noballs.png"};Tt`
  0% { transform: scale(1); }
  20% { transform: scale(1.18, 0.92); }
  40% { transform: scale(0.95, 1.08); }
  60% { transform: scale(1.08, 0.97); }
  80% { transform: scale(0.98, 1.03); }
  100% { transform: scale(1); }
`;const si=xe(jt)(({theme:t})=>({padding:t.spacing(3),maxWidth:900,margin:"0 auto",background:`linear-gradient(135deg, ${we(t.palette.primary.dark,.7)}, ${we(t.palette.primary.main,.3)})`,backdropFilter:"blur(12px)",borderRadius:20,boxShadow:"0 8px 32px rgba(0,0,0,0.18)"}));xe(V)(({theme:t})=>({position:"relative",width:"100%",height:170,overflow:"hidden",margin:"0 auto",background:we(t.palette.background.paper,.7),borderRadius:16,border:`2.5px solid ${we(t.palette.primary.main,.18)}`,boxShadow:`0 4px 24px ${we(t.palette.primary.main,.1)}`})),xe(V)(({theme:t})=>({display:"flex",alignItems:"center",height:"100%",willChange:"transform"})),xe(V,{shouldForwardProp:t=>t!=="iscenter"&&t!=="bounce"})(({theme:t,iscenter:e,bounce:r})=>({width:120,minWidth:120,height:140,margin:"0 12px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:14,background:e?we(t.palette.primary.main,.13):"transparent",boxShadow:e?`0 0 0 3px ${t.palette.primary.main}, 0 0 16px 2px ${we(t.palette.primary.main,.18)}, 0 0 32px 8px ${we(t.palette.primary.main,.13)}`:"none",transition:"box-shadow 0.2s, background 0.2s",position:"relative",zIndex:e?2:1,animation:r?`${r} 0.7s cubic-bezier(.36,1.56,.64,1) 1`:"none",border:`1px solid ${we(t.palette.divider,.2)}`,"&::after":{content:'""',position:"absolute",right:-12,top:"10%",height:"80%",width:1,background:we(t.palette.divider,.2)}})),xe(V)(({theme:t})=>({position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",width:li,height:"100%",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:10,"&::after":{content:'""',display:"block",width:6,height:"100%",margin:"0 auto",background:`linear-gradient(180deg, ${t.palette.primary.main} 60%, transparent 100%)`,borderRadius:3,boxShadow:`0 0 18px 4px ${we(t.palette.primary.main,.35)}`}}));const ii=xe(V)(({theme:t})=>({display:"flex",alignItems:"center",gap:t.spacing(2),marginTop:t.spacing(3)})),ci=xe(V)(({theme:t,win:e})=>({textAlign:"center",marginTop:t.spacing(3),padding:t.spacing(2),borderRadius:10,background:e?we(t.palette.success.main,.13):we(t.palette.error.main,.09),color:e?t.palette.success.main:t.palette.text.primary,fontWeight:700,fontSize:"1.2rem",boxShadow:e?`0 0 16px 2px ${we(t.palette.success.main,.18)}`:"none"})),li=144;function ka(t){const e=[...Array(16).fill({type:"balls",text:`+${2*t}\u20BD`}),...Array(32).fill({type:"noballs",text:"\u0411\u0435\u0437 \u0432\u044B\u0438\u0433\u0440\u044B\u0448\u0430"})];for(let r=e.length-1;r>0;r--){const a=Math.floor(Math.random()*(r+1));[e[r],e[a]]=[e[a],e[r]]}return e.map(r=>({image:oi[r.type],text:r.text,type:r.type}))}let Ca,Sa,Ea,vr,St,Kr,st;Ca=(t,e,{isActive:r})=>n.jsxs(V,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:90,minWidth:90,height:110,background:"transparent",borderRadius:2,border:r?"2.5px solid #a78bfa":"none",boxShadow:r?"0 0 16px 2px #a78bfa55":"none",p:0,m:"0 6px",transition:"box-shadow 0.2s, border 0.2s"},children:[n.jsx(V,{component:"img",src:t.image,alt:t.type,sx:{width:54,height:54,mb:.5,filter:t.type==="noballs"?"grayscale(0.7)":"none"}}),n.jsx(oe,{sx:{fontSize:"0.95rem",fontWeight:700,color:t.type==="balls"?"#4ade80":"#a1a1aa",textShadow:t.type==="balls"?"0 0 8px #4ade8033":"none",mt:.5},align:"center",children:t.text})]},e),Sa=()=>{const t=ot(),[e,r]=d.useState(100),[a,i]=d.useState(!1),[o,s]=d.useState(null),[l,u]=d.useState(!1),[x,b]=d.useState(0),[v,j]=d.useState(()=>ka(100));return n.jsxs(si,{children:[n.jsx(oe,{variant:"h4",align:"center",gutterBottom:!0,sx:{fontWeight:800,letterSpacing:1},children:"\u041A\u0435\u0439\u0441-\u0440\u0443\u043B\u0435\u0442\u043A\u0430"}),n.jsx(V,{sx:{position:"relative",width:"100%",maxWidth:900,mx:"auto",my:4},children:n.jsx(ai,{prizes:v,prizeIndex:x,renderPrize:Ca,onPrizeDefined:()=>{const _=v[x].type==="balls";s({type:_?"balls":"noballs",amount:_?2*e:0}),_&&u(!0),i(!1)},spinning:a,start:a,options:{stopOnPrize:!0,prizeSlot:3,duration:2600,easing:"cubic-bezier(0.22, 1, 0.36, 1)"},style:{height:130}})}),n.jsxs(ii,{children:[n.jsx(oe,{children:"\u0421\u0442\u0430\u0432\u043A\u0430:"}),n.jsx(Ui,{value:e,onChange:(_,C)=>r(C),min:100,max:1e4,step:100,valueLabelDisplay:"auto",valueLabelFormat:_=>`${_} \u20BD`,sx:{flex:1,mx:2},disabled:a}),n.jsxs(oe,{sx:{fontWeight:700},children:[e," \u20BD"]})]}),n.jsx(V,{sx:{display:"flex",justifyContent:"center",mt:4},children:n.jsx(Ke,{variant:"contained",size:"large",onClick:()=>{if(a)return;i(!0),s(null),u(!1);const _=ka(e);j(_);const C=_.map((I,w)=>I.type==="balls"?w:null).filter(I=>I!==null),P=_.map((I,w)=>I.type==="noballs"?w:null).filter(I=>I!==null);let D;D=(Math.random()<.4?"balls":"noballs")=="balls"?C[Math.floor(Math.random()*C.length)]:P[Math.floor(Math.random()*P.length)],b(D)},disabled:a,startIcon:a?n.jsx(ht,{size:22}):n.jsx(On,{}),sx:{minWidth:220,height:56,fontSize:"1.15rem",borderRadius:28,fontWeight:700,background:`linear-gradient(45deg, ${t.palette.primary.main} 30%, ${t.palette.primary.dark} 90%)`,boxShadow:"0 3px 12px 2px rgba(0,0,0,0.18)",letterSpacing:1,"&:hover":{transform:"scale(1.05)"}},children:a?"\u041A\u0440\u0443\u0442\u0438\u0442\u0441\u044F...":"\u041A\u0440\u0443\u0442\u0438\u0442\u044C"})}),o&&n.jsx(ci,{win:o.type==="balls",children:o.type==="balls"?n.jsxs(n.Fragment,{children:["\u041F\u043E\u0437\u0434\u0440\u0430\u0432\u043B\u044F\u0435\u043C! \u0412\u044B \u0432\u044B\u0438\u0433\u0440\u0430\u043B\u0438 ",n.jsxs("b",{children:[o.amount," \u20BD"]})]}):n.jsx(n.Fragment,{children:"\u0411\u0435\u0437 \u0432\u044B\u0438\u0433\u0440\u044B\u0448\u0430"})}),l&&n.jsx(ri,{width:window.innerWidth,height:window.innerHeight,recycle:!1,numberOfPieces:180,gravity:.3})]})},Ea=()=>{const{inviteCode:t}=tc(),e=_t(),[r,a]=d.useState(!1),[i,o]=d.useState(null),[s,l]=d.useState(null),[u,x]=d.useState(!1),b=()=>{e("/messenger")};return r?n.jsxs(V,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2},children:[n.jsx(ht,{}),n.jsx(oe,{children:"\u041F\u0440\u0438\u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u043A \u0447\u0430\u0442\u0443..."})]}):i?n.jsxs(V,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2,p:2},children:[n.jsx(oe,{color:"error",align:"center",variant:"h6",children:i}),s&&n.jsx(V,{sx:{mt:2,p:2,bgcolor:"grey.100",borderRadius:1,maxWidth:"600px",overflow:"auto"},children:n.jsx(oe,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap"},children:s})}),n.jsx(Ke,{variant:"contained",onClick:b,children:"\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u0432 \u043C\u0435\u0441\u0441\u0435\u043D\u0434\u0436\u0435\u0440"})]}):n.jsxs(n.Fragment,{children:[n.jsxs(V,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2,p:2},children:[n.jsx(oe,{variant:"h5",align:"center",children:"\u041F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u0432 \u0433\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u0447\u0430\u0442"}),n.jsx(Ke,{variant:"contained",onClick:()=>x(!0),children:"\u041F\u0440\u0438\u0441\u043E\u0435\u0434\u0438\u043D\u0438\u0442\u044C\u0441\u044F \u043A \u0447\u0430\u0442\u0443"}),n.jsx(Ke,{variant:"outlined",onClick:b,children:"\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u0432 \u043C\u0435\u0441\u0441\u0435\u043D\u0434\u0436\u0435\u0440"})]}),n.jsxs(Ji,{open:u,onClose:()=>x(!1),PaperProps:{sx:{backgroundColor:"background.paper",borderRadius:2}},children:[n.jsx(Ki,{children:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u0435"}),n.jsx(Gi,{children:n.jsx(oe,{children:"\u0412\u044B \u0442\u043E\u0447\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0432\u0441\u0442\u0443\u043F\u0438\u0442\u044C \u0432 \u0447\u0430\u0442?"})}),n.jsxs(Yi,{children:[n.jsx(Ke,{onClick:()=>x(!1),children:"\u041D\u0435\u0442"}),n.jsx(Ke,{onClick:async()=>{a(!0);try{const v=await fetch(`/api/messenger/chats/join/${t}`,{method:"POST",credentials:"include"}),j=await v.json();if(!j.success)throw new Error(j.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u0440\u0438\u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0438 \u043A \u0447\u0430\u0442\u0443");a(!1),x(!1),o(null),e("/messenger")}catch(v){l(`Error details: ${JSON.stringify(v,null,2)}`),o(v.message||"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u0440\u0438\u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0438 \u043A \u0447\u0430\u0442\u0443"),a(!1),x(!1)}},variant:"contained",autoFocus:!0,children:"\u0414\u0430"})]})]})]})},vr=d.createContext(),St=(t,e)=>{if(!e||!t)return null;if(e.startsWith("http")||e.startsWith("/static/"))return e;let r=e;if(e.includes("uploads/avatar/")||e.includes("avatar/")){const a=e.split("/");r=a[a.length-1]}return`/static/uploads/avatar/${t}/${r}`},Kr=(t,e)=>{let r="";for(let a=0;a<t.length;a++){const i=t.charCodeAt(a)^e.charCodeAt(a%e.length);r+=String.fromCharCode(i)}return r},st=t=>{if(!t)return"";try{if(typeof t=="string"&&/^\d{1,2}:\d{2}$/.test(t)||typeof t=="string"&&/^\d{1,2}\s+\w+$/.test(t))return t;const e=new Date(t);return isNaN(e.getTime())?typeof t=="string"?t:"":`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}catch{return typeof t=="string"?t:""}},Yo=({children:t})=>{const e=d.useContext(nt),r=e?.user?.type==="channel";if(r)return n.jsx(vr.Provider,{value:{isChannel:!0,loading:!1,error:"\u041A\u0430\u043D\u0430\u043B\u044B \u043D\u0435 \u043C\u043E\u0433\u0443\u0442 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u043C\u0435\u0441\u0441\u0435\u043D\u0434\u0436\u0435\u0440",chats:[],messages:{},user:null},children:t});const a=m=>{const c=`; ${document.cookie}`.split(`; ${m}=`);return c.length===2?c.pop().split(";").shift():null},i=a("session_key")||a("jwt")||a("token"),o=localStorage.getItem("token")||i,s=e?.sessionKey||e?.session_key||localStorage.getItem("session_key")||i||o,[l]=d.useState(()=>{const m=localStorage.getItem("messenger_device_id");if(m)return m;const c=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return localStorage.setItem("messenger_device_id",c),c});d.useEffect(()=>{o&&!localStorage.getItem("session_key")&&localStorage.setItem("session_key",o),i&&!localStorage.getItem("session_key")&&localStorage.setItem("session_key",i)},[o,i]),d.useEffect(()=>(s?G.defaults.headers.common.Authorization=`Bearer ${s}`:o&&(G.defaults.headers.common.Authorization=`Bearer ${o}`),()=>{delete G.defaults.headers.common.Authorization}),[s,o]);const[u,x]=d.useState(null),[b,v]=d.useState([]),[j,_]=d.useState(null),[C,P]=d.useState({}),[D,I]=d.useState({}),[w,O]=d.useState({}),[E,A]=d.useState(!1),[S,M]=d.useState(null),[$,Y]=d.useState({}),[U,K]=d.useState(!1),[R,J]=d.useState({}),[H,se]=d.useState({}),W=d.useRef(null),B=d.useRef(null),[ce,N]=d.useState(!1),le=d.useRef(null),pe=d.useRef(null);d.useRef(Date.now()),d.useRef(0);const he=d.useCallback(()=>{if(W.current)try{W.current.onclose=null,W.current.onerror=null,W.current.onmessage=null,N(!1),W.current.close(),W.current=null}catch{}L(),Se.current=0,_e()},[]),L=d.useCallback(()=>{B.current&&(clearTimeout(B.current),B.current=null),re.current&&(clearInterval(re.current),re.current=null),le.current&&(clearTimeout(le.current),le.current=null),pe.current&&(clearTimeout(pe.current),pe.current=null),te.current&&(clearInterval(te.current),te.current=null)},[]),te=d.useRef(null),ne=d.useRef(Date.now()),de=d.useCallback(()=>{te.current&&clearInterval(te.current),ne.current=Date.now(),te.current=setInterval(()=>{ce&&Date.now()-ne.current>45e3&&he()},15e3)},[ce,he]);d.useEffect(()=>()=>{te.current&&clearInterval(te.current)},[]);const F="https://k-connect.ru/apiMes",re=d.useRef(null);d.useEffect(()=>{},[s,r]);const[ye,me]=d.useState(!1),[fe,ue]=d.useState({}),Ce=d.useRef({});d.useRef({});const qe=d.useCallback(async(m,c)=>{if(Ce.current[m])return null;const f=Date.now(),h=fe[m]||0;if(f-h<1e3)return null;try{return Ce.current[m]=!0,ue(y=>({...y,[m]:f})),await c()}finally{setTimeout(()=>{Ce.current[m]=!1},300)}},[fe]),Ae=(m,c,f)=>{if(!m||!c)return;const h=new Date().toISOString();O(y=>{const g=y[m]||{};return f?{...y,[m]:{...g,[c]:h}}:{...y,[m]:{...g,[c]:"end-"+h}}}),f||setTimeout(()=>{O(y=>{const g=y[m]||{},p=g[c];if(p&&typeof p=="string"&&p.startsWith("end-")){const k={...g};if(delete k[c],Object.keys(k).length===0){const T={...y};return delete T[m],T}return{...y,[m]:k}}return y})},5e3)},De=d.useCallback(async()=>{if(s&&!r)try{const m=await fetch(`${F}/messenger/user`,{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}}),c=await m.json();c.success&&c.user?(x(c.user),setTimeout(()=>{Je()},100)):M("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435")}catch{M("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u0438 \u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435")}},[s,r,F]);d.useEffect(()=>(s&&!r&&De(),()=>{W.current&&W.current.close(),B.current&&clearTimeout(B.current),re.current&&clearInterval(re.current)}),[s,De,r]);const _e=d.useCallback(()=>{!r&&s&&(Ce.current.websocket||(Ce.current.websocket=!0,(async()=>{try{const m=/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);if(m&&!await(async()=>{try{const g=[fetch(`${F}/ping?t=${Date.now()}`,{method:"GET",headers:{"Cache-Control":"no-cache, no-store"},timeout:5e3}).catch(()=>null),fetch(`${window.location.origin}/manifest.json?t=${Date.now()}`,{method:"GET",headers:{"Cache-Control":"no-cache, no-store"},timeout:5e3}).catch(()=>null)];return(await Promise.all(g)).some(p=>p&&p.ok)}catch{return!1}})())return void setTimeout(()=>{Ce.current.websocket=!1,Me()},5e3);let c=!1;if(W.current)try{W.current.onclose=null,W.current.onerror=null,W.current.onmessage=null,W.current.close(),W.current=null}catch{}finally{N(!1)}const f=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/messenger`,h=new WebSocket(f);W.current=h;const y=setTimeout(()=>{if(!c){try{h.onclose=null,h.onerror=null,h.onmessage=null,h.close()}catch{}W.current===h&&(W.current=null,N(!1)),Ce.current.websocket=!1,Se.current<2?setTimeout(()=>{_e()},500):Me()}},m?15e3:1e4);h.onopen=()=>{c=!0,clearTimeout(y),N(!0),h.send(JSON.stringify({token:s,device_id:l})),re.current&&clearInterval(re.current);const g=m?1e4:3e4;re.current=setInterval(()=>{if(h.readyState===WebSocket.OPEN)try{h.send(JSON.stringify({type:"ping",device_id:l}))}catch{he()}else he()},g),Se.current=0,de(),setTimeout(()=>{Ce.current.websocket=!1},1e3)},h.onmessage=g=>{try{(p=>{const{type:k}=p;switch(ne.current=Date.now(),k){case"connected":case"pong":break;case"error":M(p.message),p.message&&(p.message.includes("authentication")||p.message.includes("session expired")||p.message.includes("unauthorized"))&&setTimeout(()=>he(),2e3);break;case"new_message":const T=p.chatId||p.chat_id,z=p.message;if(z?.sender){const Z=z.sender.id||z.sender_id;Z&&ge[Z]?z.sender.avatar=ge[Z]:Z&&z.sender.photo&&(z.sender.avatar=Re(Z,z.sender.photo))}b.some(Z=>Z.id===parseInt(T))||at(),et(z,T);break;case"message_read":const Q=p.messageId||p.message_id,Ee=p.chatId||p.chat_id,ae=p.userId||p.user_id;Le(Q,Ee,ae);break;case"typing_indicator":Ae(p.chatId||p.chat_id,p.userId||p.user_id,!0);break;case"typing_indicator_end":Ae(p.chatId||p.chat_id,p.userId||p.user_id,!1);break;case"user_status":((Z,ee)=>{Z&&I(ve=>({...ve,[Z]:ee?new Date().toISOString():null}))})(p.user_id,p.status==="online");break;case"chat_update":if(p.chat){if(p.chat.members&&Array.isArray(p.chat.members)&&p.chat.members.forEach(Z=>{const ee=Z.user_id||Z.id;if(ee&&ge[ee])Z.avatar=ge[ee];else if(ee){const ve=Z.photo||Z.avatar;ve&&(Z.avatar=Re(ee,ve))}}),!p.chat.is_group&&p.chat.members){const Z=p.chat.members.find(ee=>{const ve=ee.user_id||ee.id,$e=ve?String(ve):null,ct=u?.id?String(u.id):null;return $e&&ct&&$e!==ct});if(Z){const ee=Z.user_id||Z.id;if(ee&&ge[ee])p.chat.avatar=ge[ee];else if(ee){const ve=Z.photo||Z.avatar;ve&&(p.chat.avatar=Re(ee,ve))}}}v(Z=>{const ee=Z.findIndex(nn=>nn.id===p.chat.id);if(ee===-1)return Z;const ve=Z[ee],$e={...p.chat};ve.avatar&&typeof ve.avatar=="string"&&ve.avatar.startsWith("/static/")&&($e.avatar=ve.avatar);const ct=[...Z];return ct[ee]=$e,ct})}}})(JSON.parse(g.data)),ne.current=Date.now()}catch{}},h.onclose=g=>{N(!1),clearTimeout(y),g.code===1006?setTimeout(()=>Me(),1e3):g.code===1008||g.code===1011?setTimeout(()=>Me(),3e3):Me(),re.current&&(clearInterval(re.current),re.current=null)},h.onerror=g=>{if(Pe.current("websocket",`WebSocket error: ${g.message||"Unknown error"}`),N(!1),clearTimeout(y),W.current===h){try{h.close()}catch{}W.current=null,setTimeout(()=>{Me()},2e3)}}}catch(m){M("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F \u043A \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0439"),Pe.current("websocket_setup",m.message||m.toString()),setTimeout(()=>{Ce.current.websocket=!1},5e3),Me()}})()))},[s,r,F,l,he,de]),Ue=d.useRef({}),Pe={current:(m,c)=>{Ue.current[m]={message:c,timestamp:new Date().toISOString(),device:navigator.userAgent}}};d.useRef(null);const Se=d.useRef(0),Me=d.useCallback(()=>{B.current&&clearTimeout(B.current),Ce.current.websocket=!1;const m=/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent),c=m?15e3:3e4,f=m?800:1e3,h=.5+Math.random(),y=Math.min(f*Math.pow(1.5,Se.current)*h,c);Se.current+=1,B.current=setTimeout(()=>{Se.current>5?he():_e()},y)},[_e,he]);d.useEffect(()=>{const m=setInterval(()=>{!s||r||ce||Ce.current.websocket||_e()},6e4);return()=>{clearInterval(m)}},[s,r,ce,_e]),d.useEffect(()=>{const m=()=>{document.visibilityState==="visible"&&(!W.current||W.current.readyState!==WebSocket.CLOSED&&W.current.readyState!==WebSocket.CLOSING?W.current?setTimeout(()=>{W.current&&W.current.readyState===WebSocket.OPEN&&W.current.send(JSON.stringify({type:"ping"}))},1e3):_e():setTimeout(()=>{_e()},1e3))};return document.addEventListener("visibilitychange",m),()=>{document.removeEventListener("visibilitychange",m)}},[_e]),d.useEffect(()=>{if(/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent)){let m=0;const c=setInterval(()=>{ce?m=0:(m++,m>=3&&(Se.current=0,Me()))},15e3);return()=>{clearInterval(c)}}},[ce,Me]);const et=(m,c)=>{if(!m||!c)return;if(m.created_at&&(m.created_at=st(m.created_at)),m.sender){const y=m.sender.id||m.sender_id;y&&!m.sender.avatar&&ge[y]?m.sender.avatar=ge[y]:y&&!m.sender.avatar&&m.sender.photo&&(m.sender.avatar=Re(y,m.sender.photo))}if(m.message_type&&m.message_type!=="text"){const y=m.message_type,g=m.content;g&&(y!=="photo"||m.photo_url?y!=="video"||m.video_url?y!=="audio"||m.audio_url?y!=="file"||m.file_url||(m.file_url=Fe(c,g)):m.audio_url=Fe(c,g):m.video_url=Fe(c,g):m.photo_url=Fe(c,g))}const f=m.sender_id===u?.id,h=typeof c=="string"?parseInt(c):c;P(y=>{const g=y[h]||[];return g.some(p=>p.id===m.id)?y:{...y,[h]:[...g,m].sort((p,k)=>p.id-k.id)}}),v(y=>{const g=y.findIndex(T=>T.id===h);if(g===-1)return setTimeout(()=>at(),100),y;const p={...y[g],last_message:m};if(!p.is_group&&p.members){const T=p.members.find(z=>{const Q=z.user_id||z.id,Ee=Q?String(Q):null,ae=u?.id?String(u.id):null;return Ee&&ae&&Ee!==ae});if(T){const z=T.user_id||T.id;if(!p.avatar||p.avatar&&typeof p.avatar=="string"&&!p.avatar.startsWith("/static/"))if(z&&ge[z])p.avatar=ge[z];else{const Q=T.photo||T.avatar;z&&Q&&(p.avatar=Re(z,Q))}}}const k=[...y];return k.splice(g,1),[p,...k]}),j?.id!==h?f||Y(y=>({...y,[h]:(y[h]||0)+1})):u&&!f&&ze(m.id)},ze=async m=>{if(s&&m&&!r)try{if(await fetch(`${F}/messenger/read/${m}`,{method:"POST",headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}}),W.current&&W.current.readyState===WebSocket.OPEN){const c=Object.keys(C).find(f=>C[f].some(h=>h.id===m));c&&(W.current.send(JSON.stringify({type:"read_receipt",messageId:m,chatId:parseInt(c),device_id:l})),Le(m,parseInt(c),u?.id))}}catch{}},Le=(m,c,f)=>{m&&c&&f&&P(h=>{const y=(h[c]||[]).map(g=>{if(g.id===m){const p=g.read_by||[];if(!p.includes(f))return{...g,read_by:[...p,f],read_count:(g.read_count||0)+1}}return g});return j?.id===c&&f===u?.id&&Y(g=>({...g,[c]:0})),{...h,[c]:y}})},[ge,it]=d.useState({}),Re=d.useCallback((m,c)=>{if(!m||!c)return null;if(ge[m])return ge[m];const f=St(m,c);return it(h=>({...h,[m]:f})),f},[ge]),Je=d.useCallback(async()=>{if(s&&!r&&!ye)return qe("load_chats",async()=>{A(!0),M(null),me(!0);try{const m=await fetch(`${F}/messenger/chats`,{headers:{Authorization:`Bearer ${s}`,Accept:"application/json","Cache-Control":"no-cache"}}),c=m.headers.get("content-type");if(!c||!c.includes("application/json"))throw await m.text(),new Error("API \u0432\u0435\u0440\u043D\u0443\u043B \u043E\u0442\u0432\u0435\u0442 \u043D\u0435 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 JSON");const f=await m.json();if(f.success){const h=f.chats.filter(p=>!p.members||!p.members.some(k=>k.type==="channel"));h.forEach(p=>{if(p.last_message&&p.last_message.created_at&&(p.last_message.created_at=st(p.last_message.created_at)),p.members&&Array.isArray(p.members)&&p.members.forEach(k=>{k.last_active&&(k.last_active=st(k.last_active));const T=k.user_id||k.id;if(T&&ge[T])k.avatar=ge[T];else if(T){const z=k.photo||k.avatar;z&&(k.avatar=Re(T,z))}}),!p.is_group&&p.members){const k=p.members.find(T=>{const z=T.user_id||T.id,Q=z?String(z):null,Ee=u?.id?String(u.id):null;return Q&&Ee&&Q!==Ee});if(k){const T=k.user_id||k.id;if(T&&ge[T])p.avatar=ge[T];else if(T){const z=k.photo||k.avatar;z&&(p.avatar=Re(T,z))}p.title||(p.title=k.name||k.username||`\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C #${T}`)}}}),v(h);const y={},g={};h.forEach(p=>{y[p.id]=!0,g[p.id]=null}),J(y),se(g),_e()}else M(f.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0447\u0430\u0442\u043E\u0432")}catch{M("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0447\u0430\u0442\u043E\u0432")}finally{A(!1),me(!1)}})},[s,r,F,_e,qe,ye,u,ge,Re]),Ne=d.useCallback(async(m,c=30,f=!1)=>{if(!s||!m||r)return;const h=b.find(g=>g.id===m),y=h?.is_group;return U||R[m]===!1&&C[m]?.length>0?void 0:qe(f?`load_messages_retry_${m}`:`load_messages_${m}`,async()=>{K(!0);try{const g=H[m],p=`${F}/messenger/chats/${m}/messages${g?`?before_id=${g}&limit=${c}`:`?limit=${c}`}`,k=await fetch(p,{headers:{Authorization:`Bearer ${s}`,Accept:"application/json","Cache-Control":"no-cache, no-store"}}),T=k.headers.get("content-type");if(!T||!T.includes("application/json"))throw await k.text(),new Error("API \u0432\u0435\u0440\u043D\u0443\u043B \u043E\u0442\u0432\u0435\u0442 \u043D\u0435 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 JSON");const z=await k.json();if(z.success){const Q=z.messages||[];Q.forEach(ae=>{ae.created_at&&(ae.created_at=st(ae.created_at))});const Ee=z.has_moderator_messages===!0;if(P(ae=>{const Z=[...ae[m]||[]];return Q.forEach(ee=>{Z.some(ve=>ve.id===ee.id)||Z.push(ee)}),Z.sort((ee,ve)=>ee.id-ve.id),Z.hasModeratorMessages=Ee,{...ae,[m]:Z}}),Q.length<c)J({...R,[m]:!1});else{const ae=Math.min(...Q.map(Z=>Z.id));se({...H,[m]:ae})}u&&Q.forEach(ae=>{ae.sender_id!==u.id&&ze(ae.id)}),y&&Q.length===0&&h?.last_message&&!f&&setTimeout(()=>{Ne(m,c,!0)},1e3)}}catch{y&&!f&&setTimeout(()=>{Ne(m,c,!0)},1500)}finally{K(!1)}})},[s,r,F,H,U,R,C,qe,b,u]),be=async m=>{if(!s||!m||r)return null;try{const c=await fetch(`${F}/messenger/users/${m}`,{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}}),f=c.headers.get("content-type");if(!f||!f.includes("application/json"))throw await c.text(),new Error("API returned non-JSON response");const h=await c.json();if(h.success){if(h.user){const y=h.user.photo||h.user.avatar;y&&(h.user.avatar=St(h.user.id,y))}return h.user}return null}catch{return null}},Fe=(m,c)=>{if(!s||!c)return"";const f=`token=${encodeURIComponent(s)}`;let h=`${F}/messenger/files/${m}/`;return c.includes(`attachments/chat_${m}/`)?h+=c.split(`attachments/chat_${m}/`)[1]:h+=c,h+=`?${f}`,h},Ye=d.useCallback(m=>{if(r)return;const c=b.find(f=>f.id===m);if(c){if(j?.id===m)return;_(c),Y(f=>({...f,[m]:0})),C[m]&&C[m].length!==0||setTimeout(()=>{Ne(m),c.is_group&&setTimeout(()=>{C[m]&&C[m].length!==0||Ne(m,30,!0)},1500)},100),u&&C[m]&&C[m].length>0&&C[m].forEach(f=>{f.sender_id===u.id||f.read_by&&f.read_by.includes(u.id)||ze(f.id)})}},[r,b,C,u,Ne,j]),Oe=(m,c)=>{r||v(f=>f.map(h=>h.id===m?{...h,last_message:c}:h).sort((h,y)=>{const g=h.last_message?.created_at?new Date(h.last_message.created_at).getTime():0;return(y.last_message?.created_at?new Date(y.last_message.created_at).getTime():0)-g}))},at=()=>{r||(u?Je():De())},[tt,wt]=d.useState(!1),rt=d.useRef(null);d.useEffect(()=>{if(!tt)return Se.current>5&&wt(!0),tt?(rt.current&&clearInterval(rt.current),rt.current=setInterval(async()=>{if(document.visibilityState==="visible"){if(j)try{await Ne(j.id,10)}catch{}try{await Je()}catch{}Math.random()<.3&&(async()=>{try{const m=await fetch(`${F}/ping?t=${Date.now()}`,{method:"GET",headers:{"Cache-Control":"no-cache, no-store"}}).catch(()=>null);m&&m.ok&&(wt(!1),Se.current=0,_e())}catch{}})()}},5e3),()=>{rt.current&&clearInterval(rt.current)}):void 0},[tt,j,F,Je,Ne,_e]),d.useEffect(()=>{const m=()=>{navigator.onLine?ce&&W.current&&W.current.readyState===WebSocket.OPEN||setTimeout(()=>{he()},1e3):N(!1)};return window.addEventListener("online",m),window.addEventListener("offline",m),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",m)}},[ce,he]),d.useEffect(()=>{const m=window.fetch;return window.fetch=async(...c)=>{try{const f=await m(...c);return(typeof c[0]=="string"?c[0]:c[0].url).includes("/apiMes/")&&f.status===401&&setTimeout(()=>{s&&he()},2e3),f}catch(f){if(c[0].includes&&c[0].includes("/apiMes/")&&ce&&W.current&&W.current.readyState===WebSocket.OPEN)try{W.current.send(JSON.stringify({type:"ping",device_id:l}))}catch{he()}throw f}},()=>{window.fetch=m}},[s,ce,l,he]),d.useEffect(()=>{if(u&&b.length>0){const m=[...b];m.forEach(c=>{if(!c.is_group&&c.members){const f=c.members.find(h=>{const y=h.user_id||h.id,g=y?String(y):null,p=u?.id?String(u.id):null;return g&&p&&g!==p});if(f){const h=f.user_id||f.id,y=f.photo||f.avatar;h&&y&&(c.avatar=St(h,y))}}}),v(m)}},[u,b.length]);const pt={user:u,chats:b,activeChat:j,messages:C,onlineUsers:D,typingUsers:w,loading:E,loadingMessages:U,error:S,unreadCounts:$,hasMoreMessages:R,isSocketConnected:ce,isChannel:r,deviceId:l,useFallbackMode:tt,avatarCache:ge,getAvatarUrl:Re,setActiveChat:m=>{if(!r)return Ye(m)},loadMessages:(m,c)=>r?Promise.resolve(null):Ne(m,c),loadMoreMessages:m=>r?Promise.resolve(null):Ne(m),sendTextMessage:(m,c,f)=>r?Promise.resolve(null):(async(h,y,g=null)=>{if(!s||!h||!y.trim()||!u||r)return null;try{const p=b.find(ae=>ae.id===h);let k=y;if(p?.encrypted){const ae=p.encryption_key||String(h);k=Kr(y,ae)}const T={Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json","X-Device-ID":l},z=await fetch(`${F}/messenger/chats/${h}/messages`,{method:"POST",headers:T,body:JSON.stringify({text:k,reply_to_id:g,device_id:l})}),Q=z.headers.get("content-type");if(!Q||!Q.includes("application/json"))throw await z.text(),new Error("API returned non-JSON response");const Ee=await z.json();if(Ee.success){const ae=Ee.message;return ae.created_at&&(ae.created_at=st(ae.created_at)),P(Z=>{const ee=Z[h]||[];return{...Z,[h]:[...ee,ae].sort((ve,$e)=>ve.id-$e.id)}}),v(Z=>{const ee=Z.findIndex(ct=>ct.id===h);if(ee===-1)return Z;const ve={...Z[ee],last_message:ae},$e=[...Z];return $e.splice(ee,1),[ve,...$e]}),ae}return M(Ee.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"),null}catch{return M("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"),null}})(m,c,f),uploadFile:(m,c,f,h)=>r?Promise.resolve(null):(async(y,g,p,k=null)=>{if(!s||!y||!g||!u||r)return null;try{const T=new FormData;T.append("file",g),T.append("message_type",p),k&&T.append("reply_to_id",k);const z=await fetch(`${F}/messenger/chats/${y}/upload`,{method:"POST",headers:{Authorization:`Bearer ${s}`,Accept:"application/json"},body:T}),Q=z.headers.get("content-type");if(!Q||!Q.includes("application/json"))throw await z.text(),new Error("API returned non-JSON response");const Ee=await z.json();if(Ee.success){const ae=Ee.message;return ae.created_at&&(ae.created_at=st(ae.created_at)),P(Z=>{const ee=Z[y]||[];return{...Z,[y]:[...ee,ae].sort((ve,$e)=>ve.id-$e.id)}}),v(Z=>Z.map(ee=>ee.id===y?{...ee,last_message:ae}:ee)),ae}return M(Ee.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u0430"),null}catch{return M("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u0430"),null}})(m,c,f,h),markMessageAsRead:m=>{if(!r)return ze(m)},markAllMessagesAsRead:m=>{if(!r)return(c=>{if(!u||!c||r)return;const f=(C[c]||[]).filter(h=>!(h.sender_id===u.id||h.read_by&&h.read_by.includes(u.id)));f.forEach(h=>{ze(h.id)}),f.length>0&&Y(h=>({...h,[c]:0}))})(m)},sendTypingIndicator:(m,c)=>{if(!r)return((f,h)=>{if(W.current&&f&&ce&&!r)try{W.current.send(JSON.stringify({type:h?"typing_start":"typing_end",chatId:f}))}catch{}})(m,c)},searchUsers:(m,c)=>r?Promise.resolve([]):(async(f,h=20)=>{if(!s||!f||r)return[];try{const y=await fetch(`${F}/messenger/users/search?query=${encodeURIComponent(f)}&limit=${h}`,{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}}),g=y.headers.get("content-type");if(!g||!g.includes("application/json"))throw await y.text(),new Error("API returned non-JSON response");const p=await y.json();return p.success?(p.users||[]).filter(k=>k.type!=="channel"):[]}catch{return[]}})(m,c),getUserInfo:m=>r?Promise.resolve(null):be(m),createPersonalChat:(m,c)=>r?Promise.resolve(null):(async(f,h=!1)=>{if(!s||!f||r)return null;try{if((await be(f))?.type==="channel")return M("\u041D\u0435\u043B\u044C\u0437\u044F \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0447\u0430\u0442 \u0441 \u043A\u0430\u043D\u0430\u043B\u043E\u043C"),null;const g=await fetch(`${F}/messenger/chats/personal`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({user_id:f,encrypted:h})}),p=g.headers.get("content-type");if(!p||!p.includes("application/json"))throw await g.text(),new Error("API returned non-JSON response");const k=await g.json();return k.success?(await Je(),k.chat_id):(M(k.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0447\u0430\u0442\u0430"),null)}catch{return M("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0447\u0430\u0442\u0430"),null}})(m,c),createGroupChat:(m,c,f)=>r?Promise.resolve(null):(async(h,y,g=!1)=>{if(!s||!y||!y.length||r)return null;try{const p=y.map(Q=>be(Q));if((await Promise.all(p)).some(Q=>Q?.type==="channel"))return M("\u041D\u0435\u043B\u044C\u0437\u044F \u0434\u043E\u0431\u0430\u0432\u043B\u044F\u0442\u044C \u043A\u0430\u043D\u0430\u043B\u044B \u0432 \u0433\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u0447\u0430\u0442"),null;const k=await fetch(`${F}/messenger/chats/group`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({title:h,member_ids:y,encrypted:g})}),T=k.headers.get("content-type");if(!T||!T.includes("application/json"))throw await k.text(),new Error("API returned non-JSON response");const z=await k.json();return z.success?(await Je(),z.chat_id):(M(z.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0433\u0440\u0443\u043F\u043F\u044B"),null)}catch{return M("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0433\u0440\u0443\u043F\u043F\u044B"),null}})(m,c,f),getChatDetails:m=>r?Promise.resolve(null):(async c=>{if(!s||!c||r)return null;try{const f=await fetch(`${F}/messenger/chats/${c}`,{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}}),h=f.headers.get("content-type");if(!h||!h.includes("application/json"))throw await f.text(),new Error("API \u0432\u0435\u0440\u043D\u0443\u043B \u043E\u0442\u0432\u0435\u0442 \u043D\u0435 \u0432 \u0444\u043E\u0440\u043C\u0430\u0442\u0435 JSON");const y=await f.json();if(y.success){if(y.chat.members){if(y.chat.members.some(g=>g.type==="channel"))return null;if(y.chat.last_message&&y.chat.last_message.created_at&&(y.chat.last_message.created_at=st(y.chat.last_message.created_at)),y.chat.members.forEach(g=>{g.last_active&&(g.last_active=st(g.last_active));const p=g.user_id||g.id;if(p){const k=g.photo||g.avatar;k&&(g.avatar=St(p,k))}}),!y.chat.is_group){const g=y.chat.members.find(p=>{const k=p.user_id||p.id,T=k?String(k):null,z=u?.id?String(u.id):null;return T&&z&&T!==z});if(g){const p=g.user_id||g.id,k=g.photo||g.avatar;p&&k&&(y.chat.avatar=St(p,k),y.chat.title||(y.chat.title=g.name||g.username||`\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C #${p}`))}}}return y.chat}return null}catch{return null}})(m),decryptMessage:(m,c)=>{if(!m)return m;const f=b.find(h=>h.id===c);if(f?.encrypted&&m.content){const h=f.encryption_key||String(c);try{return Kr(m.content,h)}catch{return"\u{1F512} [\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0430\u0441\u0448\u0438\u0444\u0440\u043E\u0432\u043A\u0438]"}}return m.content},getFileUrl:Fe,refreshChats:()=>{if(!r)return at()},getTotalUnreadCount:()=>r||r?0:Object.values($).reduce((m,c)=>m+c,0),updateLastMessage:(m,c)=>{if(!r)return Oe(m,c)},sessionKey:s,forceReconnectSocket:()=>{if(!r)return he()},deleteMessage:async m=>{if(r)return{success:!1,error:"\u041E\u043F\u0435\u0440\u0430\u0446\u0438\u044F \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0430 \u0434\u043B\u044F \u043A\u0430\u043D\u0430\u043B\u043E\u0432"};try{const c=await G.delete(`/api/messenger/messages/${m}`,{headers:{"X-Device-ID":l,"X-Session-Key":s}});if(c.data&&c.data.success){let f=null,h=null;if(Object.entries(C).forEach(([y,g])=>{const p=g.find(k=>k.id===m);p&&(f=parseInt(y),h=p)}),f){P(g=>{const p=(g[f]||[]).filter(k=>k.id!==m);return{...g,[f]:p}});const y=b.find(g=>g.id===f);if(y&&y.last_message&&y.last_message.id===m){const g=(C[f]||[]).filter(p=>p.id!==m).sort((p,k)=>new Date(k.created_at)-new Date(p.created_at))[0];g&&Oe(f,g)}}return{success:!0}}return{success:!1,error:c.data?.error||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435"}}catch(c){return{success:!1,error:c.response?.data?.error||"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F"}}},deleteChat:async m=>{if(r)return{success:!1,error:"\u041E\u043F\u0435\u0440\u0430\u0446\u0438\u044F \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0430 \u0434\u043B\u044F \u043A\u0430\u043D\u0430\u043B\u043E\u0432"};try{const c=await G.delete(`/api/messenger/chats/${m}`,{headers:{"X-Device-ID":l,"X-Session-Key":s}});return c.data&&c.data.success?(v(f=>f.filter(h=>h.id!==m)),j&&j.id===m&&(_(null),P([])),{success:!0}):{success:!1,error:c.data?.error||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0447\u0430\u0442"}}catch(c){return{success:!1,error:c.response?.data?.error||"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0447\u0430\u0442\u0430"}}},enableLogging:(m=!0)=>{typeof window<"u"&&(window.MESSENGER_DEV_MODE=m)}};return n.jsx(vr.Provider,{value:pt,children:t})},Go=()=>{const t=We.useContext(vr);if(!t)throw new Error("useMessenger must be used within a MessengerProvider");return t};var Ia,Vt={};function di(){if(Ia)return Vt;Ia=1;var t=Ie();Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.default=void 0;var e=t(je()),r=Te();return Vt.default=(0,e.default)((0,r.jsx)("path",{d:"M21.95 10.99c-1.79-.03-3.7-1.95-2.68-4.22-2.98 1-5.77-1.59-5.19-4.56C6.95.71 2 6.58 2 12c0 5.52 4.48 10 10 10 5.89 0 10.54-5.08 9.95-11.01M8.5 15c-.83 0-1.5-.67-1.5-1.5S7.67 12 8.5 12s1.5.67 1.5 1.5S9.33 15 8.5 15m2-5C9.67 10 9 9.33 9 8.5S9.67 7 10.5 7s1.5.67 1.5 1.5-.67 1.5-1.5 1.5m4.5 6c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"Cookie"),Vt}const ui=ke(di()),Ta="kconnect_cookie_agreed";We.memo(()=>{const[t,e]=d.useState(!1),r=d.useRef(!1),a=on("(max-width:600px)"),i=_t();return d.useEffect(()=>{localStorage.getItem(Ta)||e(!0)},[]),n.jsx(Zi,{direction:"up",in:t,mountOnEnter:!0,unmountOnExit:!0,children:n.jsx(V,{sx:{position:"fixed",bottom:24,left:0,width:"100%",zIndex:2e3,display:"flex",justifyContent:"center"},children:n.jsxs(jt,{elevation:8,sx:{px:2,py:1,borderRadius:3,display:"flex",alignItems:"center",gap:2,maxWidth:780,minHeight:0,bgcolor:"rgba(0,0,0,0.8)",boxShadow:"0 8px 32px rgba(157, 111, 250, 0.07)",width:"100%",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:[n.jsx(ui,{color:"warning",sx:{fontSize:28,minWidth:28}}),n.jsxs(V,{sx:{display:"flex",flexDirection:a?"column":"row",alignItems:a?"flex-start":"center",justifyContent:"space-between",width:"100%",gap:a?.5:2},children:[n.jsxs(oe,{variant:"body2",sx:{fontWeight:500,lineHeight:1.3,color:"#fff"},children:["\u041C\u044B \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C ",n.jsx(Qi,{href:"/cookies",onClick:o=>{o.preventDefault(),i("/cookies")},sx:{color:"#D0BCFF",textDecoration:"underline"},children:"\u043A\u0443\u043A\u0438"})," \u{1F36A} ",n.jsx("span",{style:{color:"#b39ddb"},children:n.jsx("i",{children:"\u0411\u0435\u0437 \u043A\u0443\u043A\u0438 \u2014 \u043A\u0430\u043A \u0431\u0435\u0437 \u043C\u0443\u0437\u044B\u043A\u0438!"})}),!a&&n.jsxs(n.Fragment,{children:[n.jsx("br",{}),n.jsx("span",{style:{color:"#b39ddb"},children:"\u0421 \u043A\u0443\u043A\u0438 \u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442 \u0431\u044B\u0441\u0442\u0440\u0435\u0435, \u0432\u0435\u0441\u0435\u043B\u0435\u0435 \u0438 \u0432\u043E\u043E\u0431\u0449\u0435 \u2014 \u043A\u0430\u043A \u043D\u0430\u0434\u043E!"})]})]}),n.jsx(Ke,{variant:"contained",color:"primary",onClick:()=>{localStorage.setItem(Ta,"true"),r.current=!0,e(!1)},sx:{borderRadius:2,fontWeight:600,ml:a?0:2,mt:a?1:0,whiteSpace:"nowrap",minHeight:32,minWidth:0,px:2,py:.5},children:"\u0421\u044A\u0435\u0441\u0442\u044C \u043A\u0443\u043A\u0438"})]})]})})})});let Aa,qt,Ma,Pa,Gr,Oa,Ra,Fa,za,Da,La,br,Yr,Zr,Na,Qr,$a,Wa,Ba,wr,Ha,Va,jr,qa,Ua,Ja,Ka,Ga,Ya,Za,Qa,Xa,eo,to,ro,no,ao,oo,so,io,co,lo,uo,po,ho,Xr,mo,fo,en,tn,bt,rn;Aa=xe(sn)(({theme:t})=>({paddingTop:t.spacing(1),paddingBottom:t.spacing(4),marginTop:"20px"})),qt=xe(oe)(({theme:t})=>({marginBottom:t.spacing(2),color:t.palette.primary.main,display:"flex",alignItems:"center",gap:t.spacing(1)})),Ma=()=>(ot(),n.jsx(Aa,{maxWidth:"md",children:n.jsxs(jt,{elevation:3,sx:{p:4,borderRadius:2},children:[n.jsxs(V,{sx:{mb:1},children:[n.jsxs(oe,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Xi,{color:"primary"}),"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u0435 Cookie \u0432 K-Connect"]}),n.jsx(oe,{variant:"body1",paragraph:!0,children:"K-Connect \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442 cookie-\u0444\u0430\u0439\u043B\u044B \u0434\u043B\u044F \u043E\u0431\u0435\u0441\u043F\u0435\u0447\u0435\u043D\u0438\u044F \u0431\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0441\u0442\u0438, \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0445 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0438 \u0443\u043B\u0443\u0447\u0448\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u043E\u0433\u043E \u043E\u043F\u044B\u0442\u0430. \u041D\u0430 \u044D\u0442\u043E\u0439 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435 \u043C\u044B \u043E\u0431\u044A\u044F\u0441\u043D\u044F\u0435\u043C, \u043A\u0430\u043A \u0438 \u0434\u043B\u044F \u0447\u0435\u0433\u043E \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044E\u0442\u0441\u044F cookie \u0432 \u043D\u0430\u0448\u0435\u043C \u043F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u0438."})]}),n.jsxs(V,{sx:{mb:4},children:[n.jsxs(qt,{variant:"h5",children:[n.jsx(cn,{}),"\u0411\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0441\u0442\u044C \u0438 \u0430\u0443\u0442\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u044F"]}),n.jsxs(Sr,{children:[n.jsxs(ft,{children:[n.jsx(gt,{children:n.jsx(cn,{color:"primary"})}),n.jsx(xt,{primary:"\u0421\u0435\u0441\u0441\u0438\u043E\u043D\u043D\u044B\u0435 cookie",secondary:"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044E\u0442\u0441\u044F \u0434\u043B\u044F \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0430\u043D\u0438\u044F \u0441\u0435\u0441\u0441\u0438\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0438 \u043E\u0431\u0435\u0441\u043F\u0435\u0447\u0435\u043D\u0438\u044F \u0431\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0433\u043E \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u043A \u0437\u0430\u0449\u0438\u0449\u0435\u043D\u043D\u044B\u043C \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043C. \u042D\u0442\u0438 cookie \u044F\u0432\u043B\u044F\u044E\u0442\u0441\u044F HTTP-only \u0438 \u043D\u0435 \u043C\u043E\u0433\u0443\u0442 \u0431\u044B\u0442\u044C \u043F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u044B JavaScript."})]}),n.jsxs(ft,{children:[n.jsx(gt,{children:n.jsx(cn,{color:"primary"})}),n.jsx(xt,{primary:"\u0421\u0435\u0441\u0441\u0438\u043E\u043D\u043D\u044B\u0435 \u043A\u043B\u044E\u0447\u0438",secondary:"\u0425\u0440\u0430\u043D\u044F\u0442\u0441\u044F \u0432 \u0437\u0430\u0449\u0438\u0449\u0435\u043D\u043D\u044B\u0445 HTTP-only cookie \u0434\u043B\u044F \u0431\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0439 \u0430\u0443\u0442\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439. \u0421\u0435\u0441\u0441\u0438\u044F \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u043F\u0440\u043E\u0434\u043B\u0435\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0440\u0438 \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u043C \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u0438 \u043F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u044F."})]})]})]}),n.jsx(ln,{sx:{my:4}}),n.jsxs(V,{sx:{mb:4},children:[n.jsxs(qt,{variant:"h5",children:[n.jsx(dn,{}),"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438"]}),n.jsxs(Sr,{children:[n.jsxs(ft,{children:[n.jsx(gt,{children:n.jsx(dn,{color:"primary"})}),n.jsx(xt,{primary:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0442\u0435\u043C\u044B",secondary:"Cookie \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044E\u0442\u0441\u044F \u0434\u043B\u044F \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u043E\u0439 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u043C \u0442\u0435\u043C\u044B \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u044F (\u0441\u0432\u0435\u0442\u043B\u0430\u044F/\u0442\u0435\u043C\u043D\u0430\u044F/\u043A\u043E\u043D\u0442\u0440\u0430\u0441\u0442\u043D\u0430\u044F)."})]}),n.jsxs(ft,{children:[n.jsx(gt,{children:n.jsx(dn,{color:"primary"})}),n.jsx(xt,{primary:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0435 \u043F\u0440\u0435\u0434\u043F\u043E\u0447\u0442\u0435\u043D\u0438\u044F",secondary:"\u0421\u043E\u0445\u0440\u0430\u043D\u044F\u044E\u0442 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430, \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u043C \u0434\u043B\u044F \u0443\u043B\u0443\u0447\u0448\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u043E\u0433\u043E \u043E\u043F\u044B\u0442\u0430."})]})]})]}),n.jsx(ln,{sx:{my:4}}),n.jsxs(V,{sx:{mb:4},children:[n.jsxs(qt,{variant:"h5",children:[n.jsx(un,{}),"\u0425\u0440\u0430\u043D\u0435\u043D\u0438\u0435 \u0434\u0430\u043D\u043D\u044B\u0445"]}),n.jsxs(Sr,{children:[n.jsxs(ft,{children:[n.jsx(gt,{children:n.jsx(un,{color:"primary"})}),n.jsx(xt,{primary:"\u041B\u043E\u043A\u0430\u043B\u044C\u043D\u043E\u0435 \u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435",secondary:"\u041D\u0435\u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0434\u0443\u0431\u043B\u0438\u0440\u0443\u044E\u0442\u0441\u044F \u0432 localStorage \u0434\u043B\u044F \u0431\u044B\u0441\u0442\u0440\u043E\u0433\u043E \u0434\u043E\u0441\u0442\u0443\u043F\u0430 \u0438 \u0443\u043B\u0443\u0447\u0448\u0435\u043D\u0438\u044F \u043F\u0440\u043E\u0438\u0437\u0432\u043E\u0434\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u0438."})]}),n.jsxs(ft,{children:[n.jsx(gt,{children:n.jsx(un,{color:"primary"})}),n.jsx(xt,{primary:"\u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445",secondary:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u0443\u044E\u0442\u0441\u044F \u043C\u0435\u0436\u0434\u0443 cookie, localStorage \u0438 sessionStorage \u0434\u043B\u044F \u043E\u0431\u0435\u0441\u043F\u0435\u0447\u0435\u043D\u0438\u044F \u043D\u0430\u0434\u0435\u0436\u043D\u043E\u0441\u0442\u0438."})]})]})]}),n.jsx(ln,{sx:{my:4}}),n.jsxs(V,{sx:{mb:4},children:[n.jsxs(qt,{variant:"h5",children:[n.jsx(pn,{}),"\u0412\u0430\u0436\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F"]}),n.jsxs(Sr,{children:[n.jsxs(ft,{children:[n.jsx(gt,{children:n.jsx(pn,{color:"primary"})}),n.jsx(xt,{primary:"\u0411\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0441\u0442\u044C",secondary:"\u0412\u0441\u0435 cookie, \u0441\u0432\u044F\u0437\u0430\u043D\u043D\u044B\u0435 \u0441 \u0430\u0443\u0442\u0435\u043D\u0442\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u0435\u0439, \u0437\u0430\u0449\u0438\u0449\u0435\u043D\u044B \u0444\u043B\u0430\u0433\u0430\u043C\u0438 HttpOnly \u0438 SameSite \u0434\u043B\u044F \u043F\u0440\u0435\u0434\u043E\u0442\u0432\u0440\u0430\u0449\u0435\u043D\u0438\u044F XSS-\u0430\u0442\u0430\u043A."})]}),n.jsxs(ft,{children:[n.jsx(gt,{children:n.jsx(pn,{color:"primary"})}),n.jsx(xt,{primary:"\u0421\u0440\u043E\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F",secondary:"\u0421\u0435\u0441\u0441\u0438\u043E\u043D\u043D\u044B\u0435 cookie \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u044B \u0434\u043E \u0437\u0430\u043A\u0440\u044B\u0442\u0438\u044F \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430 \u0438\u043B\u0438 \u043F\u0440\u0438 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0438 \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0441\u0442\u0438 \u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u043E\u0433\u043E \u0432\u0440\u0435\u043C\u0435\u043D\u0438. \u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0445\u0440\u0430\u043D\u044F\u0442\u0441\u044F \u0434\u043E 365 \u0434\u043D\u0435\u0439."})]})]})]})]})})),Pa=We.createContext({sessionActive:!0,sessionExpired:!1,lastFetchTime:null,broadcastUpdate:()=>{},checkSessionStatus:()=>!0,refreshSession:()=>{}}),Gr=({children:t})=>{const{isAuthenticated:e,loading:r}=d.useContext(nt),a=yt();return r?null:e?t:n.jsx(ie,{to:"/login",state:{from:a.pathname},replace:!0})},Oa=d.lazy(()=>X(()=>import("./Login.C_21mygB.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),Ra=d.lazy(()=>X(()=>import("./Register.BZF1FJFm.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),Fa=d.lazy(()=>X(()=>import("./ForgotPassword.DVOENv1e.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url)),za=d.lazy(()=>X(()=>import("./ResetPassword.C3Fw6vA0.js"),__vite__mapDeps([7,1,2,3,8,9,4]),import.meta.url)),Da=d.lazy(()=>X(()=>import("./RegisterProfile.iKcZnDDT.js"),__vite__mapDeps([10,1,2,3,4]),import.meta.url)),La=d.lazy(()=>X(()=>import("./EmailConfirmation.DZwrRAlG.js"),__vite__mapDeps([11,1,2,3,4]),import.meta.url)),br=d.lazy(()=>X(()=>import("./ElementAuth.DtLlgwrh.js"),__vite__mapDeps([12,1,2,3]),import.meta.url)),Yr=d.lazy(()=>X(()=>import("./MainLayout.D0Ngvinf.js"),__vite__mapDeps([13,1,2,3,14,15,16,17,18,19,20,21,22,23,24,25,4,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43]),import.meta.url)),Zr=d.lazy(()=>X(()=>import("./ProfilePage.DzabE94M.js"),__vite__mapDeps([44,1,2,3,4,26,29,21,22,24,30,31,32,33,34,35,45,46,47,48,38,49,50,51,52,53,54,55,41,16,17,8,39,56,57,19,18,58]),import.meta.url)),Na=d.lazy(()=>X(()=>import("./MainPage.CFkrN-o-.js"),__vite__mapDeps([59,1,2,3,24,53,4,26,54,21,22,48,31,55,41,38,16,17,8,29,30,32,33,34,35,39,56,45,57,49,60,61,62,63,64,65]),import.meta.url)),Qr=d.lazy(()=>X(()=>import("./PostDetailPage.DXoXnl_Z.js"),__vite__mapDeps([66,1,2,3,4,53,26,54,21,22,48,31,55,41,38,16,17,8,29,24,30,32,33,34,35,39,56,45,57,67,68,69]),import.meta.url)),$a=d.lazy(()=>X(()=>import("./SettingsPage.Djo7_KbD.js"),__vite__mapDeps([70,1,2,3,4,41,29,21,22,24,30,26,31,32,33,34,35,71,72,73,74,20,75,76,77,19,78,79,14,67,48,80,81,52,82,51,38,47,83,84]),import.meta.url)),Wa=d.lazy(()=>X(()=>import("./NotificationsPage.CuuEHV3z.js"),__vite__mapDeps([85,1,2,3,4,26,28,27,68]),import.meta.url)),Ba=d.lazy(()=>X(()=>import("./SearchPage.BEXiq8eS.js"),__vite__mapDeps([86,1,2,3,46,21,22,87,54,4]),import.meta.url)),wr=d.lazy(()=>X(()=>import("./MusicPage.C1dJ9gmr.js"),__vite__mapDeps([88,1,2,3,36,37,38,39,40,16,4,41,42,29,21,22,24,30,26,31,32,33,34,35,19,8,9]),import.meta.url)),Ha=d.lazy(()=>X(()=>import("./ArtistPage.BmCMwOEq.js"),__vite__mapDeps([89,1,2,3,4,36,37,38,39,40,16,41,42,71,43]),import.meta.url)),Va=d.lazy(()=>X(()=>import("./MessengerPage.DflbkRuK.js"),__vite__mapDeps([90,1,2,3,67,20,35,56,24,68,31,91,25,69,4,92,34,33,39,19,93]),import.meta.url)),jr=d.lazy(()=>X(()=>import("./SubscriptionsPage.hkTBGGan.js"),__vite__mapDeps([94,1,2,3,4,67,46]),import.meta.url)),qa=d.lazy(()=>X(()=>import("./BugReportPage.BbCbZ6CD.js"),__vite__mapDeps([95,1,2,3,4,63,35,77,87]),import.meta.url)),Ua=d.lazy(()=>X(()=>import("./LeaderboardPage.Cz1qhngq.js"),__vite__mapDeps([96,1,2,3,4,45]),import.meta.url)),Ja=d.lazy(()=>X(()=>import("./RulesPage.DYdgIFLt.js"),__vite__mapDeps([97,1,2,3,80,52,98,64,76,50,84,99,4]),import.meta.url)),Ka=d.lazy(()=>X(()=>import("./PrivacyPolicyPage.BL9f_KuI.js"),__vite__mapDeps([100,1,2,3,98,80,4]),import.meta.url)),Ga=d.lazy(()=>X(()=>import("./TermsOfServicePage.zJ2CfL3c.js"),__vite__mapDeps([101,1,2,3,98,80,4]),import.meta.url)),Ya=d.lazy(()=>X(()=>import("./MorePage.C-AR8doZ.js"),__vite__mapDeps([102,1,2,3,4,15,29,21,22,24,30,26,31,32,33,34,35,45]),import.meta.url)),Za=d.lazy(()=>X(()=>import("./NotFound.BKexQ4wF.js"),__vite__mapDeps([103,1,2,3,4]),import.meta.url)),Qa=d.lazy(()=>X(()=>import("./AdminPage.AIuATBTk.js"),__vite__mapDeps([104,1,2,3,105,52,31,81,106,24,38,8,80,56,63,74,14,91,107,108,4]),import.meta.url)),Xa=d.lazy(()=>X(()=>import("./ModeratorPage.B2uVA173.js"),__vite__mapDeps([109,1,2,3,80,38,31,56,105,63,34,39,20,110,9,32,81,4,108,16,52,30,82,40,19,24]),import.meta.url)),eo=d.lazy(()=>X(()=>import("./UpdatesPage.C8GFTzId.js"),__vite__mapDeps([111,1,2,3,60,61,62,63,64,65,30,4]),import.meta.url)),to=d.lazy(()=>X(()=>import("./SharePreviewTest.DCb1dVxj.js"),__vite__mapDeps([112,1,2,3]),import.meta.url)),ro=d.lazy(()=>X(()=>import("./BadgeShopPage.DhWOYfWF.js"),__vite__mapDeps([113,1,2,3,4,19,24,75,73,72,61,108]),import.meta.url)),no=d.lazy(()=>X(()=>import("./BalancePage.DDRAK5Kp.js"),__vite__mapDeps([114,1,2,3,4,75,115,27,106,19,35,73,50,23,14,116,24,117,118,29,21,22,30,26,31,32,33,34,65]),import.meta.url)),ao=d.lazy(()=>X(()=>import("./UsernameAuctionPage.BY72N8hL.js"),__vite__mapDeps([119,1,2,3,4,116,34,30,19,20,24,92]),import.meta.url)),oo=d.lazy(()=>X(()=>import("./SimpleApiDocsPage.DtOlNVoS.js"),__vite__mapDeps([120,1,2,3,121,80,106,40,83,63,118,4]),import.meta.url)),so=d.lazy(()=>X(()=>import("./SubPlanes.Dck8yoIN.js"),__vite__mapDeps([122,1,2,3,79,50,107,4,62]),import.meta.url)),io=d.lazy(()=>X(()=>import("./TestNotifications.D04rk8X2.js"),__vite__mapDeps([123,1,2,3]),import.meta.url)),co=d.lazy(()=>X(()=>import("./MiniGamesPage.Cy23NCxr.js"),__vite__mapDeps([124,1,2,3,4,117,118,110]),import.meta.url)),lo=d.lazy(()=>X(()=>import("./CupsGamePage.hBzk0GX9.js"),__vite__mapDeps([125,1,2,3,67,4]),import.meta.url)),uo=d.lazy(()=>X(()=>import("./LuckyNumberGame.vqu-YAZs.js"),__vite__mapDeps([126,1,2,3,4,67,73]),import.meta.url)),po=d.lazy(()=>X(()=>import("./ClickerPage.VO5eP5pM.js"),__vite__mapDeps([127,1,2,3,4,117,115,67]),import.meta.url)),ho=d.lazy(()=>X(()=>import("./BlackjackPage.CbNrywfg.js"),__vite__mapDeps([128,1,2,3,4]),import.meta.url)),Xr=d.lazy(()=>X(()=>import("./AboutPage.BZBVvc1B.js"),__vite__mapDeps([129,1,2,3,121,99,38,118,106,84,73,37,78,63,55,51,4]),import.meta.url)),At=We.createContext({themeSettings:{mode:"dark",primaryColor:"#D0BCFF",secondaryColor:"#f28c9a"},updateThemeSettings:()=>{},setProfileBackground:()=>{},clearProfileBackground:()=>{}}),mo=()=>{const t=ot();return n.jsx(V,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:t.palette.background.default},children:n.jsx(ht,{color:"primary",size:40,thickness:4,sx:{color:t.palette.primary.main,filter:"drop-shadow(0 0 8px rgba(208, 188, 255, 0.4))"}})})},fo=({children:t})=>t,en=()=>{const t=ot();return n.jsx(V,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%",position:"fixed",top:0,left:0,zIndex:1e3,backgroundColor:t.palette.background.default},children:n.jsx(V,{sx:{animation:"pulse 1.5s infinite ease-in-out","@keyframes pulse":{"0%, 100%":{opacity:.7,transform:"scale(1)"},"50%":{opacity:1,transform:"scale(1.2)"}}},children:n.jsx(V,{component:"img",src:"/icon-512.png",alt:"K-Connect",sx:{width:80,height:80,filter:"drop-shadow(0 0 8px rgba(208, 188, 255, 0.4))"}})})})},tn=({error:t,resetErrorBoundary:e})=>(d.useEffect(()=>{(t?.message?.includes("Failed to fetch")||t?.name==="TypeError"||t?.message?.includes("Failed to fetch dynamically imported module"))&&window.location.reload()},[t]),n.jsxs(V,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",textAlign:"center",p:3},children:[n.jsx(oe,{variant:"h5",gutterBottom:!0,children:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A"}),n.jsx(oe,{variant:"body1",color:"text.secondary",paragraph:!0,children:"\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"}),n.jsxs(V,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:2,maxWidth:"600px",width:"100%",textAlign:"left"},children:[n.jsx(oe,{variant:"subtitle2",color:"error",gutterBottom:!0,children:"\u0414\u0435\u0442\u0430\u043B\u0438 \u043E\u0448\u0438\u0431\u043A\u0438:"}),n.jsx(oe,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",color:"text.secondary",fontFamily:"monospace",fontSize:"0.875rem"},children:t?.message||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430"}),t?.stack&&n.jsx(oe,{variant:"body2",component:"pre",sx:{mt:1,whiteSpace:"pre-wrap",wordBreak:"break-word",color:"text.secondary",fontFamily:"monospace",fontSize:"0.75rem",opacity:.7},children:t.stack})]}),n.jsx(Ke,{variant:"contained",onClick:e||(()=>window.location.reload()),sx:{mt:3},children:"\u041F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C"})]})),bt=()=>{const t=yt(),{isAuthenticated:e}=d.useContext(nt),r=t.pathname;let a;if(r==="/rules")a=Ja;else if(r==="/privacy-policy")a=Ka;else if(r==="/terms-of-service")a=Ga;else{if(r==="/about")return n.jsx(Xr,{});r==="/cookies"&&(a=Ma)}const i=n.jsx(V,{children:n.jsx(a,{})});return e?n.jsx(Yr,{children:i}):i},rn=()=>{const{user:t,isAuthenticated:e,loading:r,checkAuth:a,error:i,setUser:o}=d.useContext(nt),s=yt(),l=ot(),u=s.state&&s.state.background,[x,b]=d.useTransition();d.useEffect(()=>{const D=s.pathname==="/reset-password"&&(s.search.includes("token=")||window.location.hash.includes("/reset-password?token=")),I=["/login","/register","/register/profile","/confirm-email","/auth_elem","/about","/forgot-password"].some(O=>s.pathname.startsWith(O))||s.pathname.startsWith("/reset-password"),w=!!localStorage.getItem("login_error");if(localStorage.getItem("auth_success")==="true"&&s.pathname==="/")return localStorage.removeItem("auth_success"),void b(()=>{a(!0)});I||D||i||w||(async()=>b(()=>{a(!0)}))()},[s.pathname,s.search,window.location.hash]);const v=s.pathname,j=v==="/login",_=v==="/register",C=v==="/forgot-password"||v==="/reset-password",P=v.startsWith("/auth_elem")||v==="/element-auth";return j||_||C?n.jsx(V,{sx:{minHeight:"100vh",background:l.palette.background.default,display:"flex",flexDirection:"column"},children:n.jsx(d.Suspense,{fallback:n.jsx(mo,{}),children:n.jsxs(cr,{location:s,children:[n.jsx(q,{path:"/login",element:e?n.jsx(ie,{to:"/",replace:!0}):n.jsx(Oa,{})}),n.jsx(q,{path:"/register",element:e?n.jsx(ie,{to:"/",replace:!0}):n.jsx(Ra,{setUser:o})}),n.jsx(q,{path:"/forgot-password",element:n.jsx(Fa,{})}),n.jsx(q,{path:"/reset-password",element:n.jsx(za,{})}),n.jsx(q,{path:"*",element:n.jsx(ie,{to:"/login",replace:!0})})]})})}):P?n.jsx(V,{sx:{minHeight:"100vh",background:l.palette.background.default,display:"flex",flexDirection:"column"},children:n.jsxs(cr,{location:s,children:[n.jsx(q,{path:"/element-auth",element:n.jsx(br,{})}),n.jsx(q,{path:"/auth_elem/:token",element:n.jsx(br,{})}),n.jsx(q,{path:"/auth_elem/direct/:token",element:n.jsx(br,{})}),n.jsx(q,{path:"*",element:n.jsx(ie,{to:"/login",replace:!0})})]})}):n.jsxs(Yr,{children:[n.jsxs(fo,{children:[n.jsxs(cr,{location:u||s,children:[n.jsx(q,{path:"/register/profile",element:n.jsx(Da,{setUser:o})}),n.jsx(q,{path:"/register/channel",element:n.jsx(ws,{})}),n.jsx(q,{path:"/confirm-email/:token",element:n.jsx(La,{})}),n.jsx(q,{path:"/",element:r?n.jsx(V,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:n.jsx(ht,{})}):e?n.jsx(Na,{}):n.jsx(ie,{to:"/login",replace:!0,state:{from:s.pathname}})}),n.jsx(q,{path:"/feed",element:n.jsx(ie,{to:"/",replace:!0})}),n.jsx(q,{path:"/main",element:n.jsx(ie,{to:"/",replace:!0})}),n.jsx(q,{path:"/post/:postId",element:n.jsx(Qr,{})}),n.jsx(q,{path:"/profile",element:n.jsx(Zr,{})}),n.jsx(q,{path:"/profile/:username",element:n.jsx(Zr,{})}),n.jsx(q,{path:"/profile/:username/followers",element:e?n.jsx(jr,{tabIndex:0}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/profile/:username/following",element:e?n.jsx(jr,{tabIndex:1}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/subscriptions",element:e?n.jsx(jr,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/settings",element:e?n.jsx($a,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/notifications",element:e?n.jsx(Wa,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/search",element:e?n.jsx(Ba,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/music",element:e?n.jsx(wr,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/music/:section",element:e?n.jsx(wr,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/music/track/:trackId",element:e?n.jsx(wr,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/artist/:artistParam",element:e?n.jsx(Ha,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/messenger",element:e?n.jsx(Va,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/messenger/join/:inviteCode",element:e?n.jsx(Ea,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/bugs",element:n.jsx(qa,{})}),n.jsx(q,{path:"/leaderboard",element:n.jsx(Gr,{children:n.jsx(Ua,{})})}),n.jsx(q,{path:"/share-preview-test",element:e?n.jsx(to,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/more",element:e?n.jsx(Ya,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/admin",element:e?n.jsx(Qa,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/moderator",element:e?n.jsx(Xa,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/badge-shop",element:e?n.jsx(ro,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/username-auction",element:e?n.jsx(ao,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/minigames",element:e?n.jsx(co,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/minigames/cups",element:e?n.jsx(lo,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/minigames/lucky-number",element:e?n.jsx(uo,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/minigames/clicker",element:e?n.jsx(po,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/minigames/blackjack",element:e?n.jsx(ho,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/minigames/roulette",element:e?n.jsx(Sa,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/balance",element:e?n.jsx(no,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/api-docs",element:e?n.jsx(oo,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/sub-planes",element:e?n.jsx(so,{}):n.jsx(ie,{to:"/login",replace:!0})}),n.jsx(q,{path:"/channels",element:n.jsx(Gr,{children:n.jsx(Js,{})})}),n.jsx(q,{path:"/updates",element:n.jsx(eo,{})}),n.jsx(q,{path:"/test-notifications",element:n.jsx(io,{})}),n.jsx(q,{path:"/cookies",element:n.jsx(bt,{})}),n.jsx(q,{path:"/badge/:badgeId",element:n.jsx(ie,{to:"/badge-shop",replace:!0,state:{openBadgeId:s.pathname.match(/\/badge\/(\d+)/)?.[1]||null}})}),n.jsx(q,{path:"*",element:n.jsx(Za,{})})]}),u&&n.jsx(cr,{children:n.jsx(q,{path:"/post/:postId",element:n.jsx(Qr,{isOverlay:!0})})})]}),n.jsx(ca,{user:t})]})},We.memo(rn);const pi=()=>{const t=typeof window<"u"?window.location.href:"https://k-connect.ru";return n.jsx(dr,{title:"\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442",description:"\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442 - \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0441\u0435\u0442\u044C \u043E\u0442 \u043D\u0435\u0437\u0430\u0432\u0438\u0441\u0438\u043C\u043E\u0433\u043E \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A\u0430 \u0441 \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C\u0438 \u0434\u043B\u044F \u043E\u0431\u0449\u0435\u043D\u0438\u044F, \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438 \u043F\u043E\u0441\u0442\u043E\u0432, \u043C\u0443\u0437\u044B\u043A\u0438 \u0438 \u043C\u043D\u043E\u0433\u043E\u0433\u043E \u0434\u0440\u0443\u0433\u043E\u0433\u043E.",image:"/icon-512.png",url:t,type:(()=>{if(typeof window<"u"){const e=window.location.pathname;if(e.includes("/post/"))return"article";if(e.includes("/profile/"))return"profile";if(e.includes("/music/"))return"music"}return"website"})(),meta:{keywords:"\u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u0430\u044F \u0441\u0435\u0442\u044C, \u043A-\u043A\u043E\u043D\u043D\u0435\u043A\u0442, \u043E\u0431\u0449\u0435\u043D\u0438\u0435, \u043C\u0443\u0437\u044B\u043A\u0430, \u043B\u0435\u043D\u0442\u0430, \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F",viewport:"width=device-width, initial-scale=1, maximum-scale=5"}})},hi=({children:t})=>{const[e,r]=d.useState(!0),[a,i]=d.useState(!1),o=d.useRef(Date.now()),s=d.useRef(null),l=d.useRef(null);d.useEffect(()=>{if(typeof BroadcastChannel<"u")try{l.current=new BroadcastChannel("k_connect_app_channel"),l.current.onmessage=b=>{const{type:v,data:j,timestamp:_}=b.data;v==="session_refresh"?(o.current=_,r(!0),i(!1)):v==="last_fetch_update"&&_>(s.current||0)&&(s.current=_)}}catch{}return()=>{if(l.current)try{l.current.close()}catch{}}},[]),d.useEffect(()=>{const b=setInterval(()=>{Date.now()-o.current>=36e5&&!a&&(i(!0),r(!1))},6e4);return()=>clearInterval(b)},[a]);const u=(b,v)=>{if(l.current)try{l.current.postMessage({type:b,data:v,timestamp:Date.now()})}catch{}},x={sessionActive:e,sessionExpired:a,lastFetchTime:s.current,broadcastUpdate:u,checkSessionStatus:()=>{if(a)return!1;const b=Date.now();return!(s.current&&b-s.current<15e3||(s.current=b,u("last_fetch_update",null),0))},refreshSession:()=>{const b=Date.now();o.current=b,r(!0),i(!1),u("session_refresh",{newStartTime:b})}};return d.useEffect(()=>{s.current},[e,a]),d.useEffect(()=>{const b=()=>{if(document.visibilityState==="visible"){const v=Date.now();s.current=v,u("last_fetch_update",null)}};return document.addEventListener("visibilitychange",b),()=>{document.removeEventListener("visibilitychange",b)}},[]),n.jsx(Pa.Provider,{value:x,children:t})};function mi(){const[t,e]=d.useTransition(),[r,a]=d.useState(()=>{const w=(M,$)=>{const Y=sessionStorage.getItem(M);if(Y)return Y;const U=localStorage.getItem(M);if(U)return U;const K=He(M);if(K)return K;try{const R=JSON.parse(localStorage.getItem("themeData")||"{}");if(R[M])return R[M]}catch{}return $},O=sessionStorage.getItem("themeMode"),E=localStorage.getItem("theme")||localStorage.getItem("themeMode"),A=He("themeMode")||He("theme"),S=O||E||A||"dark";return localStorage.setItem("theme",S),localStorage.setItem("themeMode",S),sessionStorage.setItem("theme",S),sessionStorage.setItem("themeMode",S),_r("theme",S),_r("themeMode",S),{mode:S,backgroundColor:w("backgroundColor",S==="light"?"#f5f5f5":S==="contrast"?"#080808":"#131313"),paperColor:w("paperColor",S==="light"?"#ffffff":S==="contrast"?"#101010":"#1A1A1A"),headerColor:w("headerColor",S==="light"?"#ffffff":S==="contrast"?"#101010":"#121212"),bottomNavColor:w("bottomNavColor",S==="light"?"#ffffff":S==="contrast"?"#101010":"#1A1A1A"),contentColor:w("contentColor",S==="light"?"#ffffff":S==="contrast"?"#101010":"#1A1A1A"),primaryColor:w("primaryColor",S==="light"?"#8c52ff":S==="contrast"?"#7B46E3":"#D0BCFF"),textColor:w("textColor",S==="light"?"#121212":"#FFFFFF")}}),i=d.useCallback(()=>{const w=r.mode,O=sessionStorage.getItem("themeMode"),E=localStorage.getItem("themeMode"),A=He("themeMode");if(!O||!E||!A){Ve("theme",w),Ve("themeMode",w),Object.entries(r).forEach(([S,M])=>{S!=="mode"&&M&&Ve(S,M)});try{const S={};Object.entries(r).forEach(([M,$])=>{$&&(S[M]=$,M==="mode"&&(S.theme=$,S.themeMode=$))}),localStorage.setItem("themeData",JSON.stringify(S)),sessionStorage.setItem("themeData",JSON.stringify(S))}catch{}}},[r]);d.useEffect(()=>{i();const w=setInterval(i,3e4),O=()=>{document.visibilityState==="visible"&&i()},E=()=>{i()};return window.addEventListener("focus",E),document.addEventListener("visibilitychange",O),()=>{clearInterval(w),window.removeEventListener("focus",E),document.removeEventListener("visibilitychange",O)}},[i]);const o=d.useMemo(()=>window.location.hostname==="about.k-connect.ru",[]),s=d.useMemo(()=>window.location.hostname==="share.k-connect.ru",[]);d.useEffect(()=>{},[s]),d.useEffect(()=>{(()=>{const w=["like_playlist.jpg","all_tracks.jpg","random_tracks.jpg","album_placeholder.jpg","playlist_placeholder.jpg"];["/static/uploads/system","/uploads/system"].forEach(O=>{w.forEach(E=>{const A=`${O}/${E}`,S=new Image;S.src=A,S.onerror=()=>{}})})})()},[]);const l=w=>{if(r.mode==="dark"||r.mode==="contrast")return"#FFFFFF";if(!w||typeof w!="string")return"#000000";const O=w.charAt(0)==="#"?w.substring(1):w;return/^[0-9A-Fa-f]{6}$/.test(O)?(.299*parseInt(O.substr(0,2),16)+.587*parseInt(O.substr(2,2),16)+.114*parseInt(O.substr(4,2),16))/255>.6?"#000000":"#FFFFFF":"#000000"},u=async(w=!1)=>{try{if(w)return void x({background_color:"#131313",container_color:"#1A1A1A",header_color:"#1A1A1A",bottom_nav_color:"#1A1A1A",content_color:"#1A1A1A",welcome_bubble_color:"#131313",avatar_border_color:"#D0BCFF"});const O=await Mn.getSettings();O&&O.success&&O.settings&&x(O.settings)}catch{x({background_color:"#131313",container_color:"#1A1A1A",header_color:"#1A1A1A",bottom_nav_color:"#1A1A1A",content_color:"#1A1A1A",welcome_bubble_color:"#131313",avatar_border_color:"#D0BCFF"})}},x=w=>{const O=w.background_color||"#131313",E=w.container_color||"#1A1A1A",A=w.header_color||w.container_color||"#1A1A1A",S=w.bottom_nav_color||w.container_color||"#1A1A1A",M=w.content_color||w.container_color||"#1A1A1A",$=w.welcome_bubble_color||"#131313",Y=w.avatar_border_color||"#D0BCFF",U=l(O),K=l(E),R=l(A),J=l(M),H=l(S);v({backgroundColor:O,paperColor:E,headerColor:A,bottomNavColor:S,contentColor:M,primaryColor:Y,textColor:K,headerTextColor:R,contentTextColor:J,bottomNavTextColor:H,backgroundTextColor:U}),document.documentElement.style.setProperty("--background-color",O),document.documentElement.style.setProperty("--container-color",E),document.documentElement.style.setProperty("--header-color",A),document.documentElement.style.setProperty("--bottom-nav-color",S),document.documentElement.style.setProperty("--content-color",M),document.documentElement.style.setProperty("--welcome-bubble-color",$),document.documentElement.style.setProperty("--avatar-border-color",Y),document.documentElement.style.setProperty("--background-text-color",U),document.documentElement.style.setProperty("--container-text-color",K),document.documentElement.style.setProperty("--header-text-color",R),document.documentElement.style.setProperty("--content-text-color",J),document.documentElement.style.setProperty("--bottom-nav-text-color",H),document.documentElement.style.setProperty("--primary",Y),document.documentElement.style.setProperty("--primary-light",Y),document.documentElement.style.setProperty("--primary-dark",Y)},b=d.useContext(nt)||{};d.useEffect(()=>{b.isAuthenticated?u():b.loading||u(!0)},[b.isAuthenticated,b.loading]);const v=w=>{a(O=>{const E={...O,...w};return w.mode&&(Ve("theme",w.mode),Ve("themeMode",w.mode)),w.backgroundColor&&Ve("backgroundColor",w.backgroundColor),w.paperColor&&Ve("paperColor",w.paperColor),w.headerColor&&Ve("headerColor",w.headerColor),w.bottomNavColor&&Ve("bottomNavColor",w.bottomNavColor),w.contentColor&&Ve("contentColor",w.contentColor),w.primaryColor&&Ve("primaryColor",w.primaryColor),w.textColor&&Ve("textColor",w.textColor),E})},j=d.useMemo(()=>ec({palette:{mode:r.mode==="dark"?"dark":"light",primary:{main:r.primaryColor||"#D0BCFF",light:r.primaryColor||"#E9DDFF",dark:r.primaryColor||"#B69DF8"},secondary:{main:r.secondaryColor||"#f28c9a"},background:{default:r.backgroundColor||"#131313",paper:r.paperColor||"#1A1A1A"},text:{primary:r.textColor||(r.mode==="dark"?"#FFFFFF":"#121212"),secondary:r.mode==="dark"?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)"},header:{main:r.headerColor||r.paperColor||"#1A1A1A",contrastText:r.headerTextColor||(r.mode==="dark"?"#FFFFFF":"#121212")},bottomNav:{main:r.bottomNavColor||r.paperColor||"#1A1A1A",contrastText:r.bottomNavTextColor||(r.mode==="dark"?"#FFFFFF":"#121212")},content:{main:r.contentColor||r.paperColor||"#1A1A1A",contrastText:r.contentTextColor||(r.mode==="dark"?"#FFFFFF":"#121212")}},typography:{fontFamily:'"SF Pro Display", "Roboto", "Arial", sans-serif',h1:{fontSize:"2.5rem",fontWeight:700},h2:{fontSize:"2rem",fontWeight:700},h3:{fontSize:"1.8rem",fontWeight:600},h4:{fontSize:"1.5rem",fontWeight:600},h5:{fontSize:"1.2rem",fontWeight:500},h6:{fontSize:"1rem",fontWeight:500}},shape:{borderRadius:12},components:{MuiButton:{styleOverrides:{root:{borderRadius:"12px",textTransform:"none",fontWeight:500}}},MuiCssBaseline:{styleOverrides:{body:{lineHeight:1,backgroundColor:r.backgroundColor||"#131313",color:r.mode==="contrast"?"#FFFFFF":r.textColor||(r.mode==="light"?"#121212":"#FFFFFF"),"& *":r.mode==="contrast"?{color:"inherit"}:{}}}},MuiCard:{styleOverrides:{root:{borderRadius:"15px",overflow:"hidden",backgroundColor:r.contentColor||r.paperColor||"#1A1A1A",color:r.mode==="dark"||r.mode==="contrast"?"#FFFFFF":r.contentTextColor||l(r.contentColor||"#1A1A1A")}}},MuiPaper:{styleOverrides:{root:{borderRadius:"12px",backgroundColor:r.paperColor||"#1A1A1A",color:r.mode==="dark"||r.mode==="contrast"?"#FFFFFF":r.contentTextColor||l(r.paperColor||"#1A1A1A")}}},MuiAppBar:{styleOverrides:{root:{backgroundColor:r.headerColor||r.paperColor||"#1A1A1A",color:r.headerTextColor||l(r.headerColor||"#1A1A1A")}}},MuiBottomNavigation:{styleOverrides:{root:{backgroundColor:r.bottomNavColor||r.paperColor||"#1A1A1A"}}},MuiBottomNavigationAction:{styleOverrides:{root:{color:r.mode==="dark"||r.mode==="contrast"?"#FFFFFF":r.bottomNavTextColor||l(r.bottomNavColor||"#1A1A1A"),"&.Mui-selected":{color:r.primaryColor||"#D0BCFF"}},label:{color:"inherit","&.Mui-selected":{color:"inherit"}},iconOnly:{color:"inherit"}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:"10px","& fieldset":{borderColor:r.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},"&:hover fieldset":{borderColor:r.mode==="dark"?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.2)"},"&.Mui-focused fieldset":{borderColor:r.primaryColor||"#D0BCFF"}},"& .MuiInputLabel-root":{color:r.mode==="dark"?"rgba(255, 255, 255, 0.6)":"rgba(0, 0, 0, 0.6)","&.Mui-focused":{color:r.primaryColor||"#D0BCFF"}}}}}}}),[r]),[_,C]=d.useState(null),P=w=>C(w),D=()=>C(null);d.useEffect(()=>{_?(document.body.style.backgroundImage=`url(${_})`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center",document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundAttachment="scroll",document.body.classList.add("profile-background-active")):(document.body.style.backgroundImage="",document.body.style.backgroundSize="",document.body.style.backgroundPosition="",document.body.style.backgroundRepeat="",document.body.style.backgroundAttachment="",document.body.classList.remove("profile-background-active"))},[_]);const I=d.useMemo(()=>({themeSettings:r,updateThemeSettings:v,loadThemeSettings:u,setProfileBackground:P,clearProfileBackground:D,profileBackground:_}),[r,_]);return yt().pathname,s?null:o?n.jsx(pa,{FallbackComponent:tn,children:n.jsxs(qo,{theme:j,children:[n.jsx(Uo,{}),n.jsx(V,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"background.default"},children:n.jsxs(d.Suspense,{fallback:n.jsx(en,{}),children:[n.jsx(dr,{title:"\u041E K-Connect",description:"\u0418\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u043F\u043B\u0430\u0442\u0444\u043E\u0440\u043C\u0435 K-Connect - \u0441\u043E\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439 \u0441\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0439 \u0441\u0435\u0442\u0438 \u0441 \u0444\u0443\u043D\u043A\u0446\u0438\u044F\u043C\u0438 \u0434\u043B\u044F \u043E\u0431\u0449\u0435\u043D\u0438\u044F, \u043F\u0443\u0431\u043B\u0438\u043A\u0430\u0446\u0438\u0438 \u043F\u043E\u0441\u0442\u043E\u0432, \u043C\u0443\u0437\u044B\u043A\u0438 \u0438 \u043C\u043D\u043E\u0433\u043E\u0433\u043E \u0434\u0440\u0443\u0433\u043E\u0433\u043E.",image:"/icon-512.png",type:"website"}),n.jsx(Xr,{})]})})]})}):(d.useEffect(()=>{localStorage.setItem("themeMode",r.mode)},[r.mode]),d.useEffect(()=>{const w=localStorage.getItem("themeMode");w&&w!==r.mode&&v({mode:w})},[]),d.useEffect(()=>{const w=E=>{if(E.key&&(E.key==="theme"||E.key==="themeMode"||E.key==="backgroundColor"||E.key==="paperColor"||E.key==="headerColor"||E.key==="bottomNavColor"||E.key==="contentColor"||E.key==="primaryColor"||E.key==="textColor")){const A={};if(E.key==="theme"||E.key==="themeMode")A.mode=E.newValue;else{const S=E.key.charAt(0).toLowerCase()+E.key.slice(1);A[S]=E.newValue}a(S=>({...S,...A}))}};window.addEventListener("storage",w);const O=()=>{if(!sessionStorage.getItem("themeMode")&&localStorage.getItem("themeMode")){const E=localStorage.getItem("themeMode");sessionStorage.setItem("themeMode",E),sessionStorage.setItem("theme",E),["backgroundColor","paperColor","headerColor","bottomNavColor","contentColor","primaryColor","textColor"].forEach(A=>{const S=localStorage.getItem(A);S&&sessionStorage.setItem(A,S)}),v({mode:E})}};return window.addEventListener("focus",O),()=>{window.removeEventListener("storage",w),window.removeEventListener("focus",O)}},[]),d.useEffect(()=>{const w=()=>{const O=sessionStorage.getItem("themeMode")||localStorage.getItem("themeMode")||He("themeMode")||"dark";document.documentElement.setAttribute("data-theme",O),document.documentElement.classList.add(`theme-${O}`),document.querySelector("html").setAttribute("data-theme",O);let E=document.querySelector('meta[name="theme-color"]');E||(E=document.createElement("meta"),E.setAttribute("name","theme-color"),document.head.appendChild(E)),O==="light"?E.setAttribute("content","#ffffff"):O==="contrast"?E.setAttribute("content","#080808"):E.setAttribute("content","#131313");const A={backgroundColor:sessionStorage.getItem("backgroundColor")||localStorage.getItem("backgroundColor")||He("backgroundColor"),paperColor:sessionStorage.getItem("paperColor")||localStorage.getItem("paperColor")||He("paperColor"),headerColor:sessionStorage.getItem("headerColor")||localStorage.getItem("headerColor")||He("headerColor"),bottomNavColor:sessionStorage.getItem("bottomNavColor")||localStorage.getItem("bottomNavColor")||He("bottomNavColor"),contentColor:sessionStorage.getItem("contentColor")||localStorage.getItem("contentColor")||He("contentColor"),primaryColor:sessionStorage.getItem("primaryColor")||localStorage.getItem("primaryColor")||He("primaryColor"),textColor:sessionStorage.getItem("textColor")||localStorage.getItem("textColor")||He("textColor")};Object.entries(A).forEach(([S,M])=>{if(M){const $=S.replace(/([A-Z])/g,"-$1").toLowerCase();document.documentElement.style.setProperty(`--${$}`,M)}});try{const S=JSON.parse(localStorage.getItem("themeData")||sessionStorage.getItem("themeData")||"{}");Object.entries(S).forEach(([M,$])=>{if($&&M!=="mode"&&M!=="theme"&&M!=="themeMode"){const Y=M.replace(/([A-Z])/g,"-$1").toLowerCase();document.documentElement.style.setProperty(`--${Y}`,$)}})}catch{}};if(w(),document.readyState!=="complete")return window.addEventListener("load",w),()=>window.removeEventListener("load",w);w()},[]),n.jsx(cc,{children:n.jsx(Fn,{children:n.jsx(At.Provider,{value:I,children:n.jsxs(qo,{theme:j,children:[n.jsx(Uo,{}),r.mode==="contrast"&&n.jsx("style",{dangerouslySetInnerHTML:{__html:`
                  .MuiListItemText-primary, 
                  .MuiListItemText-secondary,
                  .MuiTypography-root,
                  .MuiInputBase-input,
                  .MuiInputLabel-root,
                  .MuiFormHelperText-root,
                  .MuiMenuItem-root,
                  .MuiButton-root,
                  .MuiLink-root:not(a),
                  .MuiChip-label,
                  .MuiTab-root,
                  .MuiTableCell-root,
                  [class*="css-"],
                  /* Additional text selectors */
                  span:not(.MuiIcon-root):not(.material-icons),
                  p,
                  h1, h2, h3, h4, h5, h6,
                  label,
                  div:not(.MuiAvatar-root):not(.MuiSwitch-thumb):not(.MuiSwitch-track):not([role="progressbar"]) {
                    color: #FFFFFF !important;
                  }
                  
                  .MuiChip-root.status-online *,
                  .MuiChip-root[color="success"] *,
                  .MuiChip-root[color="error"] *,
                  .MuiChip-root[color="warning"] *,
                  .MuiChip-root[color="info"] *,
                  a.MuiLink-root,
                  .MuiButton-containedPrimary,
                  .Mui-selected,
                  .MuiSwitch-thumb,
                  .MuiSwitch-track,
                  .MuiIcon-root,
                  .material-icons,
                  svg,
                  .MuiAvatar-root *,
                  img,
                  [role="progressbar"] * {
                    color: inherit !important;
                  }
                `}}),n.jsx(hi,{children:n.jsx(la,{children:n.jsx(da,{children:n.jsx(pa,{FallbackComponent:tn,children:n.jsx(V,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"background.default"},children:n.jsxs(d.Suspense,{fallback:n.jsx(en,{}),children:[n.jsx(pi,{}),n.jsxs(cr,{children:[n.jsx(q,{path:"/rules",element:n.jsx(bt,{})}),n.jsx(q,{path:"/privacy-policy",element:n.jsx(bt,{})}),n.jsx(q,{path:"/terms-of-service",element:n.jsx(bt,{})}),n.jsx(q,{path:"/about",element:n.jsx(bt,{})}),n.jsx(q,{path:"/cookies",element:n.jsx(bt,{})}),n.jsx(q,{path:"*",element:n.jsx(rn,{})})]}),n.jsx(Ks,{})]})})})})})})]})})})}))}let _r,He,Ve,Xe,kr;_r=(t,e,r=365)=>{try{const a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3),document.cookie=`${t}=${e};expires=${a.toUTCString()};path=/;SameSite=Lax`}catch{}},He=t=>{try{const e=t+"=",r=document.cookie.split(";");for(let a=0;a<r.length;a++){let i=r[a];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}}catch{}return null},Ve=(t,e)=>{try{if(localStorage.setItem(t,e),sessionStorage.setItem(t,e),_r(t,e,365),t==="themeMode"||t==="theme")document.documentElement.setAttribute("data-theme",e);else{const r=t.replace(/([A-Z])/g,"-$1").toLowerCase();document.documentElement.style.setProperty(`--${r}`,e)}try{const r=JSON.parse(localStorage.getItem("themeData")||"{}");r[t]=e,localStorage.setItem("themeData",JSON.stringify(r)),sessionStorage.setItem("themeData",JSON.stringify(r))}catch{}}catch{}},Xe={cache:new Map,get(t){const e=this.cache.get(t);return e?e.expiry&&e.expiry<Date.now()?(this.cache.delete(t),null):e.data:null},set(t,e,r=15){const a=r>0?Date.now()+1e3*r:null;this.cache.set(t,{data:e,expiry:a})},generateKey(t){const{url:e,method:r,params:a,data:i}=t;return`${r}:${e}:${JSON.stringify(a||{})}:${JSON.stringify(i||{})}`},clear(){this.cache.clear()},clearByUrlPrefix(t){for(const[e]of this.cache.entries()){const[r,a]=e.split(":");a&&a.startsWith(t)&&this.cache.delete(e)}},clearPostsCache(){const t=["/api/posts","/api/feed","/api/profile","/api/profile/posts","/api/profile/wall","/api/profile/pinned_post","/api/users","/api/reposts","/api/stories"];for(const e of t)this.clearByUrlPrefix(e)}},kr={requests:new Map,startRequest(t){const e=this.requests.get(t)||0;this.requests.set(t,e+1),this.updateGlobalState()},finishRequest(t){const e=this.requests.get(t)||1;e>1?this.requests.set(t,e-1):this.requests.delete(t),this.updateGlobalState()},updateGlobalState(){const t=this.requests.size>0;typeof window<"u"&&window.dispatchEvent(new CustomEvent("api-loading-changed",{detail:{isLoading:t,activeRequests:this.getActiveRequests()}}))},getActiveRequests(){return Array.from(this.requests.keys())}},vt=G.create({baseURL:"https://k-connect.ru",withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),G.defaults.withCredentials=!0;const fi=[{method:"post",urlPattern:"/api/posts/create"},{method:"put",urlPattern:"/api/posts"},{method:"post",urlPattern:"/api/post/new"},{method:"delete",urlPattern:"/api/posts/"},{method:"post",urlPattern:"/api/posts/delete/"},{method:"post",urlPattern:"/api/posts/*/like"},{method:"post",urlPattern:"/api/posts/*/dislike"},{method:"post",urlPattern:"/api/comments/create"},{method:"post",urlPattern:"/api/comments/*/like"},{method:"post",urlPattern:"/api/posts/*/edit"}];vt.interceptors.request.use(t=>{if(t.requestId=Math.random().toString(36).substring(2,9),t.method==="get"&&t.cache!==!1){if(t.url&&(t.url.includes("/api/posts")||t.url.includes("/api/feed")||t.url.includes("/api/profile/posts")||t.url.includes("/api/profile/wall")||t.url.includes("/api/profile/pinned_post")))return t.cache=!1,t;const r=Xe.generateKey(t),a=Xe.get(r),i=t.forceRefresh===!0;if(a&&!i){const o=G.CancelToken.source();return setTimeout(()=>{o.cancel(JSON.stringify({status:200,data:a,fromCache:!0}))},0),t.cancelToken=o.token,t}t._cacheKey=r}if(t.method!=="get"){const r=t.url||"";for(const a of fi)if(t.method===a.method&&(r.includes(a.urlPattern)||r.match(new RegExp(a.urlPattern.replace("*",".*"))))){t._invalidatesCache=!0;break}}const e=t.url?.split("?")[0]||"unknown";return kr.startRequest(e),t},t=>Promise.reject(t)),vt.interceptors.response.use(t=>{const e=t.config.url?.split("?")[0]||"unknown";return kr.finishRequest(e),t.config._invalidatesCache&&(Xe.clearPostsCache(),typeof window<"u"&&window.dispatchEvent(new CustomEvent("data-updated",{detail:{url:t.config.url,method:t.config.method}}))),t.config.method==="get"&&t.config._cacheKey&&t.status===200&&Xe.set(t.config._cacheKey,t.data,15),t},async t=>{if(G.isCancel(t)&&t.message)try{const r=JSON.parse(t.message);if(r.fromCache)return{...r,status:200,statusText:"OK",headers:{},config:t.config,fromCache:!0}}catch{}let e=t.config;if(e&&e.url){const r=e.url?.split("?")[0]||"unknown";kr.finishRequest(r)}if(t.response){if(t.response.status===401&&window.dispatchEvent(new CustomEvent("auth-error",{detail:{message:"\u0421\u0435\u0441\u0441\u0438\u044F \u0438\u0441\u0442\u0435\u043A\u043B\u0430",shortMessage:"\u0412\u043E\u0439\u0434\u0438\u0442\u0435 \u0441\u043D\u043E\u0432\u0430",notificationType:"error",animationType:"pill"}})),t.response.status===429&&window.dispatchEvent(new CustomEvent("rate-limit-error",{detail:{message:"\u041B\u0438\u043C\u0438\u0442 \u0437\u0430\u043F\u0440\u043E\u0441\u043E\u0432 \u043F\u0440\u0435\u0432\u044B\u0448\u0435\u043D",shortMessage:"\u041F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435",notificationType:"warning",animationType:"bounce",retryAfter:t.response.headers["retry-after"]}})),[500,502,503,504].includes(t.response.status)&&e&&!e._retryCount&&(e._retryCount=e._retryCount||0,e._retryCount<2)){e._retryCount++;const r=1e3*Math.pow(2,e._retryCount-1);return window.dispatchEvent(new CustomEvent("api-retry",{detail:{url:e.url,attempt:e._retryCount,delay:r,message:"\u041F\u043E\u0432\u0442\u043E\u0440\u043D\u043E\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435",shortMessage:`\u041F\u043E\u043F\u044B\u0442\u043A\u0430 ${e._retryCount}`,notificationType:"info",animationType:"pulse"}})),await new Promise(a=>setTimeout(a,r)),vt(e)}}else t.request&&window.dispatchEvent(new CustomEvent("network-error",{detail:{message:"\u041F\u0440\u043E\u0431\u043B\u0435\u043C\u0430 \u0441 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435\u043C",shortMessage:"\u041D\u0435\u0442 \u0441\u0435\u0442\u0438",notificationType:"error",animationType:"drop"}}));return Promise.reject(t)}),vt.cache={clear:Xe.clear.bind(Xe),clearByUrlPrefix:Xe.clearByUrlPrefix.bind(Xe),clearPostsCache:Xe.clearPostsCache.bind(Xe)},vt.helpers={async loadData(t,e,r){try{return(await vt(t)).data}catch(a){if(r)r(a);else{let i="\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0434\u0430\u043D\u043D\u044B\u0445",o="\u041E\u0448\u0438\u0431\u043A\u0430",s="error",l="pill";if(a.response)switch(a.response.status){case 400:i="\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0437\u0430\u043F\u0440\u043E\u0441",o="\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u043F\u0440\u043E\u0441\u0430";break;case 401:i="\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u044F",o="\u0412\u043E\u0439\u0434\u0438\u0442\u0435";break;case 403:i="\u0414\u043E\u0441\u0442\u0443\u043F \u0437\u0430\u043F\u0440\u0435\u0449\u0435\u043D",o="\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u0430";break;case 404:i="\u0420\u0435\u0441\u0443\u0440\u0441 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D",o="\u041D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E";break;case 429:i="\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043B\u0438\u043C\u0438\u0442 \u0437\u0430\u043F\u0440\u043E\u0441\u043E\u0432",o="\u041F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435",s="warning",l="bounce";break;case 500:i="\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",o="\u0421\u0435\u0440\u0432\u0435\u0440 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D"}else a.request&&(i="\u041D\u0435\u0442 \u043E\u0442\u0432\u0435\u0442\u0430 \u043E\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",o="\u041D\u0435\u0442 \u0441\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u044F",l="drop");window.dispatchEvent(new CustomEvent("show-error",{detail:{message:i,shortMessage:o,notificationType:s,animationType:l}}))}throw a}}};var go,Ut={};function gi(){if(go)return Ut;go=1;var t=Ie();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var e=t(je()),r=Te();return Ut.default=(0,e.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),Ut}_n=ke(gi());var xo,Jt={};function xi(){if(xo)return Jt;xo=1;var t=Ie();Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.default=void 0;var e=t(je()),r=Te();return Jt.default=(0,e.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),Jt}fn=ke(xi());var yo,Kt={};function yi(){if(yo)return Kt;yo=1;var t=Ie();Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.default=void 0;var e=t(je()),r=Te();return Kt.default=(0,e.default)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),Kt}jn=ke(yi());var vo,Gt={};function vi(){if(vo)return Gt;vo=1;var t=Ie();Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.default=void 0;var e=t(je()),r=Te();return Gt.default=(0,e.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),Gt}An=ke(vi());var bo,Yt={};function bi(){if(bo)return Yt;bo=1;var t=Ie();Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.default=void 0;var e=t(je()),r=Te();return Yt.default=(0,e.default)((0,r.jsx)("path",{d:"M22.99 9C19.15 5.16 13.8 3.76 8.84 4.78l2.52 2.52c3.47-.17 6.99 1.05 9.63 3.7zm-4 4c-1.29-1.29-2.84-2.13-4.49-2.56l3.53 3.53zM2 3.05 5.07 6.1C3.6 6.82 2.22 7.78 1 9l1.99 2c1.24-1.24 2.67-2.16 4.2-2.77l2.24 2.24C7.81 10.89 6.27 11.73 5 13v.01L6.99 15c1.36-1.36 3.14-2.04 4.92-2.06L18.98 20l1.27-1.26L3.29 1.79zM9 17l3 3 3-3c-1.65-1.66-4.34-1.66-6 0"}),"WifiOff"),Yt}const wi=ke(bi());var wo,Zt={};function ji(){if(wo)return Zt;wo=1;var t=Ie();Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.default=void 0;var e=t(je()),r=Te();return Zt.default=(0,e.default)((0,r.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),Zt}yn=ke(ji());var jo,Qt={};function _i(){if(jo)return Qt;jo=1;var t=Ie();Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.default=void 0;var e=t(je()),r=Te();return Qt.default=(0,e.default)((0,r.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications"),Qt}Er=ke(_i());var _o,Xt={};function ki(){if(_o)return Xt;_o=1;var t=Ie();Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.default=void 0;var e=t(je()),r=Te();return Xt.default=(0,e.default)((0,r.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),Xt}gn=ke(ki());var ko,er={};function Ci(){if(ko)return er;ko=1;var t=Ie();Object.defineProperty(er,"__esModule",{value:!0}),er.default=void 0;var e=t(je()),r=Te();return er.default=(0,e.default)((0,r.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2"}),"ChatBubble"),er}In=ke(Ci());var Co,tr={};function Si(){if(Co)return tr;Co=1;var t=Ie();Object.defineProperty(tr,"__esModule",{value:!0}),tr.default=void 0;var e=t(je()),r=Te();return tr.default=(0,e.default)((0,r.jsx)("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2z"}),"Repeat"),tr}wn=ke(Si());var So,rr={};function Ei(){if(So)return rr;So=1;var t=Ie();Object.defineProperty(rr,"__esModule",{value:!0}),rr.default=void 0;var e=t(je()),r=Te();return rr.default=(0,e.default)([(0,r.jsx)("path",{d:"M17 19.22H5V7h7V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-7h-2z"},"0"),(0,r.jsx)("path",{d:"M19 2h-2v3h-3c.01.01 0 2 0 2h3v2.99c.01.01 2 0 2 0V7h3V5h-3zM7 9h8v2H7zm0 3v2h8v-2h-3zm0 3h8v2H7z"},"1")],"PostAdd"),rr}En=ke(Ei());var Eo,nr={};function Ii(){if(Eo)return nr;Eo=1;var t=Ie();Object.defineProperty(nr,"__esModule",{value:!0}),nr.default=void 0;var e=t(je()),r=Te();return nr.default=(0,e.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16"}),"MonetizationOn"),nr}Cn=ke(Ii());var Io,ar={};function Ti(){if(Io)return ar;Io=1;var t=Ie();Object.defineProperty(ar,"__esModule",{value:!0}),ar.default=void 0;var e=t(je()),r=Te();return ar.default=(0,e.default)((0,r.jsx)("path",{d:"m5.2494 8.0688 2.83-2.8269 14.1343 14.15-2.83 2.8269zm4.2363-4.2415 2.828-2.8289 5.6577 5.656-2.828 2.8289zM.9989 12.3147l2.8284-2.8285 5.6569 5.6569-2.8285 2.8284zM1 21h12v2H1z"}),"Gavel"),ar}xn=ke(Ti());var To,or={};function Ai(){if(To)return or;To=1;var t=Ie();Object.defineProperty(or,"__esModule",{value:!0}),or.default=void 0;var e=t(je()),r=Te();return or.default=(0,e.default)((0,r.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 12H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Message"),or}vn=ke(Ai());var Ao,sr={};function Mi(){if(Ao)return sr;Ao=1;var t=Ie();Object.defineProperty(sr,"__esModule",{value:!0}),sr.default=void 0;var e=t(je()),r=Te();return sr.default=(0,e.default)((0,r.jsx)("path",{d:"M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2M5 8V7h2v3.82C5.84 10.4 5 9.3 5 8m14 0c0 1.3-.84 2.4-2 2.82V7h2z"}),"EmojiEvents"),sr}let Mo,Po,Oo,Ro,Fo,zo,Do,Lo,No;kn=ke(Mi()),Sn={width:24,height:24,body:'<g fill="currentColor"><path fill-rule="evenodd" d="M20.41 9.86a2.822 2.822 0 0 0-.175-.003H17.8c-1.992 0-3.698 1.581-3.698 3.643s1.706 3.643 3.699 3.643h2.433c.061 0 .12 0 .175-.004a1.698 1.698 0 0 0 1.586-1.581c.004-.059.004-.122.004-.18v-3.756c0-.058 0-.121-.004-.18a1.698 1.698 0 0 0-1.585-1.581Zm-2.823 4.611c.513 0 .93-.434.93-.971c0-.537-.417-.971-.93-.971c-.513 0-.929.434-.929.971c0 .537.416.971.93.971Z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M20.234 18.6a.214.214 0 0 1 .214.27c-.194.692-.501 1.282-.994 1.778c-.721.727-1.636 1.05-2.766 1.203c-1.098.149-2.5.149-4.272.149h-2.037c-1.771 0-3.174 0-4.272-.149c-1.13-.153-2.045-.476-2.766-1.203C2.62 19.922 2.3 19 2.148 17.861C2 16.754 2 15.34 2 13.555v-.11c0-1.785 0-3.2.148-4.306C2.3 8 2.62 7.08 3.34 6.351c.721-.726 1.636-1.05 2.766-1.202C7.205 5 8.608 5 10.379 5h2.037c1.771 0 3.174 0 4.272.149c1.13.153 2.045.476 2.766 1.202c.493.497.8 1.087.994 1.78a.214.214 0 0 1-.214.269h-2.433c-2.734 0-5.143 2.177-5.143 5.1c0 2.923 2.41 5.1 5.144 5.1h2.432ZM5.614 8.886a.725.725 0 0 0-.722.728c0 .403.323.729.722.729H9.47c.4 0 .723-.326.723-.729a.726.726 0 0 0-.723-.728H5.614Z" clip-rule="evenodd"/><path d="m7.777 4.024l1.958-1.443a2.969 2.969 0 0 1 3.53 0l1.969 1.451C14.41 4 13.49 4 12.483 4h-2.17c-.922 0-1.769 0-2.536.024Z"/></g>'},Mo=Tt`
  0% { width: 100px; border-radius: 50px; opacity: 0; transform: translateY(-20px) scale(0.8); }
  20% { opacity: 1; transform: translateY(0) scale(1); }
  80% { width: 300px; border-radius: 24px; }
  100% { width: 300px; border-radius: 24px; }
`,Po=Tt`
  0% { width: 300px; border-radius: 24px; opacity: 1; }
  20% { width: 250px; border-radius: 30px; opacity: 0.9; }
  80% { width: 100px; border-radius: 50px; opacity: 0.3; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-20px) scale(0.8); }
`,Oo=Tt`
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
`,Ro=Tt`
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-10px); }
  60% { transform: translateY(-5px); }
`,Fo=Tt`
  0% { transform: translateY(-50px); opacity: 0; }
  50% { transform: translateY(10px); opacity: 1; }
  70% { transform: translateY(-5px); }
  100% { transform: translateY(0); opacity: 1; }
`,zo=xe(V,{shouldForwardProp:t=>t!=="isVisible"&&t!=="animationType"})(({theme:t,isVisible:e,animationType:r})=>{let a="";return r==="pulse"&&(a=`${Oo} 2s infinite`),r==="bounce"&&(a=`${Ro} 2s infinite`),r==="drop"&&(a=`${Fo} 0.5s forwards`),{position:"fixed",top:20,left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(20, 20, 22, 0.95)",backdropFilter:"blur(10px)",color:"white",padding:"10px 16px",borderRadius:"24px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,boxShadow:"0 4px 30px rgba(0, 0, 0, 0.3)",animation:e?`${Mo} 0.5s forwards`:`${Po} 0.5s forwards`,overflow:"hidden",width:"300px",border:"1px solid rgba(255, 255, 255, 0.1)","& .animation-wrapper":{animation:a,display:"flex",alignItems:"center",width:"100%",minWidth:0},"& .notification-bg-icon":{position:"absolute",right:20,top:"50%",transform:"translateY(-50%) rotate(-15deg)",fontSize:"3rem",opacity:.3,color:t.palette.primary.main,pointerEvents:"none",filter:"blur(2px)","& svg":{filter:`drop-shadow(0 0 8px ${we(t.palette.primary.main,.6)})`}}}}),Do=xe(V)(({theme:t,notificationType:e})=>{const r={success:"#4caf50",error:"#ff5252",warning:"#fb8c00",info:"#2196f3",notification:"#D0BCFF"};return{display:"flex",alignItems:"center",justifyContent:"center",marginRight:12,color:r[e]||r.info,"& svg":{fontSize:20}}}),Lo=xe(V)({flex:1,display:"flex",flexDirection:"column",minWidth:0,overflow:"hidden"}),No=t=>{switch(t){case"comment_like":case"reply_like":case"post_like":return n.jsx(gn,{sx:{fontSize:"3rem"}});case"comment":case"reply":return n.jsx(In,{sx:{fontSize:"3rem"}});case"follow":return n.jsx(bn,{sx:{fontSize:"3rem"}});case"repost":return n.jsx(wn,{sx:{fontSize:"3rem"}});case"wall_post":return n.jsx(En,{sx:{fontSize:"3rem"}});case"points_transfer":return n.jsx(Ze,{icon:Sn,width:"3rem",height:"3rem"});case"badge_purchase":case"username_auction_bid":case"username_bid_accepted":case"username_auction_outbid":case"username_auction_sold":case"username_auction_won":case"username_auction_cancelled":case"username_auction_bid_increased":case"auction_win":case"auction_sold":case"auction_refund":case"new_auction_bid":return n.jsx(Cn,{sx:{fontSize:"3rem"}});case"moderation":case"ban":case"unban":case"warning":return n.jsx(xn,{sx:{fontSize:"3rem"}});case"mention":return n.jsx(vn,{sx:{fontSize:"3rem"}});case"medal":return n.jsx(kn,{sx:{fontSize:"3rem"}});default:return n.jsx(Er,{sx:{fontSize:"3rem"}})}},mn=({open:t=!1,message:e="",shortMessage:r="",notificationType:a="info",animationType:i="pill",autoHideDuration:o=3e3,onClose:s=()=>{},icon:l=null,notificationData:u=null})=>{const[x,b]=d.useState(!1);return d.useEffect(()=>{if(t){b(!0);const v=setTimeout(()=>{b(!1),setTimeout(()=>{s()},500)},o);return()=>clearTimeout(v)}},[t,o,s]),t||x?n.jsxs(zo,{isVisible:x,animationType:i,children:[n.jsxs("div",{className:"animation-wrapper",children:[n.jsx(Do,{notificationType:a,children:(()=>{if(l)return l;switch(a){case"success":return n.jsx(_n,{});case"error":return a==="network"?n.jsx(wi,{}):n.jsx(fn,{});case"warning":return n.jsx(jn,{});case"auth":return n.jsx(yn,{});case"notification":return n.jsx(Er,{});default:return n.jsx(An,{})}})()}),x&&n.jsxs(Lo,{children:[n.jsx(oe,{variant:"subtitle2",sx:{fontWeight:"bold",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r||e}),r&&e&&r!==e&&n.jsx(oe,{variant:"caption",sx:{opacity:.7,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e})]})]}),n.jsx(V,{className:"notification-bg-icon",children:No(u?u.type:"default")})]}):null};class Pi extends d.Component{constructor(r){super(r);lt(this,"handleAuthError",r=>{const{message:a,shortMessage:i="\u0421\u0435\u0441\u0441\u0438\u044F \u0438\u0441\u0442\u0435\u043A\u043B\u0430",notificationType:o="auth",animationType:s="pill"}=r.detail;this.addNotification({id:Date.now(),type:"error",message:a||"\u0421\u0435\u0441\u0441\u0438\u044F \u0438\u0441\u0442\u0435\u043A\u043B\u0430, \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u043E\u0439\u0434\u0438\u0442\u0435 \u0441\u043D\u043E\u0432\u0430",shortMessage:i,notificationType:o,animationType:s,action:"redirect",actionLabel:"\u0412\u043E\u0439\u0442\u0438",actionUrl:"/login"})});lt(this,"handleNetworkError",r=>{const{message:a,shortMessage:i="\u041D\u0435\u0442 \u0441\u0435\u0442\u0438",notificationType:o="error",animationType:s="drop"}=r.detail;this.addNotification({id:Date.now(),type:"warning",message:a||"\u041F\u0440\u043E\u0431\u043B\u0435\u043C\u0430 \u0441 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435\u043C \u043A \u0441\u0435\u0440\u0432\u0435\u0440\u0443",shortMessage:i,notificationType:o,animationType:s,action:"retry",actionLabel:"\u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u044C"})});lt(this,"handleRateLimitError",r=>{const{message:a,shortMessage:i="\u041F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435",notificationType:o="warning",animationType:s="bounce",retryAfter:l}=r.detail;this.addNotification({id:Date.now(),type:"info",message:a||"\u0421\u043B\u0438\u0448\u043A\u043E\u043C \u043C\u043D\u043E\u0433\u043E \u0437\u0430\u043F\u0440\u043E\u0441\u043E\u0432, \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u0434\u043E\u0436\u0434\u0438\u0442\u0435",shortMessage:i,notificationType:o,animationType:s,autoHide:!0,hideAfter:5e3})});lt(this,"handleShowError",r=>{const{message:a,shortMessage:i="\u041E\u0448\u0438\u0431\u043A\u0430",notificationType:o="error",animationType:s="pill"}=r.detail;this.addNotification({id:Date.now(),type:"error",message:a||"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430",shortMessage:i,notificationType:o,animationType:s,autoHide:!0,hideAfter:5e3})});lt(this,"handleApiRetry",r=>{const{url:a,attempt:i,delay:o,message:s,shortMessage:l=`\u041F\u043E\u043F\u044B\u0442\u043A\u0430 ${i||1}`,notificationType:u="info",animationType:x="pulse"}=r.detail;this.addNotification({id:Date.now(),type:"info",message:s||`\u041F\u043E\u0432\u0442\u043E\u0440\u043D\u0430\u044F \u043F\u043E\u043F\u044B\u0442\u043A\u0430 ${i||1}`,shortMessage:l,notificationType:u,animationType:x,autoHide:!0,hideAfter:3e3})});lt(this,"addNotification",r=>{this.setState(a=>({notifications:[...a.notifications,r]})),r.autoHide&&setTimeout(()=>{this.removeNotification(r.id)},r.hideAfter||5e3)});lt(this,"removeNotification",r=>{this.setState(a=>({notifications:a.notifications.filter(i=>i.id!==r)}))});lt(this,"handleNotificationAction",r=>{r.action==="redirect"&&r.actionUrl?window.location.href=r.actionUrl:r.action==="retry"?window.location.reload():r.onAction&&r.onAction(),this.removeNotification(r.id)});this.state={hasError:!1,error:null,errorInfo:null,notifications:[]}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){this.setState({errorInfo:a})}componentDidMount(){window.addEventListener("auth-error",this.handleAuthError),window.addEventListener("network-error",this.handleNetworkError),window.addEventListener("rate-limit-error",this.handleRateLimitError),window.addEventListener("show-error",this.handleShowError),window.addEventListener("api-retry",this.handleApiRetry)}componentWillUnmount(){window.removeEventListener("auth-error",this.handleAuthError),window.removeEventListener("network-error",this.handleNetworkError),window.removeEventListener("rate-limit-error",this.handleRateLimitError),window.removeEventListener("show-error",this.handleShowError),window.removeEventListener("api-retry",this.handleApiRetry)}render(){const{hasError:r,error:a,errorInfo:i,notifications:o}=this.state,{children:s,fallback:l}=this.props;return r&&l?l(a,i):r?n.jsxs("div",{className:"error-boundary",children:[n.jsx("h2",{children:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A :("}),n.jsx("p",{children:"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0438 \u044D\u0442\u043E\u0433\u043E \u0440\u0430\u0437\u0434\u0435\u043B\u0430."}),n.jsx("button",{onClick:()=>window.location.reload(),className:"error-boundary-button",children:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443"}),!1,n.jsx("style",{jsx:!0,children:`
            .error-boundary {
              padding: 20px;
              margin: 20px;
              border: 1px solid #f5c6cb;
              border-radius: 4px;
              background-color: #f8d7da;
              color: #721c24;
              text-align: center;
            }
            
            .error-boundary-button {
              padding: 8px 16px;
              background-color: #dc3545;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              margin-top: 10px;
            }
            
            .error-details {
              margin-top: 20px;
              text-align: left;
              background-color: #f8f9fa;
              padding: 10px;
              border-radius: 4px;
            }
            
            .error-details pre {
              overflow: auto;
              margin: 10px 0;
              padding: 10px;
              background-color: #f1f1f1;
              border-radius: 4px;
              font-size: 12px;
            }
          `})]}):n.jsxs(n.Fragment,{children:[s,o.length>0&&n.jsx(n.Fragment,{children:o.map((u,x)=>n.jsx(mn,{open:!0,message:u.message,shortMessage:u.shortMessage,notificationType:u.notificationType,animationType:u.animationType,autoHideDuration:u.hideAfter||5e3,onClose:()=>{u.action?this.handleNotificationAction(u):this.removeNotification(u.id)}},u.id))})]})}}const Oi=()=>{const{isLoading:t}=function(){const[i,o]=d.useState(!1),[s,l]=d.useState([]);return d.useEffect(()=>{const u=x=>{o(x.detail.isLoading),l(x.detail.activeRequests||[])};return window.addEventListener("api-loading-changed",u),()=>{window.removeEventListener("api-loading-changed",u)}},[]),{isLoading:i,activeRequests:s}}(),[e,r]=d.useState(!1),a=ot();return d.useEffect(()=>{let i;return t?i=setTimeout(()=>{r(!0)},300):r(!1),()=>{clearTimeout(i)}},[t]),e?n.jsxs("div",{className:"global-loading-indicator",children:[n.jsx("div",{className:"loading-spinner"}),n.jsx("style",{jsx:!0,children:`
        .global-loading-indicator {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          height: 3px;
          z-index: 9999;
          background-color: rgba(0, 0, 0, 0.1);
          overflow: hidden;
        }
        
        .loading-spinner {
          position: absolute;
          top: 0;
          left: 0;
          height: 100%;
          background: ${a.palette.primary.main};
          width: 20%;
          animation: loadingAnimation 1.5s infinite ease-in-out;
        }
        
        @keyframes loadingAnimation {
          0% {
            left: -20%;
          }
          50% {
            left: 40%;
          }
          100% {
            left: 100%;
          }
        }
      `})]}):null};(()=>{(async()=>{try{if("caches"in window){const a=await caches.keys();await Promise.all(a.map(i=>caches.delete(i)))}try{const a=(await ur()).transaction(Qe,"readwrite").objectStore(Qe).index("timestamp"),i=Date.now()-Tr,o=IDBKeyRange.upperBound(i);a.openCursor(o).onsuccess=s=>{const l=s.target.result;l&&(l.delete(),l.continue())}}catch{}localStorage.clear(),sessionStorage.clear()}catch{}})();const t=document.createElement("meta");t.httpEquiv="Cache-Control",t.content="no-cache, no-store, must-revalidate",document.head.appendChild(t);const e=document.createElement("meta");e.httpEquiv="Pragma",e.content="no-cache",document.head.appendChild(e);const r=document.createElement("meta");r.httpEquiv="Expires",r.content="0",document.head.appendChild(r),(()=>{const a=window.fetch;window.fetch=async function(i,o={}){const s=i instanceof Request?i.url:i;if(o.method&&o.method!=="GET"||!pr(s))return a(i,o);try{const l=await Ar(s);if(l)return l;const u=await a(i,o);return u&&u.ok&&(async(x,b)=>{if(pr(x))try{const v=await ur(),j=b.clone(),_={};j.headers.forEach((w,O)=>{_[O]=w});const C=await j.blob();if(C.size>5242880)return;const P=v.transaction(Qe,"readwrite"),D=P.objectStore(Qe),I={url:x,data:C,timestamp:Date.now(),headers:_,status:j.status,statusText:j.statusText};D.put(I),P.oncomplete=()=>{},P.onerror=w=>{}}catch{}})(s,u.clone()),u}catch(l){try{const u=await Ar(s);if(u)return u}catch{}throw l}}})()})(),async function(){try{if("serviceWorker"in navigator){const r=await navigator.serviceWorker.getRegistrations();for(const a of r)try{const i=a.active;if(i&&(i.scriptURL||"").includes("service-worker.js"))continue;await a.unregister()}catch{}}const t=window.fetch;window.fetch=function(r,a={}){const i=r instanceof Request?r.url:r;if(typeof i=="string"&&i.includes("/assets/"))return t(r,a);if(a.headers||(a.headers={}),a.headers instanceof Headers){const o={};for(const[s,l]of a.headers.entries())o[s]=l;a.headers=o}return a.headers["Cache-Control"]="no-cache, no-store, must-revalidate",a.headers.Pragma="no-cache",a.headers.Expires="0",t(r,a)};const e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(r,a,...i){if(typeof a=="string"&&a.includes("/assets/"))return void e.call(this,r,a,...i);this.setRequestHeader=this.setRequestHeader||function(){},e.call(this,r,a,...i);const o=this.setRequestHeader;this.setRequestHeader=function(s,l){s!=="Cache-Control"&&s!=="Pragma"&&s!=="Expires"&&o.call(this,s,l)};try{this.setRequestHeader("Cache-Control","no-cache, no-store, must-revalidate"),this.setRequestHeader("Pragma","no-cache"),this.setRequestHeader("Expires","0")}catch{}}}catch{}}().then(()=>{const t=document.getElementById("root");kt.createRoot(t).render(n.jsx(We.StrictMode,{children:n.jsxs(Pi,{children:[n.jsx(Oi,{}),n.jsx(rc,{children:n.jsx(mi,{})})]})}))})});export{nt as A,hn as C,mn as D,fn as E,gn as F,xn as G,Ze as I,yn as L,vn as M,Er as N,bn as P,wn as R,dr as S,At as T,jn as W,lc as __tla,Mt as a,_n as b,kn as c,Cn as d,Sn as e,En as f,In as g,Tn as h,vt as i,Jo as j,Ir as k,An as l,Ko as m,Mn as n,Go as o,Yo as p,Pn as q,je as r,On as s,Rn as u};
