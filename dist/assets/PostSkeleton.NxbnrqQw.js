import{g as Y}from"./vendor-react.DF-_cTkv.js";import{r as Z,a as ee,j as e,s as b,E as te,T as R,w as v,ak as _,i as n,I as B,al as ae,v as re,H as se,q as ie,o as ne,am as D,O as oe,a7 as le,k as de,an as ce,ao as xe,U as he,ap as me,aq as ue,ar as pe,J as ge,l as q,D as be,m as je,t as fe,Q as ye,d as $,b as ve,p as we,S as l,C as ke}from"./vendor-mui.08p3AH88.js";import{r as Ce,u as Se}from"./index.CdVNWeFt.js";import{r as d,a as V}from"./vendor-router.BRqU_Zs2.js";var F,j={};function We(){if(F)return j;F=1;var a=Z();Object.defineProperty(j,"__esModule",{value:!0}),j.default=void 0;var x=a(Ce()),w=ee();return j.default=(0,x.default)((0,w.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-4.86 8.86-3 3.87L9 13.14 6 17h12z"}),"ImageOutlined"),j}const Te=Y(We()),ze=b(be)(({theme:a})=>({"& .MuiDialog-paper":{borderRadius:16,background:"rgba(18, 18, 22, 0.95)",backdropFilter:"blur(30px)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.08)",width:"100%",maxWidth:500,maxHeight:"80vh",[a.breakpoints.down("sm")]:{width:"100%",maxWidth:"100%",margin:0,borderRadius:0}}})),J=b(fe)(({theme:a})=>({textTransform:"none",fontSize:"0.9rem",fontWeight:"normal",minWidth:100,"&.Mui-selected":{fontWeight:"medium",color:a.palette.primary.main}})),Re=b(ye)(({theme:a,selected:x})=>({borderRadius:8,marginBottom:8,backgroundColor:x?$(a.palette.primary.main,.1):"rgba(255, 255, 255, 0.03)",transition:"all 0.2s ease","&:hover":{backgroundColor:x?$(a.palette.primary.main,.15):"rgba(255, 255, 255, 0.05)"},border:x?`1px solid ${$(a.palette.primary.main,.3)}`:"1px solid rgba(255, 255, 255, 0.05)"})),$e=b(je)(({theme:a})=>({"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)",borderRadius:8,"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:a.palette.primary.main,borderWidth:1}}})),Ie=({open:a,onClose:x,onSelectTracks:w,maxTracks:I=3})=>{const[h,K]=d.useState([]),[k,N]=d.useState(0),[m,M]=d.useState(""),[Q,L]=d.useState(!1),[U,u]=d.useState([]),[f,C]=d.useState(null),[S,W]=d.useState(!1),c=V.useRef(new Audio),A=V.useRef(""),{tracks:T,likedTracks:X,isLoading:G,searchTracks:O}=Se(),y=()=>{c.current&&(c.current.pause(),c.current.src="",W(!1))},P=d.useCallback((()=>{let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>(async i=>{if(i.trim()){if(i===A.current)return;A.current=i,L(!0);try{const o=T.filter(r=>r.title.toLowerCase().includes(i.toLowerCase())||r.artist.toLowerCase().includes(i.toLowerCase()));if(o.length>=5)u(o);else try{const r=await O(i);r&&Array.isArray(r)?u(r):u(o)}catch{u(o)}}catch{u([])}finally{L(!1)}}else u([])})(...s),300)}})(),[T,O]);d.useEffect(()=>{P(m)},[m,P]);const E=t=>{K(s=>s.some(i=>i.id===t.id)?s.filter(i=>i.id!==t.id):s.length>=I?[...s.slice(1),t]:[...s,t])};d.useEffect(()=>{const t=()=>{document.hidden&&y()};return document.addEventListener("visibilitychange",t),()=>{y(),document.removeEventListener("visibilitychange",t)}},[]);const z=()=>{y(),C(null),x()},H=m.trim()?U:k===0?T:X;return e.jsxs(ze,{open:a,onClose:z,maxWidth:"md",fullWidth:!0,children:[e.jsxs(te,{sx:{textAlign:"center",pt:3,pb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(R,{variant:"h6",component:"div",sx:{fontWeight:"medium"},children:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043C\u0443\u0437\u044B\u043A\u0443"}),e.jsx(v,{edge:"end",color:"inherit",onClick:z,"aria-label":"close",children:e.jsx(_,{})})]}),e.jsx(n,{sx:{px:3},children:e.jsx($e,{fullWidth:!0,placeholder:"\u041F\u043E\u0438\u0441\u043A \u0442\u0440\u0435\u043A\u043E\u0432...",value:m,onChange:t=>{M(t.target.value)},variant:"outlined",size:"small",InputProps:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(ae,{fontSize:"small"})}),endAdornment:m&&e.jsx(B,{position:"end",children:e.jsx(v,{size:"small",onClick:()=>M(""),edge:"end",children:e.jsx(_,{fontSize:"small"})})})},sx:{mb:2}})}),!m&&e.jsxs(re,{value:k,onChange:(t,s)=>{N(s)},variant:"fullWidth",textColor:"primary",indicatorColor:"primary",sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.08)"},children:[e.jsx(J,{label:"\u0412\u0441\u0435 \u0442\u0440\u0435\u043A\u0438"}),e.jsx(J,{label:"\u041B\u044E\u0431\u0438\u043C\u044B\u0435"})]}),e.jsxs(se,{sx:{py:2},children:[h.length>0&&e.jsxs(n,{sx:{mb:2},children:[e.jsxs(R,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["\u0412\u044B\u0431\u0440\u0430\u043D\u043E (",h.length,"/",I,"):"]}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:h.map(t=>e.jsx(ie,{label:`${t.title} - ${t.artist}`,onDelete:()=>E(t),color:"primary",variant:"outlined",size:"small"},`selected-${t.id}`))})]}),G||Q?e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(ne,{size:30})}):H.length===0?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:6},children:[e.jsx(D,{sx:{fontSize:40,color:"text.secondary",opacity:.5,mb:2}}),e.jsx(R,{color:"text.secondary",children:m?"\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E":k===0?"\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0445 \u0442\u0440\u0435\u043A\u043E\u0432":"\u0423 \u0432\u0430\u0441 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442 \u043B\u044E\u0431\u0438\u043C\u044B\u0445 \u0442\u0440\u0435\u043A\u043E\u0432"})]}):e.jsx(oe,{disablePadding:!0,children:H.map(t=>{const s=h.some(p=>p.id===t.id),i=f&&f.id===t.id;return e.jsxs(Re,{selected:s,children:[e.jsx(le,{children:e.jsxs(n,{sx:{position:"relative"},children:[e.jsx(de,{variant:"rounded",sx:{width:48,height:48},src:(r=t.cover_path,r?r.startsWith("/static/")?r:r.startsWith("static/")?`/${r}`:r.startsWith("http")?r:`/static/music/${r}`:"/uploads/system/album_placeholder.jpg"),children:e.jsx(D,{})}),e.jsx(n,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)",borderRadius:1,transition:"background 0.2s ease","&:hover":{background:"rgba(0,0,0,0.5)"}},children:e.jsx(v,{size:"small",onClick:()=>(p=>{if(f&&f.id===p.id)S?c.current.pause():c.current.play().catch(g=>{}),W(!S);else if(c.current){c.current.pause();let g=p.file_path;g.startsWith("/")||(g=`/${g}`),c.current.src=g,c.current.play().catch(Ae=>{}),C(p),W(!0)}})(t),sx:{color:"white",backgroundColor:"rgba(0,0,0,0.2)","&:hover":{backgroundColor:"rgba(0,0,0,0.3)"}},children:i&&S?e.jsx(ce,{fontSize:"small"}):e.jsx(xe,{fontSize:"small"})})})]})}),e.jsx(he,{primary:t.title,secondary:`${t.artist} \u2022 ${o=t.duration,o?`${Math.floor(o/60)}:${Math.floor(o%60).toString().padStart(2,"0")}`:"0:00"}`,primaryTypographyProps:{variant:"body2",noWrap:!0,sx:{fontWeight:s?"medium":"normal",color:s?"primary.main":"text.primary"}},secondaryTypographyProps:{variant:"caption",noWrap:!0},sx:{ml:1}}),e.jsx(me,{children:e.jsx(v,{edge:"end","aria-label":"select",onClick:()=>E(t),sx:{color:s?"primary.main":"text.secondary"},children:s?e.jsx(ue,{}):e.jsx(pe,{})})})]},t.id);var o,r})})]}),e.jsxs(ge,{sx:{px:3,py:2,borderTop:"1px solid rgba(255, 255, 255, 0.08)"},children:[e.jsx(q,{onClick:z,color:"inherit",sx:{textTransform:"none",color:"text.secondary",borderRadius:2},children:"\u041E\u0442\u043C\u0435\u043D\u0430"}),e.jsxs(q,{onClick:()=>{y(),C(null),w(h),x()},variant:"contained",color:"primary",disabled:h.length===0,sx:{textTransform:"none",borderRadius:2,px:3},children:["\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C (",h.length,")"]})]})]})},Me=b(ke)(({theme:a})=>({marginBottom:10,borderRadius:"10px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",background:a.palette.background.paper,[a.breakpoints.down("sm")]:{boxShadow:"none",marginBottom:2,width:"100%"}})),Le=()=>{const a=ve().palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";return e.jsx(Me,{children:e.jsxs(we,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(l,{variant:"circular",width:40,height:40,sx:{bgcolor:a},animation:"wave"}),e.jsxs(n,{sx:{ml:1,width:"50%"},children:[e.jsx(l,{variant:"text",width:"80%",height:20,sx:{bgcolor:a},animation:"wave"}),e.jsx(l,{variant:"text",width:"40%",height:15,sx:{bgcolor:a},animation:"wave"})]})]}),e.jsxs(n,{sx:{mb:2},children:[e.jsx(l,{variant:"text",height:18,sx:{bgcolor:a},animation:"wave"}),e.jsx(l,{variant:"text",height:18,sx:{bgcolor:a},animation:"wave"}),e.jsx(l,{variant:"text",width:"80%",height:18,sx:{bgcolor:a},animation:"wave"})]}),e.jsx(l,{variant:"rectangular",height:200,sx:{mb:2,bgcolor:a,borderRadius:1},animation:"wave"}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsx(l,{variant:"rounded",width:90,height:32,sx:{bgcolor:a},animation:"wave"}),e.jsx(l,{variant:"rounded",width:90,height:32,sx:{bgcolor:a},animation:"wave"}),e.jsx(l,{variant:"rounded",width:90,height:32,sx:{bgcolor:a},animation:"wave"})]})]})})};export{Te as I,Ie as M,Le as P};
