{"version":3,"file":"ProfilePage.DzabE94M.js","sources":["../../src/services/PostService.js","../../src/components/UI/TabContentLoader.js","../../node_modules/@mui/icons-material/Today.js","../../node_modules/@mui/icons-material/Feed.js","../../src/pages/User/components/PostsFeed.js","../../src/pages/User/components/WallFeed.js","../../node_modules/@mui/icons-material/LinkRounded.js","../../src/UIKIT/Stories/storiesApi.js","../../src/UIKIT/Stories/StoryViewer.js","../../src/UIKIT/Stories/Stories.js","../../src/pages/User/ProfilePage.js"],"sourcesContent":["import axios from './axiosConfig';\nimport AuthService from './AuthService';\n\nconst PostService = {\n    getFeed: async (page = 1, limit = 10) => {\n    try {\n      const response = await axios.get(`/api/posts/feed?page=${page}&limit=${limit}`, {\n        forceRefresh: true\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching feed:', error);\n      return { success: false, error: error.response?.data?.error || 'Не удалось загрузить ленту постов' };\n    }\n  },\n\n    getPost: async (postId) => {\n    try {\n      const response = await axios.get(`/api/posts/${postId}`, {\n        forceRefresh: true\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching post:', error);\n      return { success: false, error: error.response?.data?.error || 'Не удалось загрузить пост' };\n    }\n  },\n\n    createPost: async (postData) => {\n    try {\n            const formData = postData instanceof FormData \n        ? postData \n        : new FormData();\n      \n            if (!(postData instanceof FormData) && typeof postData === 'object') {\n        if (postData.content) {\n          formData.append('content', postData.content);\n        }\n        \n                if (Array.isArray(postData.images)) {\n          postData.images.forEach((image, index) => {\n            formData.append(`images[${index}]`, image);\n          });\n        }\n        \n                if (postData.image && postData.image instanceof File) {\n          formData.append('image', postData.image);\n        }\n        \n                if (postData.video && postData.video instanceof File) {\n          formData.append('video', postData.video);\n        }\n        \n                if (postData.music && Array.isArray(postData.music) && postData.music.length > 0) {\n          formData.append('music', JSON.stringify(postData.music));\n        }\n      }\n      \n            console.log('Creating post with form data:');\n      for (let [key, value] of formData.entries()) {\n        if (value instanceof File) {\n          console.log(`${key}: File ${value.name} (${value.size} bytes)`);\n        } else {\n          console.log(`${key}: ${value}`);\n        }\n      }\n      \n            try {\n        console.log('Attempting to create post with POST method');\n        const response = await axios.post('/api/posts/create', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          },\n          _invalidatesCache: true\n        });\n        console.log('POST success:', response.data);\n        \n        axios.cache.clearPostsCache();\n        \n        if (typeof window !== 'undefined') {\n          window.dispatchEvent(new CustomEvent('post-created', {\n            detail: { post: response.data.post }\n          }));\n        }\n        \n        return response.data;\n      } catch (postError) {\n        console.error('POST method failed:', postError);\n        \n                try {\n          console.log('Attempting fallback: PUT method to /api/posts');\n          const putResponse = await axios.put('/api/posts', formData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            },\n            _invalidatesCache: true\n          });\n          console.log('PUT success:', putResponse.data);\n          \n          axios.cache.clearPostsCache();\n          \n          if (typeof window !== 'undefined') {\n            window.dispatchEvent(new CustomEvent('post-created', {\n              detail: { post: putResponse.data.post }\n            }));\n          }\n          \n          return putResponse.data;\n        } catch (putError) {\n          console.error('PUT method failed:', putError);\n          \n                    console.log('Attempting final fallback: POST to /api/post/new');\n          const finalResponse = await axios.post('/api/post/new', formData, {\n            headers: {\n              'Content-Type': 'multipart/form-data'\n            }\n          });\n          console.log('Final attempt success:', finalResponse.data);\n          \n\n          axios.cache.clearPostsCache();\n          \n\n          if (typeof window !== 'undefined') {\n            window.dispatchEvent(new CustomEvent('post-created', {\n              detail: { post: finalResponse.data.post }\n            }));\n          }\n          \n          return finalResponse.data;\n        }\n      }\n    } catch (error) {\n      console.error('All post creation methods failed:', error);\n      throw error;\n    }\n  },\n\n    likePost: async (postId) => {\n    try {\n      const response = await axios.post(`/api/posts/${postId}/like`);\n      \n\n      axios.cache.clearByUrlPrefix(`/api/posts/${postId}`);\n      \n      return response.data;\n    } catch (error) {\n      console.error('Error liking post:', error);\n      return { success: false, error: error.response?.data?.error || 'Не удалось поставить лайк' };\n    }\n  },\n\n    deletePost: async (postId) => {\n    try {\n      console.log(`Attempting to delete post ${postId} with DELETE method and cascade`);\n      \n            const response = await axios.delete(`/api/posts/${postId}`, {\n        params: {\n          cascade: true,\n          full_delete: true\n        }\n      });\n      console.log('DELETE method with cascade succeeded:', response.data);\n      \n\n      axios.cache.clearPostsCache();\n      \n\n      if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('post-deleted', {\n          detail: { postId }\n        }));\n      }\n      \n      return response.data;\n    } catch (error) {\n      console.error(`Error deleting post ${postId} with DELETE method:`, error);\n      \n            if (error.response?.status === 404 || error.response?.status === 405 || error.response?.status === 500) {\n        try {\n          console.log(`Falling back to POST method with cascade for deletion of post ${postId}`);\n          \n                    const response = await axios.post(`/api/posts/${postId}/delete`, {\n            cascade: true,\n            full_delete: true\n          });\n          console.log('POST fallback method with cascade succeeded:', response.data);\n          \n\n          axios.cache.clearPostsCache();\n          \n\n          if (typeof window !== 'undefined') {\n            window.dispatchEvent(new CustomEvent('post-deleted', {\n              detail: { postId }\n            }));\n          }\n          \n          return response.data;\n        } catch (fallbackError) {\n          console.error(`Fallback deletion also failed for post ${postId}:`, fallbackError);\n          \n                    try {\n            console.log(`Trying second fallback: POST to /api/posts/delete/${postId} with cascade`);\n            const response = await axios.post(`/api/posts/delete/${postId}`, {\n              cascade: true,\n              full_delete: true\n            });\n            console.log('Second fallback with cascade succeeded:', response.data);\n            \n\n            axios.cache.clearPostsCache();\n            \n\n            if (typeof window !== 'undefined') {\n              window.dispatchEvent(new CustomEvent('post-deleted', {\n                detail: { postId }\n              }));\n            }\n            \n            return response.data;\n          } catch (secondFallbackError) {\n                        try {\n              console.log(`Final attempt: GET /api/posts/delete/${postId}/cascade`);\n              const response = await axios.get(`/api/posts/delete/${postId}/cascade`);\n              console.log('Final cascade deletion attempt succeeded:', response.data);\n              \n\n              axios.cache.clearPostsCache();\n              \n\n              if (typeof window !== 'undefined') {\n                window.dispatchEvent(new CustomEvent('post-deleted', {\n                  detail: { postId }\n                }));\n              }\n              \n              return response.data;\n            } catch (finalError) {\n              console.error('All deletion methods failed:', finalError);\n              return { \n                success: false, \n                error: 'Не удалось удалить пост. Возможно, у вас нет прав на это действие или сервер временно недоступен.'\n              };\n            }\n          }\n        }\n      }\n      \n      return { \n        success: false, \n        error: error.response?.data?.error || 'Не удалось удалить пост. Проверьте соединение и попробуйте снова.'\n      };\n    }\n  },\n\n    editPost: async (postId, postData) => {\n    try {\n      const formData = postData instanceof FormData \n        ? postData \n        : new FormData();\n      \n      if (!(postData instanceof FormData) && typeof postData === 'object') {\n        if (postData.content) {\n          formData.append('content', postData.content);\n        }\n        \n        if (Array.isArray(postData.images)) {\n          postData.images.forEach((image, index) => {\n            formData.append(`images[${index}]`, image);\n          });\n        }\n        \n        if (postData.image && postData.image instanceof File) {\n          formData.append('image', postData.image);\n        }\n        \n        if (postData.video && postData.video instanceof File) {\n          formData.append('video', postData.video);\n        }\n        \n        if (postData.music && Array.isArray(postData.music) && postData.music.length > 0) {\n          formData.append('music', JSON.stringify(postData.music));\n        }\n        \n        if (postData.deleteImages) {\n          formData.append('delete_images', 'true');\n        }\n        \n        if (postData.deleteVideo) {\n          formData.append('delete_video', 'true');\n        }\n        \n        if (postData.deleteMusic) {\n          formData.append('delete_music', 'true');\n        }\n      }\n      \n      const response = await axios.put(`/api/posts/${postId}`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        },\n        _invalidatesCache: true // Mark this request as cache-invalidating\n      });\n      \n      // Clear cache for posts and feed\n      axios.cache.clearPostsCache();\n      \n      if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('post-updated', {\n          detail: { postId, post: response.data.post }\n        }));\n      }\n      \n      return response.data;\n    } catch (error) {\n      console.error('Error editing post:', error);\n      throw error;\n    }\n  },\n\n  refreshFeed: async () => {\n    try {\n\n      axios.cache.clearPostsCache();\n      \n\n      const response = await axios.get('/api/posts/feed?page=1&limit=10', {\n        forceRefresh: true\n      });\n      \n\n      if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('feed-refreshed', {\n          detail: { data: response.data }\n        }));\n      }\n      \n      return response.data;\n    } catch (error) {\n      console.error('Error refreshing feed:', error);\n      return { \n        success: false, \n        error: error.response?.data?.error || 'Не удалось обновить ленту'\n      };\n    }\n  }\n};\n\nexport default PostService;\n","import React from 'react';\nimport { Box } from '@mui/material';\nimport { motion, AnimatePresence } from 'framer-motion';\n\n/**\n * TabContentLoader component that provides instant tab switching\n * without any loading indicators or background color flashes\n */\nconst TabContentLoader = ({ \n  tabIndex, \n  children,\n  containerSx = {}\n}) => {\n  return (\n    <Box sx={{ position: 'relative', overflow: 'hidden', ...containerSx }}>\n      <AnimatePresence mode=\"wait\" initial={false}>\n        <motion.div\n          key={tabIndex}\n          initial={{ opacity: 0.95 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0.95 }}\n          transition={{ \n            type: 'tween',\n            duration: 0.12,\n            ease: 'easeInOut'\n          }}\n        >\n          {children}\n        </motion.div>\n      </AnimatePresence>\n    </Box>\n  );\n};\n\nexport default TabContentLoader; ","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14zM7 10h5v5H7z\"\n}), 'Today');","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M16 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8zM7 7h5v2H7zm10 10H7v-2h10zm0-4H7v-2h10zm-2-4V5l4 4z\"\n}), 'Feed');","import React, { useState, useEffect, useRef, useCallback, useContext } from 'react';\nimport { Box, CircularProgress, Typography } from '@mui/material';\nimport axios from 'axios';\nimport { AuthContext } from '../../../context/AuthContext';\nimport FeedIcon from '@mui/icons-material/Feed';\n\nimport Post from '../../../components/Post/Post';\nimport PostSkeleton from '../../../components/Post/PostSkeleton';\n\nconst PostsFeed = ({ userId, statusColor }) => {\n  const [posts, setPosts] = useState([]);\n  const [pinnedPost, setPinnedPost] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [hasMore, setHasMore] = useState(true);\n  const [page, setPage] = useState(1);\n  const [error, setError] = useState(null);\n  const observer = useRef();\n  \n  const isMounted = useRef(true);\n  const loadingRef = useRef(false);\n  const { isAuthenticated } = useContext(AuthContext);\n  const isProfilePage = window.location.pathname.includes('/profile/');\n\n  useEffect(() => {\n    isMounted.current = true;\n    return () => {\n      isMounted.current = false;\n    };\n  }, []);\n\n  const fetchPinnedPost = useCallback(async (username) => {\n    if (!isProfilePage || !username) return null;\n    \n    try {\n      const response = await axios.get(`/api/profile/pinned_post/${username}`);\n      if (isMounted.current && response.data && response.data.id) {\n        setPinnedPost(response.data);\n        return response.data;\n      }\n      setPinnedPost(null);\n      return null;\n    } catch (error) {\n      console.error('Ошибка при загрузке закрепленного поста:', error);\n      setPinnedPost(null);\n      return null;\n    }\n  }, [isProfilePage]);\n\n  const fetchPosts = useCallback(async (pageNumber = 1, username = null) => {\n    if (loadingRef.current) return;\n    \n    try {\n      loadingRef.current = true;\n      \n      if (pageNumber === 1) {\n        setLoading(true);\n      } else {\n        setIsLoadingMore(true);\n      }\n\n      // Если это страница профиля и первая загрузка, получаем закрепленный пост\n      if (isProfilePage && pageNumber === 1 && username) {\n        await fetchPinnedPost(username);\n      }\n\n      const response = await axios.get(`/api/profile/${userId}/posts`, {\n        params: { \n          page: pageNumber, \n          per_page: 10  \n        },\n        forceRefresh: true\n      });\n\n      if (!isMounted.current) return;\n\n      if (response.data.posts && Array.isArray(response.data.posts)) {\n        const newPosts = response.data.posts;\n        \n        if (pageNumber === 1) {\n          setPosts(newPosts);\n        } else {\n          setPosts(prevPosts => {\n            const prevArray = Array.isArray(prevPosts) ? prevPosts : [];\n            return [...prevArray, ...newPosts];\n          });\n        }\n\n        setHasMore(response.data.has_next);\n      } else {\n        if (pageNumber === 1) {\n          setPosts([]);\n        }\n        setHasMore(false);\n      }\n    } catch (error) {\n      console.error('Ошибка при загрузке постов:', error);\n      if (isMounted.current) {\n        if (error.response && error.response.status === 401) {\n          setError('Для просмотра постов необходима авторизация');\n        } else {\n          setError('Произошла ошибка при загрузке постов');\n        }\n      }\n    } finally {\n      if (isMounted.current) {\n        setLoading(false);\n        setIsLoadingMore(false);\n        loadingRef.current = false;\n      }\n    }\n  }, [userId, isProfilePage, fetchPinnedPost]);\n\n  // Add effect to handle pin state changes\n  useEffect(() => {\n    const handlePinStateChanged = async (event) => {\n      const { postId, isPinned } = event.detail;\n      \n      if (isPinned) {\n        // Находим пост для закрепления\n        const postToPin = posts.find(p => p.id === postId);\n        if (postToPin) {\n          // Устанавливаем как закрепленный, но оставляем в основной ленте\n          setPinnedPost(postToPin);\n        }\n      } else {\n        // При откреплении просто убираем из закрепленных\n        if (pinnedPost && pinnedPost.id === postId) {\n          setPinnedPost(null);\n        }\n      }\n\n      // Обновляем данные с сервера для синхронизации\n      await fetchPinnedPost();\n      await fetchPosts(1);\n    };\n\n    window.addEventListener('post-pinned-state-changed', handlePinStateChanged);\n    \n    return () => {\n      window.removeEventListener('post-pinned-state-changed', handlePinStateChanged);\n    };\n  }, [fetchPinnedPost, fetchPosts, posts, pinnedPost]);\n\n  useEffect(() => {\n    if (userId) {\n      setPage(1);\n      setPosts([]);\n      setPinnedPost(null);\n      setHasMore(true);\n      \n      // Получаем username из URL для запроса закрепленного поста\n      const username = window.location.pathname.split('/profile/')[1];\n      fetchPosts(1, username);\n    }\n    \n    return () => {\n      if (observer.current) {\n        observer.current.disconnect();\n      }\n    };\n  }, [userId, fetchPosts]);\n\n  const lastPostElementRef = useCallback(node => {\n    if (loading || isLoadingMore || !hasMore) return;\n    \n    if (observer.current) observer.current.disconnect();\n    \n    observer.current = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && hasMore && !loadingRef.current) {\n        setPage(prevPage => prevPage + 1);\n      }\n    }, { threshold: 0.5 });\n    \n    if (node) observer.current.observe(node);\n  }, [loading, isLoadingMore, hasMore]);\n\n  useEffect(() => {\n    if (page > 1) {\n      fetchPosts(page);\n    }\n  }, [page, fetchPosts]);\n\n  const handleDeletePost = (postId, updatedPost) => {\n    if (updatedPost) {\n      setPosts(prevPosts => \n        prevPosts.map(post => \n          post.id.toString() === postId.toString() ? updatedPost : post\n        )\n      );\n      if (pinnedPost && pinnedPost.id.toString() === postId.toString()) {\n        setPinnedPost(updatedPost);\n      }\n    } else {\n      setPosts(prevPosts => \n        prevPosts.filter(post => post.id.toString() !== postId.toString())\n      );\n      if (pinnedPost && pinnedPost.id.toString() === postId.toString()) {\n        setPinnedPost(null);\n      }\n    }\n  };\n\n  useEffect(() => {\n    const handleGlobalPostCreated = (event) => {\n      const newPost = event.detail;\n      \n      if (newPost && newPost.user_id === parseInt(userId)) {\n        setPosts(prevPosts => [newPost, ...prevPosts]);\n      }\n    };\n    \n    window.addEventListener('post_created', handleGlobalPostCreated);\n    \n    return () => {\n      window.removeEventListener('post_created', handleGlobalPostCreated);\n    };\n  }, [userId]);\n\n  if (loading && posts.length === 0) {\n    return (\n      <Box sx={{ mt: 2 }}>\n        {[1, 2, 3].map((_, index) => (\n          <PostSkeleton key={index} />\n        ))}\n      </Box>\n    );\n  }\n\n  if (error) {\n    return (\n      <Box sx={{ \n        textAlign: 'center', \n        py: 4, \n        px: 3,\n        bgcolor: 'background.paper', \n        borderRadius: 2,\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        gap: 1\n      }}>\n        <FeedIcon sx={{ fontSize: 40, color: 'text.secondary', mb: 1 }} />\n        <Typography variant=\"h6\" color=\"text.primary\" gutterBottom>\n          {error === 'Для просмотра постов необходима авторизация' \n            ? 'Для просмотра постов необходима авторизация'\n            : 'Произошла ошибка'}\n        </Typography>\n        <Typography variant=\"body1\" color=\"text.secondary\" sx={{ maxWidth: 400 }}>\n          {error === 'Для просмотра постов необходима авторизация'\n            ? 'Войдите в аккаунт, чтобы просматривать посты пользователей'\n            : error}\n        </Typography>\n      </Box>\n    );\n  }\n\n  if (posts.length === 0 && !loading && !pinnedPost) {\n    return (\n      <Box sx={{ \n        textAlign: 'center', \n        py: 4, \n        px: 3,\n        bgcolor: 'background.paper', \n        borderRadius: 2,\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        gap: 1\n      }}>\n        <FeedIcon sx={{ fontSize: 40, color: 'text.secondary', mb: 1 }} />\n        <Typography variant=\"h6\" color=\"text.primary\" gutterBottom>\n          {isAuthenticated ? 'Здесь пока пусто' : 'Для просмотра постов необходима авторизация'}\n        </Typography>\n        <Typography variant=\"body1\" color=\"text.secondary\" sx={{ maxWidth: 400 }}>\n          {isAuthenticated \n            ? 'Пользователь еще не создал ни одного поста'\n            : 'Войдите в аккаунт, чтобы просматривать посты пользователей'}\n        </Typography>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{ mt: 0.5 }}>\n      {pinnedPost && (\n        <Box sx={{ \n          position: 'relative',\n        }}>\n          <Post \n            post={pinnedPost} \n            onDelete={handleDeletePost}\n            showActions\n            isPinned\n            statusColor={statusColor}\n          />\n        </Box>\n      )}\n      \n      {posts.map((post, index) => {\n        if (posts.length === index + 1) {\n          return (\n            <Box ref={lastPostElementRef} key={post.id}>\n              <Post \n                post={post} \n                onDelete={handleDeletePost}\n                showActions\n                statusColor={statusColor}\n              />\n            </Box>\n          );\n        } else {\n          return (\n            <Post \n              key={post.id} \n              post={post} \n              onDelete={handleDeletePost}\n              showActions\n              statusColor={statusColor}\n            />\n          );\n        }\n      })}\n      \n      {isLoadingMore && (\n        <Box sx={{ display: 'flex', justifyContent: 'center', my: 2 }}>\n          <CircularProgress size={24} />\n        </Box>\n      )}\n      \n      {!hasMore && posts.length > 5 && (\n        <Box sx={{ textAlign: 'center', py: 2, mt: 2 }}>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            Все посты загружены\n          </Typography>\n        </Box>\n      )}\n    </Box>\n  );\n};\n\nexport default PostsFeed; ","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Box, CircularProgress, Typography } from '@mui/material';\nimport axios from 'axios';\n\n\nimport Post from '../../../components/Post/Post';\nimport PostSkeleton from '../../../components/Post/PostSkeleton';\n\nconst WallFeed = ({ userId }) => {\n  const [wallPosts, setWallPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [hasMore, setHasMore] = useState(true);\n  const [page, setPage] = useState(1);\n  const [error, setError] = useState(null);\n  const observer = useRef();\n  const isMounted = useRef(true);\n  const loadingRef = useRef(false);\n\n  \n  useEffect(() => {\n    isMounted.current = true;\n    return () => {\n      isMounted.current = false;\n    };\n  }, []);\n\n  \n  const fetchWallPosts = useCallback(async (pageNumber = 1) => {\n    \n    if (loadingRef.current) return;\n    \n    try {\n      loadingRef.current = true;\n      \n      if (pageNumber === 1) {\n        setLoading(true);\n      } else {\n        setIsLoadingMore(true);\n      }\n\n      \n      const response = await axios.get(`/api/profile/${userId}/wall`, {\n        params: {\n          page: pageNumber,\n          per_page: 10 \n        }\n      });\n\n      \n      if (!isMounted.current) return;\n\n      \n      if (response.data.posts && Array.isArray(response.data.posts)) {\n        if (pageNumber === 1) {\n          setWallPosts(response.data.posts);\n        } else {\n          setWallPosts(prev => [...prev, ...response.data.posts]);\n        }\n        \n        setHasMore(response.data.has_next);\n      } else {\n        if (pageNumber === 1) setWallPosts([]);\n        setHasMore(false);\n      }\n    } catch (error) {\n      console.error('Ошибка при загрузке записей стены:', error);\n      if (isMounted.current) {\n        if (pageNumber === 1) setWallPosts([]);\n        setError('Произошла ошибка при загрузке записей стены');\n      }\n    } finally {\n      if (isMounted.current) {\n        setLoading(false);\n        setIsLoadingMore(false);\n        loadingRef.current = false;\n      }\n    }\n  }, [userId]);\n\n  \n  useEffect(() => {\n    if (userId) {\n      setPage(1);\n      setWallPosts([]);\n      setHasMore(true);\n      fetchWallPosts(1);\n    }\n    \n    return () => {\n      if (observer.current) {\n        observer.current.disconnect();\n      }\n    };\n  }, [userId, fetchWallPosts]);\n\n  \n  const lastPostElementRef = useCallback(node => {\n    if (loading || isLoadingMore || !hasMore) return;\n    \n    if (observer.current) observer.current.disconnect();\n    \n    observer.current = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting && hasMore && !loadingRef.current) {\n        setPage(prevPage => prevPage + 1);\n      }\n    }, { threshold: 0.5 });\n    \n    if (node) observer.current.observe(node);\n  }, [loading, isLoadingMore, hasMore]);\n\n  \n  useEffect(() => {\n    if (page > 1) {\n      fetchWallPosts(page);\n    }\n  }, [page, fetchWallPosts]);\n\n  \n  const handleDeletePost = (postId, updatedPost) => {\n    if (updatedPost) {\n      setWallPosts(prevPosts => \n        prevPosts.map(post => \n          post.id.toString() === postId.toString() ? updatedPost : post\n        )\n      );\n    } else {\n      setWallPosts(prevPosts => \n        prevPosts.filter(post => \n          post.id.toString() !== postId.toString()\n        )\n      );\n    }\n  };\n\n  \n  useEffect(() => {\n    const handleGlobalPostCreated = (event) => {\n      const newPost = event.detail;\n      \n      if (newPost.type === 'stena' && newPost.recipient_id === parseInt(userId)) {\n        setWallPosts(prevPosts => [newPost, ...prevPosts]);\n      }\n    };\n    \n    window.addEventListener('post_created', handleGlobalPostCreated);\n    \n    return () => {\n      window.removeEventListener('post_created', handleGlobalPostCreated);\n    };\n  }, [userId]);\n\n  if (loading && wallPosts.length === 0) {\n    return (\n      <Box sx={{ mt: 2 }}>\n        {[1, 2, 3].map((_, index) => (\n          <PostSkeleton key={index} />\n        ))}\n      </Box>\n    );\n  }\n\n  if (error) {\n    return (\n      <Box sx={{ textAlign: 'center', py: 3, bgcolor: 'background.paper', borderRadius: 2, mt: 2 }}>\n        <Typography color=\"error\">{error}</Typography>\n      </Box>\n    );\n  }\n\n  if (wallPosts.length === 0 && !loading) {\n    return (\n      <Box sx={{ textAlign: 'center', py: 6, bgcolor: 'background.paper', borderRadius: 2, mt: 2 }}>\n        <Typography variant=\"h6\" color=\"text.secondary\">\n          На стене пока нет записей\n        </Typography>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{ mt:0.5 }}>\n      {wallPosts.map((post, index) => {\n        \n        if (wallPosts.length === index + 1) {\n          return (\n            <Box ref={lastPostElementRef} key={post.id}>\n              <Post \n                post={post} \n                onDelete={handleDeletePost}\n                showActions\n              />\n            </Box>\n          );\n        } else {\n          return (\n            <Post \n              key={post.id} \n              post={post} \n              onDelete={handleDeletePost}\n              showActions\n            />\n          );\n        }\n      })}\n      \n      {/* Индикатор загрузки */}\n      {isLoadingMore && (\n        <Box sx={{ display: 'flex', justifyContent: 'center', my: 2 }}>\n          <CircularProgress size={24} />\n        </Box>\n      )}\n      \n      {/* Сообщение, когда постов больше нет */}\n      {!hasMore && wallPosts.length > 5 && (\n        <Box sx={{ textAlign: 'center', py: 2, mt: 2 }}>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            Все записи стены загружены\n          </Typography>\n        </Box>\n      )}\n    </Box>\n  );\n};\n\nexport default WallFeed; ","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M17 7h-3c-.55 0-1 .45-1 1s.45 1 1 1h3c1.65 0 3 1.35 3 3s-1.35 3-3 3h-3c-.55 0-1 .45-1 1s.45 1 1 1h3c2.76 0 5-2.24 5-5s-2.24-5-5-5m-9 5c0 .55.45 1 1 1h6c.55 0 1-.45 1-1s-.45-1-1-1H9c-.55 0-1 .45-1 1m2 3H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h3c.55 0 1-.45 1-1s-.45-1-1-1H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h3c.55 0 1-.45 1-1s-.45-1-1-1\"\n}), 'LinkRounded');","import { useState, useCallback } from 'react';\nimport axios from '../../services/axiosConfig';\n\n// Получить ленту историй\nexport const fetchStories = async () => {\n  const response = await axios.get('/api/stories/feed');\n  return response.data && response.data.stories ? response.data.stories : [];\n};\n\n// Опубликовать новую историю\nexport const publishStory = async (file) => {\n  const formData = new FormData();\n  formData.append('media', file);\n  const response = await axios.post('/api/stories', formData, {\n    headers: { 'Content-Type': 'multipart/form-data' },\n  });\n  return response.data;\n};\n\n// Отметить историю как просмотренную\nexport const viewStory = async (storyId) => {\n  if (!storyId) return;\n  return axios.post(`/api/stories/${storyId}/view`);\n};\n\n// Удалить историю\nexport const deleteStory = async (storyId) => {\n  if (!storyId) return;\n  return axios.delete(`/api/stories/${storyId}`);\n};\n\n// Добавить/убрать реакцию на историю\nexport const addStoryReaction = async (storyId, emoji) => {\n  if (!storyId || !emoji) return;\n  return axios.post(`/api/stories/${storyId}/reaction`, { emoji });\n};\n\n// Получить список реакций с пользователями для истории\nexport const getStoryReactionsWithUsers = async (storyId) => {\n  if (!storyId) return [];\n  const response = await axios.get(`/api/stories/${storyId}/reactions`);\n  return response.data && response.data.reactions ? response.data.reactions : [];\n};\n\n// Получить истории конкретного пользователя\nexport const fetchUserStories = async (userIdentifier) => {\n  const response = await axios.get(`/api/stories/user/${userIdentifier}`);\n  return response.data && response.data.stories ? [response.data] : [];\n};\n\n// Хук для получения и обновления ленты историй\nexport function useStoriesFeed(userIdentifier = null) {\n  const [stories, setStories] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  const loadStories = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const data = userIdentifier \n        ? await fetchUserStories(userIdentifier)\n        : await fetchStories();\n      setStories(data);\n    } catch (e) {\n      setError(e);\n    } finally {\n      setLoading(false);\n    }\n  }, [userIdentifier]);\n\n  return { stories, loading, error, loadStories, setStories };\n}\n\n// Хук для действий с историями (публикация, просмотр, удаление)\nexport function useStoryActions() {\n  const [actionLoading, setActionLoading] = useState(false);\n  const [actionError, setActionError] = useState(null);\n\n  const publish = useCallback(async (file) => {\n    setActionLoading(true);\n    setActionError(null);\n    try {\n      const data = await publishStory(file);\n      return data;\n    } catch (e) {\n      setActionError(e);\n      throw e;\n    } finally {\n      setActionLoading(false);\n    }\n  }, []);\n\n  const view = useCallback(async (storyId) => {\n    try {\n      await viewStory(storyId);\n    } catch (e) {\n      // Не критично, просто логируем\n      console.error('Error viewing story', e);\n    }\n  }, []);\n\n  const remove = useCallback(async (storyId) => {\n    setActionLoading(true);\n    setActionError(null);\n    try {\n      await deleteStory(storyId);\n    } catch (e) {\n      setActionError(e);\n      throw e;\n    } finally {\n      setActionLoading(false);\n    }\n  }, []);\n\n  return { publish, view, remove, actionLoading, actionError };\n} ","import React, { useState, useEffect, useRef } from 'react';\nimport { Box, IconButton, Typography, styled, Avatar, Dialog, DialogTitle, DialogActions, Button, useMediaQuery, Fade, Popper, Tabs, Tab, CircularProgress } from '@mui/material';\nimport { useTheme } from '@mui/material/styles';\nimport CloseIcon from '@mui/icons-material/Close';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport ArrowBackIosNewIcon from '@mui/icons-material/ArrowBackIosNew';\nimport ArrowForwardIosIcon from '@mui/icons-material/ArrowForwardIos';\nimport VolumeUpIcon from '@mui/icons-material/VolumeUp';\nimport VolumeOffIcon from '@mui/icons-material/VolumeOff';\nimport VisibilityIcon from '@mui/icons-material/Visibility';\nimport { useAuth } from '../../context/AuthContext';\nimport { deleteStory as apiDeleteStory, addStoryReaction, getStoryReactionsWithUsers } from './storiesApi';\n\nconst REACTION_EMOJIS = ['❤️', '😂', '😮', '😢', '🔥'];\n\nconst ReactionMenu = styled(Box)(({ theme }) => ({\n  position: 'absolute',\n  left: '50%',\n  bottom: '10%',\n  transform: 'translateX(-50%)',\n  display: 'flex',\n  gap: 12,\n  zIndex: 20,\n  background: 'rgba(30,30,30,0.95)',\n  borderRadius: 24,\n  padding: '8px 16px',\n  boxShadow: '0 2px 12px rgba(0,0,0,0.18)',\n  alignItems: 'center',\n  maxWidth: '90%',\n  backdropFilter: 'blur(8px)',\n  border: '1px solid rgba(255,255,255,0.1)',\n}));\n\nconst ReactionButton = styled(IconButton)(({ theme, selected }) => ({\n  fontSize: 28,\n  transition: 'transform 0.25s cubic-bezier(.4,2,.6,1)',\n  transform: selected ? 'translateY(-18px) scale(1.25)' : 'none',\n  filter: selected ? 'drop-shadow(0 4px 12px rgba(0,0,0,0.25))' : 'none',\n  background: selected ? 'rgba(255,255,255,0.08)' : 'none',\n  border: selected ? `2px solid ${theme.palette.primary.main}` : 'none',\n  zIndex: selected ? 2 : 1,\n  color: selected ? theme.palette.primary.main : 'inherit',\n  '&:hover': {\n    background: 'rgba(255,255,255,0.12)',\n    transform: 'translateY(-8px) scale(1.1)',\n  },\n}));\n\nconst ViewerContainer = styled(Box)(({ theme }) => ({\n  position: 'fixed',\n  top: 0,\n  left: 0,\n  right: 0,\n  bottom: 0,\n  backgroundColor: 'rgba(0, 0, 0, 0.9)',\n  zIndex: 1300,\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  [theme.breakpoints.up('sm')]: {\n    backgroundColor: 'rgba(0, 0, 0, 0.85)',\n  },\n}));\n\nconst StoryContentContainer = styled(Box)(({ theme, $isMobile }) => ({\n  width: $isMobile ? '100vw' : 'auto',\n  height: $isMobile ? '100vh' : 'auto',\n  display: 'flex',\n  flexDirection: 'column',\n  position: 'relative',\n  borderRadius: 16,\n  overflow: 'hidden',\n  background: 'rgba(0,0,0,0.95)',\n  minWidth: $isMobile ? '100vw' : 420,\n  minHeight: $isMobile ? '100vh' : 0,\n  maxWidth: $isMobile ? '100vw' : 420,\n  maxHeight: $isMobile ? '100vh' : '90vh',\n  aspectRatio: $isMobile ? undefined : '9/16',\n}));\n\nconst BlurredMediaBackground = styled(Box)(({ theme, imageUrl }) => ({\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  right: 0,\n  bottom: 0,\n  backgroundImage: `url(${imageUrl})`,\n  backgroundSize: 'cover',\n  backgroundPosition: 'center',\n  filter: 'blur(20px)',\n  transform: 'scale(1.05)',\n  zIndex: -1,\n  opacity: 1,\n}));\n\nconst ProgressContainer = styled(Box)(({ theme }) => ({\n  display: 'flex',\n  gap: 4,\n  padding: 16,\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  right: 0,\n  zIndex: 10,\n}));\n\nconst ProgressBar = styled(Box)(({ theme, progress }) => ({\n  flex: 1,\n  height: 2,\n  backgroundColor: 'rgba(255, 255, 255, 0.3)',\n  borderRadius: 2,\n  overflow: 'hidden',\n  '&::after': {\n    content: '\"\"',\n    display: 'block',\n    height: '100%',\n    width: `${progress}%`,\n    backgroundColor: theme.palette.primary.main,\n    transition: 'width 0.1s linear',\n  },\n}));\n\nconst MediaContainer = styled(Box)(({ theme }) => ({\n  flex: 1,\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  position: 'relative',\n  zIndex: 1,\n  height: '100%',\n  maxHeight: '100%',\n  overflow: 'hidden'\n}));\n\nconst Media = styled('img')(({ theme }) => ({\n  width: '100%',\n  height: '100%',\n  objectFit: 'contain',\n  position: 'relative',\n  zIndex: 1,\n  maxWidth: '100%',\n  maxHeight: '100%'\n}));\n\nconst Video = styled('video')(({ theme }) => ({\n  width: '100%',\n  height: '100%',\n  objectFit: 'contain',\n  position: 'relative',\n  zIndex: 1,\n  maxWidth: '100%',\n  maxHeight: '100%'\n}));\n\nconst ControlsContainer = styled(Box)(({ theme }) => ({\n  position: 'absolute',\n  bottom: 16,\n  right: 16,\n  display: 'flex',\n  alignItems: 'center',\n  gap: 1,\n  zIndex: 5,\n  backgroundColor: 'rgba(0, 0, 0, 0.5)',\n  padding: '4px 8px',\n  borderRadius: '20px',\n  backdropFilter: 'blur(4px)',\n  maxHeight: 'calc(100% - 32px)'\n}));\n\nconst NavigationButton = styled(IconButton)(({ theme }) => ({\n  position: 'absolute',\n  top: '50%',\n  transform: 'translateY(-50%)',\n  color: 'white',\n  backgroundColor: 'rgba(0, 0, 0, 0.3)',\n  zIndex: 5,\n  '&:hover': {\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n  },\n}));\n\nconst Header = styled(Box)(({ theme }) => ({\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  right: 0,\n  padding: 16,\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'space-between',\n  zIndex: 10,\n}));\n\nconst UserInfo = styled(Box)(({ theme }) => ({\n  display: 'flex',\n  alignItems: 'center',\n  gap: 1,\n  zIndex: 1,\n  maxWidth: 'calc(100% - 80px)',\n}));\n\nconst UserAvatar = styled(Avatar)(({ theme }) => ({\n  width: 32,\n  height: 32,\n  border: `2px solid ${theme.palette.primary.main}`,\n  flexShrink: 0,\n}));\n\nconst ClickableOverlay = styled(Box)(({ theme }) => ({\n  position: 'absolute',\n  top: 0,\n  bottom: 0,\n  width: '50%',\n  zIndex: 2,\n  cursor: 'pointer',\n  height: '100%'\n}));\n\n// Универсальная функция для форматирования времени с учетом локали\nconst formatTime = (created_at_unix, created_at_utc) => {\n  let date;\n  if (created_at_utc) {\n    // Предпочитаем ISO 8601 строку с 'Z', так как она явно указывает UTC\n    // JS Date constructor и Date.parse корректно обрабатывают 'Z'\n    date = new Date(created_at_utc);\n  } else if (created_at_unix) {\n    // Unix timestamp - секунды с эпохи в UTC\n    date = new Date(created_at_unix * 1000);\n  } else {\n    return '';\n  }\n\n  // Если дата некорректна после парсинга\n  if (isNaN(date.getTime())) {\n      console.error('Некорректная дата получена или спарсена:', { created_at_unix, created_at_utc });\n      return '';\n  }\n\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime(); // Разница в миллисекундах (в UTC)\n\n  // Пороговые значения в миллисекундах\n  const minute = 60 * 1000;\n  const hour = 60 * minute;\n  const day = 24 * hour;\n\n  if (diffMs < 0) return 'в будущем'; // На всякий случай\n  if (diffMs < minute) return 'только что'; // Меньше 1 минуты\n  if (diffMs < hour) return `${Math.floor(diffMs / minute)}м`; // Меньше 1 часа\n  if (diffMs < day) return `${Math.floor(diffMs / hour)}ч`; // Меньше 24 часов\n\n  // Если больше 24 часов, показываем дату и время в локальном формате\n  // toLocaleString использует локальный часовой пояс клиента по умолчанию\n  return date.toLocaleString(undefined, {\n    day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit'\n  });\n};\n\nconst ReactionUsersDialog = ({ open, onClose, storyId }) => {\n  const [loading, setLoading] = useState(false);\n  const [reactions, setReactions] = useState([]);\n\n  useEffect(() => {\n    if (!open) return;\n    setLoading(true);\n    getStoryReactionsWithUsers(storyId)\n      .then((data) => {\n        setReactions(data);\n      })\n      .finally(() => setLoading(false));\n  }, [open, storyId]);\n\n  return (\n    <Dialog open={open} onClose={onClose} maxWidth=\"xs\" fullWidth\n      PaperProps={{\n        sx: {\n          background: 'rgba(24, 24, 28, 0.98)',\n          backdropFilter: 'blur(8px)',\n          boxShadow: '0 4px 32px rgba(0,0,0,0.25)',\n        }\n      }}\n    >\n      <DialogTitle sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n        <span>Реакции на историю</span>\n        <Box sx={{ flex: 1 }} />\n        <IconButton onClick={onClose}><CloseIcon /></IconButton>\n      </DialogTitle>\n      <Box sx={{ px: 2, pt: 1 }}>\n        {loading ? (\n          <Box sx={{ display: 'flex', justifyContent: 'center', py: 4 }}><CircularProgress /></Box>\n        ) : reactions.length === 0 ? (\n          <Typography color=\"text.secondary\" align=\"center\" sx={{ py: 4 }}>Нет реакций</Typography>\n        ) : (\n          <Box>\n            {reactions.map((user) => (\n              <Box key={user.user_id + user.emoji} sx={{ display: 'flex', alignItems: 'center', gap: 2, py: 1 }}>\n                <Avatar src={user.photo ? `/static/uploads/avatar/${user.user_id}/${user.photo}` : undefined} />\n                <Box>\n                  <Typography sx={{ fontWeight: 500 }}>{user.name || user.username}</Typography>\n                  <Typography variant=\"caption\" color=\"text.secondary\">@{user.username}</Typography>\n                </Box>\n                <Box sx={{ ml: 'auto', fontSize: 22 }}>{user.emoji}</Box>\n              </Box>\n            ))}\n          </Box>\n        )}\n      </Box>\n      <Box sx={{ height: 8 }} />\n    </Dialog>\n  );\n};\n\nconst StoryViewer = ({ \n  userStories, \n  currentUserIndex, \n  setCurrentUserIndex, \n  onClose, \n  currentUserId, \n  onStoryDeleted,\n  isMuted,\n  onToggleSound,\n  isMobile,\n  onStoryViewed,\n  onNextUser\n}) => {\n  const [stories, setStories] = useState([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [progress, setProgress] = useState(0);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const progressInterval = useRef(null);\n  const videoRef = useRef(null);\n  const storyDuration = 5000; // 5 seconds per story\n  const theme = useTheme();\n  const viewedStories = useRef(new Set()); // For tracking viewed stories\n  const { user: currentUser } = useAuth(); // Get current logged-in user\n  const isMobileScreen = useMediaQuery(theme.breakpoints.down('sm'));\n  const alreadyViewedStories = useRef(new Set());\n  const [lastLoadedBg, setLastLoadedBg] = useState(null);\n  const [bgLoaded, setBgLoaded] = useState(false);\n  const [reactionMenuOpen, setReactionMenuOpen] = useState(false);\n  const [myReaction, setMyReaction] = useState(null);\n  const [reactionAnchor, setReactionAnchor] = useState(null);\n  const [reactionLoading, setReactionLoading] = useState(false);\n  const [showReactionsDialog, setShowReactionsDialog] = useState(false);\n\n  // useRef для отслеживания предыдущего userId и stories.length\n  const prevUserId = useRef();\n  const prevStoriesLength = useRef();\n\n  useEffect(() => {\n    // Сбрасываем только если сменился пользователь или количество историй\n    const newUserId = userStories?.user?.id;\n    const newStoriesLength = userStories?.stories?.length;\n    if (prevUserId.current !== newUserId || prevStoriesLength.current !== newStoriesLength) {\n      setStories(userStories.stories || []);\n      setCurrentIndex(0);\n      setProgress(0);\n      prevUserId.current = newUserId;\n      prevStoriesLength.current = newStoriesLength;\n    } else if (userStories && userStories.stories) {\n      setStories(userStories.stories);\n    }\n  }, [userStories]);\n\n  const recordStoryView = (storyId) => {\n    if (!storyId) return;\n    if (alreadyViewedStories.current.has(storyId)) return;\n    alreadyViewedStories.current.add(storyId);\n    onStoryViewed?.(storyId);\n  };\n\n  useEffect(() => {\n    if (stories.length > 0 && currentIndex < stories.length) {\n      recordStoryView(stories[currentIndex].id);\n      startProgress();\n    }\n    return () => {\n      if (progressInterval.current) {\n        clearInterval(progressInterval.current);\n      }\n    };\n  }, [currentIndex, stories]);\n\n  const startProgress = () => {\n    if (progressInterval.current) {\n      clearInterval(progressInterval.current);\n    }\n    setProgress(0);\n    const isVideo = stories[currentIndex]?.media_url?.match(/\\.(mp4|webm|mov)$/i);\n    const duration = isVideo ? (videoRef.current?.duration || 5) * 1000 : storyDuration;\n    \n    progressInterval.current = setInterval(() => {\n      setProgress(prev => {\n        if (prev >= 100) {\n          clearInterval(progressInterval.current);\n          handleNext();\n          return 0;\n        }\n        return prev + (100 / (duration / 100));\n      });\n    }, 100);\n  };\n\n  const handleNext = () => {\n    if (currentIndex < stories.length - 1) {\n      setCurrentIndex(prev => prev + 1);\n    } else {\n      if (onNextUser) {\n        onNextUser();\n      } else {\n        onClose();\n      }\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentIndex > 0) {\n      setCurrentIndex(prev => prev - 1);\n    }\n  };\n\n  const handleOverlayClick = (e) => {\n    const { clientX } = e;\n    const { left, width } = e.currentTarget.getBoundingClientRect();\n    const clickPosition = clientX - left;\n    \n    if (clickPosition < width / 2) {\n      handlePrevious();\n    } else {\n      handleNext();\n    }\n  };\n\n  const handleClose = () => {\n    if (progressInterval.current) {\n      clearInterval(progressInterval.current);\n    }\n    onClose();\n  };\n\n  const handleDeleteStory = async () => {\n    try {\n      const deletedId = stories[currentIndex].id;\n      await apiDeleteStory(deletedId);\n      setDeleteDialogOpen(false);\n      // Удаляем из локального состояния\n      const updatedStories = stories.filter((_, idx) => idx !== currentIndex);\n      if (updatedStories.length === 0) {\n        // Если больше нет историй, закрываем viewer\n        if (onStoryDeleted) onStoryDeleted(deletedId); // Сообщаем родителю\n        onClose();\n      } else {\n        setStories(updatedStories);\n        if (currentIndex >= updatedStories.length) {\n          setCurrentIndex(updatedStories.length - 1);\n        }\n        if (onStoryDeleted) onStoryDeleted(deletedId); // Сообщаем родителю\n      }\n      // Показываем уведомление через NotificationManager\n      window.dispatchEvent(new CustomEvent('show-error', {\n        detail: {\n          message: 'История удалена',\n          shortMessage: 'Удалено',\n          notificationType: 'success',\n          animationType: 'pill',\n        }\n      }));\n    } catch (error) {\n      console.error('Error deleting story:', error);\n      window.dispatchEvent(new CustomEvent('show-error', {\n        detail: {\n          message: 'Ошибка при удалении истории',\n          shortMessage: 'Ошибка',\n          notificationType: 'error',\n          animationType: 'pill',\n        }\n      }));\n    }\n  };\n\n  useEffect(() => {\n    setBgLoaded(false);\n  }, [currentIndex, stories]);\n\n  useEffect(() => {\n    if (stories.length > 0 && currentIndex < stories.length) {\n      if (stories[currentIndex]?.media_url) {\n        if (bgLoaded) setLastLoadedBg(stories[currentIndex].media_url);\n      }\n    }\n  }, [bgLoaded, currentIndex, stories]);\n\n  useEffect(() => {\n    setReactionMenuOpen(false);\n    setReactionAnchor(null);\n    setReactionLoading(false);\n    // Определяем свою реакцию из currentStory.user_reaction (если есть)\n    if (stories[currentIndex] && stories[currentIndex].user_reaction) {\n      setMyReaction(stories[currentIndex].user_reaction);\n    } else {\n      setMyReaction(null);\n    }\n  }, [currentIndex, stories]);\n\n  if (!stories.length) return null;\n  const currentStory = stories[currentIndex];\n  const displayUser = userStories?.user || {};\n\n  // Определяем тип медиа для текущей истории\n  const currentMediaType = currentStory?.media_url?.match(/\\.(jpg|jpeg|png|gif|webp)$/i) ? 'image' \n                         : currentStory?.media_url?.match(/\\.(mp4|mov|webm)$/i) ? 'video' \n                         : null;\n\n  const handleReactionClick = (e) => {\n    e.stopPropagation();\n    setReactionMenuOpen((open) => !open);\n    setReactionAnchor(e.currentTarget);\n  };\n\n  const handleSelectReaction = async (emoji) => {\n    if (reactionLoading) return;\n    setReactionLoading(true);\n    try {\n      if (myReaction === emoji) {\n        // Снять реакцию\n        await addStoryReaction(currentStory.id, emoji);\n        setMyReaction(null);\n      } else {\n        await addStoryReaction(currentStory.id, emoji);\n        setMyReaction(emoji);\n      }\n      setReactionMenuOpen(false);\n    } finally {\n      setReactionLoading(false);\n    }\n  };\n\n  const isMyStory = currentUser?.id === displayUser.id;\n\n  return (\n    <ViewerContainer onClick={handleClose}>\n      <StoryContentContainer $isMobile={isMobileScreen || isMobile} onClick={(e) => e.stopPropagation()}>\n        <ProgressContainer>\n          {stories.map((_, index) => (\n            <ProgressBar\n              key={index}\n              progress={index === currentIndex ? progress : index < currentIndex ? 100 : 0}\n            />\n          ))}\n        </ProgressContainer>\n\n        <Header>\n          <UserInfo>\n            <UserAvatar \n              src={displayUser.photo ? `/static/uploads/avatar/${displayUser.id}/${displayUser.photo}` : undefined}\n              alt={displayUser.name || 'User'}\n            />\n            <Box sx={{ overflow: 'hidden' }}>\n              <Typography variant=\"subtitle1\" color=\"white\" sx={{ fontWeight: 600, lineHeight: 1.2, whiteSpace: 'nowrap', textOverflow: 'ellipsis', overflow: 'hidden' }}>\n                {displayUser.name || displayUser.username || 'Пользователь'}\n              </Typography>\n              <Typography variant=\"caption\" color=\"rgba(255, 255, 255, 0.7)\" sx={{ lineHeight: 1.2, whiteSpace: 'nowrap', textOverflow: 'ellipsis', overflow: 'hidden' }}>\n                {formatTime(currentStory?.created_at_unix, currentStory?.created_at_utc)}\n              </Typography>\n            </Box>\n          </UserInfo>\n          <Box>\n            {currentUser?.id === displayUser.id && (\n              <IconButton onClick={(e) => { e.stopPropagation(); setDeleteDialogOpen(true); }} sx={{ color: 'white', mr: 1 }}>\n                <DeleteIcon />\n              </IconButton>\n            )}\n            <IconButton onClick={(e) => { e.stopPropagation(); handleClose(); }} sx={{ color: 'white' }}>\n              <CloseIcon />\n            </IconButton>\n          </Box>\n        </Header>\n\n        <MediaContainer sx={{ position: 'relative' }}>\n          {lastLoadedBg && (\n            <BlurredMediaBackground\n              style={{\n                backgroundImage: `url(${lastLoadedBg})`,\n                opacity: bgLoaded ? 0 : 1,\n                zIndex: 0,\n                transition: 'opacity 0.3s'\n              }}\n            />\n          )}\n          {currentStory?.media_url && (\n            <BlurredMediaBackground\n              style={{\n                backgroundImage: `url(${currentStory.media_url})`,\n                opacity: bgLoaded ? 1 : 0,\n                zIndex: 1,\n                transition: 'opacity 0.3s'\n              }}\n            >\n              <img\n                src={currentStory.media_url}\n                style={{ display: 'none' }}\n                onLoad={() => setBgLoaded(true)}\n                alt=\"preload\"\n              />\n            </BlurredMediaBackground>\n          )}\n          <ClickableOverlay style={{ left: 0 }} onClick={handleOverlayClick} />\n          <ClickableOverlay style={{ right: 0, left: 'auto' }} onClick={handleOverlayClick} />\n          {currentMediaType === 'image' ? (\n            <>\n              <Media\n                src={currentStory?.media_url}\n                alt=\"Story\"\n                onLoad={startProgress}\n              />\n              <ControlsContainer>\n                <VisibilityIcon sx={{ color: 'white', fontSize: '1rem' }} />\n                <Typography\n                  variant=\"caption\"\n                  sx={{\n                    color: 'white',\n                    fontSize: '0.75rem',\n                    ml: 0.5\n                  }}\n                >\n                  {currentStory?.view_count || 0}\n                </Typography>\n              </ControlsContainer>\n            </>\n          ) : currentMediaType === 'video' ? (\n            <>\n              <Video\n                ref={videoRef}\n                src={currentStory?.media_url}\n                loop\n                autoPlay\n                playsInline\n                muted={isMuted}\n                onLoadedData={startProgress}\n              />\n              <ControlsContainer>\n                <VisibilityIcon sx={{ color: 'white', fontSize: '1rem' }} />\n                <Typography\n                  variant=\"caption\"\n                  sx={{\n                    color: 'white',\n                    fontSize: '0.75rem',\n                    ml: 0.5\n                  }}\n                >\n                  {currentStory?.view_count || 0}\n                </Typography>\n                <IconButton\n                  onClick={onToggleSound}\n                  sx={{\n                    color: 'white',\n                    '&:hover': {\n                      backgroundColor: 'rgba(0, 0, 0, 0.7)',\n                    },\n                    width: 32,\n                    height: 32,\n                    padding: 0,\n                  }}\n                >\n                  {isMuted ? <VolumeOffIcon fontSize=\"small\" /> : <VolumeUpIcon fontSize=\"small\" />}\n                </IconButton>\n              </ControlsContainer>\n            </>\n          ) : null}\n          {/* Реакции */}\n          <Box sx={{ position: 'absolute', left: '50%', bottom: 24, transform: 'translateX(-50%)', zIndex: 20 }}>\n            <IconButton\n              onClick={isMyStory ? () => setShowReactionsDialog(true) : handleReactionClick}\n              sx={{\n                fontSize: 28,\n                background: myReaction ? 'rgba(255,255,255,0.08)' : 'rgba(30,30,30,0.7)',\n                border: myReaction ? `2px solid ${theme.palette.primary.main}` : 'none',\n                color: myReaction ? theme.palette.primary.main : 'inherit',\n                transition: 'all 0.2s',\n                boxShadow: myReaction ? '0 2px 12px rgba(0,0,0,0.18)' : 'none',\n              }}\n            >\n              {myReaction || '😊'}\n            </IconButton>\n            {!isMyStory && (\n              <Popper open={reactionMenuOpen} anchorEl={reactionAnchor} placement=\"top\" transition disablePortal>\n                {({ TransitionProps }) => (\n                  <Fade {...TransitionProps} timeout={200}>\n                    <ReactionMenu>\n                      {REACTION_EMOJIS.map((emoji) => (\n                        <ReactionButton\n                          key={emoji}\n                          selected={myReaction === emoji}\n                          onClick={() => handleSelectReaction(emoji)}\n                          disabled={reactionLoading}\n                        >\n                          {emoji}\n                        </ReactionButton>\n                      ))}\n                    </ReactionMenu>\n                  </Fade>\n                )}\n              </Popper>\n            )}\n          </Box>\n        </MediaContainer>\n      </StoryContentContainer>\n\n      <Dialog open={deleteDialogOpen} onClose={() => setDeleteDialogOpen(false)}>\n        <DialogTitle>Удалить историю?</DialogTitle>\n        <DialogActions>\n          <Button onClick={() => setDeleteDialogOpen(false)} color=\"primary\">\n            Отмена\n          </Button>\n          <Button onClick={handleDeleteStory} color=\"error\" variant=\"contained\">\n            Удалить\n          </Button>\n        </DialogActions>\n      </Dialog>\n      <ReactionUsersDialog open={showReactionsDialog} onClose={() => setShowReactionsDialog(false)} storyId={currentStory?.id} />\n    </ViewerContainer>\n  );\n};\n\nexport default StoryViewer;","import React, { useState, useEffect, useRef, useContext, useMemo } from 'react';\nimport { Box, Avatar, Typography, IconButton, styled, Card, CircularProgress, Button } from '@mui/material';\nimport AddIcon from '@mui/icons-material/Add';\nimport CloseIcon from '@mui/icons-material/Close';\nimport VolumeUpIcon from '@mui/icons-material/VolumeUp';\nimport VolumeOffIcon from '@mui/icons-material/VolumeOff';\nimport VideocamIcon from '@mui/icons-material/Videocam';\nimport { useNavigate } from 'react-router-dom';\nimport StoryViewer from './StoryViewer';\nimport * as StoryViewerComponents from './StoryViewer';\nimport { AuthContext } from '../../context/AuthContext';\nimport { useStoriesFeed, useStoryActions, viewStory } from './storiesApi';\n\n// Деструктурируем нужные компоненты из импорта\nconst { \n  StoryContentContainer, \n  MediaContainer, \n  Media: StoryMedia, \n  BlurredMediaBackground,\n  ProgressContainer,\n  Header, \n  UserInfo, \n  UserAvatar \n} = StoryViewerComponents;\n\nconst StoriesCard = styled(Card)(({ theme }) => ({\n  borderRadius: '12px',\n  overflow: 'hidden',\n  boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',\n  background: 'rgba(255, 255, 255, 0.03)',\n  backdropFilter: 'blur(20px)',\n  WebkitBackdropFilter: 'blur(20px)', \n border: theme.palette.mode === 'dark'   \n    ? '1px solid rgba(255, 255, 255, 0.1)' \n    : '1px solid rgba(0, 0, 0, 0.1)',\n  marginBottom: 0\n}));\n\nconst StoriesContainer = styled(Box)(({ theme }) => ({\n  display: 'flex',\n  gap: 2,\n  overflowX: 'auto',\n  padding: '16px',\n  '&::-webkit-scrollbar': {\n    height: '0px',\n    display: 'none'\n  },\n  '&::-webkit-scrollbar-thumb': {\n    backgroundColor: 'transparent',\n  },\n  '&::-webkit-scrollbar-track': {\n    backgroundColor: 'transparent',\n  },\n  msOverflowStyle: 'none',\n  scrollbarWidth: 'none',\n}));\n\nconst StoryItem = styled(Box)(({ theme, hasStory }) => ({\n  display: 'flex',\n  flexDirection: 'column',\n  alignItems: 'center',\n  cursor: 'pointer',\n  position: 'relative',\n  '&:hover': {\n    transform: 'scale(1.02)',\n    transition: 'transform 0.2s ease',\n  },\n}));\n\nconst StoryPreview = styled(Box)(({ theme }) => ({\n  width: 64,\n  height: 64,\n  borderRadius: '50%',\n  overflow: 'hidden',\n  border: `2px solid ${theme.palette.primary.main}`,\n  \n  background: theme.palette.background.paper,\n'&::before': {\n    content: '\"\"',\n    position: 'absolute',\n    top: -2,\n    left: -2,\n    right: -2,\n    bottom: -2,\n    borderRadius: '50%',\n    zIndex: -1,\n  },\n}));\n\nconst AddStoryButton = styled(IconButton)(({ theme }) => ({\n  width: 64,\n  height: 64,\n  border: `2px solid ${theme.palette.primary.main}`,\n  backgroundColor: theme.palette.background.paper,\n  '&:hover': {\n    backgroundColor: 'rgba(208, 188, 255, 0.1)',\n  },\n}));\n\nconst PreviewActionBox = styled(Box)(({ theme }) => ({\n  position: 'absolute',\n  bottom: 16,\n  left: 0,\n  right: 0,\n  display: 'flex',\n  justifyContent: 'center',\n  gap: 16,\n  zIndex: 100, // Убедимся, что кнопки поверх предпросмотра\n}));\n\nconst Stories = ({ userIdentifier = null }) => {\n  const { stories, loading, loadStories, setStories } = useStoriesFeed(userIdentifier);\n  const { publish: publishStory } = useStoryActions();\n  const [currentUserIndex, setCurrentUserIndex] = useState(null);\n  const [previewFile, setPreviewFile] = useState(null);\n  const [previewUrl, setPreviewUrl] = useState(null);\n  const [isMuted, setIsMuted] = useState(true);\n  const [isMobile, setIsMobile] = useState(false);\n  const [viewedStories, setViewedStories] = useState(new Set());\n  const fileInputRef = useRef(null);\n  const videoRef = useRef(null);\n  const { user } = useContext(AuthContext);\n\n  // Если пользователь не типа 'user', не показываем компонент\n  // Для просмотра историй другого пользователя не проверяем тип аккаунта\n  if (!userIdentifier && (!user || user.account_type !== 'user')) {\n    return null;\n  }\n\n  // Определяем, является ли текущий профиль профилем авторизованного пользователя\n  const isOwnProfile = userIdentifier === user?.id;\n\n  // Определяем, является ли устройство мобильным\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.matchMedia('(max-width: 600px)').matches);\n    };\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n\n  // Отслеживаем изменение громкости на мобильных устройствах\n  useEffect(() => {\n    if (!isMobile || !videoRef.current) return;\n\n    const handleVolumeChange = (e) => {\n      if (e.target.volume > 0) {\n        setIsMuted(false);\n      }\n    };\n\n    const video = videoRef.current;\n    video.addEventListener('volumechange', handleVolumeChange);\n\n    return () => {\n      video.removeEventListener('volumechange', handleVolumeChange);\n    };\n  }, [isMobile]);\n\n  useEffect(() => {\n    loadStories();\n  }, [loadStories]);\n\n  useEffect(() => {\n    if (!stories || stories.length === 0) return;\n    setViewedStories(() => {\n      const viewed = new Set();\n      stories.forEach(storyGroup => {\n        storyGroup.stories.forEach(story => {\n          if (story.view_count > 0) {\n            viewed.add(story.id);\n          }\n        });\n      });\n      return viewed;\n    });\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [stories && stories.length > 0]);\n\n  // Преобразуем истории в плоский массив\n  const flattenedStories = useMemo(() => {\n    if (!stories || stories.length === 0) return [];\n    return stories.flatMap(storyGroup => \n      storyGroup.stories.map(story => ({\n        ...story,\n        user: storyGroup.user\n      }))\n    ).sort((a, b) => {\n      const aViewed = a.view_count > 0;\n      const bViewed = b.view_count > 0;\n      if (aViewed !== bViewed) {\n        return aViewed ? 1 : -1;\n      }\n      const aDate = new Date(a.created_at_utc || a.created_at);\n      const bDate = new Date(b.created_at_utc || b.created_at);\n      return bDate - aDate;\n    });\n  }, [stories]);\n\n  const handleStoryClick = (storyId) => {\n    const idx = flattenedStories.findIndex(s => s.id === storyId);\n    setCurrentUserIndex(idx);\n  };\n\n  const handleCloseStory = () => {\n    setCurrentUserIndex(null);\n  };\n\n  const handleAddStory = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = (event) => {\n    const file = event.target.files[0];\n    if (!file) return;\n    setPreviewFile(file);\n    setPreviewUrl(URL.createObjectURL(file));\n  };\n\n  const handleCancelPreview = () => {\n    setPreviewFile(null);\n    setPreviewUrl(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const handlePublishStory = async () => {\n    if (!previewFile) return;\n    try {\n      await publishStory(previewFile);\n      await loadStories(); // Обновляем список историй после успешной загрузки\n      handleCancelPreview();\n    } catch (error) {\n      console.error('Error uploading story:', error);\n      alert('Ошибка при загрузке истории');\n    }\n  };\n\n  const handleToggleSound = (e) => {\n    e.stopPropagation();\n    setIsMuted(!isMuted);\n  };\n\n  const previewMediaType = previewFile?.type.startsWith('video') ? 'video' : 'image';\n\n  const areAllStoriesViewed = (storyGroup) => {\n    return storyGroup.stories.every(story => viewedStories.has(story.id));\n  };\n\n  const updateViewedStories = async (storyId) => {\n    // Создаём новый Set, чтобы React всегда увидел изменение\n    setViewedStories(prev => new Set([...prev, storyId]));\n    try {\n      await viewStory(storyId);\n      setStories(prevStories => prevStories.map(storyGroup => ({\n        ...storyGroup,\n        stories: storyGroup.stories.map(story =>\n          story.id === storyId\n            ? { ...story, view_count: (story.view_count || 0) + 1 }\n            : story\n        )\n      })));\n    } catch (e) {\n      // ignore\n    }\n  };\n\n  // Переключение на следующего пользователя\n  const handleNextUser = () => {\n    if (currentUserIndex < flattenedStories.length - 1) {\n      setCurrentUserIndex(currentUserIndex + 1);\n    } else {\n      setCurrentUserIndex(null); // Закрыть viewer\n    }\n  };\n\n  // Удаление истории из массива stories\n  const handleStoryDeleted = (deletedId) => {\n    setStories(prevStories => {\n      const updatedStories = prevStories.map((sg, idx) => {\n        if (idx !== currentUserIndex) return sg;\n        return {\n          ...sg,\n          stories: sg.stories.filter(story => story.id !== deletedId)\n        };\n      }).filter(sg => sg.stories.length > 0); // Удаляем пользователя, если не осталось историй\n      // Если у текущего пользователя не осталось историй — перейти к следующему\n      if (\n        updatedStories.length > 0 &&\n        (!updatedStories[currentUserIndex] || updatedStories[currentUserIndex].stories.length === 0)\n      ) {\n        setCurrentUserIndex(idx => (idx < updatedStories.length ? idx : null));\n      } else if (updatedStories.length === 0) {\n        setCurrentUserIndex(null);\n      }\n      return updatedStories;\n    });\n  };\n\n  if (loading) {\n    return (\n      <StoriesCard>\n        <Box sx={{ p: 2, display: 'flex', alignItems: 'center' }}>\n          <CircularProgress size={20} sx={{ mr: 2 }} />\n          <Typography variant=\"h6\" sx={{ fontSize: '1.1rem' }}>\n            Загрузка...\n          </Typography>\n        </Box>\n      </StoriesCard>\n    );\n  }\n\n  // Проверяем ответ API после загрузки\n  if (!loading && !isOwnProfile && (!stories || stories.length === 0)) {\n    return null;\n  }\n\n  return (\n    <>\n      <StoriesCard>\n        <StoriesContainer>\n          <input\n            type=\"file\"\n            ref={fileInputRef}\n            onChange={handleFileChange}\n            accept=\"image/*,video/*\"\n            style={{ display: 'none' }}\n          />\n          {/* Add Story Button - показываем только на своем профиле */}\n          {isOwnProfile && (\n            <StoryItem>\n              <AddStoryButton onClick={handleAddStory}>\n                <AddIcon color=\"primary\" />\n              </AddStoryButton>\n            </StoryItem>\n          )}\n          {/* Stories List */}\n          {flattenedStories.map((story) => (\n            <StoryItem \n              key={story.id}\n              onClick={() => handleStoryClick(story.id)}\n            >\n              <StoryPreview>\n                {story.preview_url ? (\n                  <Box\n                    component=\"img\"\n                    src={story.preview_url}\n                    alt=\"story preview\"\n                    sx={{\n                      width: '100%',\n                      height: '100%',\n                      objectFit: 'cover'\n                    }}\n                  />\n                ) : (\n                  <Box\n                    sx={{\n                      width: '100%',\n                      height: '100%',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      background: 'transparent'\n                    }}\n                  >\n                    <VideocamIcon sx={{ color: 'primary.main', fontSize: 32 }} />\n                  </Box>\n                )}\n              </StoryPreview>\n            </StoryItem>\n          ))}\n        </StoriesContainer>\n\n        {/* Preview Modal */}\n        {previewFile && previewUrl && (\n          <Box \n            sx={{\n              position: 'fixed',\n              top: 0,\n              left: 0,\n              right: 0,\n              bottom: 0,\n              zIndex: 2000,\n              background: 'rgba(0,0,0,0.9)',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n            }} \n            onClick={handleCancelPreview}\n          >\n            <Box \n              onClick={(e) => e.stopPropagation()}\n              sx={{\n                width: '100%',\n                height: '100%',\n                display: 'flex',\n                flexDirection: 'column',\n                position: 'relative',\n                borderRadius: 2,\n                overflow: 'hidden',\n                maxWidth: 400,\n                maxHeight: 600,\n              }}\n            >\n              {/* Blurred Background */}\n              <Box\n                sx={{\n                  position: 'absolute',\n                  top: 0,\n                  left: 0,\n                  right: 0,\n                  bottom: 0,\n                  backgroundImage: `url(${previewUrl})`,\n                  backgroundSize: 'cover',\n                  backgroundPosition: 'center',\n                  filter: 'blur(20px)',\n                  transform: 'scale(1.05)',\n                  zIndex: -1,\n                  opacity: 1,\n                }}\n              />\n              {/* Header */}\n              <Box\n                sx={{\n                  position: 'absolute',\n                  top: 0,\n                  left: 0,\n                  right: 0,\n                  padding: 2,\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'space-between',\n                  zIndex: 10,\n                }}\n              >\n                <Box\n                  sx={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 1,\n                    zIndex: 1,\n                    maxWidth: 'calc(100% - 80px)',\n                  }}\n                >\n                  <Avatar\n                    src={user?.photo ? `/static/uploads/avatar/${user.id}/${user.photo}` : undefined}\n                    alt={user?.name || 'You'}\n                    sx={{\n                      width: 32,\n                      height: 32,\n                      border: theme => `2px solid ${theme.palette.primary.main}`,\n                      flexShrink: 0,\n                    }}\n                  />\n                  <Box sx={{ overflow: 'hidden' }}>\n                    <Typography \n                      variant=\"subtitle1\" \n                      color=\"white\" \n                      sx={{ \n                        fontWeight: 600, \n                        lineHeight: 1.2, \n                        whiteSpace: 'nowrap', \n                        textOverflow: 'ellipsis', \n                        overflow: 'hidden' \n                      }}\n                    >\n                      {user?.name || 'Ваша история'}\n                    </Typography>\n                  </Box>\n                </Box>\n                <IconButton \n                  onClick={(e) => { \n                    e.stopPropagation(); \n                    handleCancelPreview(); \n                  }} \n                  sx={{ color: 'white', zIndex: 1 }}\n                >\n                  <CloseIcon />\n                </IconButton>\n              </Box>\n              {/* Media Container */}\n              <Box\n                sx={{\n                  flex: 1,\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  position: 'relative',\n                }}\n              >\n                {previewMediaType === 'image' ? (\n                  <Box\n                    component=\"img\"\n                    src={previewUrl}\n                    alt=\"preview\"\n                    sx={{\n                      maxWidth: '100%',\n                      maxHeight: '100%',\n                      objectFit: 'contain',\n                      position: 'relative',\n                      zIndex: 1,\n                    }}\n                  />\n                ) : (\n                  <>\n                    <Box\n                      component=\"video\"\n                      ref={videoRef}\n                      src={previewUrl}\n                      loop\n                      autoPlay\n                      playsInline\n                      muted={isMuted}\n                      sx={{\n                        maxWidth: '100%',\n                        maxHeight: '100%',\n                        objectFit: 'contain',\n                        position: 'relative',\n                        zIndex: 1,\n                      }}\n                    />\n                    <Box\n                      sx={{\n                        position: 'absolute',\n                        bottom: 16,\n                        right: 16,\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: 1,\n                        zIndex: 1000,\n                      }}\n                    >\n                      <IconButton\n                        onClick={handleToggleSound}\n                        sx={{\n                          color: 'white',\n                          backgroundColor: 'rgba(0, 0, 0, 0.5)',\n                          '&:hover': {\n                            backgroundColor: 'rgba(0, 0, 0, 0.7)',\n                          },\n                          width: 32,\n                          height: 32,\n                          padding: 0,\n                        }}\n                      >\n                        {isMuted ? <VolumeOffIcon fontSize=\"small\" /> : <VolumeUpIcon fontSize=\"small\" />}\n                      </IconButton>\n                    </Box>\n                  </>\n                )}\n              </Box>\n              {/* Action Buttons */}\n              <Box\n                sx={{\n                  position: 'absolute',\n                  bottom: 16,\n                  left: 0,\n                  right: 0,\n                  display: 'flex',\n                  justifyContent: 'center',\n                  gap: 2,\n                  zIndex: 100,\n                }}\n              >\n                <Button \n                  variant=\"contained\" \n                  color=\"primary\" \n                  onClick={(e) => { \n                    e.stopPropagation(); \n                    handlePublishStory(); \n                  }}\n                >\n                  Опубликовать\n                </Button>\n                <Button \n                  variant=\"outlined\" \n                  color=\"secondary\" \n                  onClick={(e) => { \n                    e.stopPropagation(); \n                    handleCancelPreview(); \n                  }}\n                >\n                  Отмена\n                </Button>\n              </Box>\n            </Box>\n          </Box>\n        )}\n      </StoriesCard>\n\n      {/* Story Viewer */}\n      {currentUserIndex !== null && flattenedStories[currentUserIndex] && (\n        <StoryViewer\n          userStories={{\n            user: flattenedStories[currentUserIndex].user,\n            stories: [flattenedStories[currentUserIndex]]\n          }}\n          currentUserIndex={0}\n          setCurrentUserIndex={setCurrentUserIndex}\n          onClose={handleCloseStory}\n          currentUserId={flattenedStories[currentUserIndex]?.user?.id}\n          onStoryDeleted={handleStoryDeleted}\n          isMuted={isMuted}\n          onToggleSound={handleToggleSound}\n          isMobile={isMobile}\n          onStoryViewed={updateViewedStories}\n          onNextUser={handleNextUser}\n        />\n      )}\n    </>\n  );\n};\n\nexport default Stories; ","import React, { useState, useEffect, useContext, useRef } from 'react';\nimport { \n  Box, \n  Typography, \n  Button, \n  CircularProgress, \n  Container, \n  Grid, \n  Avatar, \n  Paper, \n  Tabs, \n  Tab, \n  IconButton, \n  Snackbar, \n  Alert, \n  TextField, \n  Tooltip, \n  Link as MuiLink,\n  ImageList,\n  ImageListItem,\n  Chip,\n  SvgIcon\n} from '@mui/material';\nimport { styled } from '@mui/material/styles';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Link, useParams, useLocation, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { AuthContext } from '../../context/AuthContext';\nimport PostService from '../../services/PostService';\nimport 'react-medium-image-zoom/dist/styles.css';\nimport { ThemeSettingsContext } from '../../App';\nimport { formatDate } from '../../utils/dateUtils';\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\nimport TabContentLoader from '../../components/UI/TabContentLoader';\nimport { UsernameCard, VerificationBadge } from '../../UIKIT';\nimport PersonAddIcon from '@mui/icons-material/PersonAdd';\nimport PersonRemoveIcon from '@mui/icons-material/PersonRemove';\nimport CloseIcon from '@mui/icons-material/Close';\nimport LocationOnIcon from '@mui/icons-material/LocationOn';\nimport LinkIcon from '@mui/icons-material/Link';\nimport MusicNoteIcon from '@mui/icons-material/MusicNote';\nimport ImageOutlinedIcon from '@mui/icons-material/ImageOutlined';\nimport MusicSelectDialog from '../../components/Music/MusicSelectDialog';\nimport InfoIcon from '@mui/icons-material/Info';\nimport CakeIcon from '@mui/icons-material/Cake';\nimport TodayIcon from '@mui/icons-material/Today';\nimport AccessTimeIcon from '@mui/icons-material/AccessTime';\nimport AlternateEmailIcon from '@mui/icons-material/AlternateEmail';\nimport DiamondIcon from '@mui/icons-material/Diamond';\nimport ChatIcon from '@mui/icons-material/Chat';\nimport WarningIcon from '@mui/icons-material/Warning';\nimport BlockIcon from '@mui/icons-material/Block';\nimport { Icon } from '@iconify/react';\nimport { PostsFeed, WallFeed } from './components';\nimport EmojiEventsIcon from '@mui/icons-material/EmojiEvents';\nimport ModeCommentOutlinedIcon from '@mui/icons-material/ModeCommentOutlined';\nimport PeopleAltIcon from '@mui/icons-material/PeopleAlt';\nimport { MusicContext } from '../../context/MusicContext';\nimport FavoriteIcon from '@mui/icons-material/Favorite';\nimport CompareArrowsIcon from '@mui/icons-material/CompareArrows';\nimport LinkRoundedIcon from '@mui/icons-material/LinkRounded';\nimport DynamicIslandNotification from '../../components/DynamicIslandNotification';\nimport { Stories } from '../../UIKIT/Stories';\n\n\nconst PostInput = styled(TextField)(({ theme }) => ({\n  '& .MuiInputBase-root': {\n    background: theme.palette.mode === 'dark' \n      ? 'rgba(0, 0, 0, 0.2)'\n      : 'rgba(0, 0, 0, 0.03)',\n    backdropFilter: 'blur(5px)',\n    borderRadius: '12px',\n    border: theme.palette.mode === 'dark'\n      ? '1px solid rgba(255, 255, 255, 0.05)'\n      : '1px solid rgba(0, 0, 0, 0.05)',\n    fontSize: '0.95rem',\n    padding: theme.spacing(1, 1.5),\n    color: theme.palette.text.primary,\n    transition: 'all 0.3s ease',\n    '&:hover': {\n      borderColor: 'rgba(208, 188, 255, 0.3)',\n      background: theme.palette.mode === 'dark'\n        ? 'rgba(0, 0, 0, 0.25)'\n        : 'rgba(0, 0, 0, 0.05)',\n    },\n    '&.Mui-focused': {\n      borderColor: 'rgba(208, 188, 255, 0.5)',\n      boxShadow: '0 0 0 2px rgba(208, 188, 255, 0.1)'\n    }\n  },\n  '& .MuiOutlinedInput-notchedOutline': {\n    border: 'none'\n  },\n  width: '100%'\n}));\n\n\nconst PostActions = styled(Box)(({ theme }) => ({\n  display: 'flex',\n  justifyContent: 'space-between',\n  padding: theme.spacing(1.5, 0, 0),\n  borderTop: '1px solid rgba(255, 255, 255, 0.05)',\n  marginTop: theme.spacing(1.5)\n}));\n\n\n\n\n\nconst PublishButton = styled(Button)(({ theme }) => ({\n  borderRadius: '18px',\n  textTransform: 'none',\n  fontSize: '0.6rem',\n  fontWeight: 600,\n  boxShadow: '0 2px 8px rgba(124, 77, 255, 0.25)',\n  padding: theme.spacing(0.4, 1.5),\n  background: theme.palette.mode === 'dark'\n    ? 'linear-gradient(90deg, rgb(180 163 220) 0%, rgb(177 161 216) 100%)'\n    : 'linear-gradient(90deg, rgb(124 77 255) 0%, rgb(148 108 255) 100%)',\n  color: theme.palette.mode === 'dark' ? '#000' : '#fff',\n  '&:hover': {\n    boxShadow: '0 4px 12px rgba(124, 77, 255, 0.35)',\n  },\n  '&.Mui-disabled': {\n    background: theme.palette.mode === 'dark'\n      ? 'rgba(255, 255, 255, 0.05)'\n      : 'rgba(0, 0, 0, 0.05)',\n    color: theme.palette.mode === 'dark'\n      ? 'rgba(255, 255, 255, 0.3)'\n      : 'rgba(0, 0, 0, 0.3)'\n  }\n}));\n\n\nconst CreatePost = ({ onPostCreated, postType = 'post', recipientId = null }) => {\n  const { user } = useContext(AuthContext);\n  const { playTrack, currentTrack, isPlaying, togglePlay } = useContext(MusicContext);\n  const [content, setContent] = useState('');\n  const [mediaFiles, setMediaFiles] = useState([]);\n  const [mediaType, setMediaType] = useState('');\n  const [mediaPreview, setMediaPreview] = useState([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState('');\n  const fileInputRef = useRef(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [mediaNotification, setMediaNotification] = useState({ open: false, message: '' });\n  const [musicSelectOpen, setMusicSelectOpen] = useState(false);\n  const [selectedTracks, setSelectedTracks] = useState([]);\n  const [snackbar, setSnackbar] = useState({\n    open: false,\n    message: '',\n    severity: 'error'\n  });\n  const [rateLimitDialog, setRateLimitDialog] = useState({\n    open: false,\n    message: '',\n    timeRemaining: 0\n  });\n  const [showSizeError, setShowSizeError] = useState(false);\n  const [sizeErrorMessage, setSizeErrorMessage] = useState('');\n\n  // Добавляем константы в начало компонента\n  const MAX_VIDEO_SIZE = 150 * 1024 * 1024; // 150MB in bytes\n  const MAX_PHOTO_SIZE = 50 * 1024 * 1024;  // 50MB in bytes\n  const ALLOWED_IMAGE_TYPES = [\n    'image/jpeg',\n    'image/png',\n    'image/gif',\n    'image/webp',\n    'image/heic',\n    'image/heif'\n  ];\n  const ALLOWED_VIDEO_TYPES = [\n    'video/mp4',\n    'video/webm',\n    'video/quicktime',\n    'video/x-msvideo',\n    'video/x-matroska'\n  ];\n\n  useEffect(() => {\n    if (error) setError('');\n  }, [content, mediaFiles, selectedTracks, error]);\n\n  const dragCounter = useRef(0);\n\n  const handleDragEnter = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    dragCounter.current += 1;\n    if (dragCounter.current === 1) {\n      setIsDragging(true);\n    }\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDragLeave = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    dragCounter.current -= 1;\n    if (dragCounter.current === 0) {\n      setIsDragging(false);\n    }\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    setDragActive(false);\n    \n    const files = e.dataTransfer.files;\n    if (!files.length) return;\n\n    let hasInvalidSize = false;\n\n    Array.from(files).forEach(file => {\n      const isVideo = file.type.startsWith('video/');\n      const isImage = file.type.startsWith('image/');\n\n      if (isVideo && file.size > MAX_VIDEO_SIZE) {\n        setSizeErrorMessage(`Размер видео превышает лимит в 150МБ`);\n        setShowSizeError(true);\n        hasInvalidSize = true;\n      }\n\n      if (isImage && file.size > MAX_PHOTO_SIZE) {\n        setSizeErrorMessage(`Размер изображения превышает лимит в 50МБ`);\n        setShowSizeError(true);\n        hasInvalidSize = true;\n      }\n    });\n\n    if (hasInvalidSize) return;\n\n    processFiles(files);\n  };\n\n  const handleMediaChange = (event) => {\n    event.preventDefault();\n    const files = event.target.files;\n    if (!files.length) return;\n\n    let hasInvalidSize = false;\n    \n    // Проверяем размер после выбора\n    Array.from(files).forEach(file => {\n      const isVideo = file.type.startsWith('video/');\n      const isImage = file.type.startsWith('image/');\n\n      if (isVideo && file.size > MAX_VIDEO_SIZE) {\n        setSizeErrorMessage(`Размер видео превышает лимит в 150МБ`);\n        setShowSizeError(true);\n        hasInvalidSize = true;\n      }\n\n      if (isImage && file.size > MAX_PHOTO_SIZE) {\n        setSizeErrorMessage(`Размер изображения превышает лимит в 50МБ`);\n        setShowSizeError(true);\n        hasInvalidSize = true;\n      }\n    });\n\n    if (hasInvalidSize) {\n      event.target.value = '';\n      return;\n    }\n\n    processFiles(files);\n  };\n\n  // Обновляем processFiles для работы с уже проверенными файлами\n  const processFiles = (files) => {\n    if (!files.length) return;\n\n    // Проверяем MIME-типы файлов\n    const allFiles = Array.from(files);\n    const validTypeFiles = allFiles.filter(file => {\n      const isValidImage = ALLOWED_IMAGE_TYPES.includes(file.type);\n      const isValidVideo = ALLOWED_VIDEO_TYPES.includes(file.type);\n\n      if (!isValidImage && !isValidVideo) {\n        window.dispatchEvent(new CustomEvent('showError', {\n          detail: {\n            message: `Неподдерживаемый формат файла: ${file.name}. Разрешены только изображения (JPEG, PNG, GIF, WEBP) и видео (MP4, WEBM, MOV, AVI, MKV)`,\n            severity: 'error'\n          }\n        }));\n        return false;\n      }\n      return true;\n    });\n\n    if (validTypeFiles.length === 0) {\n      return;\n    }\n\n    const imageFiles = validTypeFiles.filter(file => ALLOWED_IMAGE_TYPES.includes(file.type));\n    const videoFiles = validTypeFiles.filter(file => ALLOWED_VIDEO_TYPES.includes(file.type));\n\n    // Если уже есть видео, не позволяем добавлять изображения\n    if (mediaType === 'video' && imageFiles.length > 0) {\n      setMediaNotification({\n        open: true,\n        message: 'Нельзя прикрепить фото и видео одновременно'\n      });\n      return;\n    }\n\n    // Если уже есть изображения, не позволяем добавлять видео\n    if (mediaType === 'image' && videoFiles.length > 0) {\n      setMediaNotification({\n        open: true,\n        message: 'Нельзя прикрепить фото и видео одновременно'\n      });\n      return;\n    }\n\n    // Обработка видео\n    if (videoFiles.length > 0) {\n      setMediaFiles([videoFiles[0]]);\n      setMediaType('video');\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setMediaPreview([reader.result]);\n      };\n      reader.readAsDataURL(videoFiles[0]);\n      return;\n    }\n\n    // Обработка изображений\n    if (imageFiles.length > 0) {\n      setMediaFiles(prev => [...prev, ...imageFiles]);\n      setMediaType('image');\n      \n      // Создаем превью для всех изображений\n      const newPreviews = [];\n      imageFiles.forEach(file => {\n        const reader = new FileReader();\n        reader.onloadend = () => {\n          newPreviews.push(reader.result);\n          if (newPreviews.length === imageFiles.length) {\n            setMediaPreview(prev => [...prev, ...newPreviews]);\n          }\n        };\n        reader.readAsDataURL(file);\n      });\n    }\n  };\n\n  const handleRemoveMedia = () => {\n    setMediaFiles([]);\n    setMediaPreview([]);\n    setMediaType('');\n    setSelectedTracks([]);\n    setError('');\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const handleMusicSelect = (tracks) => {\n    setSelectedTracks(tracks);\n  };\n\n  const handleRemoveTrack = (trackId) => {\n    setSelectedTracks(prev => prev.filter(track => track.id !== trackId));\n  };\n\n  const clearForm = () => {\n    setContent('');\n    setMediaFiles([]);\n    setMediaPreview([]);\n    setMediaType('');\n    setSelectedTracks([]);\n    setError('');\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const handleTrackPlay = (track, event) => {\n    if (event) {\n      event.stopPropagation();\n    }\n    \n    if (currentTrack && currentTrack.id === track.id) {\n      togglePlay(); \n    } else {\n      playTrack(track); \n    }\n  };\n\n  const handlePaste = (e) => {\n    const clipboardData = e.clipboardData;\n    if (clipboardData.items) {\n      const items = clipboardData.items;\n      for (let i = 0; i < items.length; i++) {\n        if (items[i].type.indexOf('image') !== -1) {\n          e.preventDefault();  \n          const file = items[i].getAsFile();\n          if (file) {\n            if (mediaType && mediaType === 'video') {\n              setMediaNotification({\n                open: true,\n                message: 'Нельзя прикрепить фото и видео одновременно'\n              });\n              return;\n            }\n\n            // Обновляем тип медиа на 'images' для множественной загрузки\n            setMediaType('images');\n            setMediaFiles(prev => [...prev, file]);\n            \n            const reader = new FileReader();\n            reader.onloadend = () => {\n              setMediaPreview(prev => [...prev, reader.result]);\n            };\n            reader.readAsDataURL(file);\n            break;\n          }\n        }\n      }\n    }\n  };\n\n  const handleSubmit = async () => {\n    if (!content.trim() && mediaFiles.length === 0 && selectedTracks.length === 0) return;\n    \n    try {\n      setIsSubmitting(true);\n      setError('');\n      console.log(\"Starting post submission...\");\n      \n      const formData = new FormData();\n      formData.append('content', content.trim());\n      \n      console.log(\"Added content to FormData:\", content.trim());\n      \n      if (postType && postType !== 'post') {\n        formData.append('type', postType);\n      }\n      \n      if (recipientId) {\n        formData.append('recipient_id', recipientId);\n      }\n      \n      if (mediaType === 'image') {\n        // Отправляем все изображения с правильным форматом\n        mediaFiles.forEach((file, index) => {\n          console.log(`Adding image[${index}]:`, file.name, file.size);\n          formData.append(`images[${index}]`, file); // Исправлено на правильный формат\n        });\n      } else if (mediaType === 'video') {\n        console.log(\"Adding video to FormData:\", mediaFiles[0].name, mediaFiles[0].size);\n        formData.append('video', mediaFiles[0]);\n      }\n      \n      if (selectedTracks.length > 0) {\n        console.log(`Adding ${selectedTracks.length} music tracks to post`);\n        \n        const trackData = selectedTracks.map(track => ({\n          id: track.id,\n          title: track.title,\n          artist: track.artist,\n          duration: track.duration,\n          file_path: track.file_path,\n          cover_path: track.cover_path\n        }));\n        formData.append('music', JSON.stringify(trackData));\n      }\n      \n      console.log(\"Sending post request to server...\");\n      const response = await PostService.createPost(formData);\n      console.log('Post created:', response);\n      \n      if (response && response.success) {\n        clearForm();\n        if (onPostCreated && response.post) {\n          onPostCreated(response.post);\n        }\n        console.log('Post created successfully');\n      }\n    } catch (error) {\n      console.error('Error creating post:', error);\n      \n      if (error.response && error.response.status === 429) {\n        const rateLimit = error.response.data.rate_limit;\n        let errorMessage = \"Превышен лимит публикации постов. \";\n        \n        if (rateLimit && rateLimit.reset) {\n          const resetTime = new Date(rateLimit.reset * 1000);\n          const now = new Date();\n          const diffSeconds = Math.round((resetTime - now) / 1000);\n          \n          if (diffSeconds > 60) {\n            const minutes = Math.floor(diffSeconds / 60);\n            const seconds = diffSeconds % 60;\n            errorMessage += `Следующий пост можно опубликовать через ${minutes} мин. ${seconds} сек.`;\n          } else {\n            errorMessage += `Следующий пост можно опубликовать через ${diffSeconds} сек.`;\n          }\n        } else {\n          errorMessage += \"Пожалуйста, повторите попытку позже.\";\n        }\n        \n        setError(errorMessage);\n      } else if (error.response && error.response.data && error.response.data.error) {\n        setError(error.response.data.error);\n      } else {\n        setError(\"Произошла ошибка при создании поста. Пожалуйста, попробуйте еще раз.\");\n      }\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (!user) return null;\n  \n  return (\n    <Paper \n      elevation={0} \n      sx={{ \n        p: 2, \n        borderRadius: 1,\n        background: 'rgba(255, 255, 255, 0.03)',\n        backdropFilter: 'blur(20px)',\n        WebkitBackdropFilter: 'blur(20px)',\n        position: 'relative',\n        overflow: 'hidden',\n        border: '1px solid rgba(255, 255, 255, 0.1)',\n\n      }}\n    >\n      {error && (\n        <Alert \n          severity=\"error\" \n          sx={{ mb: 2 }}\n          onClose={() => setError('')}\n        >\n          {error}\n        </Alert>\n      )}\n      \n      <Box \n        component=\"form\" \n        onSubmit={(e) => {\n          e.preventDefault();\n          handleSubmit();\n        }}\n        sx={{ \n          position: 'relative',\n          zIndex: 1 \n        }}\n        onDragEnter={handleDragEnter}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n      >\n        <Box \n          sx={{ \n            display: 'flex', \n            flexDirection: 'column',\n            position: 'relative',\n            borderRadius: '12px',\n            border: isDragging ? '2px dashed #D0BCFF' : 'none',\n            backgroundColor: isDragging ? 'rgba(208, 188, 255, 0.05)' : 'transparent',\n            padding: isDragging ? 1 : 0,\n            transition: 'all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)'\n          }}\n        >\n          {isDragging && (\n            <Box \n              sx={{\n                position: 'absolute',\n                top: 0,\n                left: 0,\n                right: 0,\n                bottom: 0,\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                flexDirection: 'column',\n                backgroundColor: 'rgba(26, 26, 26, 0.7)',\n                borderRadius: '12px',\n                zIndex: 10,\n                opacity: isDragging ? 1 : 0,\n                transition: 'opacity 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)'\n              }}\n            >\n              <ImageOutlinedIcon sx={{ fontSize: 40, color: '#D0BCFF', mb: 1, filter: 'drop-shadow(0 0 8px rgba(208, 188, 255, 0.6))' }} />\n              <Typography variant=\"body1\" color=\"primary\" sx={{ fontWeight: 'medium', textShadow: '0 1px 3px rgba(0,0,0,0.3)' }}>\n                Перетащите файлы сюда\n              </Typography>\n            </Box>\n          )}\n          \n          <Box sx={{ display: 'flex', alignItems: 'flex-start', mb: 1 }}>\n            <Avatar \n              src={user.photo ? `/static/uploads/avatar/${user.id}/${user.photo}` : undefined}\n              alt={user.name}\n              sx={{ \n                mr: 1.5, \n                width: 40, \n                height: 40, \n                border: '2px solid rgba(208, 188, 255)',\n                boxShadow: '0 2px 8px rgba(0, 0, 0, 0.2)',\n                transition: 'all 0.2s ease',\n                '&:hover': {\n                  transform: 'scale(1.05)',\n                  boxShadow: '0 3px 10px rgba(0, 0, 0, 0.3)'\n                }\n              }}\n            />\n            <PostInput\n              placeholder=\"Что у вас нового?\"\n              multiline\n              maxRows={6}\n              value={content}\n              onChange={(e) => setContent(e.target.value)}\n              onPaste={handlePaste}\n              fullWidth\n            />\n          </Box>\n          \n          \n          {mediaPreview.length > 0 && (\n            <Box sx={{ position: 'relative', mb: 2 }}>\n              <Box sx={{ \n                position: 'relative',\n                borderRadius: '12px',\n                overflow: 'hidden',\n                border: '1px solid rgba(255, 255, 255, 0.1)',\n                backgroundColor: 'rgba(0, 0, 0, 0.2)'\n              }}>\n                {mediaType === 'image' ? (\n                  <ImageList \n                    sx={{ \n                      width: '100%', \n                      height: 'auto',\n                      maxHeight: 500,\n                      margin: 0,\n                      padding: 1\n                    }} \n                    cols={mediaPreview.length > 3 ? 3 : mediaPreview.length} \n                    rowHeight={164}\n                    gap={8}\n                  >\n                    {mediaPreview.map((preview, index) => (\n                      <ImageListItem \n                        key={index}\n                        sx={{\n                          position: 'relative',\n                          borderRadius: '8px',\n                          overflow: 'hidden',\n                          border: '1px solid rgba(255, 255, 255, 0.1)'\n                        }}\n                      >\n                        <img\n                          src={preview}\n                          alt={`Preview ${index + 1}`}\n                          style={{ \n                            objectFit: 'cover',\n                            height: '100%',\n                            width: '100%',\n                            borderRadius: '8px'\n                          }}\n                        />\n                        <IconButton\n                          onClick={() => {\n                            setMediaFiles(prev => prev.filter((_, i) => i !== index));\n                            setMediaPreview(prev => prev.filter((_, i) => i !== index));\n                            if (mediaPreview.length === 1) {\n                              setMediaType('');\n                            }\n                          }}\n                          sx={{\n                            position: 'absolute',\n                            top: 4,\n                            right: 4,\n                            backgroundColor: 'rgba(0, 0, 0, 0.6)',\n                            color: 'white',\n                            padding: '4px',\n                            '&:hover': {\n                              backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                            },\n                            backdropFilter: 'blur(4px)'\n                          }}\n                        >\n                          <CloseIcon fontSize=\"small\" />\n                        </IconButton>\n                      </ImageListItem>\n                    ))}\n                  </ImageList>\n                ) : (\n                  <video\n                    src={mediaPreview[0]}\n                    controls\n                    style={{ \n                      width: '100%', \n                      maxHeight: '300px',\n                      borderRadius: '12px'\n                    }}\n                  />\n                )}\n                {mediaType === 'video' && (\n                  <IconButton\n                    onClick={handleRemoveMedia}\n                    sx={{\n                      position: 'absolute',\n                      top: 8,\n                      right: 8,\n                      backgroundColor: 'rgba(0, 0, 0, 0.6)',\n                      color: 'white',\n                      '&:hover': {\n                        backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                      },\n                      padding: '8px',\n                      backdropFilter: 'blur(4px)'\n                    }}\n                  >\n                    <CloseIcon fontSize=\"small\" />\n                  </IconButton>\n                )}\n              </Box>\n            </Box>\n          )}\n          \n          \n          {selectedTracks.length > 0 && (\n            <Box sx={{ mt: 2, mb: 1 }}>\n              {selectedTracks.map(track => (\n                <Box \n                  key={track.id}\n                  sx={{ \n                    display: 'flex', \n                    alignItems: 'center', \n                    py: 1, \n                    px: 2, \n                    mb: 1, \n                    borderRadius: '8px',\n                    bgcolor: theme => theme.palette.mode === 'dark'\n                      ? 'rgba(255, 255, 255, 0.05)'\n                      : 'rgba(0, 0, 0, 0.03)',\n                    border: theme => theme.palette.mode === 'dark'\n                      ? '1px solid rgba(255, 255, 255, 0.08)'\n                      : '1px solid rgba(0, 0, 0, 0.05)'\n                  }}\n                >\n                  <Box \n                    sx={{ \n                      width: 36, \n                      height: 36, \n                      borderRadius: '4px', \n                      overflow: 'hidden',\n                      mr: 1.5,\n                      position: 'relative',\n                      bgcolor: theme => theme.palette.mode === 'dark' \n                        ? 'rgba(0, 0, 0, 0.3)'\n                        : 'rgba(0, 0, 0, 0.1)',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center'\n                    }}\n                  >\n                    <img \n                      src={track.cover_path.startsWith('/static/') ? track.cover_path : `/static/uploads/music/covers/${track.cover_path}`} \n                      alt={track.title}\n                      style={{ width: '100%', height: '100%', objectFit: 'cover' }}\n                      onError={(e) => {\n                        e.target.src = '/uploads/system/album_placeholder.jpg';\n                      }}\n                    />\n                    <MusicNoteIcon \n                      sx={{ \n                        position: 'absolute', \n                        fontSize: 16, \n                        color: 'rgba(255, 255, 255, 0.7)'\n                      }} \n                    />\n                  </Box>\n                  <Box sx={{ flex: 1, minWidth: 0 }}>\n                    <Typography variant=\"body2\" noWrap>\n                      {track.title}\n                    </Typography>\n                    <Typography variant=\"caption\" color=\"text.secondary\" noWrap>\n                      {track.artist}\n                    </Typography>\n                  </Box>\n                  <IconButton \n                    size=\"small\" \n                    onClick={() => handleRemoveTrack(track.id)}\n                    sx={{ ml: 1 }}\n                  >\n                    <CloseIcon fontSize=\"small\" />\n                  </IconButton>\n                </Box>\n              ))}\n            </Box>\n          )}\n          \n          <PostActions>\n            <Box sx={{ display: 'flex', gap: 1 }}>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"image/*,video/*\"\n                onChange={handleMediaChange}\n                multiple\n                style={{ display: 'none' }}\n                id=\"media-upload-profile\"\n              />\n              <label htmlFor=\"media-upload-profile\">\n                <Button\n                  component=\"span\"\n                  startIcon={<ImageOutlinedIcon sx={{ fontSize: 18 }} />}\n                  sx={{\n                    color: mediaFiles.length > 0 || selectedTracks.length > 0 ? 'primary.main' : 'text.secondary',\n                    borderRadius: '10px',\n                    textTransform: 'none',\n                    fontSize: '0.8rem',\n                    fontWeight: 500,\n                    border: mediaFiles.length > 0 || selectedTracks.length > 0 \n                      ? '1px solid rgba(208, 188, 255, 0.5)'\n                      : theme => theme.palette.mode === 'dark'\n                        ? '1px solid rgba(255, 255, 255, 0.12)'\n                        : '1px solid rgba(0, 0, 0, 0.12)',\n                    padding: '4px 10px',\n                    '&:hover': {\n                      backgroundColor: 'rgba(208, 188, 255, 0.08)',\n                      borderColor: 'rgba(208, 188, 255, 0.4)'\n                    }\n                  }}\n                  size=\"small\"\n                >\n                  {mediaFiles.length > 0 ? `Файлы (${mediaFiles.length})` : 'Медиа'}\n                </Button>\n              </label>\n              \n              \n              <Button\n                onClick={() => setMusicSelectOpen(true)}\n                startIcon={<MusicNoteIcon sx={{ fontSize: 18 }} />}\n                sx={{\n                  color: selectedTracks.length > 0 ? 'primary.main' : 'text.secondary',\n                  borderRadius: '10px',\n                  textTransform: 'none',\n                  fontSize: '0.8rem',\n                  fontWeight: 500,\n                  padding: '4px 10px',\n                  border: selectedTracks.length > 0 \n                    ? '1px solid rgba(208, 188, 255, 0.5)' \n                    : theme => theme.palette.mode === 'dark'\n                      ? '1px solid rgba(255, 255, 255, 0.12)'\n                      : '1px solid rgba(0, 0, 0, 0.12)',\n                  '&:hover': {\n                    backgroundColor: 'rgba(208, 188, 255, 0.08)',\n                    borderColor: 'rgba(208, 188, 255, 0.4)'\n                  }\n                }}\n                size=\"small\"\n              >\n                {selectedTracks.length > 0 ? `Музыка (${selectedTracks.length})` : 'Музыка'}\n              </Button>\n            </Box>\n            \n            <PublishButton \n              variant=\"contained\" \n              onClick={handleSubmit}\n              disabled={isSubmitting || (!content.trim() && mediaFiles.length === 0 && selectedTracks.length === 0)}\n              endIcon={isSubmitting ? <CircularProgress size={14} color=\"inherit\" /> : null}\n              size=\"small\"\n            >\n              Опубликовать\n            </PublishButton>\n          </PostActions>\n          \n          \n          <MusicSelectDialog\n            open={musicSelectOpen}\n            onClose={() => setMusicSelectOpen(false)}\n            onSelectTracks={handleMusicSelect}\n            maxTracks={3}\n          />\n        </Box>\n      </Box>\n      \n      <Snackbar\n        open={mediaNotification.open}\n        autoHideDuration={3000}\n        onClose={() => setMediaNotification({ ...mediaNotification, open: false })}\n        anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\n      >\n        <Alert \n          onClose={() => setMediaNotification({ ...mediaNotification, open: false })} \n          severity=\"warning\"\n          sx={{ width: '100%' }}\n        >\n          {mediaNotification.message}\n        </Alert>\n      </Snackbar>\n      \n      {/* Добавляем DynamicIslandNotification */}\n      <DynamicIslandNotification\n        open={showSizeError}\n        message={sizeErrorMessage}\n        shortMessage=\"Ошибка размера файла\"\n        notificationType=\"error\"\n        animationType=\"pill\"\n        autoHideDuration={5000}\n        onClose={() => setShowSizeError(false)}\n      />\n    </Paper>\n  );\n};\n\n\nconst TabPanel = ({ children, value, index, ...other }) => {\n  return (\n    <div\n      role=\"tabpanel\"\n      hidden={value !== index}\n      id={`simple-tabpanel-${index}`}\n      aria-labelledby={`simple-tab-${index}`}\n      {...other}\n    >\n      {value === index && (\n        <TabContentLoader tabIndex={index}>\n          <Box sx={{ pt: 0 }}>\n            {children}\n          </Box>\n        </TabContentLoader>\n      )}\n    </div>\n  );\n};\n\n\nconst UserStatus = ({ statusText, statusColor }) => {\n  if (!statusText) return null;\n  \n  \n  const getContrastTextColor = (hexColor) => {\n    \n    const r = parseInt(hexColor.substr(1, 2), 16);\n    const g = parseInt(hexColor.substr(3, 2), 16);\n    const b = parseInt(hexColor.substr(5, 2), 16);\n    \n    \n    const brightness = (r * 299 + g * 587 + b * 114) / 1000;\n    \n    \n    return brightness > 128 ? '#000000' : '#FFFFFF';\n  };\n\n  \n  const createGradientColor = (hexColor) => {\n    \n    let r = parseInt(hexColor.substr(1, 2), 16);\n    let g = parseInt(hexColor.substr(3, 2), 16);\n    let b = parseInt(hexColor.substr(5, 2), 16);\n    \n    \n    const brightness = (r * 299 + g * 587 + b * 114) / 1000;\n    \n    \n    if (brightness < 128) {\n      \n      r = Math.min(255, r + 30);\n      g = Math.min(255, g + 30);\n      b = Math.min(255, b + 30);\n    } else {\n      \n      r = Math.max(0, r - 30);\n      g = Math.max(0, g - 30);\n      b = Math.max(0, b - 30);\n    }\n    \n    \n    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\n  };\n\n  \n  const gradientColor = createGradientColor(statusColor || '#D0BCFF');\n  const textColor = getContrastTextColor(statusColor || '#D0BCFF');\n\n  \n  const parseStatusText = (text) => {\n    \n    const iconTagRegex = /\\{(\\w+)\\}/;\n    const match = text.match(iconTagRegex);\n    \n    \n    const result = {\n      text: text,\n      iconName: null\n    };\n    \n    if (match) {\n      \n      result.iconName = match[1].toLowerCase();\n      \n      result.text = text.replace(iconTagRegex, '').trim();\n    }\n    \n    return result;\n  };\n  \n  \n  const parsedStatus = parseStatusText(statusText);\n  \n  \n  const getIconByName = (iconName) => {\n    switch (iconName) {\n      case 'minion':\n        return (\n          <SvgIcon sx={{ fontSize: 18, opacity: 0.8 }}>\n            <svg width=\"800\" height=\"800\" viewBox=\"0 0 800 800\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M402.667 518C367.33 518 332.786 507.523 303.405 487.89C274.023 468.257 251.123 440.353 237.6 407.707C224.077 375.06 220.539 339.137 227.433 304.478C234.327 269.82 251.343 237.984 276.33 212.997C301.317 188.01 333.153 170.994 367.81 164.1C402.47 157.206 438.393 160.744 471.04 174.267C503.687 187.79 531.59 210.69 551.223 240.072C570.853 269.453 581.333 303.997 581.333 339.333C581.333 362.797 576.713 386.03 567.733 407.707C558.753 429.383 545.593 449.08 529.003 465.67C512.413 482.26 492.717 495.42 471.04 504.4C449.363 513.38 426.13 518 402.667 518ZM402.667 210.667C377.22 210.667 352.343 218.213 331.183 232.351C310.024 246.489 293.533 266.584 283.794 290.095C274.056 313.606 271.508 339.477 276.472 364.437C281.437 389.393 293.691 412.32 311.686 430.313C329.68 448.31 352.607 460.563 377.567 465.527C402.523 470.493 428.393 467.943 451.907 458.207C475.417 448.467 495.51 431.977 509.65 410.817C523.787 389.657 531.333 364.78 531.333 339.333C531.333 305.209 517.777 272.482 493.647 248.353C469.517 224.223 436.79 210.667 402.667 210.667Z\" fill=\"currentColor\"/>\n            <path d=\"M400 643.667C376.53 643.72 353.28 639.123 331.597 630.14C309.913 621.157 290.224 607.97 273.667 591.333C269.251 586.593 266.847 580.327 266.961 573.85C267.075 567.373 269.699 561.193 274.28 556.613C278.86 552.033 285.04 549.407 291.516 549.293C297.993 549.18 304.261 551.583 309 556C333.693 579.057 366.216 591.88 400 591.88C433.783 591.88 466.31 579.057 491 556C495.74 551.583 502.006 549.18 508.483 549.293C514.96 549.407 521.14 552.033 525.72 556.613C530.303 561.193 532.926 567.373 533.04 573.85C533.153 580.327 530.75 586.593 526.333 591.333C509.776 607.97 490.086 621.157 468.403 630.14C446.72 639.123 423.47 643.72 400 643.667Z\" fill=\"currentColor\"/>\n            <path d=\"M402.667 400C436.173 400 463.333 372.837 463.333 339.333C463.333 305.828 436.173 278.666 402.667 278.666C369.163 278.666 342 305.828 342 339.333C342 372.837 369.163 400 402.667 400Z\" fill=\"currentColor\"/>\n            <path d=\"M666.666 755.333C660.036 755.333 653.676 752.7 648.99 748.01C644.3 743.323 641.666 736.963 641.666 730.333V333.333C637.156 272.944 609.983 216.492 565.596 175.297C521.21 134.102 462.89 111.209 402.333 111.209C341.776 111.209 283.457 134.102 239.07 175.297C194.684 216.492 167.511 272.944 163 333.333V730.333C163 736.963 160.366 743.323 155.678 748.01C150.989 752.7 144.631 755.333 138 755.333C131.37 755.333 125.011 752.7 120.322 748.01C115.634 743.323 113 736.963 113 730.333V333.333C115.55 258.166 147.202 186.929 201.278 134.656C255.354 82.3832 327.623 53.1636 402.833 53.1636C478.043 53.1636 550.313 82.3832 604.39 134.656C658.466 186.929 690.116 258.166 692.666 333.333V730.333C692.623 733.69 691.913 737.003 690.58 740.08C689.246 743.16 687.313 745.943 684.893 748.27C682.476 750.597 679.62 752.417 676.49 753.63C673.36 754.843 670.023 755.423 666.666 755.333Z\" fill=\"currentColor\"/>\n            <path d=\"M666.666 755.333H138C131.37 755.333 125.011 752.7 120.322 748.01C115.634 743.323 113 736.963 113 730.333C113 723.703 115.634 717.343 120.322 712.657C125.011 707.967 131.37 705.333 138 705.333H666.666C673.296 705.333 679.656 707.967 684.343 712.657C689.033 717.343 691.666 723.703 691.666 730.333C691.666 736.963 689.033 743.323 684.343 748.01C679.656 752.7 673.296 755.333 666.666 755.333Z\" fill=\"currentColor\"/>\n            </svg>\n\n          </SvgIcon>\n        );\n      case 'heart':\n        return (\n          <SvgIcon sx={{ fontSize: 18, opacity: 0.8 }}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M12,21.35l-1.45-1.32C5.4,15.36,2,12.28,2,8.5C2,5.42,4.42,3,7.5,3c1.74,0,3.41,0.81,4.5,2.09C13.09,3.81,14.76,3,16.5,3 C19.58,3,22,5.42,22,8.5c0,3.78-3.4,6.86-8.55,11.54L12,21.35z\"/>\n            </svg>\n          </SvgIcon>\n        );\n      case 'star':\n        return (\n          <SvgIcon sx={{ fontSize: 18, opacity: 0.8 }}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M12,17.27L18.18,21l-1.64-7.03L22,9.24l-7.19-0.61L12,2L9.19,8.63L2,9.24l5.46,4.73L5.82,21L12,17.27z\"/>\n            </svg>\n          </SvgIcon>\n        );\n      case 'music':\n        return <MusicNoteIcon sx={{ fontSize: 18, opacity: 0.8 }} />;\n      case 'location':\n        return <LocationOnIcon sx={{ fontSize: 18, opacity: 0.8 }} />;\n      case 'cake':\n        return <CakeIcon sx={{ fontSize: 18, opacity: 0.8 }} />;\n      case 'info':\n        return <InfoIcon sx={{ fontSize: 18, opacity: 0.8 }} />;\n      case 'chat':\n        return <ChatIcon sx={{ fontSize: 18, opacity: 0.8 }} />;\n      default:\n        \n        return (\n          <SvgIcon sx={{ fontSize: 18, opacity: 0.8 }}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n              <path d=\"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z\"/>\n            </svg>\n          </SvgIcon>\n        );\n    }\n  };\n\n  \n  const StatusIcon = getIconByName(parsedStatus.iconName);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.8, y: 10 }}\n      animate={{ opacity: 1, scale: 1, y: 0 }}\n      transition={{ \n        type: \"spring\", \n        stiffness: 500, \n        damping: 30,\n        delay: 0.2\n      }}\n      style={{\n        position: 'absolute',\n        left: '100%',\n        top: '60%',\n        zIndex: 10\n      }}\n    >\n      <Box\n        sx={{\n          position: 'relative',\n          backgroundColor: 'transparent',\n          filter: `drop-shadow(0 4px 8px rgba(0,0,0,0.2))`,\n          maxWidth: '200px',\n          transform: 'translateX(10px)',\n          '&:before': {\n            content: '\"\"',\n            position: 'absolute',\n            top: 0,\n            left: -8,\n            width: 0,\n            height: 0,\n            borderStyle: 'solid',\n            borderWidth: '0 14px 14px 0',\n            borderColor: `transparent ${statusColor || '#D0BCFF'} transparent transparent`,\n            transform: 'rotate(40deg)',\n            filter: 'drop-shadow(-3px 2px 2px rgba(0,0,0,0.1))',\n            zIndex: 0\n          }\n        }}\n      >\n        <Box\n          sx={{\n            background: `linear-gradient(135deg, ${statusColor || '#D0BCFF'} 0%, ${gradientColor} 100%)`,\n            color: textColor,\n            padding: '8px 12px',\n            borderRadius: '18px',\n            fontSize: '14px',\n            fontWeight: 500,\n            whiteSpace: 'nowrap',\n            overflow: 'hidden',\n            boxShadow: `inset 0 0 10px rgba(255,255,255,0.15), \n                        0 1px 1px rgba(0,0,0,0.1),\n                        0 4px 10px rgba(0,0,0,0.15)`,\n            backdropFilter: 'blur(4px)',\n            border: `1px solid ${statusColor === '#ffffff' ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.2)'}`,\n            display: 'flex',\n            alignItems: 'center',\n            gap: '6px',\n            position: 'relative'\n          }}\n        >\n          {StatusIcon}\n          <Box \n            sx={{ \n              overflow: 'hidden',\n              maskImage: 'linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%)'\n            }}\n          >\n            <Box\n              className=\"scrolling-text\"\n              sx={{\n                whiteSpace: 'nowrap',\n                display: 'inline-block',\n                animation: parsedStatus.text.length > 15 ? 'scrollText 10s linear infinite' : 'none',\n                '@keyframes scrollText': {\n                  '0%': { transform: 'translateX(0%)' },\n                  '25%': { transform: 'translateX(0%)' },\n                  '75%': { transform: parsedStatus.text.length > 15 ? 'translateX(-50%)' : 'translateX(0%)' },\n                  '100%': { transform: 'translateX(0%)' }\n                },\n                '&::after': parsedStatus.text.length > 15 ? {\n                  content: `\" • ${parsedStatus.text} • \"`,\n                  paddingLeft: '10px'\n                } : {}\n              }}\n            >\n              {parsedStatus.text}\n            </Box>\n          </Box>\n        </Box>\n      </Box>\n    </motion.div>\n  );\n};\n\n\nconst requireAuth = (user, isAuthenticated, navigate) => {\n  if (!isAuthenticated || !user) {\n    \n    navigate('/login', { \n      state: { \n        from: window.location.pathname,\n        message: 'Для выполнения этого действия необходима авторизация'\n      } \n    });\n    return false;\n  }\n  return true;\n};\n\n\nconst getLighterColor = (hexColor, factor = 0.3) => {\n  if (!hexColor || hexColor === 'transparent' || hexColor.startsWith('rgba')) {\n    return hexColor;\n  }\n  \n  \n  const hex = hexColor.replace('#', '');\n  \n  \n  const r = parseInt(hex.substring(0, 2), 16);\n  const g = parseInt(hex.substring(2, 4), 16);\n  const b = parseInt(hex.substring(4, 6), 16);\n  \n  \n  const lighter = (component) => Math.min(255, Math.floor(component + (255 - component) * factor));\n  \n  \n  return `#${lighter(r).toString(16).padStart(2, '0')}${lighter(g).toString(16).padStart(2, '0')}${lighter(b).toString(16).padStart(2, '0')}`;\n};\n\n\nconst SubscriptionBadge = ({ duration, subscriptionDate, subscriptionType }) => {\n  \n  if (!duration || duration < 1 || subscriptionType !== 'ultimate') return null;\n  \n  console.log(`SubscriptionBadge: duration=${duration}, type=${subscriptionType}`); \n  \n  \n  let badgeType = 'bronze'; \n  if (duration >= 6) {\n    badgeType = 'diamond';\n  } else if (duration >= 3) {\n    badgeType = 'gold';\n  } else if (duration >= 2) {\n    badgeType = 'silver';\n  }\n  \n  console.log(`SubscriptionBadge: selected badge type=${badgeType}`); \n  \n  \n  const formatDate = (dateString) => {\n    if (!dateString) return '';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('ru-RU', {\n      day: 'numeric',\n      month: 'long',\n      year: 'numeric'\n    });\n  };\n  \n  const tooltipText = `Подписчик Ultima с ${formatDate(subscriptionDate)}`;\n  \n  return (\n    <Tooltip title={tooltipText} arrow placement=\"top\">\n      <Box \n        component=\"img\" \n        src={`/static/subs/${badgeType}.svg`}\n        alt={`${badgeType} подписка`}\n        sx={{ \n          width: 24, \n          height: 24, \n          ml: 0.5,\n          cursor: 'pointer',\n          transition: 'transform 0.2s ease-in-out',\n          '&:hover': {\n            transform: 'scale(1.2)'\n          }\n        }} \n      />\n    </Tooltip>\n  );\n};\n\nconst ProfilePage = () => {\n  const { username } = useParams();\n  const { user: currentUser, isAuthenticated } = useContext(AuthContext);\n  const [user, setUser] = useState(null);\n  const [ownedUsernames, setOwnedUsernames] = useState([]);\n  const [photos, setPhotos] = useState([]);  \n  const [videos, setVideos] = useState([]);  \n  const [tabValue, setTabValue] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [loadingPhotos, setLoadingPhotos] = useState(true);\n  const [loadingVideos, setLoadingVideos] = useState(true);\n  const [following, setFollowing] = useState(false);\n  const [followersCount, setFollowersCount] = useState(0);\n  const [followingCount, setFollowingCount] = useState(0);\n  const [postsCount, setPostsCount] = useState(0);\n  const [followers, setFollowers] = useState([]);\n  const [followingList, setFollowingList] = useState([]);\n  const [friends, setFriends] = useState([]);\n  const [loadingFollowers, setLoadingFollowers] = useState(true);\n  const [loadingFollowing, setLoadingFollowing] = useState(true);\n  const [loadingFriends, setLoadingFriends] = useState(true);\n  const [socials, setSocials] = useState([]);\n  const [page, setPage] = useState(1);\n  const [lightboxIsOpen, setLightboxIsOpen] = useState(false);\n  const [currentImage, setCurrentImage] = useState('');\n  const [snackbar, setSnackbar] = useState({ open: false, message: '', severity: 'success' });\n  const navigate = useNavigate();\n  const { themeSettings, setProfileBackground, clearProfileBackground } = useContext(ThemeSettingsContext);\n  const [totalLikes, setTotalLikes] = useState(0);\n  \n  const [isOnline, setIsOnline] = useState(false);\n  const [lastActive, setLastActive] = useState(null);\n  \n  const [fallbackAvatarUrl, setFallbackAvatarUrl] = useState('');\n  \n  const [medals, setMedals] = useState([]);\n  const [loadingMedals, setLoadingMedals] = useState(false);\n  \n  const [selectedUsername, setSelectedUsername] = useState(null);\n  const [usernameCardAnchor, setUsernameCardAnchor] = useState(null);\n  const [usernameCardOpen, setUsernameCardOpen] = useState(false);\n  \n\n  const [userBanInfo, setUserBanInfo] = useState(null);\n  \n\n  const [isCurrentUserModerator, setIsCurrentUserModerator] = useState(false);\n  \n  \n  const openLightbox = (imageUrl) => {\n    console.log(\"Opening lightbox for image:\", imageUrl);\n    if (typeof imageUrl === 'string') {\n      setCurrentImage(imageUrl);\n      setLightboxIsOpen(true);\n    } else {\n      console.error(\"Invalid image URL provided to lightbox:\", imageUrl);\n    }\n  };\n  \n  \n  const closeLightbox = () => {\n    setLightboxIsOpen(false);\n  };\n  \n  \n  const showNotification = (severity, message) => {\n    setSnackbar({\n      open: true,\n      severity,\n      message\n    });\n  };\n  \n  const handleCloseSnackbar = () => {\n    setSnackbar(prev => ({ ...prev, open: false }));\n  };\n\n  const handleTabChange = (event, newValue) => {\n    setTabValue(newValue);\n  };\n  \n\n  \n  const handleFollow = async () => {\n    \n    if (!requireAuth(currentUser, isAuthenticated, navigate)) {\n      return;\n    }\n    \n    try {\n      const response = await axios.post('/api/profile/follow', {\n        followed_id: user.id\n      });\n      \n      if (response.data.success) {\n        setFollowing(response.data.is_following);\n        setFollowersCount(prev => response.data.is_following ? prev + 1 : prev - 1);\n      }\n    } catch (error) {\n      console.error('Error following/unfollowing user:', error);\n    }\n  };\n  \n  const handlePostCreated = (newPost) => {\n    showNotification('success', 'Пост успешно создан');\n  };\n  \n  useEffect(() => {\n    const fetchUserProfile = async () => {\n      try {\n        setLoading(true);\n        console.log(`Fetching profile for username: ${username}`);\n        \n        const response = await axios.get(`/api/profile/${username}`);\n        console.log(\"Profile API response:\", response.data);\n        \n        \n        console.log(\"Profile achievement data:\", {\n          rootAchievement: response.data.achievement_data,\n          userAchievement: response.data.user?.achievement\n        });\n        \n        \n        if (response.data.user) {\n          \n          if (response.data.user.verification_status === undefined && response.data.verification) {\n            response.data.user.verification_status = response.data.verification.status || null;\n          }\n          \n          \n          if (response.data.achievement) {\n            response.data.user.achievement = response.data.achievement;\n            console.log('Copied achievement data from root to user object:', response.data.achievement);\n          }\n          \n          // Копируем connect_info из корневого объекта, если он есть\n          if (response.data.connect_info) {\n            response.data.user.connect_info = response.data.connect_info;\n            console.log('Copied connect_info from root to user object:', response.data.connect_info);\n          }\n          \n          setUser(response.data.user);\n          \n          \n          if (response.data.user.total_likes !== undefined) {\n            setTotalLikes(response.data.user.total_likes);\n          }\n          \n          \n          if (response.data.subscription) {\n            response.data.user.subscription = response.data.subscription;\n            console.log('Subscription data found:', response.data.subscription);\n          } else if (response.data.user.subscription) {\n            console.log('Subscription data found in user object:', response.data.user.subscription);\n          } else {\n            console.log('No subscription data found in API response');\n            console.log('Full API response:', response.data);\n          }\n          \n          \n          \n          if (response.data.user.photos) {\n            \n            const photosData = Array.isArray(response.data.user.photos) ? response.data.user.photos : [];\n            setPhotos(photosData);\n          } else {\n            setPhotos([]);\n          }\n          \n          if (response.data.user.videos) {\n            \n            const videosData = Array.isArray(response.data.user.videos) ? response.data.user.videos : [];\n            setVideos(videosData);\n          } else {\n            setVideos([]);\n          }\n          \n          \n          if (response.data.user.followers_count !== undefined) {\n            setFollowersCount(response.data.user.followers_count);\n          }\n          \n          if (response.data.user.following_count !== undefined) {\n            setFollowingCount(response.data.user.following_count);\n          }\n          \n          \n          if (response.data.user.is_following !== undefined) {\n            setFollowing(response.data.user.is_following);\n          } else if (response.data.is_following !== undefined) {\n            setFollowing(response.data.is_following);\n          }\n          \n          if (response.data.user.posts_count !== undefined) {\n            setPostsCount(response.data.user.posts_count);\n          } else if (response.data.posts_count !== undefined) {\n            setPostsCount(response.data.posts_count);\n          }\n          \n          \n          if (response.data.socials) {\n            setSocials(response.data.socials);\n          }\n          \n          try {\n            const usernamesResponse = await axios.get(`/api/username/purchased/${response.data.user.id}`);\n            if (usernamesResponse.data.success) {\n              const otherUsernames = usernamesResponse.data.usernames\n                .filter(item => !item.is_active && item.username !== response.data.user.username)\n                .map(item => item.username);\n              \n              setOwnedUsernames(otherUsernames);\n            }\n          } catch (error) {\n            console.error('Error fetching owned usernames:', error);\n            setOwnedUsernames([]);\n          }\n          \n\n          if (response.data.user.ban || response.data.ban) {\n            setUserBanInfo(response.data.user.ban || response.data.ban);\n          } else {\n            setUserBanInfo(null);\n          }\n          \n\n          if (response.data.current_user_is_moderator !== undefined) {\n            setIsCurrentUserModerator(response.data.current_user_is_moderator);\n          }\n        } else {\n          console.error('User data not found in response', response.data);\n          setUser(null); \n        }\n      } catch (error) {\n        console.error('Error fetching profile', error);\n        if (error.response && error.response.status === 404) {\n          \n          setUser(null);\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    \n    fetchUserProfile();\n  }, [username, setLoading, setUser, setFollowersCount, setFollowingCount, setFollowing, setPostsCount, setSocials, setTotalLikes]);\n  \n  \n  useEffect(() => {\n    if (!currentUser) {\n      setUser(null);\n    }\n  }, [currentUser]);\n\n  \n  useEffect(() => {\n    \n    if (user && user.id) {\n      setLoadingFollowers(true);\n      setLoadingFollowing(true);\n      setLoadingFriends(true);\n      \n      console.log(`Загрузка подписчиков для пользователя ${user.id}`);\n      \n      axios.get(`/api/profile/${user.id}/followers`)\n        .then(response => {\n          console.log('Ответ API подписчиков:', response.data);\n          if (response.data && response.data.followers) {\n            \n            const followersData = Array.isArray(response.data.followers) \n              ? response.data.followers.filter(f => f && typeof f === 'object') \n              : [];\n            console.log(`Получено ${followersData.length} подписчиков`);\n            setFollowers(followersData);\n          } else {\n            \n            console.warn('Нет данных о подписчиках в ответе API');\n            setFollowers([]);\n          }\n        })\n        .catch(error => {\n          console.error('Ошибка загрузки подписчиков:', error);\n          setFollowers([]); \n        })\n        .finally(() => {\n          setLoadingFollowers(false);\n        });\n      \n      console.log(`Загрузка подписок для пользователя ${user.id}`);\n      \n      axios.get(`/api/profile/${user.id}/following`)\n        .then(response => {\n          console.log('Ответ API подписок:', response.data);\n          if (response.data && response.data.following) {\n            \n            const followingData = Array.isArray(response.data.following) \n              ? response.data.following.filter(f => f && typeof f === 'object') \n              : [];\n            console.log(`Получено ${followingData.length} подписок`);\n            setFollowingList(followingData);\n          } else {\n            \n            console.warn('Нет данных о подписках в ответе API');\n            setFollowingList([]);\n          }\n        })\n        .catch(error => {\n          console.error('Ошибка загрузки подписок:', error);\n          setFollowingList([]); \n        })\n        .finally(() => {\n          setLoadingFollowing(false);\n        });\n        \n      console.log(`Загрузка друзей для пользователя ${user.id}`);\n      \n      axios.get(`/api/profile/${user.id}/friends`)\n        .then(response => {\n          console.log('Ответ API друзей:', response.data);\n          if (response.data && response.data.friends) {\n            \n            const friendsData = Array.isArray(response.data.friends) \n              ? response.data.friends.filter(f => f && typeof f === 'object') \n              : [];\n            console.log(`Получено ${friendsData.length} друзей`);\n            setFriends(friendsData);\n          } else {\n            \n            console.warn('Нет данных о друзьях в ответе API');\n            setFriends([]);\n          }\n        })\n        .catch(error => {\n          console.error('Ошибка загрузки друзей:', error);\n          setFriends([]); \n        })\n        .finally(() => {\n          setLoadingFriends(false);\n        });\n    }\n  }, [user]);\n\n  \n  useEffect(() => {\n    const fetchTotalLikes = async () => {\n      try {\n        if (user && user.id) {\n          const response = await axios.get(`/api/profile/${user.id}/stats`);\n          if (response.data && response.data.total_likes !== undefined) {\n            setTotalLikes(response.data.total_likes);\n          } else {\n            setTotalLikes(0);\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching total likes:', error);\n        setTotalLikes(0);\n      }\n    };\n    \n    if (user && user.id) {\n      fetchTotalLikes();\n    }\n  }, [user]);\n\n  \n  const fetchOnlineStatus = async () => {\n    try {\n      if (!username) return;\n      \n      const response = await axios.get(`/api/profile/${username}/online_status`);\n      \n      if (response.data.success) {\n        setIsOnline(response.data.is_online);\n        setLastActive(response.data.last_active);\n      }\n    } catch (error) {\n      console.error('Error fetching online status:', error);\n    }\n  };\n  \n  \n  useEffect(() => {\n    if (username) {\n      fetchOnlineStatus();\n    }\n  }, [username]);\n\n  \n  useEffect(() => {\n    if (user) {\n      console.log('User state after setting:', {\n        name: user.name,\n        achievement: user.achievement,\n        verification_status: user.verification_status\n      });\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (user && user.id) {\n      fetchUserMedals();\n    }\n  }, [user]);\n\n  const fetchUserMedals = async () => {\n    try {\n      setLoadingMedals(true);\n      const response = await axios.get(`/api/profile/${user.id}/medals`);\n      if (response.data.success) {\n        setMedals(response.data.medals || []);\n      } else {\n        console.error('Error fetching medals:', response.data.error);\n        setMedals([]);\n      }\n    } catch (error) {\n      console.error('Error fetching medals:', error);\n      setMedals([]);\n    } finally {\n      setLoadingMedals(false);\n    }\n  };\n\n\n  const handleUsernameClick = (event, username) => {\n    event.preventDefault();\n    setSelectedUsername(username);\n    setUsernameCardOpen(true);\n  };\n  \n  const handleCloseUsernameCard = () => {\n    setUsernameCardOpen(false);\n  };\n\n  useEffect(() => {\n    if (user && user.profile_background_url) {\n      setProfileBackground(user.profile_background_url);\n      return () => clearProfileBackground();\n    } else {\n      clearProfileBackground();\n    }\n  }, [user && user.profile_background_url]);\n\n  if (loading) {\n    return (\n      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '80vh' }}>\n        <CircularProgress />\n      </Box>\n    );\n  }\n  \n  if (!user) {\n    return (\n      <Container maxWidth=\"lg\">\n        <Box sx={{ textAlign: 'center', mt: 5 }}>\n          <Typography variant=\"h5\">Пользователь не найден</Typography>\n        <Button \n            component={Link} \n            to=\"/\" \n          variant=\"contained\" \n          color=\"primary\" \n            sx={{ mt: 2, borderRadius: 20, textTransform: 'none' }}\n        >\n          Вернуться на главную\n        </Button>\n        </Box>\n      </Container>\n    );\n  }\n  \n  const isCurrentUser = currentUser && currentUser.username === user.username;\n  \n  const WallPostsTab = ({ userId }) => {\n    return (\n      <WallFeed userId={userId} />\n    );\n  };\n\n  const PostsTab = () => {\n    return (\n      <PostsFeed userId={user?.id} statusColor={user?.status_color} />\n    );\n  };\n\n  return (\n    <Container \n      maxWidth=\"lg\" \n      sx={{ \n        pt: 0, \n        pb: 4, \n        px: { xs: 0.5, sm: 1 },\n        width: '100%',\n        marginRight: 'auto',\n        marginLeft: '0!important',\n        paddingTop: '24px',\n        paddingBottom: '40px',\n        paddingLeft: '0',\n        paddingRight: '0',\n        minHeight: 'calc(100vh - 64px)',\n      }}\n    >\n      <Grid \n        container \n        spacing={0.5}\n        sx={{\n          flexDirection: { xs: 'column', md: 'row' },\n          flexWrap: { xs: 'nowrap', md: 'nowrap' }\n        }}\n      >\n        \n        <Grid item xs={12} md={5} sx={{ \n          position: { xs: 'static', md: 'sticky' },\n          top: '60px',\n          height: 'fit-content',\n          zIndex: 2\n        }}>\n          \n          <Paper sx={{ \n            p: 0, \n            borderRadius: '16px', \n            background: 'rgba(255, 255, 255, 0.03)',\n            backdropFilter: 'blur(20px)',\n            WebkitBackdropFilter: 'blur(20px)',\n            boxShadow: '0 5px 15px rgba(0, 0, 0, 0.2)',\n            overflow: 'hidden',\n            mb: '5px',\n            border: '1px solid rgba(255, 255, 255, 0.1)',\n            position: 'relative',\n            zIndex: 2\n          }}>\n            \n            {/* Banner section */}\n            {user?.profile_id !== 2 ? (\n              \n              user?.banner_url ? (\n                <Box sx={{ \n                  width: '100%',\n                  height: { xs: 150, sm: 200 },\n                  backgroundImage: `url(${user.banner_url})`,\n                  backgroundSize: 'cover',\n                  backgroundPosition: 'center',\n                  position: 'relative',\n                  transition: 'transform 0.5s ease',\n                  '&:hover': {\n                    transform: 'scale(1.02)'\n                  },\n                  '&::after': {\n                    content: '\"\"',\n                    position: 'absolute',\n                    top: 0,\n                    left: 0,\n                    right: 0,\n                    bottom: 0,\n                    zIndex: 1\n                  }\n                }}></Box>\n              ) : (\n                <Box sx={{ \n                  width: '100%',\n                  height: { xs: 100, sm: 120 },\n                  position: 'relative',\n\n                }}></Box>\n              )\n            ) : (\n              \n              null\n            )}\n            \n            <Box sx={{ px: 3, pb: 3, pt: 0, mt: user?.profile_id === 2 ? 2 : -7 }}>\n              \n              <Box sx={{ \n                display: 'flex', \n                justifyContent: 'space-between',\n                alignItems: 'flex-start'\n              }}>\n                \n                <Box sx={{ position: 'relative' }}>\n                  <Tooltip title=\"Открыть аватар\" arrow placement=\"top\">\n                    <Avatar \n                      src={user?.avatar_url} \n                      alt={user?.name}\n                      onClick={() => {\n                        const imageUrl = user?.avatar_url || fallbackAvatarUrl;\n                        if (imageUrl) openLightbox(imageUrl);\n                      }}\n                      sx={{ \n                        width: { xs: 110, sm: 130 }, \n                        height: { xs: 110, sm: 130 }, \n                        border: (user?.status_color && user?.status_text && user?.subscription) \n                          ? `4px solid ${user.status_color}` \n                          : user?.subscription \n                            ? `4px solid ${user.subscription.type === 'premium' ? 'rgba(186, 104, 200)' : user.subscription.type === 'pick-me' ? 'rgba(208, 188, 255)' : user.subscription.type === 'ultimate' ? 'rgba(124, 77, 255)' : 'rgba(66, 165, 245)'}` \n                          : theme => theme.palette.mode === 'dark'\n                              ? '4px solid #121212'\n                              : '4px solid #ffffff',\n                        boxShadow: (user?.status_color && user?.status_text && user.subscription) \n                          ? `0 0 15px ${user.status_color}80` \n                          : user?.subscription \n                            ? (user.subscription.type === 'premium' ? '0 0 15px rgba(186, 104, 200, 0.5)' : user.subscription.type === 'pick-me' ? '0 0 15px rgba(208, 188, 255, 0.5)' : user.subscription.type === 'ultimate' ? '0 0 15px rgba(124, 77, 255, 0.5)' : '0 0 15px rgba(66, 165, 245, 0.5)') \n                            : '0 8px 20px rgba(0, 0, 0, 0.25)',\n                        bgcolor: 'primary.dark',\n                        transition: 'all 0.3s ease',\n                        cursor: 'pointer',\n                        '&:hover': {\n                          transform: 'scale(1.03)',\n                          boxShadow: (user?.status_color && user?.status_text && user.subscription) \n                            ? `0 0 20px ${user.status_color}B3` \n                            : user?.subscription \n                              ? (user.subscription.type === 'premium' ? '0 0 20px rgba(186, 104, 200, 0.7)' : user.subscription.type === 'pick-me' ? '0 0 20px rgba(208, 188, 255, 0.7)' : user.subscription.type === 'ultimate' ? '0 0 20px rgba(124, 77, 255, 0.7)' : '0 0 20px rgba(66, 165, 245, 0.7)') \n                              : '0 10px 25px rgba(0, 0, 0, 0.35)',\n                          border: (user?.status_color && user?.status_text && user.subscription) \n                            ? `4px solid ${user.status_color}CC` \n                            : user?.subscription \n                              ? `4px solid ${user.subscription.type === 'premium' ? 'rgba(186, 104, 200, 0.8)' : user.subscription.type === 'pick-me' ? 'rgba(208, 188, 255, 0.8)' : user.subscription.type === 'ultimate' ? 'rgba(124, 77, 255, 0.8)' : 'rgba(66, 165, 245, 0.8)'}`\n                              : '4px solid rgba(208, 188, 255, 0.4)'\n                        }\n                      }}\n                      onError={(e) => {\n                        if (user?.id) {\n                          const fallbackSrc = `/static/uploads/avatar/${user.id}/${user.photo || 'default.png'}`;\n                          e.currentTarget.src = fallbackSrc;\n                          setFallbackAvatarUrl(fallbackSrc);\n                        }\n                      }}\n                    />\n                  </Tooltip>\n                  \n                  \n                  {isOnline && user?.subscription?.type !== 'channel' && (\n                    <Box\n                      sx={{\n                        position: 'absolute',\n                        width: 20,\n                        height: 20,\n                        borderRadius: '50%',\n                        bgcolor: '#4caf50',\n                        border: theme => theme.palette.mode === 'dark'\n                          ? '2px solid #121212'\n                          : '2px solid #ffffff',\n                        bottom: 5,\n                        right: 15,\n                        boxShadow: '0 0 8px rgba(76, 175, 80, 0.9)',\n                        zIndex: 2,\n                        animation: 'pulse 2s infinite',\n                        '@keyframes pulse': {\n                          '0%': {\n                            boxShadow: '0 0 0 0 rgba(76, 175, 80, 0.7)'\n                          },\n                          '70%': {\n                            boxShadow: '0 0 0 6px rgba(76, 175, 80, 0)'\n                          },\n                          '100%': {\n                            boxShadow: '0 0 0 0 rgba(76, 175, 80, 0)'\n                          }\n                        }\n                      }}\n                    />\n                  )}\n                  \n                  \n                  <UserStatus statusText={user?.status_text} statusColor={user?.status_color} />\n                </Box>\n                \n\n              </Box>\n              \n              \n              <Box sx={{ mt: 2, whiteSpace: 'nowrap' }}>\n                <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n                  <Box sx={{ display: 'flex', alignItems: 'center' }}>\n                    <Typography \n                      variant=\"h5\" \n                      sx={{ \n                        fontWeight: 700,\n                        color: user?.profile_id === 2 ? '#fff' : 'inherit',\n                        textShadow: user?.profile_id === 2 ? '0 1px 3px rgba(0,0,0,0.7)' : 'none',\n                        background: user?.profile_id === 2 ? 'none' : theme => theme.palette.mode === 'dark' \n                          ? 'linear-gradient(90deg, #fff 0%, rgba(255,255,255,0.8) 100%)'\n                          : 'linear-gradient(90deg, #000 0%, rgba(0,0,0,0.8) 100%)',\n                        WebkitBackgroundClip: user?.profile_id === 2 ? 'unset' : 'text',\n                        WebkitTextFillColor: user?.profile_id === 2 ? 'unset' : 'transparent'\n                      }}>\n                      {user?.name || 'Пользователь'}\n                    </Typography>\n                    <VerificationBadge status={user?.verification_status} size=\"small\" />\n                    \n                    {/* Добавляем значок подписки, если у пользователя есть подписка */}\n                    {user?.subscription && user.subscription.total_duration_months > 0 && (\n                      <SubscriptionBadge \n                        duration={user.subscription.total_duration_months} \n                        subscriptionDate={user.subscription.subscription_date}\n                        subscriptionType={user.subscription.type}\n                      />\n                    )}\n\n                    {user?.achievement && (\n                      <Box \n                        component=\"img\" \n                        sx={{ \n                          width: 'auto', \n                          height: 25, \n                          ml: 0.5\n                        }} \n                        src={`/static/images/bages/${user.achievement.image_path}`} \n                        alt={user.achievement.bage}\n                        onError={(e) => {\n                          console.error(\"Achievement badge failed to load:\", e);\n                          if (e.target && e.target instanceof HTMLImageElement) {\n                            e.target.style.display = 'none';\n                          }\n                        }}\n                      />\n                    )}\n                  </Box>\n\n\n                </Box>\n                \n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 0.5, mt: 0.5, flexWrap: 'wrap', maxWidth: '100%' }}>\n                  <Typography \n                    variant=\"body2\" \n                    sx={{ \n                      fontWeight: 500,\n                      color: user?.profile_id === 2 ? 'rgba(255,255,255,0.9)' : theme => theme.palette.text.secondary,\n                      textShadow: user?.profile_id === 2 ? '0 1px 2px rgba(0,0,0,0.5)' : 'none',\n                      display: 'flex',\n                      alignItems: 'center',\n                      background: user?.profile_id === 2 \n                        ? 'rgba(0,0,0,0.3)'\n                        : theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.03)',\n                      px: 1.2,\n                      py: 0.4,\n                      borderRadius: 4,\n                      border: user?.profile_id === 2\n                        ? '1px solid rgba(255,255,255,0.15)'\n                        : theme => theme.palette.mode === 'dark' ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.05)'\n                    }}\n                  >\n                    @{user?.username || 'username'}\n                  </Typography>\n\n                  {user?.connect_info && user.connect_info.length > 0 && (\n                    <>\n                      <LinkRoundedIcon \n                        sx={theme => ({ \n                          width: '2em',\n                          height: '2em',\n                          fontSize: 16,\n                          color: user?.profile_id === 2 ? 'rgba(255,255,255,0.9)' : theme.palette.text.secondary\n                        })} \n                      />\n                      <Typography\n                        variant=\"body2\"\n                        component={Link}\n                        to={`/profile/${user.connect_info[0].username}`}\n                        sx={theme => ({\n                          fontWeight: 500,\n                          color: user?.profile_id === 2 ? 'rgba(255,255,255,0.9)' : theme.palette.text.secondary,\n                          textShadow: user?.profile_id === 2 ? '0 1px 2px rgba(0,0,0,0.5)' : 'none',\n                          display: 'flex',\n                          alignItems: 'center',\n                          background: user?.profile_id === 2\n                            ? 'rgba(0,0,0,0.3)'\n                            : theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.03)',\n                          px: 1.2,\n                          py: 0.4,\n                          borderRadius: 4,\n                          border: user?.profile_id === 2\n                            ? '1px solid rgba(255,255,255,0.15)'\n                            : theme.palette.mode === 'dark' ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.05)',\n                          textDecoration: 'none',\n                          '&:hover': {\n                            textDecoration: 'none',\n                            background: user?.profile_id === 2\n                              ? 'rgba(0,0,0,0.4)'\n                              : theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)'\n                          }\n                        })}\n                      >\n                        @{user.connect_info[0].username}\n                      </Typography>\n                    </>\n                  )}\n\n                  {userBanInfo ? (\n                    <Tooltip \n                      title={\n                        <Box sx={{ p: 0.5 }}>\n                          <Typography variant=\"subtitle2\" sx={{ mb: 1, fontWeight: 'bold' }}>Аккаунт заблокирован</Typography>\n                          <Typography variant=\"body2\" sx={{ mb: 0.5 }}>Причина: {userBanInfo.reason}</Typography>\n                          <Typography variant=\"body2\" sx={{ mb: 0.5 }}>До: {userBanInfo.end_date}</Typography>\n                          {userBanInfo.remaining_days > 0 && (\n                            <Typography variant=\"body2\">\n                              Осталось дней: {userBanInfo.remaining_days}\n                            </Typography>\n                          )}\n                        </Box>\n                      } \n                      arrow \n                      placement=\"top\"\n                    >\n                      <Typography \n                        variant=\"caption\" \n                        sx={{\n                          display: 'flex', \n                          alignItems: 'center',\n                          color: '#fff',\n                          fontWeight: 500,\n                          background: 'rgba(211, 47, 47, 0.7)', \n                          px: 1,\n                          py: 0.1,\n                          borderRadius: 4,\n                          border: '1px solid rgba(211, 47, 47, 0.8)',\n                          boxShadow: '0 0 8px rgba(211, 47, 47, 0.5)',\n                          '&:hover': {\n                            background: 'rgba(211, 47, 47, 0.8)',\n                          },\n                          animation: 'pulse-red 2s infinite',\n                          '@keyframes pulse-red': {\n                            '0%': { boxShadow: '0 0 0 0 rgba(211, 47, 47, 0.4)' },\n                            '70%': { boxShadow: '0 0 0 6px rgba(211, 47, 47, 0)' },\n                            '100%': { boxShadow: '0 0 0 0 rgba(211, 47, 47, 0)' }\n                          }\n                        }}\n                      >\n                        <BlockIcon sx={{ fontSize: 14, mr: 0.5, opacity: 0.9 }} />\n                        <Box component=\"span\">В бане</Box>\n                      </Typography>\n                    </Tooltip>\n                  ) : null}\n\n                  {user?.scam === 1 && (\n                    <Tooltip \n                      title=\"Этот аккаунт был отмечен как мошеннический. Будьте осторожны!\" \n                      arrow \n                      placement=\"top\"\n                    >\n                      <Typography \n                        variant=\"caption\" \n                        sx={{\n                          display: 'flex', \n                          alignItems: 'center',\n                          color: '#fff',\n                          fontWeight: 500,\n                          background: 'rgba(211, 47, 47, 0.6)',\n                          px: 1,\n                          py: 0.1,\n                          borderRadius: 4,\n                          border: '1px solid rgba(211, 47, 47, 0.8)',\n                          boxShadow: '0 0 8px rgba(211, 47, 47, 0.5)',\n                          '&:hover': {\n                            background: 'rgba(211, 47, 47, 0.7)',\n                          },\n                          animation: 'pulse-red 2s infinite',\n                          '@keyframes pulse-red': {\n                            '0%': { boxShadow: '0 0 0 0 rgba(211, 47, 47, 0.4)' },\n                            '70%': { boxShadow: '0 0 0 6px rgba(211, 47, 47, 0)' },\n                            '100%': { boxShadow: '0 0 0 0 rgba(211, 47, 47, 0)' }\n                          }\n                        }}\n                      >\n                        <WarningIcon sx={{ fontSize: 14, mr: 0.5, opacity: 0.9 }} />\n                        <Box component=\"span\">SCAM</Box>\n                      </Typography>\n                    </Tooltip>\n                  )}\n                  \n                  {user?.subscription && (\n                    user.subscription.type === 'channel' ? (\n                      <Chip\n                        icon={<ChatIcon fontSize=\"small\" />}\n                        label=\"Канал\"\n                        size=\"small\"\n                        sx={{\n                          bgcolor: (user.status_color) \n                            ? `${user.status_color}26` \n                            : theme => theme.palette.mode === 'dark'\n                              ? 'rgba(208, 188, 255, 0.15)' \n                              : 'rgba(124, 77, 255, 0.15)',\n                          color: (user.status_color) \n                            ? user.status_color \n                            : theme => theme.palette.mode === 'dark'\n                              ? '#d0bcff'\n                              : '#7c4dff',\n                          fontWeight: 'bold',\n                          border: '1px solid',\n                          borderColor: (user.status_color) \n                            ? `${user.status_color}4D` \n                            : theme => theme.palette.mode === 'dark'\n                              ? 'rgba(208, 188, 255, 0.3)'\n                              : 'rgba(124, 77, 255, 0.3)',\n                          '& .MuiChip-icon': {\n                            color: 'inherit'\n                          },\n                          py: 0.25, \n                          height: 'auto',\n                          animation: 'pulse-light 2s infinite',\n                          '@keyframes pulse-light': {\n                            '0%': {\n                              boxShadow: (user.status_color) ? \n                                `0 0 0 0 ${user.status_color}66` : \n                                '0 0 0 0 rgba(124, 77, 255, 0.4)'\n                            },\n                            '70%': {\n                              boxShadow: (user.status_color) ? \n                                `0 0 0 6px ${user.status_color}00` : \n                                '0 0 0 6px rgba(124, 77, 255, 0)'\n                            },\n                            '100%': {\n                              boxShadow: (user.status_color) ? \n                                `0 0 0 0 ${user.status_color}00` : \n                                '0 0 0 0 rgba(124, 77, 255, 0)'\n                            }\n                          }\n                        }}\n                      />\n                    ) : (\n                      <Tooltip title={`Подписка ${user.subscription.type === 'pick-me' ? 'Пикми' : user.subscription.type} активна до ${new Date(user.subscription.expires_at).toLocaleDateString()}`}>\n                        <Chip\n                          icon={<DiamondIcon fontSize=\"small\" />}\n                          label={user.subscription.type === 'pick-me' ? 'Пикми' : \n                                user.subscription.type.charAt(0).toUpperCase() + user.subscription.type.slice(1)}\n                          size=\"small\"\n                          sx={{\n                            bgcolor: user.subscription.type === 'premium' ? 'rgba(186, 104, 200, 0.15)' : \n                                    user.subscription.type === 'ultimate' ? 'rgba(124, 77, 255, 0.15)' :\n                                    user.subscription.type === 'pick-me' ? 'rgba(208, 188, 255, 0.15)' : \n                                    'rgba(66, 165, 245, 0.15)',\n                            color: user.subscription.type === 'premium' ? '#ba68c8' : \n                                  user.subscription.type === 'ultimate' ? '#7c4dff' : \n                                  user.subscription.type === 'pick-me' ? 'rgb(208, 188, 255)' :\n                                  '#42a5f5',\n                            fontWeight: 'bold',\n                            border: '1px solid',\n                            borderColor: user.subscription.type === 'premium' ? 'rgba(186, 104, 200, 0.3)' : \n                                        user.subscription.type === 'ultimate' ? 'rgba(124, 77, 255, 0.3)' :\n                                        user.subscription.type === 'pick-me' ? 'rgba(208, 188, 255, 0.3)' :\n                                        'rgba(66, 165, 245, 0.3)',\n                            '& .MuiChip-icon': {\n                              color: 'inherit'\n                            },\n                            py: 0.25, \n                            height: 'auto',\n                            animation: 'pulse-light 2s infinite',\n                            '@keyframes pulse-light': {\n                              '0%': {\n                                boxShadow: (user.status_color && user.status_text) ? \n                                  `0 0 0 0 ${user.status_color}66` : \n                                  '0 0 0 0 rgba(124, 77, 255, 0.4)'\n                              },\n                              '70%': {\n                                boxShadow: (user.status_color && user.status_text) ? \n                                  `0 0 0 6px ${user.status_color}00` : \n                                  '0 0 0 6px rgba(124, 77, 255, 0)'\n                              },\n                              '100%': {\n                                boxShadow: (user.status_color && user.status_text) ? \n                                  `0 0 0 0 ${user.status_color}00` : \n                                  '0 0 0 0 rgba(124, 77, 255, 0)'\n                              }\n                            }\n                          }}\n                        />\n                      </Tooltip>\n                    )\n                  )}\n                  \n                </Box>\n                  \n                {ownedUsernames.length > 0 && (\n                  <Box sx={{ \n                    display: 'flex',\n                    mt: 1,\n                    width: '100%'\n                  }}>\n                    <Box \n                      sx={{ \n                        color: theme => theme.palette.text.secondary,\n                        backgroundColor: (user.status_color && user.status_text && user.subscription) ? \n                          `${user.status_color}1A` : \n                          theme => theme.palette.mode === 'dark' ? 'rgba(208, 188, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)',\n                        px: 1.2,\n                        py: 0.4,\n                        borderRadius: 4,\n                        border: (user.status_color && user.status_text && user.subscription) ? \n                          `1px solid ${user.status_color}33` : \n                          theme => theme.palette.mode === 'dark' ? '1px solid rgba(208, 188, 255, 0.2)' : '1px solid rgba(0, 0, 0, 0.1)',\n                        fontSize: '0.75rem',\n                        display: 'inline-flex',\n                        alignItems: 'center',\n                        maxWidth: '100%',\n                        flexWrap: 'wrap'\n                      }}\n                    >\n                      <Typography variant=\"caption\" sx={{ color: user?.status_color ? getLighterColor(user.status_color) : theme => theme.palette.text.secondary, mr: 0.5 }}>\n                        А также:\n                      </Typography>\n                      {ownedUsernames.slice(0, 3).map((usernameItem, idx) => (\n                        <React.Fragment key={idx}>\n                          <Typography \n                            variant=\"caption\" \n                            component=\"span\" \n                            sx={{ \n                              color: (user.status_color && user.status_text && user.subscription) ? \n                                user.status_color : \n                                theme => theme.palette.mode === 'dark' ? '#d0bcff' : '#7c4dff',\n                              fontWeight: 500,\n                              cursor: 'pointer',\n                              '&:hover': {\n                                textDecoration: 'underline'\n                              }\n                            }}\n                            onClick={(e) => handleUsernameClick(e, usernameItem)}\n                          >\n                            @{usernameItem}\n                          </Typography>\n                          {idx < Math.min(ownedUsernames.length, 3) - 1 && (\n                            <Typography variant=\"caption\" component=\"span\" sx={{ mx: 0.5, color: theme => theme.palette.text.disabled }}>\n                              ,\n                            </Typography>\n                          )}\n                        </React.Fragment>\n                      ))}\n                      {ownedUsernames.length > 3 && (\n                        <Typography variant=\"caption\" component=\"span\" sx={{ ml: 0.5, color: theme => theme.palette.text.disabled }}>\n                          и ещё {ownedUsernames.length - 3}\n                        </Typography>\n                      )}\n                    </Box>\n                  </Box>\n                )}\n                \n                {userBanInfo && (isCurrentUserModerator || (currentUser && currentUser.id === 3)) && (\n                  <Box sx={{ \n                    mt: 2,\n                    p: 1.5,\n                    borderRadius: '12px',\n                    backgroundColor: 'rgba(211, 47, 47, 0.7)',\n                    backdropFilter: 'blur(10px)',\n                    border: '1px solid rgba(211, 47, 47, 0.8)',\n                    boxShadow: '0 0 15px rgba(211, 47, 47, 0.4)',\n                    display: 'flex',\n                    alignItems: 'flex-start',\n                    gap: 1.5\n                  }}>\n                    <WarningIcon sx={{ fontSize: 22, mt: 0.5, color: 'white' }} />\n                    <Box>\n                      <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold', color: 'white' }}>\n                        Аккаунт заблокирован\n                      </Typography>\n                      <Typography variant=\"caption\" sx={{ display: 'block', color: 'rgba(255,255,255,0.9)' }}>\n                        Причина: {userBanInfo.reason}\n                      </Typography>\n                      <Typography variant=\"caption\" sx={{ display: 'block', color: 'rgba(255,255,255,0.9)' }}>\n                        До {userBanInfo.end_date} \n                        {userBanInfo.remaining_days > 0 && ` (осталось ${userBanInfo.remaining_days} дн.)`}\n                      </Typography>\n                      \n                      {currentUser && currentUser.id === 3 && (\n                        <Box sx={{ mt: 1, pt: 1, borderTop: '1px dashed rgba(255, 255, 255, 0.4)' }}>\n                          <Typography variant=\"caption\" sx={{ display: 'block', fontStyle: 'italic', color: 'rgba(255,255,255,0.9)' }}>\n                            {userBanInfo.is_auto_ban ? 'Автоматический бан системой' : (\n                              userBanInfo.admin ? `Бан выдал: ${userBanInfo.admin.name} (@${userBanInfo.admin.username})` : 'Бан выдан администрацией'\n                            )}\n                          </Typography>\n                          {userBanInfo.start_date && (\n                            <Typography variant=\"caption\" sx={{ display: 'block', fontStyle: 'italic', color: 'rgba(255,255,255,0.9)' }}>\n                              Начало бана: {userBanInfo.start_date}\n                            </Typography>\n                          )}\n                          {userBanInfo.details && (\n                            <Typography variant=\"caption\" sx={{ display: 'block', fontStyle: 'italic', color: 'rgba(255,255,255,0.9)' }}>\n                              Детали: {userBanInfo.details}\n                            </Typography>\n                          )}\n                        </Box>\n                      )}\n                    </Box>\n                  </Box>\n                )}\n                \n                {/* Блок с информацией о пользователе */}\n                {user?.about && (\n                  <Typography \n                    variant=\"body2\" \n                    sx={{ \n                      mt: 1,\n                      lineHeight: 1.5,\n                      color: user?.status_color ? getLighterColor(user.status_color) : theme => theme.palette.text.secondary,\n                      p: 1.5,\n                      borderRadius: 1,\n                      background: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.03)',\n                      backdropFilter: 'blur(10px)',\n                      border: theme => theme.palette.mode === 'dark' ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.05)',\n                      overflowWrap: 'break-word',\n                      wordBreak: 'break-word',\n                      whiteSpace: 'normal'\n                    }}\n                  >\n                    {user.about}\n                  </Typography>\n\n                )}\n                \n                \n                \n                <Box sx={{ \n                  display: 'grid', \n                  gridTemplateColumns: user?.subscription?.type === 'channel' ? 'repeat(2, 1fr)' : 'repeat(3, 1fr)', \n                  gap: 1, \n                  mt: 1 \n                }}>\n                  \n                  <Paper sx={{ \n                    p: 1.5, \n                    borderRadius: 2, \n                    textAlign: 'center',\n                    background: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.04)' : 'rgba(0,0,0,0.04)',\n                    backdropFilter: 'blur(5px)',\n                    border: theme => theme.palette.mode === 'dark' ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.05)',\n                    transition: 'all 0.2s ease',\n                    '&:hover': {\n                      background: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.07)' : 'rgba(0,0,0,0.07)',\n                      transform: 'translateY(-2px)'\n                    }\n                  }}>\n                    <Typography \n                      variant=\"h6\" \n                      sx={{ \n                        fontWeight: 700,\n                        color: (user.status_color && user.status_text && user.subscription) ? \n                          user.status_color : \n                          'primary.main'\n                      }}\n                    >\n                      {postsCount || 0}\n                    </Typography>\n                    <Typography variant=\"caption\" sx={{ \n                      color: user?.status_color ? getLighterColor(user.status_color) : theme => theme.palette.text.secondary\n                    }}>\n                      публикаций\n                    </Typography>\n                  </Paper>\n                  \n                  \n                  <Paper \n                    component={Link}\n                    to={`/profile/${user?.username}/followers`}\n                    sx={{ \n                      p: 1.5, \n                      borderRadius: 2, \n                      textAlign: 'center',\n                      background: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.04)' : 'rgba(0,0,0,0.04)',\n                      backdropFilter: 'blur(5px)',\n                      border: (user.status_color && user.status_text && user.subscription) ? \n                        `1px solid ${user.status_color}33` : \n                        theme => theme.palette.mode === 'dark' ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.05)',\n                      textDecoration: 'none',\n                      transition: 'all 0.2s ease',\n                      '&:hover': {\n                        background: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.07)' : 'rgba(0,0,0,0.07)',\n                        transform: 'translateY(-2px)',\n                        boxShadow: (user.status_color && user.status_text && user.subscription) ? \n                          `0 4px 15px ${user.status_color}33` : \n                          '0 4px 15px rgba(0,0,0,0.1)'\n                      }\n                    }}\n                  >\n                    <Typography \n                      variant=\"h6\" \n                      sx={{ \n                        fontWeight: 700,\n                        color: (user.status_color && user.status_text && user.subscription) ? \n                          user.status_color : \n                          'primary.main'\n                      }}\n                    >\n                      {followersCount || 0}\n                    </Typography>\n                    <Typography variant=\"caption\" sx={{ \n                      color: user?.status_color ? getLighterColor(user.status_color) : theme => theme.palette.text.secondary\n                    }}>\n                      подписчиков\n                    </Typography>\n                  </Paper>\n                  \n                  \n                  {(!user?.subscription || user.subscription.type !== 'channel') && (\n                    <Paper \n                      component={Link}\n                      to={`/profile/${user?.username}/following`}\n                      sx={{ \n                        p: 1.5, \n                        borderRadius: 2, \n                        textAlign: 'center',\n                        background: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.04)' : 'rgba(0,0,0,0.04)',\n                        backdropFilter: 'blur(5px)',\n                        border: (user.status_color && user.status_text && user.subscription) ? \n                          `1px solid ${user.status_color}33` : \n                          theme => theme.palette.mode === 'dark' ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.05)',\n                        textDecoration: 'none',\n                        transition: 'all 0.2s ease',\n                        '&:hover': {\n                          background: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.07)' : 'rgba(0,0,0,0.07)',\n                          transform: 'translateY(-2px)',\n                          boxShadow: (user.status_color && user.status_text && user.subscription) ? \n                            `0 4px 15px ${user.status_color}33` : \n                            '0 4px 15px rgba(0,0,0,0.1)'\n                        }\n                      }}\n                    >\n                      <Typography \n                        variant=\"h6\" \n                        sx={{ \n                          fontWeight: 700,\n                          color: (user.status_color && user.status_text && user.subscription) ? \n                            user.status_color : \n                            'primary.main'\n                        }}\n                      >\n                        {followingCount || 0}\n                      </Typography>\n                      <Typography variant=\"caption\" sx={{ \n                        color: user?.status_color ? getLighterColor(user.status_color) : theme => theme.palette.text.secondary\n                      }}>\n                        подписок\n                      </Typography>\n                    </Paper>\n                  )}\n                </Box>\n                \n                \n                {(!user?.subscription || user.subscription.type !== 'channel') && (\n                  <Grid container spacing={1} sx={{ mt: 1 }}> \n                    \n                    \n                    {(!user?.subscription || user.subscription.type !== 'channel') ? (\n                      <Grid item xs={6}>\n                        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\n                          <Typography variant=\"subtitle2\" color=\"text.secondary\" sx={{ fontSize: '0.8rem' }}>\n                            Подписчики\n                          </Typography>\n                          \n                          \n                          {loadingFriends ? (\n                            <CircularProgress size={20} />\n                          ) : friends && friends.length > 0 ? (\n                            <Box sx={{ display: 'flex', gap: 1 }}>\n                              {friends.slice(0, 3).map(friend => (\n                                <Tooltip key={friend.id} title={friend.name} arrow>\n                                  <Avatar \n                                    src={friend.avatar_url} \n                                    alt={friend.name}\n                                    component={Link}\n                                    to={`/profile/${friend.username}`}\n                                    sx={{ \n                                      width: 32, \n                                      height: 32, \n                                      border: (user.status_color && user.status_text && user.subscription) ? \n                                        `1px solid ${user.status_color}` : \n                                        '1px solid #D0BCFF', \n                                      flexShrink: 0 \n                                    }}\n                                    onError={(e) => {\n                                      console.error(`Failed to load friend avatar for ${friend.username}`);\n                                      if (friend.id) {\n                                        e.target.src = `/static/uploads/avatar/${friend.id}/${friend.photo || 'avatar.png'}`;\n                                      }\n                                    }}\n                                  />\n                                </Tooltip>\n                              ))}\n                              {user?.friends_count > 3 && (\n                                <Tooltip title=\"Показать всех подписчиков\" arrow>\n                                  <Avatar \n                                    component={Link}\n                                    to={`/profile/${user?.username}/followers`}\n                                    sx={{ \n                                      width: 32, \n                                      height: 32, \n                                      bgcolor: (user.status_color && user.status_text && user.subscription) ? \n                                        `${user.status_color}26` : \n                                        'rgba(208, 188, 255, 0.15)', \n                                      fontSize: '0.75rem',\n                                      color: (user.status_color && user.status_text && user.subscription) ? \n                                        user.status_color : \n                                        '#D0BCFF',\n                                      flexShrink: 0 \n                                    }}\n                                  >\n                                    +{user?.friends_count - 3}\n                                  </Avatar>\n                                </Tooltip>\n                              )}\n                            </Box>\n                          ) : (\n                            <Typography variant=\"caption\" color=\"text.secondary\">\n                              Нет подписчиков\n                            </Typography>\n                          )}\n                        </Box>\n                      </Grid>\n                    ) : (\n                      \n                      <Grid item xs={6}>\n                        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\n                          <Typography variant=\"subtitle2\" color=\"text.secondary\" sx={{ fontSize: '0.8rem' }}>\n                            Подписчики\n                          </Typography>\n                          <Typography variant=\"body2\">\n                            {followersCount || 0}\n                          </Typography>\n                        </Box>\n                      </Grid>\n                    )}\n                    \n                    \n                    <Grid item xs={6}>\n                      <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\n                        <Typography variant=\"subtitle2\" color=\"text.secondary\" sx={{ fontSize: '0.8rem' }}>\n                          Подписки\n                        </Typography>\n                        \n                        \n                        {user?.subscription && user.subscription.type === 'channel' ? (\n                          <Typography variant=\"body2\">\n                            {followingCount || 0}\n                          </Typography>\n                        ) : (\n                          loadingFollowing ? (\n                            <CircularProgress size={20} />\n                          ) : followingList.length > 0 ? (\n                            <Box sx={{ display: 'flex', gap: 1 }}>\n                              {followingList.slice(0, 3).map(following => (\n                                <Tooltip key={following.id} title={following.name} arrow>\n                                  <Avatar \n                                    src={following.avatar_url} \n                                    alt={following.name}\n                                    component={Link}\n                                    to={`/profile/${following.username}`}\n                                    sx={{ \n                                      width: 32, \n                                      height: 32, \n                                      border: (user.status_color && user.status_text && user.subscription) ? \n                                        `1px solid ${user.status_color}` : \n                                        '1px solid #D0BCFF', \n                                      flexShrink: 0 \n                                    }}\n                                    onError={(e) => {\n                                      console.error(`Failed to load following avatar for ${following.username}`);\n                                      if (following.id) {\n                                        e.target.src = `/static/uploads/avatar/${following.id}/${following.photo || 'avatar.png'}`;\n                                      }\n                                    }}\n                                  />\n                                </Tooltip>\n                              ))}\n                              {followingCount > 3 && (\n                                <Tooltip title=\"Показать всех\" arrow>\n                                  <Avatar \n                                    component={Link}\n                                    to={`/profile/${user?.username}/following`}\n                                    sx={{ \n                                      width: 32, \n                                      height: 32, \n                                      bgcolor: (user.status_color && user.status_text && user.subscription) ? \n                                        `${user.status_color}26` : \n                                        'rgba(208, 188, 255, 0.15)', \n                                      fontSize: '0.75rem',\n                                      color: (user.status_color && user.status_text && user.subscription) ? \n                                        user.status_color : \n                                        '#D0BCFF',\n                                      flexShrink: 0 \n                                    }}\n                                  >\n                                    +{followingCount - 3}\n                                  </Avatar>\n                                </Tooltip>\n                              )}\n                            </Box>\n                          ) : (\n                            <Typography variant=\"caption\" color=\"text.secondary\">\n                              {user?.subscription && user.subscription.type === 'channel' ? 'Нет подписчиков' : 'Нет друзей'}\n                            </Typography>\n                          )\n                        )}\n                      </Box>\n                    </Grid>\n                  </Grid>\n                )}\n                \n                \n                {socials && socials.length > 0 && (\n                  <Box sx={{ \n                    display: 'flex', \n                    flexWrap: 'wrap', \n                    gap: 1, \n                    mt: 3,\n                    pt: 2,\n                    borderTop: '1px solid rgba(255,255,255,0.08)'\n                  }}>\n                    {socials.map((social, index) => (\n                      <Tooltip key={index} title={social.title || social.name} arrow>\n                        <IconButton \n                          component=\"a\" \n                          href={social.url || social.link} \n                          target=\"_blank\" \n                          rel=\"noopener noreferrer\"\n                          size=\"small\"\n                          sx={{ \n                            color: (user.status_color && user.status_text && user.subscription) ? \n                              user.status_color :\n                              social.color || 'primary.main',\n                            padding: 1,\n                            bgcolor: 'rgba(255, 255, 255, 0.07)',\n                            '&:hover': {\n                              bgcolor: (user.status_color && user.status_text && user.subscription) ? \n                                `${user.status_color}15` : \n                                'rgba(255, 255, 255, 0.12)',\n                              transform: 'translateY(-2px)',\n                              transition: 'transform 0.2s'\n                            }\n                          }}\n                        >\n                          {social.icon ? (\n                            <Box component=\"img\" src={social.icon} alt={social.title || social.name} sx={{ width: 20, height: 20 }} />\n                          ) : (\n                            <Box component=\"div\" sx={{ width: 20, height: 20, fontSize: 18, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n                              {social.name?.toLowerCase().includes('instagram') ? \n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z\"/></svg>\n                              : social.name?.toLowerCase().includes('facebook') ?\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5 1.583-5 4.615v3.385z\"/></svg>\n                              : social.name?.toLowerCase().includes('twitter') || social.name?.toLowerCase().includes('x') ?\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z\"/></svg>\n                              : social.name?.toLowerCase().includes('vk') ?\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M13.162 18.994c.609 0 .858-.406.851-.915-.031-1.917.714-2.949 2.059-1.604 1.488 1.488 1.796 2.519 3.603 2.519h3.2c.808 0 1.126-.26 1.126-.668 0-.863-1.421-2.386-2.625-3.504-1.686-1.565-1.765-1.602-.313-3.486 1.801-2.339 4.157-5.336 2.073-5.336h-3.981c-.772 0-.828.435-1.103 1.083-.995 2.347-2.886 5.387-3.604 4.922-.751-.485-.407-2.406-.35-5.261.015-.754.011-1.271-1.141-1.539-.629-.145-1.241-.205-1.809-.205-2.273 0-3.841.953-2.95 1.119 1.571.293 1.42 3.692 1.054 5.16-.638 2.556-3.036-2.024-4.035-4.305-.241-.548-.315-.974-1.175-.974h-3.255c-.492 0-.787.16-.787.516 0 .602 2.96 6.72 5.786 9.77 2.756 2.975 5.48 2.708 7.376 2.708z\"/></svg>\n                              : social.name?.toLowerCase().includes('youtube') ?\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z\"/></svg>\n                              : social.name?.toLowerCase().includes('telegram') ?\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19l-9.5 5.97-4.1-1.34c-.88-.28-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71l-4.14-3.05-1.99 1.93c-.23.23-.42.42-.83.42z\"/></svg>\n                              : social.name?.toLowerCase().includes('element') ?\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 12.7 12.7\" fill=\"currentColor\">\n                                  <path d=\"M 4.9717204,2.3834823 A 5.0230292,5.0230292 0 0 0 0.59994682,7.3615548 5.0230292,5.0230292 0 0 0 5.6228197,12.384429 5.0230292,5.0230292 0 0 0 10.645693,7.3615548 5.0230292,5.0230292 0 0 0 10.630013,6.9628311 3.8648402,3.8648402 0 0 1 8.6139939,7.532543 3.8648402,3.8648402 0 0 1 4.7492118,3.6677608 3.8648402,3.8648402 0 0 1 4.9717204,2.3834823 Z\" />\n                                  <circle cx=\"8.6142359\" cy=\"3.6677198\" r=\"3.5209935\" />\n                                </svg>\n                              : \n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg>\n                              }\n                            </Box>\n                          )}\n                        </IconButton>\n                      </Tooltip>\n                    ))}\n                  </Box>\n                )}\n                \n                \n                {!isCurrentUser && (!currentUser?.account_type || currentUser.account_type !== 'channel') && (\n                  <Box sx={{ \n                    display: 'flex', \n                    gap: 1, \n                    mt: 2,\n                    justifyContent: 'center'\n                  }}>\n                    <Button \n                      variant=\"contained\" \n                      color=\"primary\"\n                      startIcon={following ? <PersonRemoveIcon /> : <PersonAddIcon />}\n                      onClick={handleFollow}\n                      fullWidth\n                      sx={{ \n                        borderRadius: 6,\n                        py: 0.7,\n                        fontWeight: 'bold',\n                        textTransform: 'none',\n                        boxShadow: (user.status_color && user.status_text && user.subscription) ?\n                          `0 2px 8px ${user.status_color}40` : \n                          '0 2px 8px rgba(208, 188, 255, 0.25)',\n                        backgroundColor: following ? \n                          'rgba(255, 255, 255, 0.1)' : \n                          (user.status_color && user.status_text && user.subscription) ?\n                            user.status_color :\n                            'primary.main',\n                        color: following ? 'text.primary' : '#fff',\n                        transition: 'all 0.2s ease',\n                        '&:hover': {\n                          backgroundColor: following ? \n                            'rgba(255, 255, 255, 0.15)' : \n                            (user.status_color && user.status_text && user.subscription) ?\n                              `${user.status_color}E6` : \n                              'primary.dark',\n                          transform: 'translateY(-2px)',\n                          boxShadow: (user.status_color && user.status_text && user.subscription) ?\n                            `0 4px 12px ${user.status_color}66` : \n                            '0 4px 12px rgba(208, 188, 255, 0.4)'\n                        },\n                        '&:active': {\n                          transform: 'translateY(0)'\n                        }\n                      }}\n                    >\n                      {following ? 'Отписаться' : 'Подписаться'}\n                    </Button>\n                  </Box>\n                )}\n                \n                \n              </Box>\n\n            </Box>\n          </Paper>\n          {user && user.account_type !== 'channel' && (\n            <Box sx={{ position: 'relative', zIndex: 1 }}>\n              <Stories userIdentifier={user.id} />\n            </Box>\n          )}\n\n        </Grid>\n        \n        \n        <Grid item xs={12} md={7} sx={{ pt: 0, ml: { xs: 0, md: '5px' }, mb: '100px' }}>\n        \n          <Paper sx={{ \n            borderRadius: '12px', \n            background: 'rgba(255, 255, 255, 0.03)',\n            backdropFilter: 'blur(20px)',\n            WebkitBackdropFilter: 'blur(20px)',\n            boxShadow: '0 5px 15px rgba(0, 0, 0, 0.2)',\n            overflow: 'hidden',\n            mb: '5px',\n            border: '1px solid rgba(255, 255, 255, 0.1)'\n          }}>\n            <Tabs \n              value={tabValue} \n              onChange={handleTabChange}\n              indicatorColor=\"primary\"\n              variant=\"fullWidth\"\n              sx={{\n                '& .MuiTab-root': {\n                  color: theme => theme.palette.mode === 'dark' ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.7)',\n                  '&.Mui-selected': {\n                    color: theme => theme.palette.primary.main,\n                  }\n                },\n                '& .MuiTabs-indicator': {\n                  backgroundColor: 'primary.main',\n                }\n              }}\n            >\n              <Tab label=\"Посты\" />\n              <Tab label=\"Стена\" />\n              <Tab label=\"Профиль\" />\n            </Tabs>\n          </Paper>\n          \n          \n          <TabPanel value={tabValue} index={0} sx={{ p: 0, mt: 1 }}>\n            {isCurrentUser && (\n              <CreatePost onPostCreated={handlePostCreated} />\n            )}\n            \n            <PostsTab />\n          </TabPanel>\n          \n          <TabPanel value={tabValue} index={1} sx={{ p: 0, mt: 1 }}>\n            {currentUser && (!currentUser.subscription || currentUser.subscription.type !== 'channel') && (\n              <CreatePost \n                onPostCreated={handlePostCreated} \n                postType=\"stena\" \n                recipientId={user.id} \n              />\n            )}\n            \n            <WallPostsTab userId={user.id} />\n          </TabPanel>\n          \n          <TabPanel value={tabValue} index={2} sx={{ p: 0, mt: 1 }}>\n            <Paper sx={{ \n              p: 3, \n              borderRadius: '12px',\n              background: 'rgba(255, 255, 255, 0.03)',\n              backdropFilter: 'blur(20px)',\n              WebkitBackdropFilter: 'blur(20px)',\n              boxShadow: '0 5px 15px rgba(0, 0, 0, 0.2)',\n              border: '1px solid rgba(255, 255, 255, 0.1)'\n            }}>\n\n              \n              <Grid container spacing={3}>\n                {/* Основная информация */}\n                <Grid item xs={12}>\n                  <Box sx={{ mb: 2 }}>\n                    {/* Коннект */}\n                    {user?.connect_info && user.connect_info.length > 0 && (\n                      <Box sx={{ \n                        display: 'flex', \n                        alignItems: 'center', \n                        justifyContent: 'center',\n                        mb: 2,\n                        p: 2,\n                        borderRadius: 2,\n                        bgcolor: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.03)',\n                        border: theme => theme.palette.mode === 'dark' ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.05)'\n                      }}>\n                        <Box sx={{ display: 'flex', alignItems: 'center' }}>\n                          <Typography \n                            component={Link} \n                            to={`/profile/${user.username}`}\n                            sx={{ \n                              color: 'text.primary',\n                              textDecoration: 'none',\n                              '&:hover': {\n                                textDecoration: 'underline'\n                              }\n                            }}\n                          >\n                            @{user.username}\n                          </Typography>\n                          <Typography sx={{ mx: 1, color: 'text.secondary' }}>\n                            •\n                          </Typography>\n                          <Typography sx={{ color: 'text.secondary' }}>\n                            {user.connect_info[0].days} дней\n                          </Typography>\n                          <Typography sx={{ mx: 1, color: 'text.secondary' }}>\n                            •\n                          </Typography>\n                          <Typography \n                            component={Link} \n                            to={`/profile/${user.connect_info[0].username}`}\n                            sx={{ \n                              color: 'text.primary',\n                              textDecoration: 'none',\n                              '&:hover': {\n                                textDecoration: 'underline'\n                              }\n                            }}\n                          >\n                            @{user.connect_info[0].username}\n                          </Typography>\n                        </Box>\n                      </Box>\n                    )}\n\n                    {/* Остальная информация */}\n                    {user?.about && (\n                      <Typography \n                        variant=\"body2\" \n                        sx={{ \n                          mt: 1,\n                          lineHeight: 1.5,\n                          color: user?.status_color ? getLighterColor(user.status_color) : theme => theme.palette.text.secondary,\n                          p: 1.5,\n                          borderRadius: 2,\n                          background: theme => theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.03)',\n                          backdropFilter: 'blur(10px)',\n                          border: theme => theme.palette.mode === 'dark' ? '1px solid rgba(255,255,255,0.05)' : '1px solid rgba(0,0,0,0.05)',\n                          overflowWrap: 'break-word',\n                          wordBreak: 'break-word',\n                          whiteSpace: 'normal'\n                        }}\n                      >\n                        {user.about}\n                      </Typography>\n                    )}\n                  </Box>\n                </Grid>\n                \n                {user?.location && (\n                  <Grid item xs={12} sm={6}>\n                    <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 1.5 }}>\n                      <LocationOnIcon color=\"primary\" sx={{ mt: 0.5 }} />\n                      <Box>\n                        <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                          Местоположение\n                        </Typography>\n                        <Typography variant=\"body2\">\n                          {user.location}\n                        </Typography>\n                      </Box>\n                    </Box>\n                  </Grid>\n                )}\n                \n                {user?.website && (\n                  <Grid item xs={12} sm={6}>\n                    <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 1.5 }}>\n                      <LinkIcon color=\"primary\" sx={{ mt: 0.5 }} />\n                      <Box>\n                        <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                          Веб-сайт\n                        </Typography>\n                        <Typography variant=\"body2\">\n                          <Link href={user.website} target=\"_blank\" rel=\"noopener noreferrer\" sx={{ color: 'primary.main' }}>\n                            {user.website.replace(/^https?:\\/\\//, '')}\n                          </Link>\n                        </Typography>\n                      </Box>\n                    </Box>\n                  </Grid>\n                )}\n                \n                {user?.birthday && (\n                  <Grid item xs={12} sm={6}>\n                    <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 1.5 }}>\n                      <CakeIcon color=\"primary\" sx={{ mt: 0.5 }} />\n                      <Box>\n                        <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                          Дата рождения\n                        </Typography>\n                        <Typography variant=\"body2\">\n                          {formatDate(user.birthday)}\n                        </Typography>\n                      </Box>\n                    </Box>\n                  </Grid>\n                )}\n                \n                <Grid item xs={12} sm={6}>\n                  <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 1.5 }}>\n                    <TodayIcon color=\"primary\" sx={{ mt: 0.5 }} />\n                    <Box>\n                      <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                        Дата регистрации\n                      </Typography>\n                      <Typography variant=\"body2\">\n                        {user?.registration_date ? new Date(user.registration_date).toLocaleDateString('ru-RU', {\n                          year: 'numeric',\n                          month: 'long',\n                          day: 'numeric'\n                        }) : 'Недоступно'}\n                      </Typography>\n                    </Box>\n                  </Box>\n                </Grid>\n                \n                {user?.purchased_usernames && user.purchased_usernames.length > 0 && (\n                  <Grid item xs={12}>\n                    <Box sx={{ display: 'flex', alignItems: 'flex-start', gap: 1.5 }}>\n                      <AlternateEmailIcon color=\"primary\" sx={{ mt: 0.5 }} />\n                      <Box>\n                        <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                          Юзернеймы\n                        </Typography>\n                        <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1 }}>\n                          \n                          {user.purchased_usernames.map((usernameObj, idx) => (\n                            <Chip \n                              key={idx}\n                              label={usernameObj.username}\n                              size=\"small\"\n                              variant={usernameObj.is_active ? \"filled\" : \"outlined\"}\n                              color={usernameObj.is_active ? \"primary\" : \"default\"}\n                              onClick={(e) => handleUsernameClick(e, usernameObj.username)}\n                              sx={{ \n                                '& .MuiChip-label': {\n                                  px: 1\n                                }\n                              }}\n                            />\n                          ))}\n                        </Box>\n                      </Box>\n                    </Box>\n                  </Grid>\n                )}\n\n                {/* Medals section */}\n                {medals && medals.length > 0 && (\n                  <Grid item xs={12}>\n                    <Box sx={{ \n                      display: 'flex', \n                      alignItems: 'flex-start', \n                      gap: 1.5,\n                      pb: 2,\n                      borderBottom: '1px solid rgba(255,255,255,0.07)'\n                    }}>\n                      <EmojiEventsIcon color=\"primary\" sx={{ mt: 0.5 }} />\n                      <Box>\n                        <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\n                          Медали\n                        </Typography>\n                        <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 2, mt: 1 }}>\n                          {medals.map((medal) => (\n                            <Tooltip\n                              key={medal.id}\n                              title={\n                                <Box>\n                                  {medal.description && (\n                                    <Typography variant=\"caption\">{medal.description}</Typography>\n                                  )}\n                                  <Typography variant=\"caption\" display=\"block\" sx={{ mt: 0.5, opacity: 0.8 }}>\n                                    Выдана: {new Date(medal.awarded_at).toLocaleDateString()}\n                                  </Typography>\n                                  <Typography variant=\"caption\" display=\"block\" sx={{ opacity: 0.8 }}>\n                                    Кем: @{medal.awarded_by}\n                                  </Typography>\n                                </Box>\n                              }\n                              arrow\n                            >\n                              <img\n                                src={medal.image_path}\n                                alt={medal.name}\n                                style={{ \n                                  width: 150,\n                                  height: 150,\n                                  cursor: 'pointer',\n                                  transition: 'transform 0.2s',\n                                  filter: 'drop-shadow(0 2px 4px rgba(0,0,0,0.2))'\n                                }}\n                                onMouseOver={(e) => {\n                                  e.currentTarget.style.transform = 'translateY(-2px)';\n                                  e.currentTarget.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.3))';\n                                }}\n                                onMouseOut={(e) => {\n                                  e.currentTarget.style.transform = 'translateY(0)';\n                                  e.currentTarget.style.filter = 'drop-shadow(0 2px 4px rgba(0,0,0,0.2))';\n                                }}\n                              />\n                            </Tooltip>\n                          ))}\n                        </Box>\n                      </Box>\n                    </Box>\n                  </Grid>\n                )}\n              </Grid>\n            </Paper>\n          </TabPanel>\n        </Grid>\n      </Grid>\n      \n      \n      {lightboxIsOpen && (\n        <div \n          style={{\n            position: 'fixed',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            backgroundColor: 'rgba(0, 0, 0, 0.9)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            zIndex: 9999\n          }}\n          onClick={closeLightbox}\n        >\n          <img \n            src={currentImage} \n            alt=\"Full size\" \n            style={{ \n              maxWidth: '90%', \n              maxHeight: '90%', \n              objectFit: 'contain' \n            }} \n            onClick={(e) => e.stopPropagation()}\n          />\n          <IconButton\n            sx={{\n              position: 'absolute',\n              top: 20,\n              right: 20,\n              color: 'white',\n              backgroundColor: 'rgba(0, 0, 0, 0.5)',\n              '&:hover': {\n                backgroundColor: 'rgba(0, 0, 0, 0.7)',\n              }\n            }}\n            onClick={closeLightbox}\n          >\n            <CloseIcon />\n          </IconButton>\n        </div>\n      )}\n      \n      <Snackbar\n        open={snackbar.open}\n        autoHideDuration={4000}\n        onClose={handleCloseSnackbar}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert \n          onClose={handleCloseSnackbar} \n          severity={snackbar.severity}\n          variant=\"filled\"\n        >\n          {snackbar.message}\n        </Alert>\n      </Snackbar>\n      <AnimatePresence>\n        {selectedUsername && (\n          <UsernameCard \n            username={selectedUsername}\n            onClose={handleCloseUsernameCard}\n            open={usernameCardOpen}\n          />\n        )}\n      </AnimatePresence>\n    </Container>\n  );\n};\n\nexport default ProfilePage; "],"names":["TabContentLoader","tabIndex","children","containerSx","jsx","Box","sx","position","overflow","AnimatePresence","mode","initial","motion","div","opacity","animate","exit","transition","type","duration","ease","_interopRequireDefault","require$$0","Object","defineProperty","Today","value","default","_createSvgIcon","_jsxRuntime","require$$2","d","Feed","PostsFeed","userId","statusColor","posts","setPosts","useState","pinnedPost","setPinnedPost","loading","setLoading","isLoadingMore","setIsLoadingMore","hasMore","setHasMore","page","setPage","error","setError","observer","useRef","isMounted","loadingRef","isAuthenticated","useContext","AuthContext","isProfilePage","window","location","pathname","includes","useEffect","current","fetchPinnedPost","useCallback","async","username","response","axios","get","data","id","fetchPosts","pageNumber","params","per_page","forceRefresh","Array","isArray","newPosts","prevPosts","has_next","status","handlePinStateChanged","event","postId","isPinned","detail","postToPin","find","p","addEventListener","removeEventListener","split","disconnect","lastPostElementRef","node","IntersectionObserver","entries","isIntersecting","prevPage","threshold","observe","handleDeletePost","updatedPost","map","post","toString","filter","handleGlobalPostCreated","newPost","user_id","parseInt","length","mt","_","index","PostSkeleton","jsxs","textAlign","py","px","bgcolor","borderRadius","display","flexDirection","alignItems","gap","FeedIcon","fontSize","color","mb","Typography","variant","gutterBottom","maxWidth","Post","onDelete","showActions","ref","justifyContent","my","CircularProgress","size","WallFeed","wallPosts","setWallPosts","fetchWallPosts","prev","recipient_id","LinkRounded","viewStory","storyId","deleteStory","delete","addStoryReaction","emoji","REACTION_EMOJIS","ReactionMenu","styled","theme","left","bottom","transform","zIndex","background","padding","boxShadow","backdropFilter","border","ReactionButton","IconButton","selected","palette","primary","main","ViewerContainer","top","right","backgroundColor","breakpoints","up","StoryContentContainer","$isMobile","width","height","minWidth","minHeight","maxHeight","aspectRatio","undefined","BlurredMediaBackground","imageUrl","backgroundImage","backgroundSize","backgroundPosition","ProgressContainer","ProgressBar","progress","flex","content","MediaContainer","Media","objectFit","Video","ControlsContainer","Header","UserInfo","UserAvatar","Avatar","flexShrink","ClickableOverlay","cursor","formatTime","created_at_unix","created_at_utc","date","Date","isNaN","getTime","now","diffMs","hour","Math","floor","toLocaleString","day","month","year","minute","ReactionUsersDialog","open","onClose","reactions","setReactions","then","finally","Dialog","fullWidth","PaperProps","DialogTitle","onClick","CloseIcon","pt","align","user","src","photo","fontWeight","name","ml","StoryViewer","userStories","currentUserIndex","setCurrentUserIndex","currentUserId","onStoryDeleted","isMuted","onToggleSound","isMobile","onStoryViewed","onNextUser","stories","setStories","currentIndex","setCurrentIndex","setProgress","deleteDialogOpen","setDeleteDialogOpen","progressInterval","videoRef","useTheme","Set","currentUser","useAuth","isMobileScreen","useMediaQuery","down","alreadyViewedStories","lastLoadedBg","setLastLoadedBg","bgLoaded","setBgLoaded","reactionMenuOpen","setReactionMenuOpen","myReaction","setMyReaction","reactionAnchor","setReactionAnchor","reactionLoading","setReactionLoading","showReactionsDialog","setShowReactionsDialog","prevUserId","prevStoriesLength","newUserId","newStoriesLength","has","add","startProgress","clearInterval","isVideo","media_url","match","setInterval","handleNext","handleOverlayClick","e","clientX","currentTarget","getBoundingClientRect","handleClose","user_reaction","currentStory","displayUser","currentMediaType","isMyStory","stopPropagation","alt","lineHeight","whiteSpace","textOverflow","mr","DeleteIcon","style","onLoad","Fragment","VisibilityIcon","view_count","loop","autoPlay","playsInline","muted","onLoadedData","VolumeOffIcon","VolumeUpIcon","Popper","anchorEl","placement","disablePortal","TransitionProps","Fade","timeout","handleSelectReaction","disabled","DialogActions","Button","deletedId","apiDeleteStory","updatedStories","idx","dispatchEvent","CustomEvent","message","shortMessage","notificationType","animationType","StoriesCard","Card","WebkitBackdropFilter","marginBottom","StoriesContainer","overflowX","msOverflowStyle","scrollbarWidth","StoryItem","hasStory","StoryPreview","paper","AddStoryButton","Stories","userIdentifier","loadStories","useStoriesFeed","fetchUserStories","fetchStories","publish","publishStory","actionLoading","setActionLoading","actionError","setActionError","file","formData","FormData","append","headers","view","remove","useStoryActions","previewFile","setPreviewFile","previewUrl","setPreviewUrl","setIsMuted","setIsMobile","viewedStories","setViewedStories","fileInputRef","account_type","isOwnProfile","checkMobile","matchMedia","matches","handleVolumeChange","target","volume","video","viewed","forEach","storyGroup","story","flattenedStories","useMemo","flatMap","sort","a","b","aViewed","aDate","created_at","handleCancelPreview","handleToggleSound","previewMediaType","startsWith","onChange","files","URL","createObjectURL","accept","handleAddStory","click","AddIcon","findIndex","s","handleStoryClick","preview_url","component","VideocamIcon","alert","handlePublishStory","handleCloseStory","prevStories","sg","handleNextUser","PostInput","TextField","spacing","text","borderColor","PostActions","borderTop","marginTop","PublishButton","textTransform","CreatePost","onPostCreated","postType","recipientId","playTrack","currentTrack","isPlaying","togglePlay","MusicContext","setContent","mediaFiles","setMediaFiles","mediaType","setMediaType","mediaPreview","setMediaPreview","isSubmitting","setIsSubmitting","isDragging","setIsDragging","mediaNotification","setMediaNotification","musicSelectOpen","setMusicSelectOpen","selectedTracks","setSelectedTracks","snackbar","setSnackbar","severity","rateLimitDialog","setRateLimitDialog","timeRemaining","showSizeError","setShowSizeError","sizeErrorMessage","setSizeErrorMessage","MAX_VIDEO_SIZE","MAX_PHOTO_SIZE","ALLOWED_IMAGE_TYPES","ALLOWED_VIDEO_TYPES","dragCounter","processFiles","allFiles","validTypeFiles","from","isValidImage","isValidVideo","imageFiles","videoFiles","reader","FileReader","onloadend","result","readAsDataURL","newPreviews","push","handleSubmit","trim","trackData","track","title","artist","file_path","cover_path","JSON","stringify","postData","images","image","File","music","key","_invalidatesCache","cache","clearPostsCache","postError","putResponse","put","putError","finalResponse","PostService","success","rateLimit","rate_limit","errorMessage","reset","resetTime","diffSeconds","round","Paper","elevation","Alert","onSubmit","preventDefault","onDragEnter","onDragOver","onDragLeave","onDrop","setDragActive","dataTransfer","hasInvalidSize","isImage","ImageOutlinedIcon","textShadow","placeholder","multiline","maxRows","onPaste","clipboardData","items","i","indexOf","getAsFile","ImageList","margin","cols","rowHeight","preview","ImageListItem","controls","handleRemoveMedia","onError","MusicNoteIcon","noWrap","handleRemoveTrack","trackId","multiple","htmlFor","startIcon","endIcon","MusicSelectDialog","onSelectTracks","tracks","maxTracks","Snackbar","autoHideDuration","anchorOrigin","vertical","horizontal","DynamicIslandNotification","TabPanel","other","role","hidden","UserStatus","statusText","gradientColor","hexColor","r","substr","g","min","max","padStart","createGradientColor","textColor","parsedStatus","iconTagRegex","iconName","toLowerCase","replace","parseStatusText","StatusIcon","SvgIcon","viewBox","fill","xmlns","LocationOnIcon","CakeIcon","InfoIcon","ChatIcon","getIconByName","scale","y","stiffness","damping","delay","borderStyle","borderWidth","maskImage","className","animation","paddingLeft","getLighterColor","factor","hex","substring","lighter","SubscriptionBadge","subscriptionDate","subscriptionType","badgeType","tooltipText","dateString","toLocaleDateString","Tooltip","arrow","ProfilePage","useParams","setUser","ownedUsernames","setOwnedUsernames","photos","setPhotos","videos","setVideos","tabValue","setTabValue","loadingPhotos","setLoadingPhotos","loadingVideos","setLoadingVideos","following","setFollowing","followersCount","setFollowersCount","followingCount","setFollowingCount","postsCount","setPostsCount","followers","setFollowers","followingList","setFollowingList","friends","setFriends","loadingFollowers","setLoadingFollowers","loadingFollowing","setLoadingFollowing","loadingFriends","setLoadingFriends","socials","setSocials","lightboxIsOpen","setLightboxIsOpen","currentImage","setCurrentImage","navigate","useNavigate","themeSettings","setProfileBackground","clearProfileBackground","ThemeSettingsContext","totalLikes","setTotalLikes","isOnline","setIsOnline","lastActive","setLastActive","fallbackAvatarUrl","setFallbackAvatarUrl","medals","setMedals","loadingMedals","setLoadingMedals","selectedUsername","setSelectedUsername","usernameCardAnchor","setUsernameCardAnchor","usernameCardOpen","setUsernameCardOpen","userBanInfo","setUserBanInfo","isCurrentUserModerator","setIsCurrentUserModerator","closeLightbox","handleCloseSnackbar","handlePostCreated","verification_status","verification","achievement","connect_info","total_likes","subscription","photosData","videosData","followers_count","following_count","is_following","posts_count","usernamesResponse","otherUsernames","usernames","item","is_active","ban","current_user_is_moderator","fetchUserProfile","followersData","f","catch","followingData","friendsData","fetchTotalLikes","is_online","last_active","fetchOnlineStatus","fetchUserMedals","handleUsernameClick","profile_background_url","Container","Link","to","isCurrentUser","WallPostsTab","PostsTab","status_color","pb","xs","sm","marginRight","marginLeft","paddingTop","paddingBottom","paddingRight","Grid","container","md","flexWrap","profile_id","banner_url","avatar_url","status_text","fallbackSrc","WebkitBackgroundClip","WebkitTextFillColor","VerificationBadge","total_duration_months","subscription_date","image_path","bage","HTMLImageElement","secondary","LinkRoundedIcon","textDecoration","reason","end_date","remaining_days","BlockIcon","scam","WarningIcon","Chip","icon","label","expires_at","DiamondIcon","charAt","toUpperCase","slice","usernameItem","React","mx","fontStyle","is_auto_ban","admin","start_date","details","about","overflowWrap","wordBreak","gridTemplateColumns","friend","friends_count","social","href","url","link","rel","cx","cy","PersonRemoveIcon","PersonAddIcon","requireAuth","state","followed_id","Tabs","handleTabChange","newValue","indicatorColor","Tab","days","website","LinkIcon","birthday","formatDate","TodayIcon","registration_date","purchased_usernames","AlternateEmailIcon","usernameObj","borderBottom","EmojiEventsIcon","medal","description","awarded_at","awarded_by","onMouseOver","onMouseOut","UsernameCard","handleCloseUsernameCard"],"mappings":"yqDAGA,MCKMA,GAAmBA,EACvBC,WACAC,WACAC,cAAc,CAAA,KAGZC,EAAAA,IAACC,GAAIC,GAAI,CAAEC,SAAU,WAAYC,SAAU,YAAaL,GACtDD,SAACE,EAAAA,IAAAK,EAAA,CAAgBC,KAAK,OAAOC,SAAS,EACpCT,SAACE,EAAAA,IAAAQ,EAAOC,IAAP,CAECF,QAAS,CAAEG,QAAS,KACpBC,QAAS,CAAED,QAAS,GACpBE,KAAM,CAAEF,QAAS,KACjBG,WAAY,CACVC,KAAM,QACNC,SAAU,IACVC,KAAM,aAGPlB,YAVID,uDCdf,IAAIoB,EAAyBC,IAC7BC,OAAOC,eAAeC,GAAS,aAAc,CAC3CC,OAAO,IAESD,GAAAE,aAAA,EAClB,IAAIC,EAAiBP,OACjBQ,EAAcC,WACHL,GAAmBE,SAAA,EAAGC,EAAeD,UAAwB,EAAGE,EAAYzB,KAAK,OAAQ,CACtG2B,EAAG,oIACD,8ECTJ,IAAIV,EAAyBC,IAC7BC,OAAOC,eAAeQ,GAAS,aAAc,CAC3CN,OAAO,IAESM,GAAAL,aAAA,EAClB,IAAIC,EAAiBP,OACjBQ,EAAcC,WACHE,GAAmBL,SAAA,EAAGC,EAAeD,UAAwB,EAAGE,EAAYzB,KAAK,OAAQ,CACtG2B,EAAG,qHACD,6BCHEE,GAAYA,EAAGC,SAAQC,kBAC3B,MAAOC,EAAOC,GAAYC,EAAAA,SAAS,KAC5BC,EAAYC,GAAiBF,EAAAA,SAAS,OACtCG,EAASC,GAAcJ,EAAAA,UAAS,IAChCK,EAAeC,GAAoBN,EAAAA,UAAS,IAC5CO,EAASC,GAAcR,EAAAA,UAAS,IAChCS,EAAMC,GAAWV,EAAAA,SAAS,IAC1BW,EAAOC,GAAYZ,EAAAA,SAAS,MAC7Ba,EAAWC,EAAAA,SAEXC,EAAYD,UAAO,GACnBE,EAAaF,UAAO,IACpBG,gBAAEA,GAAoBC,EAAAA,WAAWC,GACjCC,EAAgBC,OAAOC,SAASC,SAASC,SAAS,aAExDC,EAAAA,UAAU,KACRV,EAAUW,SAAU,EACb,KACLX,EAAUW,SAAU,IAErB,IAEGC,MAAAA,EAAkBC,cAAYC,MAAOC,IACzC,IAAKV,IAAkBU,EAAiB,OAAA,KAEpC,IACF,MAAMC,QAAiBC,EAAMC,IAAI,4BAA4BH,KAC7D,OAAIf,EAAUW,SAAWK,EAASG,MAAQH,EAASG,KAAKC,IACtDjC,EAAc6B,EAASG,MAChBH,EAASG,OAElBhC,EAAc,MACP,YACAS,GAGA,OADPT,EAAc,MACP,IAAA,GAER,CAACkB,IAEEgB,EAAaR,EAAAA,YAAYC,MAAOQ,EAAa,EAAGP,EAAW,QAC/D,IAAId,EAAWU,QAEX,IACFV,EAAWU,SAAU,EAEF,IAAfW,EACFjC,GAAW,GAEXE,GAAiB,GAIfc,GAAgC,IAAfiB,GAAoBP,SACjCH,EAAgBG,GAGxB,MAAMC,QAAiBC,EAAMC,IAAI,gBAAgBrC,UAAgB,CAC/D0C,OAAQ,CACN7B,KAAM4B,EACNE,SAAU,IAEZC,cAAc,IAGZ,IAACzB,EAAUW,QAAS,OAEpBK,GAAAA,EAASG,KAAKpC,OAAS2C,MAAMC,QAAQX,EAASG,KAAKpC,OAAQ,CACvD6C,MAAAA,EAAWZ,EAASG,KAAKpC,MAG7BC,EADiB,IAAfsC,EACOM,EAEaC,GAEb,IADWH,MAAMC,QAAQE,GAAaA,EAAY,MAChCD,IAIlBZ,EAAAA,EAASG,KAAKW,SAAQ,MAEd,IAAfR,GACFtC,EAAS,IAEXS,GAAW,SAENG,GAEHI,EAAUW,UACRf,EAAMoB,UAAsC,MAA1BpB,EAAMoB,SAASe,OACnClC,EAAS,+CAETA,EAAS,wCAEb,CACQ,QACJG,EAAUW,UACZtB,GAAW,GACXE,GAAiB,GACjBU,EAAWU,SAAU,EACvB,GAED,CAAC9B,EAAQwB,EAAeO,IAG3BF,EAAAA,UAAU,KACFsB,MAAAA,EAAwBlB,MAAOmB,IAC7B,MAAAC,OAAEA,EAAAA,SAAQC,GAAaF,EAAMG,OAEnC,GAAID,EAAU,CAEZ,MAAME,EAAYtD,EAAMuD,KAAUC,GAAAA,EAAEnB,KAAOc,GACvCG,GAEFlD,EAAckD,EAChB,MAGInD,GAAcA,EAAWkC,KAAOc,GAClC/C,EAAc,YAKZyB,UACAS,EAAW,IAKnB,OAFOmB,OAAAA,iBAAiB,4BAA6BR,GAE9C,KACES,OAAAA,oBAAoB,4BAA6BT,KAEzD,CAACpB,EAAiBS,EAAYtC,EAAOG,IAExCwB,EAAAA,UAAU,KACR,GAAI7B,EAAQ,CACVc,EAAQ,GACRX,EAAS,IACTG,EAAc,MACdM,GAAW,GAGX,MAAMsB,EAAWT,OAAOC,SAASC,SAASkC,MAAM,aAAa,GAC7DrB,EAAW,EAAGN,EAAQ,CAGxB,MAAO,KACDjB,EAASa,SACXb,EAASa,QAAQgC,eAGpB,CAAC9D,EAAQwC,IAENuB,MAAAA,EAAqB/B,cAAoBgC,IACzCzD,GAAWE,IAAkBE,IAE7BM,EAASa,SAAkBA,EAAAA,QAAQgC,aAE9BhC,EAAAA,QAAU,IAAImC,qBAAgCC,IACjDA,EAAQ,GAAGC,gBAAkBxD,IAAYS,EAAWU,SAC9CsC,EAAAA,GAAYA,EAAW,IAEhC,CAAEC,UAAW,KAEZL,GAAM/C,EAASa,QAAQwC,QAAQN,KAClC,CAACzD,EAASE,EAAeE,IAE5BkB,EAAAA,UAAU,KACJhB,EAAO,GACT2B,EAAW3B,IAEZ,CAACA,EAAM2B,IAEJ+B,MAAAA,EAAmBA,CAAClB,EAAQmB,KAC5BA,GACFrE,EACE6C,GAAAA,EAAUyB,IAAIC,GACZA,EAAKnC,GAAGoC,aAAetB,EAAOsB,WAAaH,EAAcE,IAGzDrE,GAAcA,EAAWkC,GAAGoC,aAAetB,EAAOsB,YACpDrE,EAAckE,KAGPxB,EAAAA,GACPA,EAAU4B,OAAeF,GAAAA,EAAKnC,GAAGoC,aAAetB,EAAOsB,aAErDtE,GAAcA,EAAWkC,GAAGoC,aAAetB,EAAOsB,YACpDrE,EAAc,QAqBhBC,OAhBJsB,EAAAA,UAAU,KACR,MAAMgD,EAAqCzB,IACzC,MAAM0B,EAAU1B,EAAMG,OAElBuB,GAAWA,EAAQC,UAAYC,SAAShF,IAC1CG,EAAsB6C,GAAA,CAAC8B,KAAY9B,KAMvC,OAFOW,OAAAA,iBAAiB,eAAgBkB,GAEjC,KACEjB,OAAAA,oBAAoB,eAAgBiB,KAE5C,CAAC7E,IAEAO,GAA4B,IAAjBL,EAAM+E,OAEjB/G,EAAAA,IAACC,GAAIC,GAAI,CAAE8G,GAAI,GACZlH,SAAA,CAAC,EAAG,EAAG,GAAGyG,IAAI,CAACU,EAAGC,IACjBlH,EAAAA,IAACmH,GAAkBD,CAAAA,EAAAA,MAMvBrE,EAEAuE,EAAAA,KAACnH,GAAIC,GAAI,CACPmH,UAAW,SACXC,GAAI,EACJC,GAAI,EACJC,QAAS,mBACTC,aAAc,EACdC,QAAS,OACTC,cAAe,SACfC,WAAY,SACZC,IAAK,GAEL/H,SAAA,CAAAE,MAAC8H,IAAS5H,GAAI,CAAE6H,SAAU,GAAIC,MAAO,iBAAkBC,GAAI,KAC3DjI,EAAAA,IAACkI,EAAW,CAAAC,QAAQ,KAAKH,MAAM,eAAeI,cAAY,EACvDvF,SAAU,gDAAVA,EACG,8CACA,2BAELqF,EAAW,CAAAC,QAAQ,QAAQH,MAAM,iBAAiB9H,GAAI,CAAEmI,SAAU,KAChExF,SAAU,gDAAVA,EACG,6DACAA,OAMS,IAAjBb,EAAM+E,QAAiB1E,GAAYF,EA2BrCiF,EAAAA,KAACnH,GAAIC,GAAI,CAAE8G,GAAI,IACZ7E,SAAAA,CACCA,GAAAnC,EAAAA,IAACC,GAAIC,GAAI,CACPC,SAAU,YAEVL,SAAAE,EAAAA,IAACsI,GACC,CAAA9B,KAAMrE,EACNoG,SAAUlC,EACVmC,aAAW,EACXpD,UAAQ,EACRrD,kBAKLC,EAAMuE,IAAI,CAACC,EAAMU,IACZlF,EAAM+E,SAAWG,EAAQ,EAExBlH,EAAAA,IAAAC,EAAA,CAAIwI,IAAK5C,EACR/F,eAACwI,GACC,CAAA9B,OACA+B,SAAUlC,EACVmC,aAAW,EACXzG,iBAL+ByE,EAAKnC,IAWxCrE,MAACsI,IAEC9B,OACA+B,SAAUlC,EACVmC,aAAW,EACXzG,eAJKyE,EAAKnC,KAUjB9B,GACEvC,EAAAA,IAAAC,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQgB,eAAgB,SAAUC,GAAI,GACxD7I,SAAAE,EAAAA,IAAC4I,EAAiB,CAAAC,KAAM,QAI1BpG,GAAWT,EAAM+E,OAAS,GAC1B/G,MAACC,GAAIC,GAAI,CAAEmH,UAAW,SAAUC,GAAI,EAAGN,GAAI,GACzClH,eAACoI,EAAW,CAAAC,QAAQ,QAAQH,MAAM,iBAAgBlI,sCAzEtDsH,EAAAA,KAACnH,GAAIC,GAAI,CACPmH,UAAW,SACXC,GAAI,EACJC,GAAI,EACJC,QAAS,mBACTC,aAAc,EACdC,QAAS,OACTC,cAAe,SACfC,WAAY,SACZC,IAAK,GAEL/H,SAAA,CAAAE,MAAC8H,IAAS5H,GAAI,CAAE6H,SAAU,GAAIC,MAAO,iBAAkBC,GAAI,KAC3DjI,EAAAA,IAACkI,EAAW,CAAAC,QAAQ,KAAKH,MAAM,eAAeI,cAAY,EACvDjF,SAAkBA,EAAA,mBAAqB,sDAEzC+E,EAAW,CAAAC,QAAQ,QAAQH,MAAM,iBAAiB9H,GAAI,CAAEmI,SAAU,KAChElF,SACGA,EAAA,6CACA,mEC7QR2F,GAAWA,EAAGhH,aAClB,MAAOiH,EAAWC,GAAgB9G,EAAAA,SAAS,KACpCG,EAASC,GAAcJ,EAAAA,UAAS,IAChCK,EAAeC,GAAoBN,EAAAA,UAAS,IAC5CO,EAASC,GAAcR,EAAAA,UAAS,IAChCS,EAAMC,GAAWV,EAAAA,SAAS,IAC1BW,EAAOC,GAAYZ,EAAAA,SAAS,MAC7Ba,EAAWC,EAAAA,SACXC,EAAYD,UAAO,GACnBE,EAAaF,UAAO,GAG1BW,EAAAA,UAAU,KACRV,EAAUW,SAAU,EACb,KACLX,EAAUW,SAAU,IAErB,IAGH,MAAMqF,EAAiBnF,EAAAA,YAAYC,MAAOQ,EAAa,KAErD,IAAIrB,EAAWU,QAEX,IACFV,EAAWU,SAAU,EAEF,IAAfW,EACFjC,GAAW,GAEXE,GAAiB,GAInB,MAAMyB,QAAiBC,EAAMC,IAAI,gBAAgBrC,SAAe,CAC9D0C,OAAQ,CACN7B,KAAM4B,EACNE,SAAU,MAKV,IAACxB,EAAUW,QAAS,OAGpBK,EAASG,KAAKpC,OAAS2C,MAAMC,QAAQX,EAASG,KAAKpC,QAEtCiC,EADI,IAAfM,EACWN,EAASG,KAAKpC,MAEdkH,GAAQ,IAAIA,KAASjF,EAASG,KAAKpC,QAGvCiC,EAAAA,EAASG,KAAKW,YAEN,IAAfR,GAA+ByE,EAAA,IACnCtG,GAAW,UAENG,GAEHI,EAAUW,UACO,IAAfW,GAA+ByE,EAAA,IACnClG,EAAS,+CACX,CACQ,QACJG,EAAUW,UACZtB,GAAW,GACXE,GAAiB,GACjBU,EAAWU,SAAU,EACvB,GAED,CAAC9B,IAGJ6B,EAAAA,UAAU,KACJ7B,IACFc,EAAQ,GACRoG,EAAa,IACbtG,GAAW,GACXuG,EAAe,IAGV,KACDlG,EAASa,SACXb,EAASa,QAAQgC,eAGpB,CAAC9D,EAAQmH,IAGNpD,MAAAA,EAAqB/B,cAAoBgC,IACzCzD,GAAWE,IAAkBE,IAE7BM,EAASa,SAAkBA,EAAAA,QAAQgC,aAE9BhC,EAAAA,QAAU,IAAImC,qBAAgCC,IACjDA,EAAQ,GAAGC,gBAAkBxD,IAAYS,EAAWU,SAC9CsC,EAAAA,GAAYA,EAAW,IAEhC,CAAEC,UAAW,KAEZL,GAAM/C,EAASa,QAAQwC,QAAQN,KAClC,CAACzD,EAASE,EAAeE,IAG5BkB,EAAAA,UAAU,KACJhB,EAAO,GACTsG,EAAetG,IAEhB,CAACA,EAAMsG,IAGJ5C,MAAAA,EAAmBA,CAAClB,EAAQmB,KAE9B0C,EADE1C,EAEAxB,GAAAA,EAAUyB,IAAIC,GACZA,EAAKnC,GAAGoC,aAAetB,EAAOsB,WAAaH,EAAcE,GAIhD1B,GACXA,EAAU4B,OACRF,GAAAA,EAAKnC,GAAGoC,aAAetB,EAAOsB,cAuBlCpE,OAhBJsB,EAAAA,UAAU,KACR,MAAMgD,EAAqCzB,IACzC,MAAM0B,EAAU1B,EAAMG,OAED,UAAjBuB,EAAQ9F,MAAoB8F,EAAQuC,eAAiBrC,SAAShF,IAChEkH,EAA0BlE,GAAA,CAAC8B,KAAY9B,KAM3C,OAFOW,OAAAA,iBAAiB,eAAgBkB,GAEjC,KACEjB,OAAAA,oBAAoB,eAAgBiB,KAE5C,CAAC7E,IAEAO,GAAgC,IAArB0G,EAAUhC,OAErB/G,EAAAA,IAACC,GAAIC,GAAI,CAAE8G,GAAI,GACZlH,SAAA,CAAC,EAAG,EAAG,GAAGyG,IAAI,CAACU,EAAGC,IACjBlH,EAAAA,IAACmH,GAAkBD,CAAAA,EAAAA,MAMvBrE,EAEA7C,EAAAA,IAACC,GAAIC,GAAI,CAAEmH,UAAW,SAAUC,GAAI,EAAGE,QAAS,mBAAoBC,aAAc,EAAGT,GAAI,GACvFlH,SAACE,MAAAkI,EAAA,CAAWF,MAAM,QAASnF,eAKR,IAArBkG,EAAUhC,QAAiB1E,EAW7B+E,EAAAA,KAACnH,GAAIC,GAAI,CAAE8G,GAAG,IACX+B,SAAAA,CAAUxC,EAAAA,IAAI,CAACC,EAAMU,IAEhB6B,EAAUhC,SAAWG,EAAQ,EAE5BlH,EAAAA,IAAAC,EAAA,CAAIwI,IAAK5C,EACR/F,SAACE,EAAAA,IAAAsI,GAAA,CACC9B,OACA+B,SAAUlC,EACVmC,aAAW,KAJoBhC,EAAKnC,IAUxCrE,MAACsI,IAEC9B,OACA+B,SAAUlC,EACVmC,aAAW,GAHNhC,EAAKnC,KAUjB9B,GACEvC,EAAAA,IAAAC,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQgB,eAAgB,SAAUC,GAAI,GACxD7I,SAAAE,EAAAA,IAAC4I,EAAiB,CAAAC,KAAM,QAK1BpG,GAAWsG,EAAUhC,OAAS,GAC9B/G,MAACC,GAAIC,GAAI,CAAEmH,UAAW,SAAUC,GAAI,EAAGN,GAAI,GACzClH,eAACoI,EAAW,CAAAC,QAAQ,QAAQH,MAAM,iBAAgBlI,6CA5CtDE,EAAAA,IAACC,GAAIC,GAAI,CAAEmH,UAAW,SAAUC,GAAI,EAAGE,QAAS,mBAAoBC,aAAc,EAAGT,GAAI,GACvFlH,eAACoI,EAAW,CAAAC,QAAQ,KAAKH,MAAM,iBAAgBlI,0FC1KvD,IAAImB,EAAyBC,IAC7BC,OAAOC,eAAegI,GAAS,aAAc,CAC3C9H,OAAO,IAES8H,GAAA7H,aAAA,EAClB,IAAIC,EAAiBP,OACjBQ,EAAcC,WACH0H,GAAmB7H,SAAA,EAAGC,EAAeD,UAAwB,EAAGE,EAAYzB,KAAK,OAAQ,CACtG2B,EAAG,wUACD,oCCQS0H,GAAYtF,MAAOuF,IAC9B,GAAKA,EACL,OAAOpF,EAAMsC,KAAK,gBAAgB8C,WAIvBC,GAAcxF,MAAOuF,IAChC,GAAKA,EACL,OAAOpF,EAAMsF,OAAO,gBAAgBF,MAIzBG,GAAmB1F,MAAOuF,EAASI,KAC1C,GAACJ,GAAYI,EACjB,OAAOxF,EAAMsC,KAAK,gBAAgB8C,aAAoB,CAAEI,WCrB1D,MAAMC,GAAkB,CAAC,KAAM,KAAM,KAAM,KAAM,MAE3CC,GAAeC,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CAC/C3J,SAAU,WACV4J,KAAM,MACNC,OAAQ,MACRC,UAAW,mBACXvC,QAAS,OACTG,IAAK,GACLqC,OAAQ,GACRC,WAAY,sBACZ1C,aAAc,GACd2C,QAAS,WACTC,UAAW,8BACXzC,WAAY,SACZS,SAAU,MACViC,eAAgB,YAChBC,OAAQ,qCAGJC,GAAiBX,EAAOY,EAAPZ,CAAmB,EAAGC,QAAOY,eAAgB,CAClE3C,SAAU,GACVlH,WAAY,0CACZoJ,UAAWS,EAAW,gCAAkC,OACxDhE,OAAQgE,EAAW,2CAA6C,OAChEP,WAAYO,EAAW,yBAA2B,OAClDH,OAAQG,EAAW,aAAaZ,EAAMa,QAAQC,QAAQC,OAAS,OAC/DX,OAAQQ,EAAW,EAAI,EACvB1C,MAAO0C,EAAWZ,EAAMa,QAAQC,QAAQC,KAAO,UAC/C,UAAW,CACTV,WAAY,yBACZF,UAAW,kCAITa,GAAkBjB,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CAClD3J,SAAU,QACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPhB,OAAQ,EACRiB,gBAAiB,qBACjBf,OAAQ,KACRxC,QAAS,OACTE,WAAY,SACZc,eAAgB,SAChB,CAACoB,EAAMoB,YAAYC,GAAG,OAAQ,CAC5BF,gBAAiB,0BAIfG,GAAwBvB,EAAO5J,EAAP4J,CAAY,EAAGC,QAAOuB,gBAAiB,CACnEC,MAAOD,EAAY,QAAU,OAC7BE,OAAQF,EAAY,QAAU,OAC9B3D,QAAS,OACTC,cAAe,SACfxH,SAAU,WACVsH,aAAc,GACdrH,SAAU,SACV+J,WAAY,mBACZqB,SAAUH,EAAY,QAAU,IAChCI,UAAWJ,EAAY,QAAU,EACjChD,SAAUgD,EAAY,QAAU,IAChCK,UAAWL,EAAY,QAAU,OACjCM,YAAaN,OAAYO,EAAY,UAGjCC,GAAyBhC,EAAO5J,EAAP4J,CAAY,EAAGC,QAAOgC,eAAgB,CACnE3L,SAAU,WACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPhB,OAAQ,EACR+B,gBAAiB,OAAOD,KACxBE,eAAgB,QAChBC,mBAAoB,SACpBvF,OAAQ,aACRuD,UAAW,cACXC,QAAQ,EACRxJ,QAAS,KAGLwL,GAAoBrC,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CACpDpC,QAAS,OACTG,IAAK,EACLuC,QAAS,GACTjK,SAAU,WACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPd,OAAQ,MAGJiC,GAActC,EAAO5J,EAAP4J,CAAY,EAAGC,QAAOsC,eAAgB,CACxDC,KAAM,EACNd,OAAQ,EACRN,gBAAiB,2BACjBxD,aAAc,EACdrH,SAAU,SACV,WAAY,CACVkM,QAAS,KACT5E,QAAS,QACT6D,OAAQ,OACRD,MAAO,GAAGc,KACVnB,gBAAiBnB,EAAMa,QAAQC,QAAQC,KACvChK,WAAY,wBAIV0L,GAAiB1C,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CACjDuC,KAAM,EACN3E,QAAS,OACTE,WAAY,SACZc,eAAgB,SAChBvI,SAAU,WACV+J,OAAQ,EACRqB,OAAQ,OACRG,UAAW,OACXtL,SAAU,YAGNoM,GAAQ3C,EAAO,MAAPA,CAAc,EAAGC,YAAa,CAC1CwB,MAAO,OACPC,OAAQ,OACRkB,UAAW,UACXtM,SAAU,WACV+J,OAAQ,EACR7B,SAAU,OACVqD,UAAW,UAGPgB,GAAQ7C,EAAO,QAAPA,CAAgB,EAAGC,YAAa,CAC5CwB,MAAO,OACPC,OAAQ,OACRkB,UAAW,UACXtM,SAAU,WACV+J,OAAQ,EACR7B,SAAU,OACVqD,UAAW,UAGPiB,GAAoB9C,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CACpD3J,SAAU,WACV6J,OAAQ,GACRgB,MAAO,GACPtD,QAAS,OACTE,WAAY,SACZC,IAAK,EACLqC,OAAQ,EACRe,gBAAiB,qBACjBb,QAAS,UACT3C,aAAc,OACd6C,eAAgB,YAChBoB,UAAW,uBAGY7B,EAAOY,EAAPZ,CAAmB,EAAGC,YAAa,CAC1D3J,SAAU,WACV4K,IAAK,MACLd,UAAW,mBACXjC,MAAO,QACPiD,gBAAiB,qBACjBf,OAAQ,EACR,UAAW,CACTe,gBAAiB,yBAIrB,MAAM2B,GAAS/C,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CACzC3J,SAAU,WACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPZ,QAAS,GACT1C,QAAS,OACTE,WAAY,SACZc,eAAgB,gBAChBwB,OAAQ,MAGJ2C,GAAWhD,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CAC3CpC,QAAS,OACTE,WAAY,SACZC,IAAK,EACLqC,OAAQ,EACR7B,SAAU,uBAGNyE,GAAajD,EAAOkD,EAAPlD,CAAe,EAAGC,YAAa,CAChDwB,MAAO,GACPC,OAAQ,GACRhB,OAAQ,aAAaT,EAAMa,QAAQC,QAAQC,OAC3CmC,WAAY,KAGRC,GAAmBpD,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CACnD3J,SAAU,WACV4K,IAAK,EACLf,OAAQ,EACRsB,MAAO,MACPpB,OAAQ,EACRgD,OAAQ,UACR3B,OAAQ,UAIJ4B,GAAaA,CAACC,EAAiBC,KAC/BC,IAAAA,EACJ,GAAID,EAGKC,EAAA,IAAIC,KAAKF,YACPD,EAIF,MAAA,GAFAE,EAAA,IAAIC,KAAuB,IAAlBH,EAET,CAIT,GAAII,MAAMF,EAAKG,WAEJ,MAAA,GAGLC,MACAC,OADUJ,MACGE,UAAYH,EAAKG,UAI9BG,EAAO,KAGTD,OAAAA,EAAS,EAAU,YACnBA,EALW,IAKa,aACxBA,EAASC,EAAa,GAAGC,KAAKC,MAAMH,EANzB,QAOXA,EALQ,MAKa,GAAGE,KAAKC,MAAMH,EAASC,MAIzCN,EAAKS,oBAAenC,EAAW,CACpCoC,IAAK,UAAWC,MAAO,UAAWC,KAAM,UAAWN,KAAM,UAAWO,OAAQ,aAI1EC,GAAsBA,EAAGC,OAAMC,UAAShF,cAC5C,MAAOjH,EAASC,GAAcJ,EAAAA,UAAS,IAChCqM,EAAWC,GAAgBtM,EAAAA,SAAS,IAazC,OAXFyB,EAAAA,UAAU,KACH0K,IACL/L,GAAW,GDlO2ByB,OAAOuF,IAC3C,IAACA,EAAS,MAAO,GACrB,MAAMrF,QAAiBC,EAAMC,IAAI,gBAAgBmF,eAC1CrF,OAAAA,EAASG,MAAQH,EAASG,KAAKmK,UAAYtK,EAASG,KAAKmK,UAAY,ICgO/CjF,CAAAA,GACxBmF,KAAerK,IACdoK,EAAapK,KAEdsK,QAAQ,IAAMpM,GAAW,MAC3B,CAAC+L,EAAM/E,IAGRlC,EAAAA,KAACuH,GAAON,OAAYC,UAAkBjG,SAAS,KAAKuG,WAAS,EAC3DC,WAAY,CACV3O,GAAI,CACFiK,WAAY,yBACZG,eAAgB,YAChBD,UAAW,gCAIfvK,SAAA,CAAAsH,OAAC0H,GAAY5O,GAAI,CAAEwH,QAAS,OAAQE,WAAY,SAAUC,IAAK,GAC7D/H,SAAA,CAAAE,EAAAA,IAAC,QAAKF,SAAkB,uBACxBE,MAACC,GAAIC,GAAI,CAAEmM,KAAM,WAChB5B,EAAW,CAAAsE,QAAST,EAASxO,SAAAE,EAAAA,IAACgP,YAEjChP,MAACC,GAAIC,GAAI,CAAEqH,GAAI,EAAG0H,GAAI,GACnB5M,SAAAA,EACErC,EAAAA,IAAAC,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQgB,eAAgB,SAAUpB,GAAI,GAAKxH,SAAAE,EAAAA,IAAC4I,EAAmB,CAAA,KAC5D,IAArB2F,EAAUxH,OACZ/G,EAAAA,IAACkI,EAAW,CAAAF,MAAM,iBAAiBkH,MAAM,SAAShP,GAAI,CAAEoH,GAAI,GAAKxH,SAAW,gBAE3EE,EAAAA,IAAAC,EAAA,CACEsO,WAAUhI,IAAK4I,GACb/H,EAAAA,KAAAnH,EAAA,CAAoCC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,SAAUC,IAAK,EAAGP,GAAI,GAC5FxH,SAAA,CAACE,EAAAA,IAAA+M,EAAA,CAAOqC,IAAKD,EAAKE,MAAQ,0BAA0BF,EAAKtI,WAAWsI,EAAKE,aAAUzD,WAClF3L,EACC,CAAAH,SAAA,CAAAE,MAACkI,GAAWhI,GAAI,CAAEoP,WAAY,KAAQH,SAAAA,EAAKI,MAAQJ,EAAKnL,WACvDoD,EAAAA,KAAAc,EAAA,CAAWC,QAAQ,UAAUH,MAAM,iBAAiBlI,SAAA,CAAA,IAAEqP,EAAKnL,eAE9DhE,MAACC,GAAIC,GAAI,CAAEsP,GAAI,OAAQzH,SAAU,IAAOoH,WAAKzF,UANrCyF,EAAKtI,QAAUsI,EAAKzF,YAYtC1J,MAACC,GAAIC,GAAI,CAAEqL,OAAQ,SAKnBkE,GAAcA,EAClBC,cACAC,mBACAC,sBACAtB,UACAuB,gBACAC,iBACAC,UACAC,gBACAC,WACAC,gBACAC,iBAEA,MAAOC,EAASC,GAAcnO,EAAAA,SAAS,KAChCoO,EAAcC,GAAmBrO,EAAAA,SAAS,IAC1CkK,EAAUoE,GAAetO,EAAAA,SAAS,IAClCuO,EAAkBC,GAAuBxO,EAAAA,UAAS,GACnDyO,EAAmB3N,SAAO,MAC1B4N,EAAW5N,SAAO,MAElB8G,EAAQ+G,IACQ7N,EAAAA,OAAW8N,IAAAA,KAC3B,MAAE3B,KAAM4B,GAAgBC,IACxBC,EAAiBC,EAAcpH,EAAMoB,YAAYiG,KAAK,OACtDC,EAAuBpO,EAAAA,OAAW8N,IAAAA,MACjCO,EAAcC,GAAmBpP,EAAAA,SAAS,OAC1CqP,EAAUC,GAAetP,EAAAA,UAAS,IAClCuP,EAAkBC,GAAuBxP,EAAAA,UAAS,IAClDyP,EAAYC,GAAiB1P,EAAAA,SAAS,OACtC2P,EAAgBC,GAAqB5P,EAAAA,SAAS,OAC9C6P,EAAiBC,GAAsB9P,EAAAA,UAAS,IAChD+P,EAAqBC,GAA0BhQ,EAAAA,UAAS,GAGzDiQ,EAAanP,EAAAA,SACboP,GAAoBpP,EAAAA,SAE1BW,EAAAA,UAAU,KAEF0O,MAAAA,EAAY3C,GAAaP,MAAM9K,GAC/BiO,EAAmB5C,GAAaU,SAASrJ,OAC3CoL,EAAWvO,UAAYyO,GAAaD,GAAkBxO,UAAY0O,GACzD5C,EAAAA,EAAYU,SAAW,IAClCG,EAAgB,GAChBC,EAAY,GACZ2B,EAAWvO,QAAUyO,EACrBD,GAAkBxO,QAAU0O,GACnB5C,GAAeA,EAAYU,SACpCC,EAAWX,EAAYU,UAExB,CAACV,IASJ/L,EAAAA,UAAU,KAPe2F,IAAYA,EAYnC,OAJI8G,EAAQrJ,OAAS,GAAKuJ,EAAeF,EAAQrJ,UARduC,EASjB8G,EAAQE,GAAcjM,MAPpC+M,EAAqBxN,QAAQ2O,IAAIjJ,KAChB1F,EAAAA,QAAQ4O,IAAIlJ,GACjC4G,IAAgB5G,KAMAmJ,MAET,KACD9B,EAAiB/M,SACnB8O,cAAc/B,EAAiB/M,WAGlC,CAAC0M,EAAcF,IAElB,MAAMqC,GAAgBA,KAChB9B,EAAiB/M,SACnB8O,cAAc/B,EAAiB/M,SAEjC4M,EAAY,GACZ,MAAMmC,EAAUvC,EAAQE,IAAesC,WAAWC,MAAM,sBAClD9R,EAAW4R,EAA8C,KAAnC/B,EAAShN,SAAS7C,UAAY,GA1DtC,IA4DH6C,EAAAA,QAAUkP,YAAY,KACrCtC,EAAoBtH,GACdA,GAAQ,KACVwJ,cAAc/B,EAAiB/M,SACpBmP,KACJ,GAEF7J,EAAQ,KAAOnI,EAAW,OAElC,MAGCgS,GAAaA,KACbzC,EAAeF,EAAQrJ,OAAS,EAClBmC,EAAAA,GAAQA,EAAO,GAE3BiH,EACSA,IAEH7B,KAWR0E,GAA4BC,IAC1B,MAAAC,QAAEA,GAAYD,GACdlJ,KAAEA,EAAAA,MAAMuB,GAAU2H,EAAEE,cAAcC,wBAClBF,EAAUnJ,EAEZuB,EAAQ,EAVxBgF,EAAe,GACDpH,EAAAA,GAAQA,EAAO,GAYpB6J,MAITM,GAAcA,KACd1C,EAAiB/M,SACnB8O,cAAc/B,EAAiB/M,SAEzB0K,KAmEN,GAxBJ3K,EAAAA,UAAU,KACR6N,GAAY,IACX,CAAClB,EAAcF,IAElBzM,EAAAA,UAAU,KACJyM,EAAQrJ,OAAS,GAAKuJ,EAAeF,EAAQrJ,QAC3CqJ,EAAQE,IAAesC,WACrBrB,GAAUD,EAAgBlB,EAAQE,GAAcsC,YAGvD,CAACrB,EAAUjB,EAAcF,IAE5BzM,EAAAA,UAAU,KACR+N,GAAoB,GACpBI,EAAkB,MAClBE,GAAmB,GAEf5B,EAAQE,IAAiBF,EAAQE,GAAcgD,cACnClD,EAAAA,EAAQE,GAAcgD,eAEpC1B,EAAc,OAEf,CAACtB,EAAcF,KAEbA,EAAQrJ,OAAe,OAAA,KACtBwM,MAAAA,GAAenD,EAAQE,GACvBkD,GAAc9D,GAAaP,MAAQ,CAAC,EAGpCsE,GAAmBF,IAAcX,WAAWC,MAAM,+BAAiC,QAChEU,IAAcX,WAAWC,MAAM,sBAAwB,QACvD,KA0BnBa,GAAY3C,GAAa1M,KAAOmP,GAAYnP,GAGhD,OAAA+C,EAAAA,KAAC0D,GAAgB,CAAAiE,QAASsE,GACxBvT,SAAA,CAACsH,EAAAA,KAAAgE,GAAA,CAAsBC,UAAW4F,GAAkBhB,EAAUlB,QAAgBkE,GAAAA,EAAEU,kBAC9E7T,SAAA,CAAAE,MAACkM,IACEkE,SAAQ7J,EAAAA,IAAI,CAACU,EAAGC,UACdiF,GAEC,CAAAC,SAAUlF,IAAUoJ,EAAelE,EAAWlF,EAAQoJ,EAAe,IAAM,GADtEpJ,aAMV0F,GACC,CAAA9M,SAAA,CAAAsH,OAACyF,GACC,CAAA/M,SAAA,CAAAE,MAAC8M,GACC,CAAAsC,IAAKoE,GAAYnE,MAAQ,0BAA0BmE,GAAYnP,MAAMmP,GAAYnE,aAAUzD,EAC3FgI,IAAKJ,GAAYjE,MAAQ,SAE3BnI,OAACnH,GAAIC,GAAI,CAAEE,SAAU,UACnBN,SAAA,CAAAE,EAAAA,IAACkI,EAAW,CAAAC,QAAQ,YAAYH,MAAM,QAAQ9H,GAAI,CAAEoP,WAAY,IAAKuE,WAAY,IAAKC,WAAY,SAAUC,aAAc,WAAY3T,SAAU,UAC7IoT,SAAAA,GAAYjE,MAAQiE,GAAYxP,UAAY,uBAE9CkE,EAAW,CAAAC,QAAQ,UAAUH,MAAM,2BAA2B9H,GAAI,CAAE2T,WAAY,IAAKC,WAAY,SAAUC,aAAc,WAAY3T,SAAU,UAC7I+M,SAAWoG,GAAAA,IAAcnG,gBAAiBmG,IAAclG,+BAI9DpN,EACE8Q,CAAAA,SAAAA,CAAAA,GAAa1M,KAAOmP,GAAYnP,IAC9BrE,EAAAA,IAAAyK,EAAA,CAAWsE,QAAgBkE,IAAEA,EAAEU,kBAAmBjD,GAAoB,IAAUxQ,GAAI,CAAE8H,MAAO,QAASgM,GAAI,GACzGlU,SAACE,EAAAA,IAAAiU,GAAA,CAAA,KAGLjU,EAAAA,IAACyK,EAAW,CAAAsE,QAAgBkE,IAAEA,EAAEU,kBAA+BN,MAAMnT,GAAI,CAAE8H,MAAO,SAChFlI,SAACE,EAAAA,IAAAgP,GAAA,CAAS,WAKhB5H,OAACmF,IAAerM,GAAI,CAAEC,SAAU,YAC7BkR,SAAAA,CACCA,GAAArR,EAAAA,IAAC6L,IACCqI,MAAO,CACLnI,gBAAiB,OAAOsF,KACxB3Q,QAAS6Q,EAAW,EAAI,EACxBrH,OAAQ,EACRrJ,WAAY,kBAIjB0S,IAAcX,WACZ5S,EAAAA,IAAA6L,GAAA,CACCqI,MAAO,CACLnI,gBAAiB,OAAOwH,GAAaX,aACrClS,QAAS6Q,EAAW,EAAI,EACxBrH,OAAQ,EACRrJ,WAAY,gBAGdf,SAACE,EAAAA,IAAA,MAAA,CACCoP,IAAKmE,GAAaX,UAClBsB,MAAO,CAAExM,QAAS,QAClByM,OAAQ,IAAM3C,GAAY,GAC1BoC,IAAI,cAIV5T,MAACiN,IAAiBiH,MAAO,CAAEnK,KAAM,GAAKgF,QAASiE,KAC/ChT,MAACiN,IAAiBiH,MAAO,CAAElJ,MAAO,EAAGjB,KAAM,QAAUgF,QAASiE,KACxC,UAArBS,GAEGrM,EAAAA,KAAAgN,EAAAA,SAAA,CAAAtU,SAAA,CAAAE,MAACwM,IACC4C,IAAKmE,IAAcX,UACnBgB,IAAI,QACJO,OAAQ1B,YAET9F,GACC,CAAA7M,SAAA,CAAAE,MAACqU,IAAenU,GAAI,CAAE8H,MAAO,QAASD,SAAU,UAC/C/H,EAAAA,IAAAkI,EAAA,CACCC,QAAQ,UACRjI,GAAI,CACF8H,MAAO,QACPD,SAAU,UACVyH,GAAI,IAGL+D,SAAce,IAAAA,YAAc,UAIZ,UAArBb,GAEArM,EAAAA,KAAAgN,EAAAA,SAAA,CAAAtU,SAAA,CAAAE,EAAAA,IAAC0M,GACC,CAAAjE,IAAKmI,EACLxB,IAAKmE,IAAcX,UACnB2B,MAAI,EACJC,UAAQ,EACRC,aAAW,EACXC,MAAO3E,EACP4E,aAAclC,YAEf9F,GACC,CAAA7M,SAAA,CAAAE,MAACqU,IAAenU,GAAI,CAAE8H,MAAO,QAASD,SAAU,UAC/C/H,EAAAA,IAAAkI,EAAA,CACCC,QAAQ,UACRjI,GAAI,CACF8H,MAAO,QACPD,SAAU,UACVyH,GAAI,IAGL+D,SAAce,IAAAA,YAAc,IAE9BtU,EAAAA,IAAAyK,EAAA,CACCsE,QAASiB,EACT9P,GAAI,CACF8H,MAAO,QACP,UAAW,CACTiD,gBAAiB,sBAEnBK,MAAO,GACPC,OAAQ,GACRnB,QAAS,GAGV2F,SAAUA,EAAA/P,EAAAA,IAAC4U,GAAc,CAAA7M,SAAS,UAAc/H,EAAAA,IAAA6U,GAAA,CAAa9M,SAAS,kBAI3E,KAEJX,OAACnH,GAAIC,GAAI,CAAEC,SAAU,WAAY4J,KAAM,MAAOC,OAAQ,GAAIC,UAAW,mBAAoBC,OAAQ,IAC/FpK,SAAA,CAACE,MAAAyK,EAAA,CACCsE,QAAS2E,GAAY,IAAMxB,GAAuB,GA/J3Be,IACjCA,EAAEU,kBACmBtF,EAAAA,IAAUA,GAC/ByD,EAAkBmB,EAAEE,gBA6JVjT,GAAI,CACF6H,SAAU,GACVoC,WAAYwH,EAAa,yBAA2B,qBACpDpH,OAAQoH,EAAa,aAAa7H,EAAMa,QAAQC,QAAQC,OAAS,OACjE7C,MAAO2J,EAAa7H,EAAMa,QAAQC,QAAQC,KAAO,UACjDhK,WAAY,WACZwJ,UAAWsH,EAAa,8BAAgC,QAGzDA,YAAc,QAEf+B,IACC1T,EAAAA,IAAA8U,EAAA,CAAOzG,KAAMoD,EAAkBsD,SAAUlD,EAAgBmD,UAAU,MAAMnU,YAAU,EAACoU,eAAa,EAC/FnV,SAAC,EAAEoV,qBACFlV,EAAAA,IAACmV,EAASD,IAAAA,EAAiBE,QAAS,IAClCtV,SAAAE,EAAAA,IAAC4J,GACED,CAAAA,SAAAA,GAAgBpD,IAAKmD,GACnB1J,MAAAwK,GAAA,CAECE,SAAUiH,IAAejI,EACzBqF,QAAS,IA9KJhL,OAAO2F,IAClC,IAAIqI,EAAJ,CACAC,GAAmB,GACf,IACEL,IAAejI,SAEXD,GAAiB8J,GAAalP,GAAIqF,GACxCkI,EAAc,cAERnI,GAAiB8J,GAAalP,GAAIqF,GACxCkI,EAAclI,IAEhBgI,GAAoB,EAAK,CACjB,QACRM,GAAmB,EAAK,CAbL,GA6KgBqD,CAAqB3L,GACpC4L,SAAUvD,EAETrI,SALIA,GAAAA,mBAiBzBtC,OAACuH,GAAON,KAAMoC,EAAkBnC,QAAS,IAAMoC,GAAoB,GACjE5Q,SAAA,CAAAE,EAAAA,IAAC8O,GAAYhP,SAAgB,4BAC5ByV,EACC,CAAAzV,SAAA,CAACE,EAAAA,IAAAwV,EAAA,CAAOzG,QAAS,IAAM2B,GAAoB,GAAQ1I,MAAM,UAASlI,SAElE,WACAE,EAAAA,IAACwV,GAAOzG,QAlRUhL,UACpB,IACI0R,MAAAA,EAAYrF,EAAQE,GAAcjM,SAClCqR,GAAeD,GACrB/E,GAAoB,GAEpB,MAAMiF,EAAiBvF,EAAQ1J,OAAO,CAACO,EAAG2O,IAAQA,IAAQtF,GAC5B,IAA1BqF,EAAe5O,QAEb+I,KAA+B2F,GAC3BnH,MAER+B,EAAWsF,GACPrF,GAAgBqF,EAAe5O,QACjB4O,EAAAA,EAAe5O,OAAS,GAEtC+I,KAA+B2F,IAG9BI,OAAAA,cAAc,IAAIC,YAAY,aAAc,CACjDzQ,OAAQ,CACN0Q,QAAS,kBACTC,aAAc,UACdC,iBAAkB,UAClBC,cAAe,iBAGZrT,GAEAgT,OAAAA,cAAc,IAAIC,YAAY,aAAc,CACjDzQ,OAAQ,CACN0Q,QAAS,8BACTC,aAAc,SACdC,iBAAkB,QAClBC,cAAe,UAEjB,GA8OsClO,MAAM,QAAQG,QAAQ,YAAWrI,SAErE,kBAGJE,EAAAA,IAACoO,GAAoB,CAAAC,KAAM4D,EAAqB3D,QAAS,IAAM4D,GAAuB,GAAQ5I,QAASiK,IAAclP,SCtrBrH8R,GAActM,EAAOuM,EAAPvM,CAAa,EAAGC,YAAa,CAC/CrC,aAAc,OACdrH,SAAU,SACViK,UAAW,+BACXF,WAAY,4BACZG,eAAgB,aAChB+L,qBAAsB,aACvB9L,OAA+B,SAAvBT,EAAMa,QAAQrK,KACjB,qCACA,+BACJgW,aAAc,KAGVC,GAAmB1M,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CACnDpC,QAAS,OACTG,IAAK,EACL2O,UAAW,OACXpM,QAAS,OACT,uBAAwB,CACtBmB,OAAQ,MACR7D,QAAS,QAEX,6BAA8B,CAC5BuD,gBAAiB,eAEnB,6BAA8B,CAC5BA,gBAAiB,eAEnBwL,gBAAiB,OACjBC,eAAgB,UAGZC,GAAY9M,EAAO5J,EAAP4J,CAAY,EAAGC,QAAO8M,eAAgB,CACtDlP,QAAS,OACTC,cAAe,SACfC,WAAY,SACZsF,OAAQ,UACR/M,SAAU,WACV,UAAW,CACT8J,UAAW,cACXpJ,WAAY,0BAIVgW,GAAehN,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CAC/CwB,MAAO,GACPC,OAAQ,GACR9D,aAAc,MACdrH,SAAU,SACVmK,OAAQ,aAAaT,EAAMa,QAAQC,QAAQC,OAE3CV,WAAYL,EAAMa,QAAQR,WAAW2M,MACvC,YAAa,CACTxK,QAAS,KACTnM,SAAU,WACV4K,KAAK,EACLhB,MAAM,EACNiB,OAAO,EACPhB,QAAQ,EACRvC,aAAc,MACdyC,QAAQ,MAIN6M,GAAiBlN,EAAOY,EAAPZ,CAAmB,EAAGC,YAAa,CACxDwB,MAAO,GACPC,OAAQ,GACRhB,OAAQ,aAAaT,EAAMa,QAAQC,QAAQC,OAC3CI,gBAAiBnB,EAAMa,QAAQR,WAAW2M,MAC1C,UAAW,CACT7L,gBAAiB,+BAIIpB,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CACnD3J,SAAU,WACV6J,OAAQ,GACRD,KAAM,EACNiB,MAAO,EACPtD,QAAS,OACTgB,eAAgB,SAChBb,IAAK,GACLqC,OAAQ,OAGV,MAAM8M,GAAUA,EAAGC,iBAAiB,SAC5B,MAAA7G,QAAEA,EAAAA,QAAS/N,EAAAA,YAAS6U,EAAAA,WAAa7G,GF5DzB8G,SAAeF,EAAiB,MAC9C,MAAO7G,EAASC,GAAcnO,EAAAA,SAAS,KAChCG,EAASC,GAAcJ,EAAAA,UAAS,IAChCW,EAAOC,GAAYZ,EAAAA,SAAS,MAiB5B,MAAA,CAAEkO,UAAS/N,UAASQ,QAAOqU,YAfdpT,EAAAA,YAAYC,UAC9BzB,GAAW,GACXQ,EAAS,MACL,IACF,MAAMsB,EAAO6S,OAfalT,OAAOkT,IACrC,MAAMhT,QAAiBC,EAAMC,IAAI,qBAAqB8S,KAC/ChT,OAAAA,EAASG,MAAQH,EAASG,KAAKgM,QAAU,CAACnM,EAASG,MAAQ,IAcpDgT,CAAiBH,QAzDLlT,WAC1B,MAAME,QAAiBC,EAAMC,IAAI,qBAC1BF,OAAAA,EAASG,MAAQH,EAASG,KAAKgM,QAAUnM,EAASG,KAAKgM,QAAU,IAwD1DiH,GACVhH,EAAWjM,SACJ6O,GACPnQ,EAASmQ,EAAC,CACF,QACR3Q,GAAW,EAAK,GAEjB,CAAC2U,IAE2C5G,aACjD,CEuCwD8G,CAAeF,IAC7DK,QAASC,GFrCZ,WACL,MAAOC,EAAeC,GAAoBvV,EAAAA,UAAS,IAC5CwV,EAAaC,GAAkBzV,EAAAA,SAAS,MAsCxC,MAAA,CAAEoV,QApCOxT,cAAYC,MAAO6T,IACjCH,GAAiB,GACjBE,EAAe,MACX,IACIvT,MAAAA,OAzEgBL,OAAO6T,IAC3BC,MAAAA,EAAW,IAAIC,SAKrB,OAJSC,EAAAA,OAAO,QAASH,UACF1T,EAAMsC,KAAK,eAAgBqR,EAAU,CAC1DG,QAAS,CAAE,eAAgB,0BAEb5T,MAmEOmT,CAAaK,GACzBxT,OAAAA,QACA6O,GAEDA,MADN0E,EAAe1E,GACTA,CAAAA,CACE,QACRwE,GAAiB,EAAK,GAEvB,IAwBeQ,KAtBLnU,cAAYC,MAAOuF,IAC1B,UACID,GAAUC,SACT2J,GAAG,GAIX,IAeqBiF,OAbTpU,cAAYC,MAAOuF,IAChCmO,GAAiB,GACjBE,EAAe,MACX,UACIpO,GAAYD,SACX2J,GAEDA,MADN0E,EAAe1E,GACTA,CAAAA,CACE,QACRwE,GAAiB,EAAK,GAEvB,IAE6BD,gBAAeE,cACjD,CEJoCS,IAC3BxI,EAAkBC,GAAuB1N,EAAAA,SAAS,OAClDkW,EAAaC,GAAkBnW,EAAAA,SAAS,OACxCoW,EAAYC,GAAiBrW,EAAAA,SAAS,OACtC6N,EAASyI,GAActW,EAAAA,UAAS,IAChC+N,EAAUwI,GAAevW,EAAAA,UAAS,IAClCwW,EAAeC,GAAoBzW,EAAAA,SAAS,IAAI4O,KACjD8H,EAAe5V,SAAO,MACtB4N,EAAW5N,SAAO,OAClBmM,KAAEA,GAAS/L,EAAAA,WAAWC,GAI5B,KAAK4T,GAAoB9H,GAA8B,SAAtBA,EAAK0J,cAC7B,OAAA,KAIHC,MAAAA,EAAe7B,IAAmB9H,GAAM9K,GAG9CV,EAAAA,UAAU,KACR,MAAMoV,EAAcA,KAClBN,EAAYlV,OAAOyV,WAAW,sBAAsBC,UAItD,OAFYF,IACLtT,OAAAA,iBAAiB,SAAUsT,GAC3B,IAAMxV,OAAOmC,oBAAoB,SAAUqT,IACjD,IAGHpV,EAAAA,UAAU,KACR,IAAKsM,IAAaW,EAAShN,QAAS,OAEpC,MAAMsV,EAA4BjG,IAC5BA,EAAEkG,OAAOC,OAAS,GACpBZ,GAAW,IAITa,EAAQzI,EAAShN,QAGvB,OAFM6B,EAAAA,iBAAiB,eAAgByT,GAEhC,KACCxT,EAAAA,oBAAoB,eAAgBwT,KAE3C,CAACjJ,IAEJtM,EAAAA,UAAU,KACIuT,KACX,CAACA,IAEJvT,EAAAA,UAAU,KACHyM,GAA8B,IAAnBA,EAAQrJ,QACxB4R,EAAiB,KACTW,MAAAA,MAAaxI,IAQZwI,OAPPlJ,EAAQmJ,QAAsBC,IACjBpJ,EAAAA,QAAQmJ,QAAiBE,IAC9BA,EAAMnF,WAAa,GACd9B,EAAAA,IAAIiH,EAAMpV,QAIhBiV,KAGR,CAAClJ,GAAWA,EAAQrJ,OAAS,IAG1B2S,MAAAA,EAAmBC,EAAAA,QAAQ,IAC1BvJ,GAA8B,IAAnBA,EAAQrJ,OACjBqJ,EAAQwJ,QAAQJ,GACrBA,EAAWpJ,QAAQ7J,IAAckT,IAAA,IAC5BA,EACHtK,KAAMqK,EAAWrK,SAEnB0K,KAAK,CAACC,EAAGC,KACHC,MAAAA,EAAUF,EAAExF,WAAa,EAE/B,GAAI0F,IADYD,EAAEzF,WAAa,EAE7B,OAAO0F,EAAU,GAAI,EAEvB,MAAMC,EAAQ,IAAI1M,KAAKuM,EAAEzM,gBAAkByM,EAAEI,YAE7C,OADc,IAAI3M,KAAKwM,EAAE1M,gBAAkB0M,EAAEG,YAC9BD,IAd4B,GAgB5C,CAAC7J,IAsBE+J,EAAsBA,KAC1B9B,EAAe,MACfE,EAAc,MACVK,EAAahV,UACfgV,EAAahV,QAAQtC,MAAQ,KAgB3B8Y,EAA2BnH,IAC/BA,EAAEU,kBACF6E,GAAYzI,IAGRsK,EAAmBjC,GAAatX,KAAKwZ,WAAW,SAAW,QAAU,QAwD3E,OAAIjY,EAECrC,EAAAA,IAAAmW,GAAA,CACCrW,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEsF,EAAG,EAAGkC,QAAS,OAAQE,WAAY,UAC5C9H,SAAA,CAACE,EAAAA,IAAA4I,EAAA,CAAiBC,KAAM,GAAI3I,GAAI,CAAE8T,GAAI,KACrChU,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,KAAKjI,GAAI,CAAE6H,SAAU,UAAWjI,SAEpD,qBAOHuC,GAAYyW,GAAkB1I,GAA8B,IAAnBA,EAAQrJ,OAMlDK,EAAAA,KAAAgN,WAAA,CAAAtU,SAAA,CAAAsH,OAAC+O,GACC,CAAArW,SAAA,CAAAsH,OAACmP,GACC,CAAAzW,SAAA,CAACE,EAAAA,IAAA,QAAA,CACCc,KAAK,OACL2H,IAAKmQ,EACL2B,SAjH0BrV,IAClC,MAAM0S,EAAO1S,EAAMiU,OAAOqB,MAAM,GAC3B5C,IACLS,EAAeT,GACD6C,EAAAA,IAAIC,gBAAgB9C,MA8G1B+C,OAAO,kBACPzG,MAAO,CAAExM,QAAS,UAGnBoR,GACC9Y,EAAAA,IAAC2W,GACC,CAAA7W,SAAAE,EAAAA,IAAC+W,GAAe,CAAAhI,QA5HL6L,KACrBhC,EAAahV,SAASiX,SA4HV/a,SAAAE,EAAAA,IAAC8a,GAAQ,CAAA9S,MAAM,gBAKpB0R,EAAiBnT,IAAKkT,GACpBzZ,EAAAA,IAAA2W,GAAA,CAEC5H,QAAS,IA9IKzF,CAAYA,IACpC,MAAMsM,EAAM8D,EAAiBqB,UAAeC,GAAAA,EAAE3W,KAAOiF,GACrDsG,EAAoBgG,IA4IKqF,CAAiBxB,EAAMpV,IAEtCvE,SAAAE,EAAAA,IAAC6W,IACE4C,SAAMyB,EAAAA,YACJlb,EAAAA,IAAAC,EAAA,CACCkb,UAAU,MACV/L,IAAKqK,EAAMyB,YACXtH,IAAI,gBACJ1T,GAAI,CACFoL,MAAO,OACPC,OAAQ,OACRkB,UAAW,WAIdzM,EAAAA,IAAAC,EAAA,CACCC,GAAI,CACFoL,MAAO,OACPC,OAAQ,OACR7D,QAAS,OACTE,WAAY,SACZc,eAAgB,SAChByB,WAAY,eAGdrK,SAACE,EAAAA,IAAAob,GAAA,CAAalb,GAAI,CAAE8H,MAAO,eAAgBD,SAAU,WA1BtD0R,EAAMpV,QAmChB+T,GAAeE,GACbtY,EAAAA,IAAAC,EAAA,CACCC,GAAI,CACFC,SAAU,QACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPhB,OAAQ,EACRE,OAAQ,IACRC,WAAY,kBACZzC,QAAS,OACTE,WAAY,SACZc,eAAgB,UAElBqG,QAASoL,EAETra,SAACsH,EAAAA,KAAAnH,EAAA,CACC8O,QAAgBkE,GAAAA,EAAEU,kBAClBzT,GAAI,CACFoL,MAAO,OACPC,OAAQ,OACR7D,QAAS,OACTC,cAAe,SACfxH,SAAU,WACVsH,aAAc,EACdrH,SAAU,SACViI,SAAU,IACVqD,UAAW,KAIb5L,SAAA,CAAAE,MAACC,GACCC,GAAI,CACFC,SAAU,WACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPhB,OAAQ,EACR+B,gBAAiB,OAAOuM,KACxBtM,eAAgB,QAChBC,mBAAoB,SACpBvF,OAAQ,aACRuD,UAAW,cACXC,QAAQ,EACRxJ,QAAS,KAIb0G,OAACnH,GACCC,GAAI,CACFC,SAAU,WACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPZ,QAAS,EACT1C,QAAS,OACTE,WAAY,SACZc,eAAgB,gBAChBwB,OAAQ,IAGVpK,SAAA,CAAAsH,OAACnH,GACCC,GAAI,CACFwH,QAAS,OACTE,WAAY,SACZC,IAAK,EACLqC,OAAQ,EACR7B,SAAU,qBAGZvI,SAAA,CAAAE,MAAC+M,GACCqC,IAAKD,GAAME,MAAQ,0BAA0BF,EAAK9K,MAAM8K,EAAKE,aAAUzD,EACvEgI,IAAKzE,GAAMI,MAAQ,MACnBrP,GAAI,CACFoL,MAAO,GACPC,OAAQ,GACRhB,OAAiBT,GAAA,aAAaA,EAAMa,QAAQC,QAAQC,OACpDmC,WAAY,KAGhBhN,MAACC,GAAIC,GAAI,CAAEE,SAAU,UACnBN,SAACE,EAAAA,IAAAkI,EAAA,CACCC,QAAQ,YACRH,MAAM,QACN9H,GAAI,CACFoP,WAAY,IACZuE,WAAY,IACZC,WAAY,SACZC,aAAc,WACd3T,SAAU,UAGX+O,SAAAA,GAAMI,MAAQ,sBAIrBvP,EAAAA,IAACyK,EACC,CAAAsE,QAAgBkE,IACdA,EAAEU,kBACkBwG,KAEtBja,GAAI,CAAE8H,MAAO,QAASkC,OAAQ,GAE9BpK,SAACE,EAAAA,IAAAgP,GAAA,CAAS,QAIdhP,MAACC,GACCC,GAAI,CACFmM,KAAM,EACN3E,QAAS,OACTE,WAAY,SACZc,eAAgB,SAChBvI,SAAU,YAGXka,SAAqB,UAAAA,EACnBra,EAAAA,IAAAC,EAAA,CACCkb,UAAU,MACV/L,IAAKkJ,EACL1E,IAAI,UACJ1T,GAAI,CACFmI,SAAU,OACVqD,UAAW,OACXe,UAAW,UACXtM,SAAU,WACV+J,OAAQ,KAKV9C,EAAAA,KAAAgN,EAAAA,SAAA,CAAAtU,SAAA,CAAAE,EAAAA,IAACC,EACC,CAAAkb,UAAU,QACV1S,IAAKmI,EACLxB,IAAKkJ,EACL/D,MAAI,EACJC,UAAQ,EACRC,aAAW,EACXC,MAAO3E,EACP7P,GAAI,CACFmI,SAAU,OACVqD,UAAW,OACXe,UAAW,UACXtM,SAAU,WACV+J,OAAQ,KAGZlK,MAACC,GACCC,GAAI,CACFC,SAAU,WACV6J,OAAQ,GACRgB,MAAO,GACPtD,QAAS,OACTE,WAAY,SACZC,IAAK,EACLqC,OAAQ,KAGVpK,SAAAE,EAAAA,IAACyK,EACC,CAAAsE,QAASqL,EACTla,GAAI,CACF8H,MAAO,QACPiD,gBAAiB,qBACjB,UAAW,CACTA,gBAAiB,sBAEnBK,MAAO,GACPC,OAAQ,GACRnB,QAAS,GAGV2F,SAAAA,EAAW/P,EAAAA,IAAA4U,GAAA,CAAc7M,SAAS,UAAa/H,EAAAA,IAAC6U,GAAa,CAAA9M,SAAS,mBAOjFX,OAACnH,GACCC,GAAI,CACFC,SAAU,WACV6J,OAAQ,GACRD,KAAM,EACNiB,MAAO,EACPtD,QAAS,OACTgB,eAAgB,SAChBb,IAAK,EACLqC,OAAQ,KAGVpK,SAAA,CAAAE,MAACwV,GACCrN,QAAQ,YACRH,MAAM,UACN+G,QAAgBkE,IACdA,EAAEU,kBAtVO5P,WACzB,GAAKqU,EACD,UACIb,EAAaa,SACblB,IACciD,UACbtX,GAEPwY,MAAM,8BAA6B,GA+UFC,IACnBxb,SAGJ,uBACC0V,EACC,CAAArN,QAAQ,WACRH,MAAM,YACN+G,QAAgBkE,IACdA,EAAEU,kBACkBwG,KACpBra,SAGJ,sBAQY,OAArB6P,GAA6B+J,EAAiB/J,IAC7C3P,MAACyP,IACCC,YAAa,CACXP,KAAMuK,EAAiB/J,GAAkBR,KACzCiB,QAAS,CAACsJ,EAAiB/J,KAE7BA,iBAAkB,EAClBC,sBACAtB,QA5YiBiN,KACvB3L,EAAoB,OA4YdC,cAAe6J,EAAiB/J,IAAmBR,MAAM9K,GACzDyL,eApUkC2F,IACxCpF,EAA0BmL,IACxB,MAAM7F,EAAiB6F,EAAYjV,IAAI,CAACkV,EAAI7F,IACtCA,IAAQjG,EAAyB8L,EAC9B,IACFA,EACHrL,QAASqL,EAAGrL,QAAQ1J,OAAgB+S,GAAAA,EAAMpV,KAAOoR,KAElD/O,UAAa+U,EAAGrL,QAAQrJ,OAAS,GAU7B4O,OAPLA,EAAe5O,OAAS,KACtB4O,EAAehG,IAAyE,IAApDgG,EAAehG,GAAkBS,QAAQrJ,QAE/E6I,EAA4BgG,GAAAA,EAAMD,EAAe5O,OAAS6O,EAAM,MAC7B,IAA1BD,EAAe5O,QACxB6I,EAAoB,MAEf+F,KAmTH5F,UACAC,cAAeoK,EACfnK,WACAC,cApWoBnM,MAAOuF,IAEhBJ,EAAAA,OAAY4H,IAAI,IAAI5H,EAAMI,KACvC,UACID,GAAUC,GACLkS,EAAAA,GAAeA,EAAYjV,IAAmBiT,IAAA,IACpDA,EACHpJ,QAASoJ,EAAWpJ,QAAQ7J,IAC1BkT,GAAAA,EAAMpV,KAAOiF,EACT,IAAKmQ,EAAOnF,YAAamF,EAAMnF,YAAc,GAAK,GAClDmF,aAGDxG,GAAG,GAwVN9C,WAlVeuL,KACjB/L,EAAmB+J,EAAiB3S,OAAS,EAC/C6I,EAAoBD,EAAmB,GAEvCC,EAAoB,YA0Cf,MC3PL+L,GAAY9R,EAAO+R,EAAP/R,CAAkB,EAAGC,YAAa,CAClD,uBAAwB,CACtBK,WAAmC,SAAvBL,EAAMa,QAAQrK,KACtB,qBACA,sBACJgK,eAAgB,YAChB7C,aAAc,OACd8C,OAA+B,SAAvBT,EAAMa,QAAQrK,KAClB,sCACA,gCACJyH,SAAU,UACVqC,QAASN,EAAM+R,QAAQ,EAAG,KAC1B7T,MAAO8B,EAAMa,QAAQmR,KAAKlR,QAC1B/J,WAAY,gBACZ,UAAW,CACTkb,YAAa,2BACb5R,WAAmC,SAAvBL,EAAMa,QAAQrK,KACtB,sBACA,uBAEN,gBAAiB,CACfyb,YAAa,2BACb1R,UAAW,uCAGf,qCAAsC,CACpCE,OAAQ,QAEVe,MAAO,UAIH0Q,GAAcnS,EAAO5J,EAAP4J,CAAY,EAAGC,YAAa,CAC9CpC,QAAS,OACTgB,eAAgB,gBAChB0B,QAASN,EAAM+R,QAAQ,IAAK,EAAG,GAC/BI,UAAW,sCACXC,UAAWpS,EAAM+R,QAAQ,QAOrBM,GAAgBtS,EAAO2L,EAAP3L,CAAe,EAAGC,YAAa,CACnDrC,aAAc,OACd2U,cAAe,OACfrU,SAAU,SACVuH,WAAY,IACZjF,UAAW,qCACXD,QAASN,EAAM+R,QAAQ,GAAK,KAC5B1R,WAAmC,SAAvBL,EAAMa,QAAQrK,KACtB,qEACA,oEACJ0H,MAA8B,SAAvB8B,EAAMa,QAAQrK,KAAkB,OAAS,OAChD,UAAW,CACT+J,UAAW,uCAEb,iBAAkB,CAChBF,WAAmC,SAAvBL,EAAMa,QAAQrK,KACtB,4BACA,sBACJ0H,MAA8B,SAAvB8B,EAAMa,QAAQrK,KACjB,2BACA,yBAKF+b,GAAaA,EAAGC,gBAAeC,WAAW,OAAQC,cAAc,SAC9D,MAAArN,KAAEA,GAAS/L,EAAAA,WAAWC,IACtBoZ,UAAEA,EAAAA,aAAWC,EAAAA,UAAcC,EAAAA,WAAWC,GAAexZ,EAAAA,WAAWyZ,IAC/DvQ,EAASwQ,GAAc5a,EAAAA,SAAS,KAChC6a,EAAYC,GAAiB9a,EAAAA,SAAS,KACtC+a,EAAWC,GAAgBhb,EAAAA,SAAS,KACpCib,EAAcC,GAAmBlb,EAAAA,SAAS,KAC1Cmb,EAAcC,GAAmBpb,EAAAA,UAAS,IAC1CW,EAAOC,GAAYZ,EAAAA,SAAS,IAC7B0W,EAAe5V,SAAO,OACrBua,EAAYC,GAAiBtb,EAAAA,UAAS,IACtCub,EAAmBC,GAAwBxb,WAAS,CAAEmM,MAAM,EAAO0H,QAAS,MAC5E4H,EAAiBC,GAAsB1b,EAAAA,UAAS,IAChD2b,EAAgBC,GAAqB5b,EAAAA,SAAS,KAC9C6b,EAAUC,GAAe9b,WAAS,CACvCmM,MAAM,EACN0H,QAAS,GACTkI,SAAU,WAELC,EAAiBC,GAAsBjc,WAAS,CACrDmM,MAAM,EACN0H,QAAS,GACTqI,cAAe,KAEVC,EAAeC,GAAoBpc,EAAAA,UAAS,IAC5Cqc,EAAkBC,GAAuBtc,EAAAA,SAAS,IAGnDuc,GAAiB,UACjBC,GAAiB,SACjBC,GAAsB,CAC1B,aACA,YACA,YACA,aACA,aACA,cAEIC,GAAsB,CAC1B,YACA,aACA,kBACA,kBACA,oBAGFjb,EAAAA,UAAU,KACJd,KAAgB,KACnB,CAACyJ,EAASyQ,EAAYc,EAAgBhb,IAEnCgc,MAAAA,GAAc7b,SAAO,GA0FrB8b,GAA0BtE,IAC1B,IAACA,EAAMzT,OAAQ,OAGbgY,MACAC,EADWra,MAAMsa,KAAKzE,GACI9T,OAAekR,IAC7C,MAAMsH,EAAeP,GAAoBjb,SAASkU,EAAK9W,MACjDqe,EAAeP,GAAoBlb,SAASkU,EAAK9W,MAEnD,SAACoe,IAAiBC,IACbtJ,OAAAA,cAAc,IAAIC,YAAY,YAAa,CAChDzQ,OAAQ,CACN0Q,QAAS,kCAAkC6B,EAAKrI,+FAChD0O,SAAU,YAGP,MAKPe,GAA0B,IAA1BA,EAAejY,OACjB,OAGIqY,MAAAA,EAAaJ,EAAetY,OAAOkR,GAAQ+G,GAAoBjb,SAASkU,EAAK9W,OAC7Eue,EAAaL,EAAetY,OAAOkR,GAAQgH,GAAoBlb,SAASkU,EAAK9W,OAGnF,GAAkB,UAAdmc,GAAyBmC,EAAWrY,OAAS,EAC1B2W,EAAA,CACnBrP,MAAM,EACN0H,QAAS,qDAMb,GAAkB,UAAdkH,GAAyBoC,EAAWtY,OAAS,EAC1B2W,EAAA,CACnBrP,MAAM,EACN0H,QAAS,oDAHb,CASIsJ,GAAAA,EAAWtY,OAAS,EAAG,CACzBiW,EAAc,CAACqC,EAAW,KAC1BnC,EAAa,SACPoC,MAAAA,EAAS,IAAIC,WAKnB,OAJAD,EAAOE,UAAY,KACDpC,EAAA,CAACkC,EAAOG,eAEnBC,EAAAA,cAAcL,EAAW,GAChC,CAIED,GAAAA,EAAWrY,OAAS,EAAG,CACzBiW,KAAsB,IAAI9T,KAASkW,IACnClC,EAAa,SAGb,MAAMyC,EAAc,GACpBP,EAAW7F,QAAgB3B,IACnB0H,MAAAA,EAAS,IAAIC,WACnBD,EAAOE,UAAY,KACLI,EAAAA,KAAKN,EAAOG,QACpBE,EAAY5Y,SAAWqY,EAAWrY,QACpCqW,KAAwB,IAAIlU,KAASyW,KAGzCL,EAAOI,cAAc9H,IACtB,CA/BD,GA+GEiI,GAAe9b,UACf,GAACuI,EAAQwT,QAAgC,IAAtB/C,EAAWhW,QAA0C,IAA1B8W,EAAe9W,OAE7D,IACFuW,GAAgB,GAChBxa,EAAS,IAGH+U,MAAAA,EAAW,IAAIC,SAwBjB+F,GAvBJhG,EAASE,OAAO,UAAWzL,EAAQwT,QAI/BvD,GAAyB,SAAbA,GACLxE,EAAAA,OAAO,OAAQwE,GAGtBC,GACOzE,EAAAA,OAAO,eAAgByE,GAGhB,UAAdS,EAES1D,EAAAA,QAAQ,CAAC3B,EAAM1Q,KAExB2Q,EAASE,OAAO,UAAU7Q,KAAU0Q,KAEf,UAAdqF,GAETpF,EAASE,OAAO,QAASgF,EAAW,IAGlCc,EAAe9W,OAAS,EAAG,CAGvBgZ,MAAAA,EAAYlC,EAAetX,IAAcyZ,IAAA,CAC7C3b,GAAI2b,EAAM3b,GACV4b,MAAOD,EAAMC,MACbC,OAAQF,EAAME,OACdnf,SAAUif,EAAMjf,SAChBof,UAAWH,EAAMG,UACjBC,WAAYJ,EAAMI,cAEpBvI,EAASE,OAAO,QAASsI,KAAKC,UAAUP,GAAU,CAIpD,MAAM9b,OV/bIF,OAAOwc,IACf,IACI,MAAM1I,EAAW0I,aAAoBzI,SACvCyI,EACA,IAAIzI,SAEIyI,aAAoBzI,UAAiC,iBAAbyI,IAC9CA,EAASjU,SACFyL,EAAAA,OAAO,UAAWwI,EAASjU,SAG1B3H,MAAMC,QAAQ2b,EAASC,SACjCD,EAASC,OAAOjH,QAAQ,CAACkH,EAAOvZ,KAC9B2Q,EAASE,OAAO,UAAU7Q,KAAUuZ,KAI5BF,EAASE,OAASF,EAASE,iBAAiBC,MAC7C3I,EAAAA,OAAO,QAASwI,EAASE,OAGxBF,EAASlH,OAASkH,EAASlH,iBAAiBqH,MAC7C3I,EAAAA,OAAO,QAASwI,EAASlH,OAGxBkH,EAASI,OAAShc,MAAMC,QAAQ2b,EAASI,QAAUJ,EAASI,MAAM5Z,OAAS,GACrF8Q,EAASE,OAAO,QAASsI,KAAKC,UAAUC,EAASI,SAKrD,IAAA,IAAUC,EAAKtf,KAAUuW,EAAS7R,UACX0a,KAOb,IAER,MAAMzc,QAAiBC,EAAMsC,KAAK,oBAAqBqR,EAAU,CAC/DG,QAAS,CACP,eAAgB,uBAElB6I,mBAAmB,IAYrB,OARA3c,EAAM4c,MAAMC,kBAEU,oBAAXxd,QACFsS,OAAAA,cAAc,IAAIC,YAAY,eAAgB,CACnDzQ,OAAQ,CAAEmB,KAAMvC,EAASG,KAAKoC,SAI3BvC,EAASG,WACT4c,GAGK,IAEV,MAAMC,QAAoB/c,EAAMgd,IAAI,aAAcrJ,EAAU,CAC1DG,QAAS,CACP,eAAgB,uBAElB6I,mBAAmB,IAYrB,OARA3c,EAAM4c,MAAMC,kBAEU,oBAAXxd,QACFsS,OAAAA,cAAc,IAAIC,YAAY,eAAgB,CACnDzQ,OAAQ,CAAEmB,KAAMya,EAAY7c,KAAKoC,SAI9Bya,EAAY7c,WACZ+c,GAIP,MAAMC,QAAsBld,EAAMsC,KAAK,gBAAiBqR,EAAU,CAChEG,QAAS,CACP,eAAgB,yBAepB,OATA9T,EAAM4c,MAAMC,kBAGU,oBAAXxd,QACFsS,OAAAA,cAAc,IAAIC,YAAY,eAAgB,CACnDzQ,OAAQ,CAAEmB,KAAM4a,EAAchd,KAAKoC,SAIhC4a,EAAchd,IAAAA,CACvB,QAEKvB,GAEDA,MAAAA,CAAAA,GUqViBwe,CAAuBxJ,GAG1C5T,GAAYA,EAASqd,UA1G3BxE,EAAW,IACXE,EAAc,IACdI,EAAgB,IAChBF,EAAa,IACbY,EAAkB,IAClBhb,EAAS,IACL8V,EAAahV,UACfgV,EAAahV,QAAQtC,MAAQ,IAqGvBgb,GAAiBrY,EAASuC,MAC5B8V,EAAcrY,EAASuC,aAIpB3D,GAGP,GAAIA,EAAMoB,UAAsC,MAA1BpB,EAAMoB,SAASe,OAAgB,CAC7Cuc,MAAAA,EAAY1e,EAAMoB,SAASG,KAAKod,WACtC,IAAIC,EAAe,qCAEfF,GAAAA,GAAaA,EAAUG,MAAO,CAChC,MAAMC,EAAY,IAAIpU,KAAuB,IAAlBgU,EAAUG,OAC/BhU,MAAUH,KACVqU,EAAc/T,KAAKgU,OAAOF,EAAYjU,GAAO,KAKjC+T,GAHdG,EAAc,GAGA,2CAFA/T,KAAKC,MAAM8T,EAAc,YACzBA,EAAc,UAGd,2CAA2CA,QAC7D,MAEgBH,GAAA,uCAGlB3e,EAAS2e,EAAY,MACZ5e,EAAMoB,UAAYpB,EAAMoB,SAASG,MAAQvB,EAAMoB,SAASG,KAAKvB,MAC7DA,EAAAA,EAAMoB,SAASG,KAAKvB,OAE7BC,EAAS,uEACX,CACQ,QACRwa,GAAgB,EAAK,GAIrB,OAACnO,EAGF/H,EAAAA,KAAA0a,EAAA,CACCC,UAAW,EACX7hB,GAAI,CACFsF,EAAG,EACHiC,aAAc,EACd0C,WAAY,4BACZG,eAAgB,aAChB+L,qBAAsB,aACtBlW,SAAU,WACVC,SAAU,SACVmK,OAAQ,sCAIT1H,SAAAA,CAAAA,GACE7C,EAAAA,IAAAgiB,EAAA,CACC/D,SAAS,QACT/d,GAAI,CAAE+H,GAAI,GACVqG,QAAS,IAAMxL,EAAS,IAEvBD,SACHA,IAGD7C,EAAAA,IAAAC,EAAA,CACCkb,UAAU,OACV8G,SAAiBhP,IACfA,EAAEiP,iBACWrC,MAEf3f,GAAI,CACFC,SAAU,WACV+J,OAAQ,GAEViY,YAlXyBlP,IAC7BA,EAAEiP,iBACFjP,EAAEU,kBACFkL,GAAYjb,SAAW,EACK,IAAxBib,GAAYjb,SACd4Z,GAAc,IA8WZ4E,WA1WwBnP,IAC5BA,EAAEiP,iBACFjP,EAAEU,mBAyWE0O,YAtWyBpP,IAC7BA,EAAEiP,iBACFjP,EAAEU,kBACFkL,GAAYjb,SAAW,EACK,IAAxBib,GAAYjb,SACd4Z,GAAc,IAkWZ8E,OA9VoBrP,IACxBA,EAAEiP,iBACFK,eAAc,GAER/H,MAAAA,EAAQvH,EAAEuP,aAAahI,MACzB,IAACA,EAAMzT,OAAQ,OAEnB,IAAI0b,GAAiB,EAErB9d,MAAMsa,KAAKzE,GAAOjB,QAAgB3B,IAChC,MAAMjF,EAAUiF,EAAK9W,KAAKwZ,WAAW,UAC/BoI,EAAU9K,EAAK9W,KAAKwZ,WAAW,UAEjC3H,GAAWiF,EAAK/O,KAAO4V,KACzBD,EAAoB,wCACpBF,GAAiB,GACAmE,GAAA,GAGfC,GAAW9K,EAAK/O,KAAO6V,KACzBF,EAAoB,6CACpBF,GAAiB,GACAmE,GAAA,KAIjBA,GAEJ3D,GAAatE,IAoUT1a,SAACsH,EAAAA,KAAAnH,EAAA,CACCC,GAAI,CACFwH,QAAS,OACTC,cAAe,SACfxH,SAAU,WACVsH,aAAc,OACd8C,OAAQgT,EAAa,qBAAuB,OAC5CtS,gBAAiBsS,EAAa,4BAA8B,cAC5DnT,QAASmT,EAAa,EAAI,EAC1B1c,WAAY,6CAGb0c,SAAAA,CACCA,GAAAnW,EAAAA,KAACnH,GACCC,GAAI,CACFC,SAAU,WACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPhB,OAAQ,EACRtC,QAAS,OACTE,WAAY,SACZc,eAAgB,SAChBf,cAAe,SACfsD,gBAAiB,wBACjBxD,aAAc,OACdyC,OAAQ,GACRxJ,QAAS6c,EAAa,EAAI,EAC1B1c,WAAY,iDAGdf,SAAA,CAAAE,MAAC2iB,IAAkBziB,GAAI,CAAE6H,SAAU,GAAIC,MAAO,UAAWC,GAAI,EAAGvB,OAAQ,yDACvEwB,EAAW,CAAAC,QAAQ,QAAQH,MAAM,UAAU9H,GAAI,CAAEoP,WAAY,SAAUsT,WAAY,6BAA8B9iB,SAElH,6BAIJsH,OAACnH,GAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,aAAcK,GAAI,GACxDnI,SAAA,CAAAE,EAAAA,IAAC+M,EACC,CAAAqC,IAAKD,EAAKE,MAAQ,0BAA0BF,EAAK9K,MAAM8K,EAAKE,aAAUzD,EACtEgI,IAAKzE,EAAKI,KACVrP,GAAI,CACF8T,GAAI,IACJ1I,MAAO,GACPC,OAAQ,GACRhB,OAAQ,gCACRF,UAAW,+BACXxJ,WAAY,gBACZ,UAAW,CACToJ,UAAW,cACXI,UAAW,oCAIjBrK,MAAC2b,IACCkH,YAAY,oBACZC,WAAS,EACTC,QAAS,EACTzhB,MAAOgL,EACPiO,SAAiBuC,GAAAA,EAAW7J,EAAEkG,OAAO7X,OACrC0hB,QAnOe/P,IACzB,MAAMgQ,EAAgBhQ,EAAEgQ,cACxB,GAAIA,EAAcC,MAAO,CACvB,MAAMA,EAAQD,EAAcC,MAC5B,IAAA,IAASC,EAAI,EAAGA,EAAID,EAAMnc,OAAQoc,IAChC,QAAID,EAAMC,GAAGriB,KAAKsiB,QAAQ,SAAiB,CACzCnQ,EAAEiP,iBACF,MAAMtK,EAAOsL,EAAMC,GAAGE,YACtB,GAAIzL,EAAM,CACJqF,GAAAA,GAA2B,UAAdA,EAKf,YAJqBS,EAAA,CACnBrP,MAAM,EACN0H,QAAS,gDAMbmH,EAAa,UACbF,EAAsB9T,GAAA,IAAIA,EAAM0O,IAE1B0H,MAAAA,EAAS,IAAIC,WACnBD,EAAOE,UAAY,KACjBpC,KAAwB,IAAIlU,EAAMoW,EAAOG,UAE3CH,EAAOI,cAAc9H,GACrB,KAAA,CACF,CAEJ,GAuMQhJ,WAAS,OAKZuO,EAAapW,OAAS,GACrB/G,EAAAA,IAACC,GAAIC,GAAI,CAAEC,SAAU,WAAY8H,GAAI,GACnCnI,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CACPC,SAAU,WACVsH,aAAc,OACdrH,SAAU,SACVmK,OAAQ,qCACRU,gBAAiB,sBAEhBgS,SAAAA,CAAc,UAAAA,EACZjd,EAAAA,IAAAsjB,EAAA,CACCpjB,GAAI,CACFoL,MAAO,OACPC,OAAQ,OACRG,UAAW,IACX6X,OAAQ,EACRnZ,QAAS,GAEXoZ,KAAMrG,EAAapW,OAAS,EAAI,EAAIoW,EAAapW,OACjD0c,UAAW,IACX5b,IAAK,EAEJsV,WAAa5W,IAAI,CAACmd,EAASxc,IAC1BE,EAAAA,KAACuc,GAECzjB,GAAI,CACFC,SAAU,WACVsH,aAAc,MACdrH,SAAU,SACVmK,OAAQ,sCAGVzK,SAAA,CAACE,EAAAA,IAAA,MAAA,CACCoP,IAAKsU,EACL9P,IAAK,WAAW1M,EAAQ,IACxBgN,MAAO,CACLzH,UAAW,QACXlB,OAAQ,OACRD,MAAO,OACP7D,aAAc,SAGlBzH,MAACyK,EACC,CAAAsE,QAAS,KACO7F,EAAAA,GAAQA,EAAKxC,OAAO,CAACO,EAAGkc,IAAMA,IAAMjc,IAClCgC,EAAAA,GAAQA,EAAKxC,OAAO,CAACO,EAAGkc,IAAMA,IAAMjc,IACxB,IAAxBiW,EAAapW,QACfmW,EAAa,KAGjBhd,GAAI,CACFC,SAAU,WACV4K,IAAK,EACLC,MAAO,EACPC,gBAAiB,qBACjBjD,MAAO,QACPoC,QAAS,MACT,UAAW,CACTa,gBAAiB,sBAEnBX,eAAgB,aAGlBxK,SAAAE,EAAAA,IAACgP,GAAU,CAAAjH,SAAS,cAvCjBb,MA6CVlH,EAAAA,IAAA,QAAA,CACCoP,IAAK+N,EAAa,GAClByG,UAAQ,EACR1P,MAAO,CACL5I,MAAO,OACPI,UAAW,QACXjE,aAAc,UAIL,UAAdwV,GACCjd,MAACyK,EACC,CAAAsE,QArWQ8U,KACxB7G,EAAc,IACdI,EAAgB,IAChBF,EAAa,IACbY,EAAkB,IAClBhb,EAAS,IACL8V,EAAahV,UACfgV,EAAahV,QAAQtC,MAAQ,KA+VfpB,GAAI,CACFC,SAAU,WACV4K,IAAK,EACLC,MAAO,EACPC,gBAAiB,qBACjBjD,MAAO,QACP,UAAW,CACTiD,gBAAiB,sBAEnBb,QAAS,MACTE,eAAgB,aAGlBxK,SAAAE,EAAAA,IAACgP,GAAU,CAAAjH,SAAS,iBAQ7B8V,EAAe9W,OAAS,GACvB/G,EAAAA,IAACC,GAAIC,GAAI,CAAE8G,GAAI,EAAGiB,GAAI,GACnB4V,SAAetX,EAAAA,IACdyZ,GAAA5Y,OAACnH,GAECC,GAAI,CACFwH,QAAS,OACTE,WAAY,SACZN,GAAI,EACJC,GAAI,EACJU,GAAI,EACJR,aAAc,MACdD,QAAkBsC,GAAuB,SAAvBA,EAAMa,QAAQrK,KAC5B,4BACA,sBACJiK,OAAiBT,GAAuB,SAAvBA,EAAMa,QAAQrK,KAC3B,sCACA,iCAGNR,SAAA,CAAAsH,OAACnH,GACCC,GAAI,CACFoL,MAAO,GACPC,OAAQ,GACR9D,aAAc,MACdrH,SAAU,SACV4T,GAAI,IACJ7T,SAAU,WACVqH,QAAkBsC,GAAuB,SAAvBA,EAAMa,QAAQrK,KAC5B,qBACA,qBACJoH,QAAS,OACTE,WAAY,SACZc,eAAgB,UAGlB5I,SAAA,CAAAE,MAAC,OACCoP,IAAK4Q,EAAMI,WAAW9F,WAAW,YAAc0F,EAAMI,WAAa,gCAAgCJ,EAAMI,aACxGxM,IAAKoM,EAAMC,MACX/L,MAAO,CAAE5I,MAAO,OAAQC,OAAQ,OAAQkB,UAAW,SACnDqX,QAAgB7Q,IACdA,EAAEkG,OAAO/J,IAAM,2CAGnBpP,MAAC+jB,IACC7jB,GAAI,CACFC,SAAU,WACV4H,SAAU,GACVC,MAAO,iCAIbZ,OAACnH,GAAIC,GAAI,CAAEmM,KAAM,EAAGb,SAAU,GAC5B1L,SAAA,CAAAE,MAACkI,GAAWC,QAAQ,QAAQ6b,QAAM,EAC/BhE,WAAMC,QAETjgB,EAAAA,IAACkI,GAAWC,QAAQ,UAAUH,MAAM,iBAAiBgc,QAAM,EACxDhE,SAAAA,EAAME,YAGXlgB,EAAAA,IAACyK,EACC,CAAA5B,KAAK,QACLkG,QAAS,KAAMkV,OA1aMC,EA0aYlE,EAAM3b,QAzavDyZ,KAA0B5U,EAAKxC,UAAgBsZ,EAAM3b,KAAO6f,IADnCA,IAAYA,GA2arBhkB,GAAI,CAAEsP,GAAI,GAEV1P,SAAAE,EAAAA,IAACgP,GAAU,CAAAjH,SAAS,cA7DjBiY,EAAM3b,cAoElB2X,GACC,CAAAlc,SAAA,CAAAsH,OAACnH,GAAIC,GAAI,CAAEwH,QAAS,OAAQG,IAAK,GAC/B/H,SAAA,CAACE,EAAAA,IAAA,QAAA,CACCyI,IAAKmQ,EACL9X,KAAK,OACL6Z,OAAO,kBACPJ,SAzjBuBrV,IACnCA,EAAMgd,iBACA1H,MAAAA,EAAQtV,EAAMiU,OAAOqB,MACvB,IAACA,EAAMzT,OAAQ,OAEnB,IAAI0b,GAAiB,EAGrB9d,MAAMsa,KAAKzE,GAAOjB,QAAgB3B,IAChC,MAAMjF,EAAUiF,EAAK9W,KAAKwZ,WAAW,UAC/BoI,EAAU9K,EAAK9W,KAAKwZ,WAAW,UAEjC3H,GAAWiF,EAAK/O,KAAO4V,KACzBD,EAAoB,wCACpBF,GAAiB,GACAmE,GAAA,GAGfC,GAAW9K,EAAK/O,KAAO6V,KACzBF,EAAoB,6CACpBF,GAAiB,GACAmE,GAAA,KAIjBA,EACFvd,EAAMiU,OAAO7X,MAAQ,GAIvBwd,GAAatE,IA4hBD2J,UAAQ,EACRjQ,MAAO,CAAExM,QAAS,QAClBrD,GAAG,yBAELrE,EAAAA,IAAC,QAAM,CAAAokB,QAAQ,uBACbtkB,SAAAE,EAAAA,IAACwV,EACC,CAAA2F,UAAU,OACVkJ,UAAYrkB,EAAAA,IAAA2iB,GAAA,CAAkBziB,GAAI,CAAE6H,SAAU,MAC9C7H,GAAI,CACF8H,MAAO+U,EAAWhW,OAAS,GAAK8W,EAAe9W,OAAS,EAAI,eAAiB,iBAC7EU,aAAc,OACd2U,cAAe,OACfrU,SAAU,SACVuH,WAAY,IACZ/E,OAAQwS,EAAWhW,OAAS,GAAK8W,EAAe9W,OAAS,EACrD,qCACS+C,GAAuB,SAAvBA,EAAMa,QAAQrK,KACrB,sCACA,gCACN8J,QAAS,WACT,UAAW,CACTa,gBAAiB,4BACjB8Q,YAAa,6BAGjBlT,KAAK,QAEJkU,SAAWhW,EAAAA,OAAS,EAAI,UAAUgW,EAAWhW,UAAY,YAK9D/G,EAAAA,IAACwV,EACC,CAAAzG,QAAS,IAAM6O,GAAmB,GAClCyG,UAAYrkB,EAAAA,IAAA+jB,GAAA,CAAc7jB,GAAI,CAAE6H,SAAU,MAC1C7H,GAAI,CACF8H,MAAO6V,EAAe9W,OAAS,EAAI,eAAiB,iBACpDU,aAAc,OACd2U,cAAe,OACfrU,SAAU,SACVuH,WAAY,IACZlF,QAAS,WACTG,OAAQsT,EAAe9W,OAAS,EAC5B,wCACgC,SAAvB+C,EAAMa,QAAQrK,KACrB,sCACA,gCACN,UAAW,CACT2K,gBAAiB,4BACjB8Q,YAAa,6BAGjBlT,KAAK,QAEJgV,SAAe9W,EAAAA,OAAS,EAAI,WAAW8W,EAAe9W,UAAY,cAItE/G,EAAAA,IAAAmc,GAAA,CACChU,QAAQ,YACR4G,QAAS8Q,GACTvK,SAAU+H,IAAkB/Q,EAAQwT,QAAgC,IAAtB/C,EAAWhW,QAA0C,IAA1B8W,EAAe9W,OACxFud,QAASjH,EAAerd,EAAAA,IAAC4I,EAAiB,CAAAC,KAAM,GAAIb,MAAM,YAAe,KACzEa,KAAK,QAAO/I,SAGd,oBAIDE,EAAAA,IAAAukB,GAAA,CACClW,KAAMsP,EACNrP,QAAS,IAAMsP,GAAmB,GAClC4G,eAxgB4BC,IACpC3G,EAAkB2G,IAwgBVC,UAAW,SAKjB1kB,MAAC2kB,GACCtW,KAAMoP,EAAkBpP,KACxBuW,iBAAkB,IAClBtW,QAAS,IAAMoP,EAAqB,IAAKD,EAAmBpP,MAAM,IAClEwW,aAAc,CAAEC,SAAU,MAAOC,WAAY,UAE7CjlB,SAAAE,EAAAA,IAACgiB,EACC,CAAA1T,QAAS,IAAMoP,EAAqB,IAAKD,EAAmBpP,MAAM,IAClE4P,SAAS,UACT/d,GAAI,CAAEoL,MAAO,QAEZmS,SAAkB1H,EAAAA,kBAKtBiP,EACC,CAAA3W,KAAMgQ,EACNtI,QAASwI,EACTvI,aAAa,uBACbC,iBAAiB,QACjBC,cAAc,OACd0O,iBAAkB,IAClBtW,QAAS,IAAMgQ,GAAiB,QAzYpB,MAgZd2G,GAAWA,EAAGnlB,WAAUwB,QAAO4F,WAAUge,KAE3CllB,EAAAA,IAAC,MACC,CAAAmlB,KAAK,WACLC,OAAQ9jB,IAAU4F,EAClB7C,GAAI,mBAAmB6C,IACvB,kBAAiB,cAAcA,OAC3Bge,EAEH5jB,SAAU4F,IAAAA,GACRlH,EAAAA,IAAAJ,GAAA,CAAiBC,SAAUqH,EAC1BpH,SAACE,EAAAA,IAAAC,EAAA,CAAIC,GAAI,CAAE+O,GAAI,GACZnP,iBASPulB,GAAaA,EAAGC,aAAYvjB,kBAC5B,IAACujB,EAAmB,OAAA,KAGxB,MAyCMC,EA3BuBC,CAAaA,IAExC,IAAIC,EAAI3e,SAAS0e,EAASE,OAAO,EAAG,GAAI,IACpCC,EAAI7e,SAAS0e,EAASE,OAAO,EAAG,GAAI,IACpC3L,EAAIjT,SAAS0e,EAASE,OAAO,EAAG,GAAI,IAmBjC,OAhBiB,IAAJD,EAAc,IAAJE,EAAc,IAAJ5L,GAAW,IAGlC,KAEf0L,EAAI5X,KAAK+X,IAAI,IAAKH,EAAI,IACtBE,EAAI9X,KAAK+X,IAAI,IAAKD,EAAI,IACtB5L,EAAIlM,KAAK+X,IAAI,IAAK7L,EAAI,MAGtB0L,EAAI5X,KAAKgY,IAAI,EAAGJ,EAAI,IACpBE,EAAI9X,KAAKgY,IAAI,EAAGF,EAAI,IACpB5L,EAAIlM,KAAKgY,IAAI,EAAG9L,EAAI,KAIf,IAAI0L,EAAEhf,SAAS,IAAIqf,SAAS,EAAG,OAAOH,EAAElf,SAAS,IAAIqf,SAAS,EAAG,OAAO/L,EAAEtT,SAAS,IAAIqf,SAAS,EAAG,QAItFC,CAAoBhkB,GAAe,WACnDikB,GA1CqCR,EA0CJzjB,GAAe,WAnC5B,IALd+E,SAAS0e,EAASE,OAAO,EAAG,GAAI,IAKR,IAJxB5e,SAAS0e,EAASE,OAAO,EAAG,GAAI,IAIE,IAHlC5e,SAAS0e,EAASE,OAAO,EAAG,GAAI,KAGS,IAG/B,IAAM,UAAY,WAVVF,IAAaA,EA6C3C,MAsBMS,EAtBmBnK,CAASA,IAEhC,MAAMoK,EAAe,YACfrT,EAAQiJ,EAAKjJ,MAAMqT,GAGnBzG,EAAS,CACb3D,OACAqK,SAAU,MAUL1G,OAPH5M,IAEF4M,EAAO0G,SAAWtT,EAAM,GAAGuT,cAE3B3G,EAAO3D,KAAOA,EAAKuK,QAAQH,EAAc,IAAIpG,QAGxCL,GAIY6G,CAAgBhB,GAyD/BiB,EAtDiBJ,CAAaA,IAClC,OAAQA,GACN,IAAK,SAED,OAAAnmB,EAAAA,IAACwmB,GAAQtmB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,IACpCZ,SAAAsH,EAAAA,KAAC,MAAI,CAAAkE,MAAM,MAAMC,OAAO,MAAMkb,QAAQ,cAAcC,KAAK,OAAOC,MAAM,6BACtE7mB,SAAA,CAAAE,EAAAA,IAAC,OAAK,CAAA2B,EAAE,mhCAAmhC+kB,KAAK,iBAC/hC1mB,EAAAA,IAAA,OAAA,CAAK2B,EAAE,6nBAA6nB+kB,KAAK,iBACzoB1mB,EAAAA,IAAA,OAAA,CAAK2B,EAAE,wLAAwL+kB,KAAK,iBACpM1mB,EAAAA,IAAA,OAAA,CAAK2B,EAAE,q2BAAq2B+kB,KAAK,iBACj3B1mB,EAAAA,IAAA,OAAA,CAAK2B,EAAE,wYAAwY+kB,KAAK,sBAK3Z,IAAK,QAED,OAAA1mB,EAAAA,IAACwmB,GAAQtmB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,IACpCZ,SAAAE,EAAAA,IAAC,MAAI,CAAA2mB,MAAM,6BAA6BF,QAAQ,YAAYC,KAAK,eAC/D5mB,SAACE,EAAAA,IAAA,OAAA,CAAK2B,EAAE,0LAIhB,IAAK,OAED,OAAA3B,EAAAA,IAACwmB,GAAQtmB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,IACpCZ,SAAAE,EAAAA,IAAC,MAAI,CAAA2mB,MAAM,6BAA6BF,QAAQ,YAAYC,KAAK,eAC/D5mB,SAACE,EAAAA,IAAA,OAAA,CAAK2B,EAAE,2GAIhB,IAAK,QACI,OAAA3B,EAAAA,IAAC+jB,IAAc7jB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,MACrD,IAAK,WACI,OAAAV,EAAAA,IAAC4mB,IAAe1mB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,MACtD,IAAK,OACI,OAAAV,EAAAA,IAAC6mB,IAAS3mB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,MAChD,IAAK,OACI,OAAAV,EAAAA,IAAC8mB,GAAS5mB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,MAChD,IAAK,OACI,OAAAV,EAAAA,IAAC+mB,IAAS7mB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,MAChD,QAGI,OAAAV,EAAAA,IAACwmB,GAAQtmB,GAAI,CAAE6H,SAAU,GAAIrH,QAAS,IACpCZ,SAAAE,EAAAA,IAAC,MAAI,CAAA2mB,MAAM,6BAA6BF,QAAQ,YAAYC,KAAK,eAC/D5mB,SAACE,EAAAA,IAAA,OAAA,CAAK2B,EAAE,mKAQDqlB,CAAcf,EAAaE,UAE9C,OACGnmB,MAAAQ,EAAOC,IAAP,CACCF,QAAS,CAAEG,QAAS,EAAGumB,MAAO,GAAKC,EAAG,IACtCvmB,QAAS,CAAED,QAAS,EAAGumB,MAAO,EAAGC,EAAG,GACpCrmB,WAAY,CACVC,KAAM,SACNqmB,UAAW,IACXC,QAAS,GACTC,MAAO,IAETnT,MAAO,CACL/T,SAAU,WACV4J,KAAM,OACNgB,IAAK,MACLb,OAAQ,IAGVpK,SAACE,EAAAA,IAAAC,EAAA,CACCC,GAAI,CACFC,SAAU,WACV8K,gBAAiB,cACjBvE,OAAQ,yCACR2B,SAAU,QACV4B,UAAW,mBACX,WAAY,CACVqC,QAAS,KACTnM,SAAU,WACV4K,IAAK,EACLhB,MAAM,EACNuB,MAAO,EACPC,OAAQ,EACR+b,YAAa,QACbC,YAAa,gBACbxL,YAAa,eAAeha,GAAe,oCAC3CkI,UAAW,gBACXvD,OAAQ,4CACRwD,OAAQ,IAIZpK,SAACsH,EAAAA,KAAAnH,EAAA,CACCC,GAAI,CACFiK,WAAY,2BAA2BpI,GAAe,iBAAiBwjB,UACvEvd,MAAOge,EACP5b,QAAS,WACT3C,aAAc,OACdM,SAAU,OACVuH,WAAY,IACZwE,WAAY,SACZ1T,SAAU,SACViK,UAAW,mJAGXC,eAAgB,YAChBC,OAAQ,cAA6B,YAAhBxI,EAA4B,kBAAoB,yBACrE2F,QAAS,OACTE,WAAY,SACZC,IAAK,MACL1H,SAAU,YAGXomB,SAAAA,CAAAA,EACDvmB,MAACC,GACCC,GAAI,CACFE,SAAU,SACVonB,UAAW,oFAGb1nB,SAAAE,EAAAA,IAACC,EACC,CAAAwnB,UAAU,iBACVvnB,GAAI,CACF4T,WAAY,SACZpM,QAAS,eACTggB,UAAWzB,EAAanK,KAAK/U,OAAS,GAAK,iCAAmC,OAC9E,wBAAyB,CACvB,KAAM,CAAEkD,UAAW,kBACnB,MAAO,CAAEA,UAAW,kBACpB,MAAO,CAAEA,UAAWgc,EAAanK,KAAK/U,OAAS,GAAK,mBAAqB,kBACzE,OAAQ,CAAEkD,UAAW,mBAEvB,WAAYgc,EAAanK,KAAK/U,OAAS,GAAK,CAC1CuF,QAAS,OAAO2Z,EAAanK,WAC7B6L,YAAa,QACX,CAAA,GAGL1B,SAAanK,EAAAA,iBAyBtB8L,GAAkBA,CAACpC,EAAUqC,EAAS,MAC1C,IAAKrC,GAAyB,gBAAbA,GAA8BA,EAASlL,WAAW,QAC1DkL,OAAAA,EAIT,MAAMsC,EAAMtC,EAASa,QAAQ,IAAK,IAG5BZ,EAAI3e,SAASghB,EAAIC,UAAU,EAAG,GAAI,IAClCpC,EAAI7e,SAASghB,EAAIC,UAAU,EAAG,GAAI,IAClChO,EAAIjT,SAASghB,EAAIC,UAAU,EAAG,GAAI,IAGlCC,EAAyBna,GAAAA,KAAK+X,IAAI,IAAK/X,KAAKC,MAAMqN,GAAa,IAAMA,GAAa0M,IAGxF,MAAO,IAAIG,EAAQvC,GAAGhf,SAAS,IAAIqf,SAAS,EAAG,OAAOkC,EAAQrC,GAAGlf,SAAS,IAAIqf,SAAS,EAAG,OAAOkC,EAAQjO,GAAGtT,SAAS,IAAIqf,SAAS,EAAG,QAIjImC,GAAoBA,EAAGlnB,WAAUmnB,mBAAkBC,uBAEvD,IAAKpnB,GAAYA,EAAW,GAA0B,aAArBonB,EAAwC,OAAA,KAKzE,IAAIC,EAAY,SACZrnB,GAAY,EACFqnB,EAAA,UACHrnB,GAAY,EACTqnB,EAAA,OACHrnB,GAAY,IACTqnB,EAAA,UAMd,MAUMC,EAAc,sBAVeC,EAUkBJ,EAT9CI,EACQ,IAAI/a,KAAK+a,GACVC,mBAAmB,QAAS,CACtCva,IAAK,UACLC,MAAO,OACPC,KAAM,YALgB,KADNoa,IAAeA,EAajC,OAAAtoB,MAACwoB,GAAQvI,MAAOoI,EAAaI,OAAK,EAACzT,UAAU,MAC3ClV,SAACE,EAAAA,IAAAC,EAAA,CACCkb,UAAU,MACV/L,IAAK,gBAAgBgZ,QACrBxU,IAAK,GAAGwU,aACRloB,GAAI,CACFoL,MAAO,GACPC,OAAQ,GACRiE,GAAI,GACJtC,OAAQ,UACRrM,WAAY,6BACZ,UAAW,CACToJ,UAAW,oBAQjBye,GAAcA,KACZ,MAAA1kB,SAAEA,GAAa2kB,KACbxZ,KAAM4B,EAAAA,gBAAa5N,GAAoBC,EAAAA,WAAWC,IACnD8L,EAAMyZ,GAAW1mB,EAAAA,SAAS,OAC1B2mB,EAAgBC,GAAqB5mB,EAAAA,SAAS,KAC9C6mB,EAAQC,GAAa9mB,EAAAA,SAAS,KAC9B+mB,EAAQC,GAAahnB,EAAAA,SAAS,KAC9BinB,EAAUC,GAAelnB,EAAAA,SAAS,IAClCG,EAASC,GAAcJ,EAAAA,UAAS,IAChCmnB,EAAeC,GAAoBpnB,EAAAA,UAAS,IAC5CqnB,EAAeC,GAAoBtnB,EAAAA,UAAS,IAC5CunB,EAAWC,GAAgBxnB,EAAAA,UAAS,IACpCynB,EAAgBC,IAAqB1nB,EAAAA,SAAS,IAC9C2nB,GAAgBC,IAAqB5nB,EAAAA,SAAS,IAC9C6nB,GAAYC,IAAiB9nB,EAAAA,SAAS,IACtC+nB,GAAWC,IAAgBhoB,EAAAA,SAAS,KACpCioB,GAAeC,IAAoBloB,EAAAA,SAAS,KAC5CmoB,GAASC,IAAcpoB,EAAAA,SAAS,KAChCqoB,GAAkBC,IAAuBtoB,EAAAA,UAAS,IAClDuoB,GAAkBC,IAAuBxoB,EAAAA,UAAS,IAClDyoB,GAAgBC,IAAqB1oB,EAAAA,UAAS,IAC9C2oB,GAASC,IAAc5oB,EAAAA,SAAS,KAChCS,GAAMC,IAAWV,EAAAA,SAAS,IAC1B6oB,GAAgBC,IAAqB9oB,EAAAA,UAAS,IAC9C+oB,GAAcC,IAAmBhpB,EAAAA,SAAS,KAC1C6b,GAAUC,IAAe9b,WAAS,CAAEmM,MAAM,EAAO0H,QAAS,GAAIkI,SAAU,YACzEkN,GAAWC,KACXC,cAAEA,GAAAA,qBAAeC,GAAAA,uBAAsBC,IAA2BnoB,EAAAA,WAAWooB,IAC5EC,GAAYC,IAAiBxpB,EAAAA,SAAS,IAEtCypB,GAAUC,IAAe1pB,EAAAA,UAAS,IAClC2pB,GAAYC,IAAiB5pB,EAAAA,SAAS,OAEtC6pB,GAAmBC,IAAwB9pB,EAAAA,SAAS,KAEpD+pB,GAAQC,IAAahqB,EAAAA,SAAS,KAC9BiqB,GAAeC,IAAoBlqB,EAAAA,UAAS,IAE5CmqB,GAAkBC,IAAuBpqB,EAAAA,SAAS,OAClDqqB,GAAoBC,IAAyBtqB,EAAAA,SAAS,OACtDuqB,GAAkBC,IAAuBxqB,EAAAA,UAAS,IAGlDyqB,GAAaC,IAAkB1qB,EAAAA,SAAS,OAGxC2qB,GAAwBC,IAA6B5qB,EAAAA,UAAS,GAc/D6qB,GAAgBA,KACpB/B,IAAkB,IAYdgC,GAAsBA,KAC1BhP,GAAqB9U,IAAA,IAAKA,EAAMmF,MAAM,MA6BlC4e,GAAiCrmB,IArCzBoX,GAAA,CACV3P,MAAM,EACN4P,SAoCe,UAnCflI,QAmC0B,yBAG9BpS,EAAAA,UAAU,KACiBI,WACnB,IACFzB,GAAW,GAGX,MAAM2B,QAAiBC,EAAMC,IAAI,gBAAgBH,KAU7CC,GAAAA,EAASG,KAAK+K,KAAM,CAsClBlL,QApC2C2H,IAA3C3H,EAASG,KAAK+K,KAAK+d,qBAAqCjpB,EAASG,KAAK+oB,eACxElpB,EAASG,KAAK+K,KAAK+d,oBAAsBjpB,EAASG,KAAK+oB,aAAanoB,QAAU,MAI5Ef,EAASG,KAAKgpB,cAChBnpB,EAASG,KAAK+K,KAAKie,YAAcnpB,EAASG,KAAKgpB,aAK7CnpB,EAASG,KAAKipB,eAChBppB,EAASG,KAAK+K,KAAKke,aAAeppB,EAASG,KAAKipB,cAI1CppB,EAAAA,EAASG,KAAK+K,WAGiBvD,IAAnC3H,EAASG,KAAK+K,KAAKme,aACPrpB,GAAAA,EAASG,KAAK+K,KAAKme,aAI/BrpB,EAASG,KAAKmpB,aAChBtpB,EAASG,KAAK+K,KAAKoe,aAAetpB,EAASG,KAAKmpB,aAEvCtpB,EAASG,KAAK+K,KAAKoe,aAS1BtpB,EAASG,KAAK+K,KAAK4Z,OAAQ,CAE7B,MAAMyE,EAAa7oB,MAAMC,QAAQX,EAASG,KAAK+K,KAAK4Z,QAAU9kB,EAASG,KAAK+K,KAAK4Z,OAAS,GAC1FC,EAAUwE,EAAU,MAEpBxE,EAAU,IAGR/kB,GAAAA,EAASG,KAAK+K,KAAK8Z,OAAQ,CAE7B,MAAMwE,EAAa9oB,MAAMC,QAAQX,EAASG,KAAK+K,KAAK8Z,QAAUhlB,EAASG,KAAK+K,KAAK8Z,OAAS,GAC1FC,EAAUuE,EAAU,MAEpBvE,EAAU,SAI+Btd,IAAvC3H,EAASG,KAAK+K,KAAKue,iBACHzpB,GAAAA,EAASG,KAAK+K,KAAKue,sBAGI9hB,IAAvC3H,EAASG,KAAK+K,KAAKwe,iBACH1pB,GAAAA,EAASG,KAAK+K,KAAKwe,sBAIC/hB,IAApC3H,EAASG,KAAK+K,KAAKye,aACR3pB,EAAAA,EAASG,KAAK+K,KAAKye,mBACQhiB,IAA/B3H,EAASG,KAAKwpB,cACV3pB,EAAAA,EAASG,KAAKwpB,mBAGUhiB,IAAnC3H,EAASG,KAAK+K,KAAK0e,YACP5pB,GAAAA,EAASG,KAAK+K,KAAK0e,kBACMjiB,IAA9B3H,EAASG,KAAKypB,aACT5pB,GAAAA,EAASG,KAAKypB,aAI1B5pB,EAASG,KAAKymB,SACL5mB,GAAAA,EAASG,KAAKymB,SAGvB,IACIiD,MAAAA,QAA0B5pB,EAAMC,IAAI,2BAA2BF,EAASG,KAAK+K,KAAK9K,MACpFypB,GAAAA,EAAkB1pB,KAAKkd,QAAS,CAClC,MAAMyM,EAAiBD,EAAkB1pB,KAAK4pB,UAC3CtnB,OAAOunB,IAASA,EAAKC,WAAaD,EAAKjqB,WAAaC,EAASG,KAAK+K,KAAKnL,UACvEuC,IAAI0nB,GAAQA,EAAKjqB,UAEpB8kB,EAAkBiF,EAAc,QAE3BlrB,GAEPimB,EAAkB,GAAE,CAIlB7kB,EAASG,KAAK+K,KAAKgf,KAAOlqB,EAASG,KAAK+pB,IAC1CvB,GAAe3oB,EAASG,KAAK+K,KAAKgf,KAAOlqB,EAASG,KAAK+pB,KAEvDvB,GAAe,WAI+BhhB,IAA5C3H,EAASG,KAAKgqB,2BACUnqB,GAAAA,EAASG,KAAKgqB,0BAC1C,MAGAxF,EAAQ,YAEH/lB,GAEHA,EAAMoB,UAAsC,MAA1BpB,EAAMoB,SAASe,QAEnC4jB,EAAQ,KACV,CACQ,QACRtmB,GAAW,EAAK,GAKH+rB,IAChB,CAACrqB,EAAU1B,EAAYsmB,EAASgB,GAAmBE,GAAmBJ,EAAcM,GAAec,GAAYY,KAGlH/nB,EAAAA,UAAU,KACHoN,GACH6X,EAAQ,OAET,CAAC7X,IAGJpN,EAAAA,UAAU,KAEJwL,GAAQA,EAAK9K,KACfmmB,IAAoB,GACpBE,IAAoB,GACpBE,IAAkB,GAIlB1mB,EAAMC,IAAI,gBAAgBgL,EAAK9K,gBAC5BoK,KAAiBxK,IAEhB,GAAIA,EAASG,MAAQH,EAASG,KAAK6lB,UAAW,CAE5C,MAAMqE,EAAgB3pB,MAAMC,QAAQX,EAASG,KAAK6lB,WAC9ChmB,EAASG,KAAK6lB,UAAUvjB,OAAY6nB,GAAAA,GAAkB,iBAANA,GAChD,GAEJrE,GAAaoE,EAAa,MAI1BpE,GAAa,MAGhBsE,MAAe3rB,IAEdqnB,GAAa,MAEdxb,QAAQ,KACP8b,IAAoB,KAKxBtmB,EAAMC,IAAI,gBAAgBgL,EAAK9K,gBAC5BoK,KAAiBxK,IAEhB,GAAIA,EAASG,MAAQH,EAASG,KAAKqlB,UAAW,CAE5C,MAAMgF,EAAgB9pB,MAAMC,QAAQX,EAASG,KAAKqlB,WAC9CxlB,EAASG,KAAKqlB,UAAU/iB,OAAY6nB,GAAAA,GAAkB,iBAANA,GAChD,GAEJnE,GAAiBqE,EAAa,MAI9BrE,GAAiB,MAGpBoE,MAAe3rB,IAEdunB,GAAiB,MAElB1b,QAAQ,KACPgc,IAAoB,KAKxBxmB,EAAMC,IAAI,gBAAgBgL,EAAK9K,cAC5BoK,KAAiBxK,IAEhB,GAAIA,EAASG,MAAQH,EAASG,KAAKimB,QAAS,CAE1C,MAAMqE,EAAc/pB,MAAMC,QAAQX,EAASG,KAAKimB,SAC5CpmB,EAASG,KAAKimB,QAAQ3jB,OAAY6nB,GAAAA,GAAkB,iBAANA,GAC9C,GAEJjE,GAAWoE,EAAW,MAItBpE,GAAW,MAGdkE,MAAe3rB,IAEdynB,GAAW,MAEZ5b,QAAQ,KACPkc,IAAkB,OAGvB,CAACzb,IAGJxL,EAAAA,UAAU,KAiBJwL,GAAQA,EAAK9K,IAhBON,WAClB,IACEoL,GAAAA,GAAQA,EAAK9K,GAAI,CACnB,MAAMJ,QAAiBC,EAAMC,IAAI,gBAAgBgL,EAAK9K,YAClDJ,EAASG,WAAsCwH,IAA9B3H,EAASG,KAAKkpB,YACnBrpB,GAAAA,EAASG,KAAKkpB,aAE5B5B,GAAc,EAChB,QAEK7oB,GAEP6oB,GAAc,EAAC,GAKDiD,IAEjB,CAACxf,IAmBJxL,EAAAA,UAAU,KACJK,GAjBoBD,WACpB,IACF,IAAKC,EAAU,OAEf,MAAMC,QAAiBC,EAAMC,IAAI,gBAAgBH,mBAE7CC,EAASG,KAAKkd,UACJrd,GAAAA,EAASG,KAAKwqB,WACZ3qB,GAAAA,EAASG,KAAKyqB,oBAEvBhsB,GAAO,GAQIisB,IAEnB,CAAC9qB,IAGJL,EAAAA,UAAU,OAQP,CAACwL,IAEJxL,EAAAA,UAAU,KACJwL,GAAQA,EAAK9K,IACC0qB,MAEjB,CAAC5f,IAEJ,MAAM4f,GAAkBhrB,UAClB,IACFqoB,IAAiB,GACjB,MAAMnoB,QAAiBC,EAAMC,IAAI,gBAAgBgL,EAAK9K,aAClDJ,EAASG,KAAKkd,QAChB4K,GAAUjoB,EAASG,KAAK6nB,QAAU,IAGlCC,GAAU,UAELrpB,GAEPqpB,GAAU,GAAE,CACJ,QACRE,IAAiB,EAAK,GAKpB4C,GAAsBA,CAAC9pB,EAAOlB,KAClCkB,EAAMgd,iBACNoK,GAAoBtoB,GACpB0oB,IAAoB,IAgBtB,GATA/oB,EAAAA,UAAU,KACJwL,GAAAA,GAAQA,EAAK8f,uBAEf,OADA3D,GAAqBnc,EAAK8f,wBACnB,IAAM1D,KAEUA,MAExB,CAACpc,GAAQA,EAAK8f,yBAEb5sB,EAEA,OAAArC,EAAAA,IAACC,GAAIC,GAAI,CAAEwH,QAAS,OAAQgB,eAAgB,SAAUd,WAAY,SAAU2D,OAAQ,QAClFzL,SAACE,EAAAA,IAAA4I,EAAA,CAAA,KAKP,IAAKuG,EACH,aACG+f,EAAU,CAAA7mB,SAAS,KAClBvI,SAAAsH,EAAAA,KAACnH,GAAIC,GAAI,CAAEmH,UAAW,SAAUL,GAAI,GAClClH,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,KAAKrI,SAAsB,2BACjDE,EAAAA,IAACwV,EACG,CAAA2F,UAAWgU,EACXC,GAAG,IACLjnB,QAAQ,YACRH,MAAM,UACJ9H,GAAI,CAAE8G,GAAI,EAAGS,aAAc,GAAI2U,cAAe,QAAStc,SAG3D,8BAMN,MAAMuvB,GAAgBte,GAAeA,EAAY/M,WAAamL,EAAKnL,SAE7DsrB,GAAeA,EAAGxtB,YAEpB9B,MAAC8I,IAAShH,WAIRytB,GAAWA,UAEZ1tB,GAAU,CAAAC,OAAQqN,GAAM9K,GAAItC,YAAaoN,GAAMqgB,eAIpD,OACGpoB,EAAAA,KAAA8nB,EAAA,CACC7mB,SAAS,KACTnI,GAAI,CACF+O,GAAI,EACJwgB,GAAI,EACJloB,GAAI,CAAEmoB,GAAI,GAAKC,GAAI,GACnBrkB,MAAO,OACPskB,YAAa,OACbC,WAAY,cACZC,WAAY,OACZC,cAAe,OACfpI,YAAa,IACbqI,aAAc,IACdvkB,UAAW,sBAGb3L,SAAA,CAAAsH,EAAAA,KAAC6oB,EACC,CAAAC,WAAS,EACTrU,QAAS,GACT3b,GAAI,CACFyH,cAAe,CAAE+nB,GAAI,SAAUS,GAAI,OACnCC,SAAU,CAAEV,GAAI,SAAUS,GAAI,WAIhCrwB,SAAA,CAAAsH,OAAC6oB,GAAKhC,MAAI,EAACyB,GAAI,GAAIS,GAAI,EAAGjwB,GAAI,CAC5BC,SAAU,CAAEuvB,GAAI,SAAUS,GAAI,UAC9BplB,IAAK,OACLQ,OAAQ,cACRrB,OAAQ,GAGRpK,SAAA,CAAAsH,OAAC0a,GAAM5hB,GAAI,CACTsF,EAAG,EACHiC,aAAc,OACd0C,WAAY,4BACZG,eAAgB,aAChB+L,qBAAsB,aACtBhM,UAAW,gCACXjK,SAAU,SACV6H,GAAI,MACJsC,OAAQ,qCACRpK,SAAU,WACV+J,OAAQ,GAIPiF,SAAAA,CAAqB,IAArBA,GAAMkhB,WAELlhB,GAAMmhB,WACJtwB,MAACC,GAAIC,GAAI,CACPoL,MAAO,OACPC,OAAQ,CAAEmkB,GAAI,IAAKC,GAAI,KACvB5jB,gBAAiB,OAAOoD,EAAKmhB,cAC7BtkB,eAAgB,QAChBC,mBAAoB,SACpB9L,SAAU,WACVU,WAAY,sBACZ,UAAW,CACToJ,UAAW,eAEb,WAAY,CACVqC,QAAS,KACTnM,SAAU,WACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPhB,OAAQ,EACRE,OAAQ,MAIXlK,EAAAA,IAAAC,EAAA,CAAIC,GAAI,CACPoL,MAAO,OACPC,OAAQ,CAAEmkB,GAAI,IAAKC,GAAI,KACvBxvB,SAAU,cAMd,KAGFiH,OAACnH,GAAIC,GAAI,CAAEqH,GAAI,EAAGkoB,GAAI,EAAGxgB,GAAI,EAAGjI,GAAyB,IAArBmI,GAAMkhB,WAAmB,GAAI,GAE/DvwB,SAAA,CAAAE,MAACC,GAAIC,GAAI,CACPwH,QAAS,OACTgB,eAAgB,gBAChBd,WAAY,cAGZ9H,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEC,SAAU,YACnBL,SAAA,CAAAE,MAACwoB,GAAQvI,MAAM,iBAAiBwI,OAAK,EAACzT,UAAU,MAC9ClV,SAAAE,EAAAA,IAAC+M,EACC,CAAAqC,IAAKD,GAAMohB,WACX3c,IAAKzE,GAAMI,KACXR,QAAS,KACDjD,MAAAA,EAAWqD,GAAMohB,YAAcxE,GACjCjgB,GAxhBJA,CAAaA,IAET,iBAAbA,IACTof,GAAgBpf,GAChBkf,IAAkB,MAohB2Blf,IAE7B5L,GAAI,CACFoL,MAAO,CAAEokB,GAAI,IAAKC,GAAI,KACtBpkB,OAAQ,CAAEmkB,GAAI,IAAKC,GAAI,KACvBplB,OAAS4E,GAAMqgB,cAAgBrgB,GAAMqhB,aAAerhB,GAAMoe,aACtD,aAAape,EAAKqgB,eAClBrgB,GAAMoe,aACJ,cAAwC,YAA3Bpe,EAAKoe,aAAazsB,KAAqB,sBAAmD,YAA3BqO,EAAKoe,aAAazsB,KAAqB,sBAAmD,aAA3BqO,EAAKoe,aAAazsB,KAAsB,qBAAuB,sBACnMgJ,GAAuB,SAAvBA,EAAMa,QAAQrK,KACnB,oBACA,oBACR+J,UAAY8E,GAAMqgB,cAAgBrgB,GAAMqhB,aAAerhB,EAAKoe,aACxD,YAAYpe,EAAKqgB,iBACjBrgB,GAAMoe,aACwB,YAA3Bpe,EAAKoe,aAAazsB,KAAqB,oCAAiE,YAA3BqO,EAAKoe,aAAazsB,KAAqB,oCAAiE,aAA3BqO,EAAKoe,aAAazsB,KAAsB,mCAAqC,mCACxO,iCACN0G,QAAS,eACT3G,WAAY,gBACZqM,OAAQ,UACR,UAAW,CACTjD,UAAW,cACXI,UAAY8E,GAAMqgB,cAAgBrgB,GAAMqhB,aAAerhB,EAAKoe,aACxD,YAAYpe,EAAKqgB,iBACjBrgB,GAAMoe,aACwB,YAA3Bpe,EAAKoe,aAAazsB,KAAqB,oCAAiE,YAA3BqO,EAAKoe,aAAazsB,KAAqB,oCAAiE,aAA3BqO,EAAKoe,aAAazsB,KAAsB,mCAAqC,mCACxO,kCACNyJ,OAAS4E,GAAMqgB,cAAgBrgB,GAAMqhB,aAAerhB,EAAKoe,aACrD,aAAape,EAAKqgB,iBAClBrgB,GAAMoe,aACJ,cAAwC,YAA3Bpe,EAAKoe,aAAazsB,KAAqB,2BAAwD,YAA3BqO,EAAKoe,aAAazsB,KAAqB,2BAAwD,aAA3BqO,EAAKoe,aAAazsB,KAAsB,0BAA4B,2BACzN,uCAGVgjB,QAAgB7Q,IACd,GAAI9D,GAAM9K,GAAI,CACZ,MAAMosB,EAAc,0BAA0BthB,EAAK9K,MAAM8K,EAAKE,OAAS,gBACvE4D,EAAEE,cAAc/D,IAAMqhB,EACtBzE,GAAqByE,EAAW,OAOvC9E,IAAyC,YAA7Bxc,GAAMoe,cAAczsB,MAC/Bd,MAACC,GACCC,GAAI,CACFC,SAAU,WACVmL,MAAO,GACPC,OAAQ,GACR9D,aAAc,MACdD,QAAS,UACT+C,OAAiBT,GAAuB,SAAvBA,EAAMa,QAAQrK,KAC3B,oBACA,oBACJ0J,OAAQ,EACRgB,MAAO,GACPX,UAAW,iCACXH,OAAQ,EACRwd,UAAW,oBACX,mBAAoB,CAClB,KAAM,CACJrd,UAAW,kCAEb,MAAO,CACLA,UAAW,kCAEb,OAAQ,CACNA,UAAW,0CAQpBgb,GAAW,CAAAC,WAAYnW,GAAMqhB,YAAazuB,YAAaoN,GAAMqgB,oBAOlEpoB,OAACnH,GAAIC,GAAI,CAAE8G,GAAI,EAAG8M,WAAY,UAC5BhU,SAAA,CAAAE,MAACC,GAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,SAAUc,eAAgB,iBAChE5I,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,UACtC9H,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CACCC,QAAQ,KACRjI,GAAI,CACFoP,WAAY,IACZtH,MAA4B,IAArBmH,GAAMkhB,WAAmB,OAAS,UACzCzN,WAAiC,IAArBzT,GAAMkhB,WAAmB,4BAA8B,OACnElmB,WAAiC,IAArBgF,GAAMkhB,WAAmB,UAAyC,SAAvBvmB,EAAMa,QAAQrK,KACjE,8DACA,wDACJowB,qBAA2C,IAArBvhB,GAAMkhB,WAAmB,QAAU,OACzDM,oBAA0C,IAArBxhB,GAAMkhB,WAAmB,QAAU,eAEzDlhB,SAAMI,GAAAA,MAAQ,uBAEhBqhB,EAAkB,CAAA5rB,OAAQmK,GAAM+d,oBAAqBrkB,KAAK,UAG1DsG,GAAMoe,cAAgBpe,EAAKoe,aAAasD,sBAAwB,SAC9D5I,GACC,CAAAlnB,SAAUoO,EAAKoe,aAAasD,sBAC5B3I,iBAAkB/Y,EAAKoe,aAAauD,kBACpC3I,iBAAkBhZ,EAAKoe,aAAazsB,OAIvCqO,GAAMie,aACLptB,MAACC,EACC,CAAAkb,UAAU,MACVjb,GAAI,CACFoL,MAAO,OACPC,OAAQ,GACRiE,GAAI,IAENJ,IAAK,wBAAwBD,EAAKie,YAAY2D,aAC9Cnd,IAAKzE,EAAKie,YAAY4D,KACtBlN,QAAgB7Q,IAEVA,EAAEkG,QAAUlG,EAAEkG,kBAAkB8X,mBAChC9X,EAAAA,OAAOjF,MAAMxM,QAAU,gBAUrCN,OAACnH,GAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,SAAUC,IAAK,GAAKb,GAAI,GAAKopB,SAAU,OAAQ/nB,SAAU,QAC/FvI,SAAA,CAACsH,EAAAA,KAAAc,EAAA,CACCC,QAAQ,QACRjI,GAAI,CACFoP,WAAY,IACZtH,MAA4B,IAArBmH,GAAMkhB,WAAmB,wBAAmCvmB,GAAAA,EAAMa,QAAQmR,KAAKoV,UACtFtO,WAAiC,IAArBzT,GAAMkhB,WAAmB,4BAA8B,OACnE3oB,QAAS,OACTE,WAAY,SACZuC,WAAiC,IAArBgF,GAAMkhB,WACd,qBACgC,SAAvBvmB,EAAMa,QAAQrK,KAAkB,yBAA2B,mBACxEiH,GAAI,IACJD,GAAI,GACJG,aAAc,EACd8C,OAA6B,IAArB4E,GAAMkhB,WACV,sCACgC,SAAvBvmB,EAAMa,QAAQrK,KAAkB,mCAAqC,8BAClFR,SAAA,CAAA,IAEAqP,GAAMnL,UAAY,cAGrBmL,GAAMke,cAAgBle,EAAKke,aAAatmB,OAAS,GAE9CK,EAAAA,KAAAgN,WAAA,CAAAtU,SAAA,CAACE,EAAAA,IAAAmxB,GAAA,CACCjxB,GAAc4J,IAAA,CACZwB,MAAO,MACPC,OAAQ,MACRxD,SAAU,GACVC,MAA4B,IAArBmH,GAAMkhB,WAAmB,wBAA0BvmB,EAAMa,QAAQmR,KAAKoV,cAGhF9pB,EAAAA,KAAAc,EAAA,CACCC,QAAQ,QACRgT,UAAWgU,EACXC,GAAI,YAAYjgB,EAAKke,aAAa,GAAGrpB,WACrC9D,GAAc4J,IAAA,CACZwF,WAAY,IACZtH,MAA4B,IAArBmH,GAAMkhB,WAAmB,wBAA0BvmB,EAAMa,QAAQmR,KAAKoV,UAC7EtO,WAAiC,IAArBzT,GAAMkhB,WAAmB,4BAA8B,OACnE3oB,QAAS,OACTE,WAAY,SACZuC,WAAiC,IAArBgF,GAAMkhB,WACd,kBACuB,SAAvBvmB,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAC/DiH,GAAI,IACJD,GAAI,GACJG,aAAc,EACd8C,OAA6B,IAArB4E,GAAMkhB,WACV,mCACuB,SAAvBvmB,EAAMa,QAAQrK,KAAkB,mCAAqC,6BACzE8wB,eAAgB,OAChB,UAAW,CACTA,eAAgB,OAChBjnB,WAAiC,IAArBgF,GAAMkhB,WACd,kBACuB,SAAvBvmB,EAAMa,QAAQrK,KAAkB,yBAA2B,sBAEhER,SAAA,CAAA,IAEDqP,EAAKke,aAAa,GAAGrpB,eAK5B2oB,GACE3sB,EAAAA,IAAAwoB,EAAA,CACCvI,MACE7Y,OAACnH,GAAIC,GAAI,CAAEsF,EAAG,IACZ1F,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,YAAYjI,GAAI,CAAE+H,GAAI,EAAGqH,WAAY,QAAUxP,SAAoB,yBACtFsH,EAAAA,KAAAc,EAAA,CAAWC,QAAQ,QAAQjI,GAAI,CAAE+H,GAAI,IAAOnI,SAAA,CAAA,YAAU6sB,GAAY0E,UAClEjqB,EAAAA,KAAAc,EAAA,CAAWC,QAAQ,QAAQjI,GAAI,CAAE+H,GAAI,IAAOnI,SAAA,CAAA,OAAK6sB,GAAY2E,YAC7D3E,GAAY4E,eAAiB,GAC3BnqB,EAAAA,KAAAc,EAAA,CAAWC,QAAQ,QAAOrI,SAAA,CAAA,kBACT6sB,GAAY4E,qBAKpC9I,OAAK,EACLzT,UAAU,MAEVlV,SAACsH,EAAAA,KAAAc,EAAA,CACCC,QAAQ,UACRjI,GAAI,CACFwH,QAAS,OACTE,WAAY,SACZI,MAAO,OACPsH,WAAY,IACZnF,WAAY,yBACZ5C,GAAI,EACJD,GAAI,GACJG,aAAc,EACd8C,OAAQ,mCACRF,UAAW,iCACX,UAAW,CACTF,WAAY,0BAEdud,UAAW,wBACX,uBAAwB,CACtB,KAAM,CAAErd,UAAW,kCACnB,MAAO,CAAEA,UAAW,kCACpB,OAAQ,CAAEA,UAAW,kCAIzBvK,SAAA,CAAAE,MAACwxB,IAAUtxB,GAAI,CAAE6H,SAAU,GAAIiM,GAAI,GAAKtT,QAAS,MAChDV,EAAAA,IAAAC,EAAA,CAAIkb,UAAU,OAAOrb,SAAM,gBAG9B,KAEY,IAAfqP,GAAMsiB,MACLzxB,EAAAA,IAACwoB,GACCvI,MAAM,gEACNwI,OAAK,EACLzT,UAAU,MAEVlV,SAAAsH,EAAAA,KAACc,EACC,CAAAC,QAAQ,UACRjI,GAAI,CACFwH,QAAS,OACTE,WAAY,SACZI,MAAO,OACPsH,WAAY,IACZnF,WAAY,yBACZ5C,GAAI,EACJD,GAAI,GACJG,aAAc,EACd8C,OAAQ,mCACRF,UAAW,iCACX,UAAW,CACTF,WAAY,0BAEdud,UAAW,wBACX,uBAAwB,CACtB,KAAM,CAAErd,UAAW,kCACnB,MAAO,CAAEA,UAAW,kCACpB,OAAQ,CAAEA,UAAW,kCAIzBvK,SAAA,CAAAE,MAAC0xB,GAAYxxB,GAAI,CAAE6H,SAAU,GAAIiM,GAAI,GAAKtT,QAAS,MAClDV,EAAAA,IAAAC,EAAA,CAAIkb,UAAU,OAAOrb,SAAI,cAK/BqP,GAAMoe,eACsB,YAA3Bpe,EAAKoe,aAAazsB,WACf6wB,EACC,CAAAC,KAAO5xB,EAAAA,IAAA+mB,GAAA,CAAShf,SAAS,UACzB8pB,MAAM,QACNhpB,KAAK,QACL3I,GAAI,CACFsH,QAAU2H,EAAKqgB,aACX,GAAGrgB,EAAKqgB,iBACR1lB,GAAgC,SAAvBA,EAAMa,QAAQrK,KACrB,4BACA,2BACN0H,MAAQmH,EAAKqgB,aACTrgB,EAAKqgB,gBAC2B,SAAvB1lB,EAAMa,QAAQrK,KACrB,UACA,UACNgP,WAAY,OACZ/E,OAAQ,YACRwR,YAAc5M,EAAKqgB,aACf,GAAGrgB,EAAKqgB,iBACR1lB,GAAgC,SAAvBA,EAAMa,QAAQrK,KACrB,2BACA,0BACN,kBAAmB,CACjB0H,MAAO,WAETV,GAAI,IACJiE,OAAQ,OACRmc,UAAW,0BACX,yBAA0B,CACxB,KAAM,CACJrd,UAAY8E,EAAKqgB,aACf,WAAWrgB,EAAKqgB,iBAChB,mCAEJ,MAAO,CACLnlB,UAAY8E,EAAKqgB,aACf,aAAargB,EAAKqgB,iBAClB,mCAEJ,OAAQ,CACNnlB,UAAY8E,EAAKqgB,aACf,WAAWrgB,EAAKqgB,iBAChB,qCAMVxvB,EAAAA,IAACwoB,EAAQ,CAAAvI,MAAO,YAAuC,YAA3B9Q,EAAKoe,aAAazsB,KAAqB,QAAUqO,EAAKoe,aAAazsB,mBAAmB,IAAIyM,KAAK4B,EAAKoe,aAAauE,YAAYvJ,uBACvJzoB,SAAAE,EAAAA,IAAC2xB,EACC,CAAAC,WAAOG,GAAY,CAAAhqB,SAAS,UAC5B8pB,MAAkC,YAA3B1iB,EAAKoe,aAAazsB,KAAqB,QACxCqO,EAAKoe,aAAazsB,KAAKkxB,OAAO,GAAGC,cAAgB9iB,EAAKoe,aAAazsB,KAAKoxB,MAAM,GACpFrpB,KAAK,QACL3I,GAAI,CACFsH,QAAoC,YAA3B2H,EAAKoe,aAAazsB,KAAqB,4BACb,aAA3BqO,EAAKoe,aAAazsB,KAAsB,2BACb,YAA3BqO,EAAKoe,aAAazsB,KAAqB,4BACvC,2BACRkH,MAAkC,YAA3BmH,EAAKoe,aAAazsB,KAAqB,UACb,aAA3BqO,EAAKoe,aAAazsB,KAAsB,UACb,YAA3BqO,EAAKoe,aAAazsB,KAAqB,qBACvC,UACNwO,WAAY,OACZ/E,OAAQ,YACRwR,YAAwC,YAA3B5M,EAAKoe,aAAazsB,KAAqB,2BACb,aAA3BqO,EAAKoe,aAAazsB,KAAsB,0BACb,YAA3BqO,EAAKoe,aAAazsB,KAAqB,2BACvC,0BACZ,kBAAmB,CACjBkH,MAAO,WAETV,GAAI,IACJiE,OAAQ,OACRmc,UAAW,0BACX,yBAA0B,CACxB,KAAM,CACJrd,UAAY8E,EAAKqgB,cAAgBrgB,EAAKqhB,YACpC,WAAWrhB,EAAKqgB,iBAChB,mCAEJ,MAAO,CACLnlB,UAAY8E,EAAKqgB,cAAgBrgB,EAAKqhB,YACpC,aAAarhB,EAAKqgB,iBAClB,mCAEJ,OAAQ,CACNnlB,UAAY8E,EAAKqgB,cAAgBrgB,EAAKqhB,YACpC,WAAWrhB,EAAKqgB,iBAChB,2CAWjB3G,EAAe9hB,OAAS,GACvB/G,EAAAA,IAACC,GAAIC,GAAI,CACPwH,QAAS,OACTV,GAAI,EACJsE,MAAO,QAEPxL,SAACsH,EAAAA,KAAAnH,EAAA,CACCC,GAAI,CACF8H,MAAO8B,GAASA,EAAMa,QAAQmR,KAAKoV,UACnCjmB,gBAAkBkE,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aAC9D,GAAGpe,EAAKqgB,iBACC1lB,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,2BAA6B,sBACxEiH,GAAI,IACJD,GAAI,GACJG,aAAc,EACd8C,OAAS4E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACrD,aAAape,EAAKqgB,iBACT1lB,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,qCAAuC,+BAClFyH,SAAU,UACVL,QAAS,cACTE,WAAY,SACZS,SAAU,OACV+nB,SAAU,QAGZtwB,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,UAAUjI,GAAI,CAAE8H,MAAOmH,GAAMqgB,aAAe5H,GAAgBzY,EAAKqgB,cAAgB1lB,GAASA,EAAMa,QAAQmR,KAAKoV,UAAWld,GAAI,IAAMlU,SAEtJ,aACC+oB,EAAeqJ,MAAM,EAAG,GAAG3rB,IAAI,CAAC4rB,EAAcvc,IAC7CxO,EAAAA,KAACgrB,EAAMhe,SAAN,CACCtU,SAAA,CAAAsH,EAAAA,KAACc,EACC,CAAAC,QAAQ,UACRgT,UAAU,OACVjb,GAAI,CACF8H,MAAQmH,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACpDpe,EAAKqgB,aACI1lB,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,UAAY,UACvDgP,WAAY,IACZpC,OAAQ,UACR,UAAW,CACTkkB,eAAgB,cAGpBriB,QAAUkE,GAAM+b,GAAoB/b,EAAGkf,GAAcryB,SAAA,CAAA,IAEnDqyB,KAEHvc,EAAM/H,KAAK+X,IAAIiD,EAAe9hB,OAAQ,GAAK,GAC1C/G,EAAAA,IAACkI,EAAW,CAAAC,QAAQ,UAAUgT,UAAU,OAAOjb,GAAI,CAAEmyB,GAAI,GAAKrqB,MAAO8B,GAASA,EAAMa,QAAQmR,KAAKxG,UAAWxV,SAE5G,QArBiB8V,IAyBtBiT,EAAe9hB,OAAS,GACvBK,EAAAA,KAACc,GAAWC,QAAQ,UAAUgT,UAAU,OAAOjb,GAAI,CAAEsP,GAAI,GAAKxH,MAAO8B,GAASA,EAAMa,QAAQmR,KAAKxG,UAAWxV,SAAA,CAAA,SACnG+oB,EAAe9hB,OAAS,UAOxC4lB,KAAgBE,IAA2B9b,GAAkC,IAAnBA,EAAY1M,KACrE+C,EAAAA,KAACnH,GAAIC,GAAI,CACP8G,GAAI,EACJxB,EAAG,IACHiC,aAAc,OACdwD,gBAAiB,yBACjBX,eAAgB,aAChBC,OAAQ,mCACRF,UAAW,kCACX3C,QAAS,OACTE,WAAY,aACZC,IAAK,KAEL/H,SAAA,CAAAE,MAAC0xB,GAAYxxB,GAAI,CAAE6H,SAAU,GAAIf,GAAI,GAAKgB,MAAO,kBAChD/H,EACC,CAAAH,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,YAAYjI,GAAI,CAAEoP,WAAY,OAAQtH,MAAO,SAAUlI,SAE3E,yBACCsH,EAAAA,KAAAc,EAAA,CAAWC,QAAQ,UAAUjI,GAAI,CAAEwH,QAAS,QAASM,MAAO,yBAA0BlI,SAAA,CAAA,YAC3E6sB,GAAY0E,UAEvBjqB,EAAAA,KAAAc,EAAA,CAAWC,QAAQ,UAAUjI,GAAI,CAAEwH,QAAS,QAASM,MAAO,yBAA0BlI,SAAA,CAAA,MACjF6sB,GAAY2E,SACf3E,GAAY4E,eAAiB,GAAK,cAAc5E,GAAY4E,yBAG9DxgB,GAAkC,IAAnBA,EAAY1M,IAC1B+C,EAAAA,KAACnH,GAAIC,GAAI,CAAE8G,GAAI,EAAGiI,GAAI,EAAGgN,UAAW,uCAClCnc,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,UAAUjI,GAAI,CAAEwH,QAAS,QAAS4qB,UAAW,SAAUtqB,MAAO,yBAC/E2kB,SAAAA,GAAY4F,YAAc,8BACzB5F,GAAY6F,MAAQ,cAAc7F,GAAY6F,MAAMjjB,UAAUod,GAAY6F,MAAMxuB,YAAc,6BAGjG2oB,GAAY8F,YACXrrB,OAACc,EAAW,CAAAC,QAAQ,UAAUjI,GAAI,CAAEwH,QAAS,QAAS4qB,UAAW,SAAUtqB,MAAO,yBAA0BlI,SAAA,CAAA,gBAC5F6sB,GAAY8F,cAG7B9F,GAAY+F,SACXtrB,OAACc,EAAW,CAAAC,QAAQ,UAAUjI,GAAI,CAAEwH,QAAS,QAAS4qB,UAAW,SAAUtqB,MAAO,yBAA0BlI,SAAA,CAAA,WACjG6sB,GAAY+F,oBAUlCvjB,GAAMwjB,OACL3yB,MAACkI,EACC,CAAAC,QAAQ,QACRjI,GAAI,CACF8G,GAAI,EACJ6M,WAAY,IACZ7L,MAAOmH,GAAMqgB,aAAe5H,GAAgBzY,EAAKqgB,cAAgB1lB,GAASA,EAAMa,QAAQmR,KAAKoV,UAC7F1rB,EAAG,IACHiC,aAAc,EACd0C,WAAqBL,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAChFgK,eAAgB,aAChBC,OAAiBT,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,mCAAqC,6BACtFsyB,aAAc,aACdC,UAAW,aACX/e,WAAY,UAGb3E,WAAKwjB,QAOVvrB,OAACnH,GAAIC,GAAI,CACPwH,QAAS,OACTorB,oBAAkD,YAA7B3jB,GAAMoe,cAAczsB,KAAqB,iBAAmB,iBACjF+G,IAAK,EACLb,GAAI,GAGJlH,SAAA,CAAAsH,OAAC0a,GAAM5hB,GAAI,CACTsF,EAAG,IACHiC,aAAc,EACdJ,UAAW,SACX8C,WAAqBL,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAChFgK,eAAgB,YAChBC,OAAiBT,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,mCAAqC,6BACtFO,WAAY,gBACZ,UAAW,CACTsJ,WAAqBL,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAChF2J,UAAW,qBAGbnK,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CACCC,QAAQ,KACRjI,GAAI,CACFoP,WAAY,IACZtH,MAAQmH,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACpDpe,EAAKqgB,aACL,gBAGHzF,aAAc,IAEhB/pB,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,UAAUjI,GAAI,CAChC8H,MAAOmH,GAAMqgB,aAAe5H,GAAgBzY,EAAKqgB,cAAgB1lB,GAASA,EAAMa,QAAQmR,KAAKoV,WAC7FpxB,SAEF,kBAIFsH,EAAAA,KAAC0a,GACC3G,UAAWgU,EACXC,GAAI,YAAYjgB,GAAMnL,qBACtB9D,GAAI,CACFsF,EAAG,IACHiC,aAAc,EACdJ,UAAW,SACX8C,WAAqBL,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAChFgK,eAAgB,YAChBC,OAAS4E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACrD,aAAape,EAAKqgB,iBACT1lB,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,mCAAqC,6BAChF8wB,eAAgB,OAChBvwB,WAAY,gBACZ,UAAW,CACTsJ,WAAqBL,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAChF2J,UAAW,mBACXI,UAAY8E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACxD,cAAcpe,EAAKqgB,iBACnB,+BAIN1vB,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CACCC,QAAQ,KACRjI,GAAI,CACFoP,WAAY,IACZtH,MAAQmH,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACpDpe,EAAKqgB,aACL,gBAGH7F,YAAkB,IAEpB3pB,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,UAAUjI,GAAI,CAChC8H,MAAOmH,GAAMqgB,aAAe5H,GAAgBzY,EAAKqgB,cAAgB1lB,GAASA,EAAMa,QAAQmR,KAAKoV,WAC7FpxB,SAEF,qBAICqP,GAAMoe,cAA2C,YAA3Bpe,EAAKoe,aAAazsB,OACzCsG,EAAAA,KAAC0a,EACC,CAAA3G,UAAWgU,EACXC,GAAI,YAAYjgB,GAAMnL,qBACtB9D,GAAI,CACFsF,EAAG,IACHiC,aAAc,EACdJ,UAAW,SACX8C,WAAqBL,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAChFgK,eAAgB,YAChBC,OAAS4E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACrD,aAAape,EAAKqgB,iBACT1lB,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,mCAAqC,6BAChF8wB,eAAgB,OAChBvwB,WAAY,gBACZ,UAAW,CACTsJ,WAAqBL,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAChF2J,UAAW,mBACXI,UAAY8E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACxD,cAAcpe,EAAKqgB,iBACnB,+BAIN1vB,SAAA,CAACE,EAAAA,IAAAkI,EAAA,CACCC,QAAQ,KACRjI,GAAI,CACFoP,WAAY,IACZtH,MAAQmH,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACpDpe,EAAKqgB,aACL,gBAGH3F,aAAkB,IAEpB7pB,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,UAAUjI,GAAI,CAChC8H,MAAOmH,GAAMqgB,aAAe5H,GAAgBzY,EAAKqgB,cAAgB1lB,GAASA,EAAMa,QAAQmR,KAAKoV,WAC7FpxB,SAEF,qBAMHqP,GAAMoe,cAA2C,YAA3Bpe,EAAKoe,aAAazsB,OACzCsG,EAAAA,KAAC6oB,EAAK,CAAAC,WAAS,EAACrU,QAAS,EAAG3b,GAAI,CAAE8G,GAAI,GAGlClH,SAAA,CAACqP,GAAMoe,cAA2C,YAA3Bpe,EAAKoe,aAAazsB,KAoEzCd,EAAAA,IAACiwB,EAAK,CAAAhC,MAAI,EAACyB,GAAI,EACb5vB,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQC,cAAe,SAAUE,IAAK,GACxD/H,SAAA,CAAAE,EAAAA,IAACkI,EAAW,CAAAC,QAAQ,YAAYH,MAAM,iBAAiB9H,GAAI,CAAE6H,SAAU,UAAWjI,SAElF,eACCE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,QACjBwhB,YAAkB,SAzEzB3pB,EAAAA,IAACiwB,EAAK,CAAAhC,MAAI,EAACyB,GAAI,EACb5vB,SAAAsH,OAACnH,GAAIC,GAAI,CAAEwH,QAAS,OAAQC,cAAe,SAAUE,IAAK,GACxD/H,SAAA,CAAAE,EAAAA,IAACkI,EAAW,CAAAC,QAAQ,YAAYH,MAAM,iBAAiB9H,GAAI,CAAE6H,SAAU,UAAWjI,SAElF,eAGC6qB,GACC3qB,EAAAA,IAAC4I,EAAiB,CAAAC,KAAM,KACtBwhB,IAAWA,GAAQtjB,OAAS,EAC7BK,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQG,IAAK,GAC9BwiB,SAAAA,CAAAA,GAAQ6H,MAAM,EAAG,GAAG3rB,IAAIwsB,GACtB/yB,EAAAA,IAAAwoB,EAAA,CAAwBvI,MAAO8S,EAAOxjB,KAAMkZ,OAAK,EAChD3oB,SAAAE,EAAAA,IAAC+M,EACC,CAAAqC,IAAK2jB,EAAOxC,WACZ3c,IAAKmf,EAAOxjB,KACZ4L,UAAWgU,EACXC,GAAI,YAAY2D,EAAO/uB,WACvB9D,GAAI,CACFoL,MAAO,GACPC,OAAQ,GACRhB,OAAS4E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACrD,aAAape,EAAKqgB,eAClB,oBACFxiB,WAAY,GAEd8W,QAAgB7Q,IAEV8f,EAAO1uB,KACP8U,EAAAA,OAAO/J,IAAM,0BAA0B2jB,EAAO1uB,MAAM0uB,EAAO1jB,OAAS,oBAjBhE0jB,EAAO1uB,KAuBtB8K,GAAM6jB,cAAgB,SACpBxK,EAAQ,CAAAvI,MAAM,4BAA4BwI,OAAK,EAC9C3oB,SAACsH,OAAA2F,EAAA,CACCoO,UAAWgU,EACXC,GAAI,YAAYjgB,GAAMnL,qBACtB9D,GAAI,CACFoL,MAAO,GACPC,OAAQ,GACR/D,QAAU2H,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACtD,GAAGpe,EAAKqgB,iBACR,4BACFznB,SAAU,UACVC,MAAQmH,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACpDpe,EAAKqgB,aACL,UACFxiB,WAAY,GACZlN,SAAA,CAAA,IAEAqP,GAAM6jB,cAAgB,UAM/BhzB,MAAAkI,EAAA,CAAWC,QAAQ,UAAUH,MAAM,iBAAgBlI,SAEpD,yBAmBRE,EAAAA,IAACiwB,GAAKhC,MAAI,EAACyB,GAAI,EACb5vB,SAAAsH,EAAAA,KAACnH,GAAIC,GAAI,CAAEwH,QAAS,OAAQC,cAAe,SAAUE,IAAK,GACxD/H,SAAA,CAAAE,EAAAA,IAACkI,EAAW,CAAAC,QAAQ,YAAYH,MAAM,iBAAiB9H,GAAI,CAAE6H,SAAU,UAAWjI,SAElF,aAGCqP,GAAMoe,cAA2C,YAA3Bpe,EAAKoe,aAAazsB,KACtCd,MAAAkI,EAAA,CAAWC,QAAQ,QACjB0hB,SAAkBA,IAAA,IAGrBY,GACEzqB,EAAAA,IAAC4I,EAAiB,CAAAC,KAAM,KACtBshB,GAAcpjB,OAAS,EACxBK,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQG,IAAK,GAC9BsiB,SAAAA,CAAAA,GAAc+H,MAAM,EAAG,GAAG3rB,IAAIkjB,GAC7BzpB,EAAAA,IAACwoB,EAA2B,CAAAvI,MAAOwJ,EAAUla,KAAMkZ,OAAK,EACtD3oB,SAACE,EAAAA,IAAA+M,EAAA,CACCqC,IAAKqa,EAAU8G,WACf3c,IAAK6V,EAAUla,KACf4L,UAAWgU,EACXC,GAAI,YAAY3F,EAAUzlB,WAC1B9D,GAAI,CACFoL,MAAO,GACPC,OAAQ,GACRhB,OAAS4E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACrD,aAAape,EAAKqgB,eAClB,oBACFxiB,WAAY,GAEd8W,QAAgB7Q,IAEVwW,EAAUplB,KACV8U,EAAAA,OAAO/J,IAAM,0BAA0Bqa,EAAUplB,MAAMolB,EAAUpa,OAAS,oBAjBtEoa,EAAUplB,KAuBzBwlB,GAAiB,GAChB7pB,EAAAA,IAACwoB,EAAQ,CAAAvI,MAAM,gBAAgBwI,OAAK,EAClC3oB,SAACsH,EAAAA,KAAA2F,EAAA,CACCoO,UAAWgU,EACXC,GAAI,YAAYjgB,GAAMnL,qBACtB9D,GAAI,CACFoL,MAAO,GACPC,OAAQ,GACR/D,QAAU2H,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACtD,GAAGpe,EAAKqgB,iBACR,4BACFznB,SAAU,UACVC,MAAQmH,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACpDpe,EAAKqgB,aACL,UACFxiB,WAAY,GACZlN,SAAA,CAAA,IAEA+pB,GAAiB,UAM3B7pB,EAAAA,IAACkI,EAAW,CAAAC,QAAQ,UAAUH,MAAM,iBACjCmH,SAAMoe,GAAAA,cAA2C,YAA3Bpe,EAAKoe,aAAazsB,KAAqB,kBAAoB,uBAU/F+pB,IAAWA,GAAQ9jB,OAAS,GAC3B/G,EAAAA,IAACC,GAAIC,GAAI,CACPwH,QAAS,OACT0oB,SAAU,OACVvoB,IAAK,EACLb,GAAI,EACJiI,GAAI,EACJgN,UAAW,oCAEV4O,SAAAA,GAAQtkB,IAAI,CAAC0sB,EAAQ/rB,IACnBlH,MAAAwoB,EAAA,CAAoBvI,MAAOgT,EAAOhT,OAASgT,EAAO1jB,KAAMkZ,OAAK,EAC5D3oB,SAACE,EAAAA,IAAAyK,EAAA,CACC0Q,UAAU,IACV+X,KAAMD,EAAOE,KAAOF,EAAOG,KAC3Bja,OAAO,SACPka,IAAI,sBACJxqB,KAAK,QACL3I,GAAI,CACF8H,MAAQmH,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACpDpe,EAAKqgB,aACLyD,EAAOjrB,OAAS,eAClBoC,QAAS,EACT5C,QAAS,4BACT,UAAW,CACTA,QAAU2H,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACtD,GAAGpe,EAAKqgB,iBACR,4BACFvlB,UAAW,mBACXpJ,WAAY,mBAIfoyB,SAAAA,EAAOrB,KACN5xB,EAAAA,IAACC,GAAIkb,UAAU,MAAM/L,IAAK6jB,EAAOrB,KAAMhe,IAAKqf,EAAOhT,OAASgT,EAAO1jB,KAAMrP,GAAI,CAAEoL,MAAO,GAAIC,OAAQ,MAElGvL,EAAAA,IAACC,EAAI,CAAAkb,UAAU,MAAMjb,GAAI,CAAEoL,MAAO,GAAIC,OAAQ,GAAIxD,SAAU,GAAIL,QAAS,OAAQE,WAAY,SAAUc,eAAgB,UACpHuqB,SAAO1jB,EAAAA,MAAM6W,cAAc1iB,SAAS,aACnC1D,MAAC,MAAI,CAAA2mB,MAAM,6BAA6Brb,MAAM,KAAKC,OAAO,KAAKkb,QAAQ,YAAYC,KAAK,eAAe5mB,SAACE,EAAAA,IAAA,OAAA,CAAK2B,EAAE,qjCAC/GsxB,EAAO1jB,MAAM6W,cAAc1iB,SAAS,YACpC1D,EAAAA,IAAC,OAAI2mB,MAAM,6BAA6Brb,MAAM,KAAKC,OAAO,KAAKkb,QAAQ,YAAYC,KAAK,eAAe5mB,eAAC,OAAK,CAAA6B,EAAE,+HAC/GsxB,EAAO1jB,MAAM6W,cAAc1iB,SAAS,YAAcuvB,EAAO1jB,MAAM6W,cAAc1iB,SAAS,KACrF1D,EAAAA,IAAA,MAAA,CAAI2mB,MAAM,6BAA6Brb,MAAM,KAAKC,OAAO,KAAKkb,QAAQ,YAAYC,KAAK,eAAe5mB,SAACE,EAAAA,IAAA,OAAA,CAAK2B,EAAE,igBAC/GsxB,EAAO1jB,MAAM6W,cAAc1iB,SAAS,YACnC,MAAI,CAAAijB,MAAM,6BAA6Brb,MAAM,KAAKC,OAAO,KAAKkb,QAAQ,YAAYC,KAAK,eAAe5mB,SAACE,MAAA,OAAA,CAAK2B,EAAE,8nBAC/GsxB,EAAO1jB,MAAM6W,cAAc1iB,SAAS,iBACnC,MAAI,CAAAijB,MAAM,6BAA6Brb,MAAM,KAAKC,OAAO,KAAKkb,QAAQ,YAAYC,KAAK,eAAe5mB,eAAC,OAAK,CAAA6B,EAAE,wPAC/GsxB,EAAO1jB,MAAM6W,cAAc1iB,SAAS,YACpC1D,EAAAA,IAAC,OAAI2mB,MAAM,6BAA6Brb,MAAM,KAAKC,OAAO,KAAKkb,QAAQ,YAAYC,KAAK,eAAe5mB,eAAC,OAAK,CAAA6B,EAAE,2NAC/GsxB,EAAO1jB,MAAM6W,cAAc1iB,SAAS,WACpC0D,EAAAA,KAAC,OAAIuf,MAAM,6BAA6Brb,MAAM,KAAKC,OAAO,KAAKkb,QAAQ,gBAAgBC,KAAK,eAC1F5mB,SAAA,CAACE,EAAAA,IAAA,OAAA,CAAK2B,EAAE,sWACP,SAAO,CAAA2xB,GAAG,YAAYC,GAAG,YAAY9N,EAAE,uBAGzC,MAAI,CAAAkB,MAAM,6BAA6Brb,MAAM,KAAKC,OAAO,KAAKkb,QAAQ,YAAYC,KAAK,eAAe5mB,SAAAE,EAAAA,IAAC,OAAK,CAAA2B,EAAE,ywBA5C3GuF,OAuDlBmoB,MAAmBte,GAAa8H,cAA6C,YAA7B9H,EAAY8H,eAC3D7Y,EAAAA,IAAAC,EAAA,CAAIC,GAAI,CACPwH,QAAS,OACTG,IAAK,EACLb,GAAI,EACJ0B,eAAgB,UAEhB5I,SAACE,MAAAwV,EAAA,CACCrN,QAAQ,YACRH,MAAM,UACNqc,UAAWoF,QAAa+J,GAAgB,UAAOC,EAAgB,CAAA,GAC/D1kB,QA32CChL,UAEnB,GA7KgB2vB,EAACvkB,EAAMhM,EAAiBgoB,OACrChoB,IAAoBgM,KAEvBgc,EAAS,SAAU,CACjBwI,MAAO,CACL1U,KAAM1b,OAAOC,SAASC,SACtBsS,QAAS,2DAGN,GAoKF2d,CAAY3iB,EAAa5N,EAAiBgoB,IAI3C,IACF,MAAMlnB,QAAiBC,EAAMsC,KAAK,sBAAuB,CACvDotB,YAAazkB,EAAK9K,KAGhBJ,EAASG,KAAKkd,UACHrd,EAAAA,EAASG,KAAKwpB,cAC3BhE,MAA0B3lB,EAASG,KAAKwpB,aAAe1kB,EAAO,EAAIA,EAAO,UAEpErG,GAAO,GA61CE+L,WAAS,EACT1O,GAAI,CACFuH,aAAc,EACdH,GAAI,GACJgI,WAAY,OACZ8M,cAAe,OACf/R,UAAY8E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACxD,aAAape,EAAKqgB,iBAClB,sCACFvkB,gBAAiBwe,EACf,2BACCta,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aAC7Cpe,EAAKqgB,aACL,eACJxnB,MAAOyhB,EAAY,eAAiB,OACpC5oB,WAAY,gBACZ,UAAW,CACToK,gBAAiBwe,EACf,4BACCta,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aAC7C,GAAGpe,EAAKqgB,iBACR,eACJvlB,UAAW,mBACXI,UAAY8E,EAAKqgB,cAAgBrgB,EAAKqhB,aAAerhB,EAAKoe,aACxD,cAAcpe,EAAKqgB,iBACnB,uCAEJ,WAAY,CACVvlB,UAAW,kBAIdwf,SAAAA,EAAY,aAAe,2BAUvCta,GAA8B,YAAtBA,EAAK0J,cACZ7Y,EAAAA,IAACC,GAAIC,GAAI,CAAEC,SAAU,WAAY+J,OAAQ,GACvCpK,SAACE,EAAAA,IAAAgX,GAAA,CAAQC,eAAgB9H,EAAK9K,UAOpC+C,OAAC6oB,GAAKhC,MAAI,EAACyB,GAAI,GAAIS,GAAI,EAAGjwB,GAAI,CAAE+O,GAAI,EAAGO,GAAI,CAAEkgB,GAAI,EAAGS,GAAI,OAASloB,GAAI,SAEnEnI,SAAA,CAAAE,MAAC8hB,GAAM5hB,GAAI,CACTuH,aAAc,OACd0C,WAAY,4BACZG,eAAgB,aAChB+L,qBAAsB,aACtBhM,UAAW,gCACXjK,SAAU,SACV6H,GAAI,MACJsC,OAAQ,sCAERzK,SAACsH,EAAAA,KAAAysB,EAAA,CACCvyB,MAAO6nB,EACP5O,SAn7CYuZ,CAAC5uB,EAAO6uB,KAC9B3K,EAAY2K,IAm7CFC,eAAe,UACf7rB,QAAQ,YACRjI,GAAI,CACF,iBAAkB,CAChB8H,MAAgB8B,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,2BAA6B,qBAC7E,iBAAkB,CAChB0H,MAAO8B,GAASA,EAAMa,QAAQC,QAAQC,OAG1C,uBAAwB,CACtBI,gBAAiB,iBAIrBnL,SAAA,CAACE,EAAAA,IAAAi0B,EAAA,CAAIpC,MAAM,UACX7xB,EAAAA,IAACi0B,EAAI,CAAApC,MAAM,UACX7xB,EAAAA,IAACi0B,EAAI,CAAApC,MAAM,wBAKd5M,GAAS,CAAA3jB,MAAO6nB,EAAUjiB,MAAO,EAAGhH,GAAI,CAAEsF,EAAG,EAAGwB,GAAI,GAClDqoB,SAAAA,CACCA,IAAArvB,EAAAA,IAACqc,GAAW,CAAAC,cAAe2Q,WAG5BsC,GAAQ,CAAA,aAGVtK,GAAS,CAAA3jB,MAAO6nB,EAAUjiB,MAAO,EAAGhH,GAAI,CAAEsF,EAAG,EAAGwB,GAAI,GAClD+J,SAAAA,CAAAA,KAAiBA,EAAYwc,cAAkD,YAAlCxc,EAAYwc,aAAazsB,OACpEd,EAAAA,IAAAqc,GAAA,CACCC,cAAe2Q,GACf1Q,SAAS,QACTC,YAAarN,EAAK9K,KAIrBrE,EAAAA,IAAAsvB,GAAA,CAAaxtB,OAAQqN,EAAK9K,cAG5B4gB,GAAS,CAAA3jB,MAAO6nB,EAAUjiB,MAAO,EAAGhH,GAAI,CAAEsF,EAAG,EAAGwB,GAAI,GACnDlH,SAACE,EAAAA,IAAA8hB,EAAA,CAAM5hB,GAAI,CACTsF,EAAG,EACHiC,aAAc,OACd0C,WAAY,4BACZG,eAAgB,aAChB+L,qBAAsB,aACtBhM,UAAW,gCACXE,OAAQ,sCAIRzK,SAACsH,EAAAA,KAAA6oB,EAAA,CAAKC,WAAS,EAACrU,QAAS,EAEvB/b,SAAA,CAAAE,EAAAA,IAACiwB,GAAKhC,MAAI,EAACyB,GAAI,GACb5vB,SAAAsH,EAAAA,KAACnH,GAAIC,GAAI,CAAE+H,GAAI,GAEZkH,SAAAA,CAAAA,GAAMke,cAAgBle,EAAKke,aAAatmB,OAAS,GAChD/G,EAAAA,IAACC,GAAIC,GAAI,CACPwH,QAAS,OACTE,WAAY,SACZc,eAAgB,SAChBT,GAAI,EACJzC,EAAG,EACHiC,aAAc,EACdD,QAAkBsC,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAC7EiK,OAAiBT,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,mCAAqC,8BAEtFR,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,UACtC9H,SAAA,CAACsH,EAAAA,KAAAc,EAAA,CACCiT,UAAWgU,EACXC,GAAI,YAAYjgB,EAAKnL,WACrB9D,GAAI,CACF8H,MAAO,eACPopB,eAAgB,OAChB,UAAW,CACTA,eAAgB,cAElBtxB,SAAA,CAAA,IAEAqP,EAAKnL,YAEThE,MAACkI,GAAWhI,GAAI,CAAEmyB,GAAI,EAAGrqB,MAAO,kBAAmBlI,SAEnD,MACAsH,OAACc,GAAWhI,GAAI,CAAE8H,MAAO,kBACtBmH,SAAAA,CAAKke,EAAAA,aAAa,GAAG6G,KAAK,WAE7Bl0B,MAACkI,GAAWhI,GAAI,CAAEmyB,GAAI,EAAGrqB,MAAO,kBAAmBlI,SAEnD,MACCsH,EAAAA,KAAAc,EAAA,CACCiT,UAAWgU,EACXC,GAAI,YAAYjgB,EAAKke,aAAa,GAAGrpB,WACrC9D,GAAI,CACF8H,MAAO,eACPopB,eAAgB,OAChB,UAAW,CACTA,eAAgB,cAElBtxB,SAAA,CAAA,IAEAqP,EAAKke,aAAa,GAAGrpB,iBAO9BmL,GAAMwjB,OACL3yB,MAACkI,EACC,CAAAC,QAAQ,QACRjI,GAAI,CACF8G,GAAI,EACJ6M,WAAY,IACZ7L,MAAOmH,GAAMqgB,aAAe5H,GAAgBzY,EAAKqgB,cAAgB1lB,GAASA,EAAMa,QAAQmR,KAAKoV,UAC7F1rB,EAAG,IACHiC,aAAc,EACd0C,WAAqBL,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,yBAA2B,mBAChFgK,eAAgB,aAChBC,OAAiBT,GAAuB,SAAvBA,EAAMa,QAAQrK,KAAkB,mCAAqC,6BACtFsyB,aAAc,aACdC,UAAW,aACX/e,WAAY,UAGb3E,WAAKwjB,aAMbxjB,GAAM3L,UACJxD,EAAAA,IAAAiwB,EAAA,CAAKhC,MAAI,EAACyB,GAAI,GAAIC,GAAI,EACrB7vB,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,aAAcC,IAAK,KACzD/H,SAAA,CAACE,EAAAA,IAAA4mB,GAAA,CAAe5e,MAAM,UAAU9H,GAAI,CAAE8G,GAAI,aACzC/G,EACC,CAAAH,SAAA,CAAAE,EAAAA,IAACkI,GAAWC,QAAQ,YAAYH,MAAM,iBAAiBI,cAAY,EAAAtI,SAEnE,mBACCE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,QACjBgH,WAAK3L,mBAOf2L,GAAMglB,SACJn0B,EAAAA,IAAAiwB,EAAA,CAAKhC,MAAI,EAACyB,GAAI,GAAIC,GAAI,EACrB7vB,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,aAAcC,IAAK,KACzD/H,SAAA,CAACE,EAAAA,IAAAo0B,GAAA,CAASpsB,MAAM,UAAU9H,GAAI,CAAE8G,GAAI,aACnC/G,EACC,CAAAH,SAAA,CAAAE,EAAAA,IAACkI,GAAWC,QAAQ,YAAYH,MAAM,iBAAiBI,cAAY,EAAAtI,SAEnE,aACCE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,QAClBrI,SAACE,EAAAA,IAAAmvB,EAAA,CAAK+D,KAAM/jB,EAAKglB,QAAShb,OAAO,SAASka,IAAI,sBAAsBnzB,GAAI,CAAE8H,MAAO,gBAC9EmH,SAAKglB,EAAAA,QAAQ9N,QAAQ,eAAgB,gBAQjDlX,GAAMklB,UACJr0B,EAAAA,IAAAiwB,EAAA,CAAKhC,MAAI,EAACyB,GAAI,GAAIC,GAAI,EACrB7vB,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,aAAcC,IAAK,KACzD/H,SAAA,CAACE,EAAAA,IAAA6mB,GAAA,CAAS7e,MAAM,UAAU9H,GAAI,CAAE8G,GAAI,aACnC/G,EACC,CAAAH,SAAA,CAAAE,EAAAA,IAACkI,GAAWC,QAAQ,YAAYH,MAAM,iBAAiBI,cAAY,EAAAtI,SAEnE,wBACCoI,EAAW,CAAAC,QAAQ,QACjBmsB,SAAWnlB,EAAAA,EAAKklB,oBAO3Br0B,EAAAA,IAACiwB,EAAK,CAAAhC,MAAI,EAACyB,GAAI,GAAIC,GAAI,EACrB7vB,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,aAAcC,IAAK,KACzD/H,SAAA,CAACE,EAAAA,IAAAu0B,GAAA,CAAUvsB,MAAM,UAAU9H,GAAI,CAAE8G,GAAI,aACpC/G,EACC,CAAAH,SAAA,CAAAE,EAAAA,IAACkI,GAAWC,QAAQ,YAAYH,MAAM,iBAAiBI,cAAY,EAAAtI,SAEnE,qBACCE,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,QACjBgH,SAAMqlB,GAAAA,kBAAoB,IAAIjnB,KAAK4B,EAAKqlB,mBAAmBjM,mBAAmB,QAAS,CACtFra,KAAM,UACND,MAAO,OACPD,IAAK,YACF,uBAMZmB,GAAMslB,qBAAuBtlB,EAAKslB,oBAAoB1tB,OAAS,GAC9D/G,EAAAA,IAACiwB,EAAK,CAAAhC,MAAI,EAACyB,GAAI,GACb5vB,SAAAsH,OAACnH,GAAIC,GAAI,CAAEwH,QAAS,OAAQE,WAAY,aAAcC,IAAK,KACzD/H,SAAA,CAACE,EAAAA,IAAA00B,EAAA,CAAmB1sB,MAAM,UAAU9H,GAAI,CAAE8G,GAAI,aAC7C/G,EACC,CAAAH,SAAA,CAAAE,EAAAA,IAACkI,GAAWC,QAAQ,YAAYH,MAAM,iBAAiBI,cAAY,EAAAtI,SAEnE,cACAE,MAACC,GAAIC,GAAI,CAAEwH,QAAS,OAAQ0oB,SAAU,OAAQvoB,IAAK,GAEhDsH,SAAAA,EAAKslB,oBAAoBluB,IAAI,CAACouB,EAAa/e,IAC1C5V,EAAAA,IAAC2xB,EAEC,CAAAE,MAAO8C,EAAY3wB,SACnB6E,KAAK,QACLV,QAASwsB,EAAYzG,UAAY,SAAW,WAC5ClmB,MAAO2sB,EAAYzG,UAAY,UAAY,UAC3Cnf,QAAUkE,GAAM+b,GAAoB/b,EAAG0hB,EAAY3wB,UACnD9D,GAAI,CACF,mBAAoB,CAClBqH,GAAI,KARHqO,cAoBlBqW,IAAUA,GAAOllB,OAAS,GACxB/G,EAAAA,IAAAiwB,EAAA,CAAKhC,MAAI,EAACyB,GAAI,GACb5vB,SAACsH,EAAAA,KAAAnH,EAAA,CAAIC,GAAI,CACPwH,QAAS,OACTE,WAAY,aACZC,IAAK,IACL4nB,GAAI,EACJmF,aAAc,oCAEd90B,SAAA,CAACE,EAAAA,IAAA60B,EAAA,CAAgB7sB,MAAM,UAAU9H,GAAI,CAAE8G,GAAI,aAC1C/G,EACC,CAAAH,SAAA,CAAAE,EAAAA,IAACkI,GAAWC,QAAQ,YAAYH,MAAM,iBAAiBI,cAAY,EAAAtI,SAEnE,WACAE,MAACC,GAAIC,GAAI,CAAEwH,QAAS,OAAQ0oB,SAAU,OAAQvoB,IAAK,EAAGb,GAAI,GACvDilB,YAAO1lB,IAAKuuB,SACVtM,EAEC,CAAAvI,aACGhgB,EACE60B,CAAAA,SAAAA,CAAAA,EAAMC,aACJ/0B,EAAAA,IAAAkI,EAAA,CAAWC,QAAQ,UAAW2sB,WAAMC,qBAEtC7sB,EAAW,CAAAC,QAAQ,UAAUT,QAAQ,QAAQxH,GAAI,CAAE8G,GAAI,GAAKtG,QAAS,IAAMZ,SAAA,CAAA,WACjE,IAAIyN,KAAKunB,EAAME,YAAYzM,+BAErCrgB,EAAW,CAAAC,QAAQ,UAAUT,QAAQ,QAAQxH,GAAI,CAAEQ,QAAS,IAAMZ,SAAA,CAAA,SAC1Dg1B,EAAMG,iBAInBxM,OAAK,EAEL3oB,SAACE,EAAAA,IAAA,MAAA,CACCoP,IAAK0lB,EAAM/D,WACXnd,IAAKkhB,EAAMvlB,KACX2E,MAAO,CACL5I,MAAO,IACPC,OAAQ,IACR2B,OAAQ,UACRrM,WAAY,iBACZ6F,OAAQ,0CAEVwuB,YAAoBjiB,IAChBE,EAAAA,cAAce,MAAMjK,UAAY,mBAChCkJ,EAAAA,cAAce,MAAMxN,OAAS,0CAEjCyuB,WAAmBliB,IACfE,EAAAA,cAAce,MAAMjK,UAAY,gBAChCkJ,EAAAA,cAAce,MAAMxN,OAAS,6CAhC9BouB,EAAMzwB,4BAiDlC0mB,IACE3jB,EAAAA,KAAA,MAAA,CACC8M,MAAO,CACL/T,SAAU,QACV4K,IAAK,EACLhB,KAAM,EACNiB,MAAO,EACPhB,OAAQ,EACRiB,gBAAiB,qBACjBvD,QAAS,OACTE,WAAY,SACZc,eAAgB,SAChBwB,OAAQ,MAEV6E,QAASge,GAETjtB,SAAA,CAAAE,EAAAA,IAAC,MACC,CAAAoP,IAAK6b,GACLrX,IAAI,YACJM,MAAO,CACL7L,SAAU,MACVqD,UAAW,MACXe,UAAW,WAEbsC,QAAgBkE,GAAAA,EAAEU,oBAEpB3T,MAACyK,GACCvK,GAAI,CACFC,SAAU,WACV4K,IAAK,GACLC,MAAO,GACPhD,MAAO,QACPiD,gBAAiB,qBACjB,UAAW,CACTA,gBAAiB,uBAGrB8D,QAASge,GAETjtB,SAAAE,EAAAA,IAACgP,YAKPhP,EAAAA,IAAC2kB,GACCtW,KAAM0P,GAAS1P,KACfuW,iBAAkB,IAClBtW,QAAS0e,GACTnI,aAAc,CAAEC,SAAU,SAAUC,WAAY,UAEhDjlB,SAAAE,EAAAA,IAACgiB,EACC,CAAA1T,QAAS0e,GACT/O,SAAUF,GAASE,SACnB9V,QAAQ,SAEP4V,SAAShI,GAAAA,YAGd/V,EAAAA,IAACK,EACEgsB,CAAAA,SAAAA,IACErsB,EAAAA,IAAAo1B,EAAA,CACCpxB,SAAUqoB,GACV/d,QA37CsB+mB,KAC9B3I,IAAoB,IA27CZre,KAAMoe","x_google_ignoreList":[2,3,6]}