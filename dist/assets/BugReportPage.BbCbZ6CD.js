import{r as U,a as E,j as e,h as O,s as p,G as i,T as l,P as j,m as k,l as x,o as V,i as o,q as g,w as Y,k as J,V as re}from"./vendor-mui.08p3AH88.js";import{r as m}from"./vendor-router.BRqU_Zs2.js";import{r as K,A as le,b as oe,E as ce}from"./index.CdVNWeFt.js";import{a as f}from"./vendor.CL98q8z6.js";import{B as de}from"./BugReport.CJI6Qv1X.js";import{S as N}from"./Send.DjUSpM3V.js";import{P as me}from"./PhotoCamera.GVaun1S8.js";import{g as Q}from"./vendor-react.DF-_cTkv.js";import{T as X}from"./ThumbUpOutlined.Dgqwey59.js";var Z,y={};function xe(){if(Z)return y;Z=1;var t=U();Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;var c=t(K()),u=E();return y.default=(0,c.default)((0,u.jsx)("path",{d:"M1 21h4V9H1zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73z"}),"ThumbUp"),y}const ee=Q(xe());var se,_={};function ue(){if(se)return _;se=1;var t=U();Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var c=t(K()),u=E();return _.default=(0,c.default)((0,u.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M7 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"Pending"),_}const I=Q(ue()),te=p(o)(({theme:t})=>({marginTop:t.spacing(4),marginBottom:t.spacing(8)})),he=p(j)(({theme:t})=>({padding:t.spacing(3),marginBottom:t.spacing(4),backgroundColor:t.palette.mode==="dark"?"#1A1A1A":"#f8f8f8",borderRadius:t.shape.borderRadius})),pe=p(j)(({theme:t})=>({padding:t.spacing(3),marginBottom:t.spacing(2),transition:"transform 0.2s",cursor:"pointer","&:hover":{transform:"translateY(-4px)",boxShadow:t.shadows[4]}})),je=p(j)(({theme:t})=>({padding:t.spacing(3),marginBottom:t.spacing(3)})),ge=p(j)(({theme:t})=>({padding:t.spacing(2),marginTop:t.spacing(1),marginBottom:t.spacing(1),backgroundColor:t.palette.mode==="dark"?"#222":"#f0f0f0"})),fe=p("img")(({theme:t})=>({maxWidth:"100%",maxHeight:"200px",borderRadius:t.shape.borderRadius,marginTop:t.spacing(1)})),B=t=>{const c=new Date(t);return new Intl.DateTimeFormat("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).format(c)},ae=({status:t})=>t&&t!=="\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E"?t==="\u0420\u0435\u0448\u0435\u043D\u043E"?e.jsx(g,{icon:e.jsx(oe,{}),label:t,color:"success",sx:{fontWeight:"bold"},size:"small"}):t==="\u0412 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0435"?e.jsx(g,{icon:e.jsx(I,{}),label:t,color:"primary",sx:{fontWeight:"bold"},size:"small"}):t==="\u041E\u0442\u043A\u0440\u044B\u0442"?e.jsx(g,{icon:e.jsx(ce,{}),label:t,color:"error",sx:{fontWeight:"bold"},size:"small"}):e.jsx(g,{icon:e.jsx(I,{}),label:"\u041E\u0442\u043A\u0440\u044B\u0442",color:"error",sx:{fontWeight:"bold"},size:"small"}):e.jsx(g,{icon:e.jsx(I,{}),label:"\u041E\u0442\u043A\u0440\u044B\u0442",color:"error",sx:{fontWeight:"bold"},size:"small"}),be=()=>{const{user:t,isAuthenticated:c}=m.useContext(le),[u,w]=m.useState([]),[n,b]=m.useState(null),[ne,P]=m.useState(!0),[v,T]=m.useState(""),[R,$]=m.useState(null),[A,D]=m.useState(""),[h,L]=m.useState({subject:"",text:"",site_link:"k-connect.ru"}),[M,G]=m.useState(!1),[q,C]=m.useState("");m.useEffect(()=>{F()},[]);const F=async()=>{P(!0);try{const s=await f.get("/api/bugs");w(s.data.bugs||[])}catch{C("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0431\u0430\u0433-\u0440\u0435\u043F\u043E\u0440\u0442\u044B")}finally{P(!1)}},S=s=>{const{name:a,value:r}=s.target;L(d=>({...d,[a]:r}))},H=async s=>{if(c)try{const a=await f.post(`/api/bugs/${s}/reaction`);a.data.success&&(w(r=>r.map(d=>d.id===s?{...d,is_liked_by_user:a.data.reaction==="added",likes_count:a.data.reaction==="added"?d.likes_count+1:d.likes_count-1}:d)),n&&n.id===s&&b(r=>({...r,is_liked_by_user:a.data.reaction==="added",likes_count:a.data.reaction==="added"?r.likes_count+1:r.likes_count-1})))}catch{}},W=async(s,a)=>{if(c&&[3,54,57].includes(t?.id))try{const r=await f.post(`/api/bugs/${s}/status`,{status:a});r.data.success&&(b(d=>({...d,status:r.data.status})),w(d=>d.map(z=>z.id===s?{...z,status:r.data.status}:z)))}catch{}},ie=c&&t&&[3,54,57].includes(t.id);return n?e.jsx(O,{maxWidth:"md",children:e.jsxs(te,{children:[e.jsx(x,{variant:"outlined",onClick:()=>b(null),sx:{mb:2},children:"\u041D\u0430\u0437\u0430\u0434 \u043A \u0441\u043F\u0438\u0441\u043A\u0443"}),e.jsx(je,{children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:12,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{variant:"h5",component:"h1",children:n.subject}),e.jsx(ae,{status:n.status})]}),e.jsx(i,{item:!0,xs:12,children:e.jsx(l,{variant:"body1",children:n.text})}),n.image_url&&e.jsx(i,{item:!0,xs:12,children:e.jsx(o,{component:"img",src:`https://${window.location.hostname}${n.image_url}`,alt:"Bug report",sx:{maxWidth:"100%",maxHeight:"300px",borderRadius:1,cursor:"pointer"},onClick:()=>window.open(`https://${window.location.hostname}${n.image_url}`,"_blank")})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(o,{children:[e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(J,{src:n.user_avatar,alt:n.user_name||"\u0413\u043E\u0441\u0442\u044C",sx:{width:24,height:24,mr:1},children:n.user_name?n.user_name[0]:"G"}),e.jsx(l,{variant:"body2",children:n.user_name||"\u0413\u043E\u0441\u0442\u044C"})]}),e.jsx(l,{variant:"caption",color:"textSecondary",children:B(n.date)})]}),e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(Y,{size:"small",onClick:()=>H(n.id),color:n.is_liked_by_user?"primary":"default",disabled:!c,children:n.is_liked_by_user?e.jsx(ee,{}):e.jsx(X,{})}),e.jsx(l,{variant:"body2",sx:{ml:.5},children:n.likes_count||0})]})]})}),ie&&e.jsxs(i,{item:!0,xs:12,children:[e.jsx(re,{sx:{my:1}}),e.jsxs(o,{display:"flex",gap:1,children:[e.jsx(x,{size:"small",variant:"outlined",color:"success",onClick:()=>W(n.id,"\u0420\u0435\u0448\u0435\u043D\u043E"),children:"\u0420\u0435\u0448\u0435\u043D\u043E"}),e.jsx(x,{size:"small",variant:"outlined",color:"primary",onClick:()=>W(n.id,"\u0412 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0435"),children:"\u0412 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0435"}),e.jsx(x,{size:"small",variant:"outlined",color:"error",onClick:()=>W(n.id,"\u041E\u0442\u043A\u0440\u044B\u0442"),children:"\u041E\u0442\u043A\u0440\u044B\u0442"})]})]})]})}),e.jsxs(l,{variant:"h6",component:"h2",sx:{mt:4,mb:2},children:["\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 (",n.comments?.length||0,")"]}),n.comments?.length>0?n.comments.map(s=>e.jsx(ge,{children:e.jsxs(o,{display:"flex",alignItems:"flex-start",children:[e.jsx(J,{src:s.user_avatar,alt:s.user_name||"\u0413\u043E\u0441\u0442\u044C",sx:{width:32,height:32,mr:2},children:s.user_name?s.user_name[0]:"G"}),e.jsxs(o,{flex:1,children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",children:[e.jsx(l,{variant:"subtitle2",children:s.user_name||"\u0413\u043E\u0441\u0442\u044C"}),e.jsx(l,{variant:"caption",color:"textSecondary",children:B(s.timestamp)})]}),e.jsx(l,{variant:"body2",children:s.comment_text})]})]})},s.id)):e.jsx(l,{align:"center",color:"textSecondary",my:2,children:"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442"}),e.jsxs(j,{sx:{padding:2,mt:2},children:[e.jsx(k,{fullWidth:!0,placeholder:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439...",multiline:!0,rows:2,value:v,onChange:s=>T(s.target.value),inputProps:{maxLength:500}}),e.jsx(o,{display:"flex",justifyContent:"flex-end",mt:1,children:e.jsx(x,{variant:"contained",endIcon:e.jsx(N,{}),onClick:async()=>{if(v.trim())try{const s=await f.post(`/api/bugs/${n.id}/comments`,{comment_text:v});s.data.success&&(b(a=>({...a,comments:[...a.comments,s.data.comment]})),T(""))}catch{}},disabled:!v.trim(),children:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C"})})]})]})}):e.jsx(O,{maxWidth:"md",children:e.jsxs(te,{children:[e.jsx(he,{elevation:0,children:e.jsxs(i,{container:!0,alignItems:"center",spacing:2,children:[e.jsx(i,{item:!0,children:e.jsx(de,{fontSize:"large",color:"error"})}),e.jsxs(i,{item:!0,xs:!0,children:[e.jsx(l,{variant:"h4",component:"h1",fontWeight:"bold",children:"\u0411\u0430\u0433-\u0440\u0435\u043F\u043E\u0440\u0442\u044B"}),e.jsx(l,{variant:"body1",color:"textSecondary",children:"\u0421\u043E\u043E\u0431\u0449\u0438\u0442\u0435 \u043E \u043D\u0430\u0439\u0434\u0435\u043D\u043D\u044B\u0445 \u043E\u0448\u0438\u0431\u043A\u0430\u0445 \u0438 \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0430\u0445 \u043D\u0430 \u0441\u0430\u0439\u0442\u0435"})]})]})}),e.jsxs(j,{sx:{padding:3,marginBottom:4},children:[e.jsx(l,{variant:"h6",component:"h2",gutterBottom:!0,children:"\u0421\u043E\u043E\u0431\u0449\u0438\u0442\u044C \u043E \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0435"}),e.jsx("form",{onSubmit:async s=>{s.preventDefault(),G(!0),C("");try{const a=new FormData;a.append("subject",h.subject),a.append("text",h.text),a.append("site_link",h.site_link),R&&a.append("image",R),(await f.post("/api/bugs",a,{headers:{"Content-Type":"multipart/form-data"}})).data.success&&(L({subject:"",text:"",site_link:"k-connect.ru"}),$(null),D(""),F())}catch(a){C(a.response?.data?.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0431\u0430\u0433-\u0440\u0435\u043F\u043E\u0440\u0442\u0430")}finally{G(!1)}},children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(k,{name:"subject",label:"\u0417\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",fullWidth:!0,required:!0,value:h.subject,onChange:S,inputProps:{maxLength:40},helperText:"\u0414\u043E 40 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(k,{name:"text",label:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",fullWidth:!0,required:!0,multiline:!0,rows:4,value:h.text,onChange:S,inputProps:{maxLength:700},helperText:"\u0414\u043E 700 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(k,{name:"site_link",label:"\u0421\u0430\u0439\u0442",select:!0,fullWidth:!0,value:h.site_link,onChange:S,SelectProps:{native:!0},children:[e.jsx("option",{value:"k-connect.ru",children:"\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442"}),e.jsx("option",{value:"elemsocial.com",children:"\u042D\u043B\u0435\u043C\u0435\u043D\u0442"}),e.jsx("option",{value:"clientelement.sault",children:"\u041A\u043B\u0438\u0435\u043D\u0442 \u042D\u043B\u0435\u043C\u0435\u043D\u0442\u0430"})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(x,{component:"label",variant:"outlined",startIcon:e.jsx(me,{}),fullWidth:!0,children:["\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u043E\u0442\u043E",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:s=>{const a=s.target.files[0];if(a){$(a);const r=new FileReader;r.onloadend=()=>{typeof r.result=="string"&&D(r.result)},r.readAsDataURL(a)}}})]})}),A&&e.jsx(i,{item:!0,xs:12,children:e.jsx(fe,{src:A,alt:"Preview"})}),q&&e.jsx(i,{item:!0,xs:12,children:e.jsx(l,{color:"error",children:q})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(x,{type:"submit",variant:"contained",color:"primary",disabled:M,startIcon:M?e.jsx(V,{size:20,color:"inherit"}):e.jsx(N,{}),children:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C"})})]})})]}),e.jsx(l,{variant:"h6",component:"h2",gutterBottom:!0,children:"\u0421\u043F\u0438\u0441\u043E\u043A \u043F\u0440\u043E\u0431\u043B\u0435\u043C"}),ne?e.jsx(o,{display:"flex",justifyContent:"center",my:4,children:e.jsx(V,{})}):u.length===0?e.jsx(l,{align:"center",color:"textSecondary",my:4,children:"\u0411\u0430\u0433-\u0440\u0435\u043F\u043E\u0440\u0442\u043E\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442"}):u.map(s=>e.jsx(pe,{onClick:()=>(async a=>{try{const r=await f.get(`/api/bugs/${a}`);b(r.data.bug)}catch{}})(s.id),children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:12,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{variant:"h6",component:"h3",noWrap:!0,children:s.subject}),e.jsx(ae,{status:s.status})]}),e.jsx(i,{item:!0,xs:12,children:e.jsx(l,{variant:"body2",color:"textSecondary",noWrap:!0,children:s.text})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsxs(l,{variant:"caption",color:"textSecondary",children:[s.user_name||"\u0413\u043E\u0441\u0442\u044C"," \u2022 ",B(s.date)]}),e.jsx(g,{size:"small",label:s.site_link,sx:{ml:1,fontSize:"0.7rem"}})]}),e.jsxs(o,{display:"flex",alignItems:"center",children:[e.jsx(Y,{size:"small",onClick:a=>{a.stopPropagation(),H(s.id)},color:s.is_liked_by_user?"primary":"default",disabled:!c,children:s.is_liked_by_user?e.jsx(ee,{}):e.jsx(X,{})}),e.jsx(l,{variant:"body2",sx:{ml:.5},children:s.likes_count||0})]})]})})]})},s.id))]})})};export{be as default};
