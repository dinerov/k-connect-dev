import{j as e,a3 as ce,w as B,aX as xt,aY as bt,b6 as vt,b0 as yt,ak as _t,g as de,T as D,af as ve,A as ie,i as v,z as Ee,b as ue,o as Ae,l as ee,b7 as jt,b8 as Oe,b9 as Ct,m as wt,ba as kt,a6 as St,a8 as Le,aZ as Mt,aN as Tt,aM as Nt,D as $t,H as Et,O as At,Q as Ot,a7 as Lt,k as zt,U as Rt,s as ze,P as Dt,bb as Bt}from"./vendor-mui.08p3AH88.js";import{r as o,u as Re,a as Q}from"./vendor-router.BRqU_Zs2.js";import{u as re,T as Pt}from"./index.CdVNWeFt.js";import{K as It}from"./KeyboardArrowDown.Cwa-wUfu.js";import{M as ye}from"./MusicNote.D4Jp3FIY.js";import{E as De}from"./Edit.6-hI7nty.js";import{Q as Be}from"./QueueMusic.Dom8AGTx.js";import{P as Ft}from"./PlayArrow.GqmCGL4o.js";import{a as Pe}from"./vendor.CL98q8z6.js";import{e as Ie,a as Wt}from"./imageUtils.BkCfy0de.js";const qt=({cover:t,dominantColor:r})=>{const n=r?`rgb(${r.r}, ${r.g}, ${r.b})`:"rgb(25, 20, 20)";return e.jsxs("div",{className:"_container_19ubi_1",children:[e.jsx("div",{className:"_baseBackground_19ubi_14",style:{backgroundColor:n}}),t&&e.jsxs("div",{className:"_imageContainer_19ubi_25",children:[e.jsx("div",{className:"_imageLayer_19ubi_37",style:{backgroundImage:`url(${t})`}}),e.jsx("div",{className:"_imageOverlay_19ubi_51",style:{backgroundImage:`linear-gradient(
    to bottom,
    rgba(0, 0, 0, 0.5) 0%,
    rgba(0, 0, 0, 0.7) 100%
  )`}})]}),e.jsx("div",{className:"_glassOverlay_19ubi_60"})]})},Z={container:"_container_vj488_1",leftControls:"_leftControls_vj488_25",rightControls:"_rightControls_vj488_25",controlButton:"_controlButton_vj488_31"},Ht=o.memo(({onClose:t,onToggleLyrics:r,onOpenLyricsEditor:n,showLyrics:i,showLyricsEditor:s,dominantColor:a})=>{const[c,l]=o.useState(!1),{currentTrack:d}=re(),p=o.useCallback(()=>{if(!d)return;const h=`${window.location.origin}/music?track=${d.id}`;navigator.clipboard.writeText(h).then(()=>{l(!0),setTimeout(()=>l(!1),2e3)}).catch(f=>{})},[d]),x=h=>h?a?`rgb(${a})`:"#d0bcff":"rgba(255, 255, 255, 0.9)";return e.jsxs("div",{className:Z.container,children:[e.jsxs("div",{className:Z.leftControls,children:[e.jsx(ce,{title:c?"\u0421\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u043E!":"\u041F\u043E\u0434\u0435\u043B\u0438\u0442\u044C\u0441\u044F",children:e.jsx(B,{onClick:p,className:`${Z.controlButton} apple-music-btn`,children:c?e.jsx(xt,{fontSize:"small"}):e.jsx(bt,{fontSize:"small"})})}),e.jsx(ce,{title:i?"\u0421\u043A\u0440\u044B\u0442\u044C \u0442\u0435\u043A\u0441\u0442":"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0442\u0435\u043A\u0441\u0442",children:e.jsx(B,{onClick:r,className:`${Z.controlButton} apple-music-btn ${i?Z.active:""}`,style:{color:x(i)},children:e.jsx(vt,{fontSize:"small"})})})]}),e.jsxs("div",{className:Z.rightControls,children:[e.jsx(ce,{title:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0442\u0435\u043A\u0441\u0442",children:e.jsx(B,{onClick:n,className:`${Z.controlButton} apple-music-btn ${s?Z.active:""}`,style:{color:x(s)},children:e.jsx(yt,{fontSize:"small"})})}),e.jsx(ce,{title:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C",children:e.jsx(B,{onClick:t,className:`${Z.controlButton} apple-music-btn`,children:e.jsx(_t,{fontSize:"small"})})})]})]})}),W={container:"_container_19ceu_1",coverArtContainer:"_coverArtContainer_19ceu_14",playing:"_playing_19ceu_29",coverArt:"_coverArt_19ceu_14",trackInfo:"_trackInfo_19ceu_55",trackTitle:"_trackTitle_19ceu_66",trackDetails:"_trackDetails_19ceu_85",artistsContainer:"_artistsContainer_19ceu_98",artistName:"_artistName_19ceu_106",clickable:"_clickable_19ceu_109",artistSeparator:"_artistSeparator_19ceu_126",separator:"_separator_19ceu_131",albumName:"_albumName_19ceu_136",desktopContainer:"_desktopContainer_19ceu_170"},Fe=o.memo(({track:t,dominantColor:r})=>{const{isPlaying:n}=re(),i=Re(),s=de("(min-width:960px)"),[a,c]=o.useState({open:!1,message:"",severity:"info"}),l=()=>{c(d=>({...d,open:!1}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${W.container} ${s?W.desktopContainer:""}`,children:[e.jsx("div",{className:`${W.coverArtContainer} ${n?W.playing:""}`,style:{boxShadow:r?`0 10px 30px rgba(${r.r}, ${r.g}, ${r.b}, 0.3), 0 30px 60px rgba(0,0,0,0.4)`:"0 10px 30px rgba(0,0,0,0.3), 0 30px 60px rgba(0,0,0,0.4)"},children:e.jsx("img",{src:t.cover_path||"/static/uploads/system/album_placeholder.jpg",alt:t.title,className:W.coverArt})}),e.jsxs("div",{className:`${W.trackInfo} ${s?W.desktopTrackInfo:""}`,children:[e.jsx(D,{variant:"h1",className:W.trackTitle,sx:{fontWeight:700,letterSpacing:"-0.02em",textShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:t.title}),e.jsxs("div",{className:W.trackDetails,children:[(()=>{if(!t.artist)return e.jsx("span",{className:W.artistName,children:"Unknown Artist"});const d=t.artist.split(",");return e.jsx(v,{className:W.artistsContainer,children:d.map((p,x)=>e.jsxs(Q.Fragment,{children:[e.jsx("span",{className:`${W.artistName} ${W.clickable}`,onClick:()=>(async h=>{if(h&&h.trim()!==""){h=h.trim();try{const f=await Pe.get(`/api/search/artists?query=${encodeURIComponent(h)}`);if(f.data&&f.data.artists&&f.data.artists.length>0){const b=f.data.artists.find(y=>y.name.toLowerCase()===h.toLowerCase());if(b)return void i(`/artist/${b.id}`);i(`/artist/${f.data.artists[0].id}`)}else c({open:!0,message:`\u0410\u0440\u0442\u0438\u0441\u0442 "${h}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`,severity:"warning"})}catch{c({open:!0,message:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435 \u0430\u0440\u0442\u0438\u0441\u0442\u0430",severity:"error"})}}})(p),title:`View artist: ${p.trim()}`,style:{color:"rgba(255, 255, 255, 0.8)","&:hover":{color:r?`rgb(${r.r}, ${r.g}, ${r.b})`:"white"}},children:p.trim()}),x<d.length-1&&e.jsx("span",{className:W.artistSeparator,children:", "})]},x))})})(),t.album&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:W.separator,children:"\u2022"}),e.jsx("span",{className:W.albumName,children:t.album})]})]})]})]}),e.jsx(ve,{open:a.open,autoHideDuration:4e3,onClose:l,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ie,{onClose:l,severity:a.severity,sx:{width:"100%",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:a.message})})]})});var We={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},qe=Q.createContext&&Q.createContext(We),Ut=["attr","size","title"];function he(){return he=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},he.apply(this,arguments)}function He(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);r&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,i)}return n}function pe(t){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?He(Object(n),!0).forEach(function(i){var s,a,c,l;s=t,a=i,c=n[i],(a=typeof(l=function(d,p){if(typeof d!="object"||!d)return d;var x=d[Symbol.toPrimitive];if(x!==void 0){var h=x.call(d,p);if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a,"string"))=="symbol"?l:l+"")in s?Object.defineProperty(s,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):s[a]=c}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Ue(t){return t&&t.map((r,n)=>Q.createElement(r.tag,pe({key:n},r.attr),Ue(r.child)))}function H(t){return r=>Q.createElement(Vt,he({attr:pe({},t.attr)},r),Ue(t.child))}function Vt(t){var r=n=>{var i,{attr:s,size:a,title:c}=t,l=function(p,x){if(p==null)return{};var h,f,b=function(k,T){if(k==null)return{};var E={};for(var P in k)if(Object.prototype.hasOwnProperty.call(k,P)){if(T.indexOf(P)>=0)continue;E[P]=k[P]}return E}(p,x);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(p);for(f=0;f<y.length;f++)h=y[f],x.indexOf(h)>=0||Object.prototype.propertyIsEnumerable.call(p,h)&&(b[h]=p[h])}return b}(t,Ut),d=a||n.size||"1em";return n.className&&(i=n.className),t.className&&(i=(i?i+" ":"")+t.className),Q.createElement("svg",he({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,l,{className:i,style:pe(pe({color:t.color||n.color},n.style),t.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),c&&Q.createElement("title",null,c),t.children)};return qe!==void 0?Q.createElement(qe.Consumer,null,n=>r(n)):r(We)}function Gt(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"48",d:"m112 184 144 144 144-144"},child:[]}]})(t)}function Yt(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"48",d:"m112 328 144-144 144 144"},child:[]}]})(t)}function _e(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M352.92 80C288 80 256 144 256 144s-32-64-96.92-64c-52.76 0-94.54 44.14-95.08 96.81-1.1 109.33 86.73 187.08 183 252.42a16 16 0 0 0 18 0c96.26-65.34 184.09-143.09 183-252.42-.54-52.67-42.32-96.81-95.08-96.81z"},child:[]}]})(t)}function je(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 448a32 32 0 0 1-18-5.57c-78.59-53.35-112.62-89.93-131.39-112.8-40-48.75-59.15-98.8-58.61-153C48.63 114.52 98.46 64 159.08 64c44.08 0 74.61 24.83 92.39 45.51a6 6 0 0 0 9.06 0C278.31 88.81 308.84 64 352.92 64c60.62 0 110.45 50.52 111.08 112.64.54 54.21-18.63 104.26-58.61 153-18.77 22.87-52.8 59.45-131.39 112.8a32 32 0 0 1-18 5.56z"},child:[]}]})(t)}function Ce(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208 208-93.31 208-208S370.69 48 256 48zm-32 272a16 16 0 0 1-32 0V192a16 16 0 0 1 32 0zm96 0a16 16 0 0 1-32 0V192a16 16 0 0 1 32 0z"},child:[]}]})(t)}function we(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208 208-93.31 208-208S370.69 48 256 48zm74.77 217.3-114.45 69.14a10.78 10.78 0 0 1-16.32-9.31V186.87a10.78 10.78 0 0 1 16.32-9.31l114.45 69.14a10.89 10.89 0 0 1 0 18.6z"},child:[]}]})(t)}function Ve(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M112 64a16 16 0 0 1 16 16v136.43L360.77 77.11a35.13 35.13 0 0 1 35.77-.44c12 6.8 19.46 20 19.46 34.33v290c0 14.37-7.46 27.53-19.46 34.33a35.14 35.14 0 0 1-35.77-.45L128 295.57V432a16 16 0 0 1-32 0V80a16 16 0 0 1 16-16z"},child:[]}]})(t)}function Ge(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M400 64a16 16 0 0 0-16 16v136.43L151.23 77.11a35.13 35.13 0 0 0-35.77-.44C103.46 83.47 96 96.63 96 111v290c0 14.37 7.46 27.53 19.46 34.33a35.14 35.14 0 0 0 35.77-.45L384 295.57V432a16 16 0 0 0 32 0V80a16 16 0 0 0-16-16z"},child:[]}]})(t)}function Ye(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"m320 120 48 48-48 48"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M352 168H144a80.24 80.24 0 0 0-80 80v16m128 128-48-48 48-48"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M160 344h208a80.24 80.24 0 0 0 80-80v-16"},child:[]}]})(t)}function Ke(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"m320 120 48 48-48 48"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M352 168H144a80.24 80.24 0 0 0-80 80v16m128 128-48-48 48-48"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M160 344h208a80.24 80.24 0 0 0 80-80v-16"},child:[]}]})(t)}function Kt(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M384 336a63.78 63.78 0 0 0-46.12 19.7l-148-83.27a63.85 63.85 0 0 0 0-32.86l148-83.27a63.8 63.8 0 1 0-15.73-27.87l-148 83.27a64 64 0 1 0 0 88.6l148 83.27A64 64 0 1 0 384 336z"},child:[]}]})(t)}function Je(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"m400 304 48 48-48 48m0-288 48 48-48 48M64 352h85.19a80 80 0 0 0 66.56-35.62L256 256"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M64 160h85.19a80 80 0 0 1 66.56 35.62l80.5 120.76A80 80 0 0 0 362.81 352H416m0-192h-53.19a80 80 0 0 0-66.56 35.62L288 208"},child:[]}]})(t)}function Qe(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M232 416a23.88 23.88 0 0 1-14.2-4.68 8.27 8.27 0 0 1-.66-.51L125.76 336H56a24 24 0 0 1-24-24V200a24 24 0 0 1 24-24h69.75l91.37-74.81a8.27 8.27 0 0 1 .66-.51A24 24 0 0 1 256 120v272a24 24 0 0 1-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 0 1-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0 1 28.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 0 1 320 336z"},child:[]},{tag:"path",attr:{d:"M368 384a16 16 0 0 1-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0 1 27.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 0 1-13.87 8z"},child:[]},{tag:"path",attr:{d:"M416 432a16 16 0 0 1-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1 1 27-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 0 1 416 432z"},child:[]}]})(t)}function Xe(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M264 416.19a23.92 23.92 0 0 1-14.21-4.69l-.66-.51-91.46-75H88a24 24 0 0 1-24-24V200a24 24 0 0 1 24-24h69.65l91.46-75 .66-.51A24 24 0 0 1 288 119.83v272.34a24 24 0 0 1-24 24zM352 336a16 16 0 0 1-14.29-23.18c9.49-18.9 14.3-38 14.3-56.82 0-19.36-4.66-37.92-14.25-56.73a16 16 0 0 1 28.5-14.54C378.2 208.16 384 231.47 384 256c0 23.83-6 47.78-17.7 71.18A16 16 0 0 1 352 336z"},child:[]},{tag:"path",attr:{d:"M400 384a16 16 0 0 1-13.87-24C405 327.05 416 299.45 416 256c0-44.12-10.94-71.52-29.83-103.95A16 16 0 0 1 413.83 136C434.92 172.16 448 204.88 448 256c0 50.36-13.06 83.24-34.12 120a16 16 0 0 1-13.88 8z"},child:[]}]})(t)}function Ze(t){return H({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M416 432 64 80"},child:[]},{tag:"path",attr:{d:"M243.33 98.86a23.89 23.89 0 0 0-25.55 1.82l-.66.51-28.52 23.35a8 8 0 0 0-.59 11.85l54.33 54.33a8 8 0 0 0 13.66-5.66v-64.49a24.51 24.51 0 0 0-12.67-21.71zm8 236.43L96.69 180.69A16 16 0 0 0 85.38 176H56a24 24 0 0 0-24 24v112a24 24 0 0 0 24 24h69.76l92 75.31a23.9 23.9 0 0 0 25.87 1.69A24.51 24.51 0 0 0 256 391.45v-44.86a16 16 0 0 0-4.67-11.3zM352 256c0-24.56-5.81-47.87-17.75-71.27a16 16 0 1 0-28.5 14.55C315.34 218.06 320 236.62 320 256q0 4-.31 8.13a8 8 0 0 0 2.32 6.25l14.36 14.36a8 8 0 0 0 13.55-4.31A146 146 0 0 0 352 256zm64 0c0-51.18-13.08-83.89-34.18-120.06a16 16 0 0 0-27.64 16.12C373.07 184.44 384 211.83 384 256c0 23.83-3.29 42.88-9.37 60.65a8 8 0 0 0 1.9 8.26L389 337.4a8 8 0 0 0 13.13-2.79C411 311.76 416 287.26 416 256z"},child:[]},{tag:"path",attr:{d:"M480 256c0-74.25-20.19-121.11-50.51-168.61a16 16 0 1 0-27 17.22C429.82 147.38 448 189.5 448 256c0 46.19-8.43 80.27-22.43 110.53a8 8 0 0 0 1.59 9l11.92 11.92a8 8 0 0 0 12.92-2.16C471.6 344.9 480 305 480 256z"},child:[]}]})(t)}const oe=t=>{if(!t||isNaN(t))return"0:00";const r=Math.floor(t/60),n=Math.floor(t%60);return`${r}:${n<10?"0":""}${n}`},et="_sliderThumb_7craq_40",tt="_sliderTrack_7craq_45",rt="_sliderRail_7craq_50",ae="_controlButton_7craq_107",me="_secondaryButton_7craq_120",nt="_active_7craq_137",Jt=({onUpdate:t,getCurrentTimeRaw:r,getDurationRaw:n,isSeeking:i})=>{const s=o.useRef(null),a=o.useRef(0);return o.useEffect(()=>{const c=()=>{if(i)return void(s.current=requestAnimationFrame(c));const l=r(),d=n();if(d>0){const p=l/d*100,x=Date.now();x-a.current>250&&(t({seekPosition:p,displayTime:{current:l,duration:d}}),a.current=x)}s.current=requestAnimationFrame(c)};return s.current=requestAnimationFrame(c),()=>{s.current&&cancelAnimationFrame(s.current)}},[i,r,n,t]),null},it=o.memo(({dominantColor:t})=>{const[r,n]=o.useState(0),[i,s]=o.useState(!1),[a,c]=o.useState(null),[l,d]=o.useState("off"),[p,x]=o.useState(!1),[h,f]=o.useState({current:0,duration:0}),b=o.useRef(null),{currentTrack:y,isPlaying:k,togglePlay:T,nextTrack:E,prevTrack:P,volume:S,setVolume:A,isMuted:M,toggleMute:N,seekTo:j,likeTrack:g,getCurrentTimeRaw:O,getDurationRaw:R}=re();o.useCallback(_=>{if(!_)return"#ffffff";const[w,$,z]=_.split(",").map(Number),F=Math.min(255,w+.4*(255-w)),V=Math.min(255,$+.4*(255-$)),X=Math.min(255,z+.4*(255-z));return`rgb(${Math.round(F)}, ${Math.round(V)}, ${Math.round(X)})`},[]);const I=o.useCallback(()=>M||S===0?e.jsx(Ze,{size:24}):S<.5?e.jsx(Xe,{size:24}):e.jsx(Qe,{size:24}),[M,S]),m=o.useCallback(()=>l==="one"?e.jsx(Ke,{size:24}):e.jsx(Ye,{size:24}),[l]),u=()=>{s(!0)},L=o.useCallback(({seekPosition:_,displayTime:w})=>{n(_),f(w)},[]);return o.useEffect(()=>{h.duration>0&&h.current>=h.duration-.1&&k&&(l==="one"?j(0):l==="all"?E():(T(),j(0)))},[h,k,T,j,l,E]),e.jsxs("div",{className:"_container_7craq_1",children:[e.jsx(Jt,{onUpdate:L,getCurrentTimeRaw:O,getDurationRaw:R,isSeeking:i}),e.jsxs("div",{className:"_progressContainer_7craq_27",ref:b,onClick:_=>{if(b.current){const w=R();if(w){const $=b.current.getBoundingClientRect(),z=(_.clientX-$.left)/$.width*100,F=Math.min(Math.max(z,0),100);n(F),j(F*w/100)}}},children:[e.jsx(Ee,{value:a!==null?a:r,onChange:(_,w)=>{c(w)},onChangeCommitted:(_,w)=>{const $=a!==null?a:w;n($);const z=R();z&&j($*z/100),c(null),s(!1)},onMouseDown:u,onTouchStart:u,"aria-labelledby":"track-progress",className:"_progressSlider_7craq_34",classes:{track:tt,rail:rt,thumb:et},sx:{color:t?`rgb(${t.r}, ${t.g}, ${t.b})`:"#d0bcff"}}),e.jsxs("div",{className:"_timeDisplay_7craq_77",children:[e.jsx("span",{className:"_currentTime_7craq_87",children:oe(h.current)}),e.jsxs("span",{className:"_duration_7craq_87",children:["-",oe(h.duration-h.current)]})]})]}),e.jsxs(v,{className:"_controlsContainer_7craq_100",sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:[e.jsx(B,{onClick:()=>{x(!p)},className:`${ae} ${me} ${p?nt:""}`,"aria-label":"shuffle",sx:{color:p?t?`rgb(${t.r}, ${t.g}, ${t.b})`:"#d0bcff":"rgba(255, 255, 255, 0.9)"},children:e.jsx(Je,{})}),e.jsx(B,{onClick:P,className:`${ae} ${me}`,"aria-label":"previous track",children:e.jsx(Ve,{})}),e.jsx(B,{onClick:T,className:`${ae} _primaryButton_7craq_129`,"aria-label":k?"pause":"play",sx:{color:"#fff"},children:k?e.jsx(Ce,{}):e.jsx(we,{})}),e.jsx(B,{onClick:E,className:`${ae} ${me}`,"aria-label":"next track",children:e.jsx(Ge,{})}),e.jsx(B,{onClick:()=>{d(l==="off"?"all":l==="all"?"one":"off")},className:`${ae} ${me} ${l!=="off"?nt:""}`,"aria-label":"repeat",sx:{color:l!=="off"?t?`rgb(${t.r}, ${t.g}, ${t.b})`:"#d0bcff":"rgba(255, 255, 255, 0.9)"},children:m()})]}),e.jsxs(v,{className:"_additionalControls_7craq_143",children:[e.jsxs("div",{className:"_volumeControl_7craq_152",children:[e.jsx(B,{onClick:N,className:"_volumeButton_7craq_159","aria-label":M?"unmute":"mute",children:I()}),e.jsx(Ee,{value:M?0:100*S,onChange:(_,w)=>{A(w/100)},"aria-labelledby":"volume-slider",className:"_volumeSlider_7craq_164",classes:{track:tt,rail:rt,thumb:et},sx:{color:t?`rgb(${t.r}, ${t.g}, ${t.b})`:"#d0bcff"}})]}),e.jsx("div",{className:"_likeContainer_7craq_196",children:e.jsx(B,{onClick:_=>{_&&_.stopPropagation(),y?.id&&g(y.id)},className:"_likeButton_7craq_202 "+(y?.liked?"_likedIcon_7craq_210":""),"aria-label":y?.liked?"unlike":"like",sx:{color:y?.liked?"#d0bcff":"rgba(255, 255, 255, 0.9)"},children:y?.liked?e.jsx(je,{}):e.jsx(_e,{})})})]})]})});var ot=function(){if(typeof Map<"u")return Map;function t(r,n){var i=-1;return r.some(function(s,a){return s[0]===n&&(i=a,!0)}),i}return function(){function r(){this.__entries__=[]}return Object.defineProperty(r.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),r.prototype.get=function(n){var i=t(this.__entries__,n),s=this.__entries__[i];return s&&s[1]},r.prototype.set=function(n,i){var s=t(this.__entries__,n);~s?this.__entries__[s][1]=i:this.__entries__.push([n,i])},r.prototype.delete=function(n){var i=this.__entries__,s=t(i,n);~s&&i.splice(s,1)},r.prototype.has=function(n){return!!~t(this.__entries__,n)},r.prototype.clear=function(){this.__entries__.splice(0)},r.prototype.forEach=function(n,i){i===void 0&&(i=null);for(var s=0,a=this.__entries__;s<a.length;s++){var c=a[s];n.call(i,c[1],c[0])}},r}()}(),ke=typeof window<"u"&&typeof document<"u"&&window.document===document,fe=typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")(),Qt=typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(fe):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},Xt=["top","right","bottom","left","width","height","size","weight"],Zt=typeof MutationObserver<"u",er=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(r){var n=!1,i=!1,s=0;function a(){n&&(n=!1,r()),i&&l()}function c(){Qt(a)}function l(){var d=Date.now();if(n){if(d-s<2)return;i=!0}else n=!0,i=!1,setTimeout(c,20);s=d}return l}(this.refresh.bind(this))}return t.prototype.addObserver=function(r){~this.observers_.indexOf(r)||this.observers_.push(r),this.connected_||this.connect_()},t.prototype.removeObserver=function(r){var n=this.observers_,i=n.indexOf(r);~i&&n.splice(i,1),!n.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var r=this.observers_.filter(function(n){return n.gatherActive(),n.hasActive()});return r.forEach(function(n){return n.broadcastActive()}),r.length>0},t.prototype.connect_=function(){ke&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Zt?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){ke&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(r){var n=r.propertyName,i=n===void 0?"":n;Xt.some(function(s){return!!~i.indexOf(s)})&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),at=function(t,r){for(var n=0,i=Object.keys(r);n<i.length;n++){var s=i[n];Object.defineProperty(t,s,{value:r[s],enumerable:!1,writable:!1,configurable:!0})}return t},ne=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||fe},st=xe(0,0,0,0);function ge(t){return parseFloat(t)||0}function lt(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return r.reduce(function(i,s){return i+ge(t["border-"+s+"-width"])},0)}var tr=typeof SVGGraphicsElement<"u"?function(t){return t instanceof ne(t).SVGGraphicsElement}:function(t){return t instanceof ne(t).SVGElement&&typeof t.getBBox=="function"};function rr(t){return ke?tr(t)?function(r){var n=r.getBBox();return xe(0,0,n.width,n.height)}(t):function(r){var n=r.clientWidth,i=r.clientHeight;if(!n&&!i)return st;var s=ne(r).getComputedStyle(r),a=function(f){for(var b={},y=0,k=["top","right","bottom","left"];y<k.length;y++){var T=k[y],E=f["padding-"+T];b[T]=ge(E)}return b}(s),c=a.left+a.right,l=a.top+a.bottom,d=ge(s.width),p=ge(s.height);if(s.boxSizing==="border-box"&&(Math.round(d+c)!==n&&(d-=lt(s,"left","right")+c),Math.round(p+l)!==i&&(p-=lt(s,"top","bottom")+l)),!function(f){return f===ne(f).document.documentElement}(r)){var x=Math.round(d+c)-n,h=Math.round(p+l)-i;Math.abs(x)!==1&&(d-=x),Math.abs(h)!==1&&(p-=h)}return xe(a.left,a.top,d,p)}(t):st}function xe(t,r,n,i){return{x:t,y:r,width:n,height:i}}var nr=function(){function t(r){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=xe(0,0,0,0),this.target=r}return t.prototype.isActive=function(){var r=rr(this.target);return this.contentRect_=r,r.width!==this.broadcastWidth||r.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var r=this.contentRect_;return this.broadcastWidth=r.width,this.broadcastHeight=r.height,r},t}(),ir=function(){return function(t,r){var n,i,s,a,c,l,d,p=(i=(n=r).x,s=n.y,a=n.width,c=n.height,l=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,d=Object.create(l.prototype),at(d,{x:i,y:s,width:a,height:c,top:s,right:i+a,bottom:c+s,left:i}),d);at(this,{target:t,contentRect:p})}}(),or=function(){function t(r,n,i){if(this.activeObservations_=[],this.observations_=new ot,typeof r!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=r,this.controller_=n,this.callbackCtx_=i}return t.prototype.observe=function(r){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(r instanceof ne(r).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(r)||(n.set(r,new nr(r)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(r){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(r instanceof ne(r).Element))throw new TypeError('parameter 1 is not of type "Element".');var n=this.observations_;n.has(r)&&(n.delete(r),n.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var r=this;this.clearActive(),this.observations_.forEach(function(n){n.isActive()&&r.activeObservations_.push(n)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var r=this.callbackCtx_,n=this.activeObservations_.map(function(i){return new ir(i.target,i.broadcastRect())});this.callback_.call(r,n,r),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),ct=typeof WeakMap<"u"?new WeakMap:new ot,dt=function(){return function t(r){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=er.getInstance(),i=new or(r,n,this);ct.set(this,i)}}();["observe","unobserve","disconnect"].forEach(function(t){dt.prototype[t]=function(){var r;return(r=ct.get(this))[t].apply(r,arguments)}});var te,be,ar=fe.ResizeObserver!==void 0?fe.ResizeObserver:dt;(be=te||(te={})).INVALID="invalid",be.METADATA="metadata",be.LYRIC="lyric",be.ENHANCED_LYRIC="enhanced_lyric";var sr=/^(\d{2,}):(\d{2})(?:\.(\d{2,3}))?$/;function lr(t){var r,n=t.match(sr);if(n===null)return 0;var i=n[1],s=n[2],a=(r=n[3])!==null&&r!==void 0?r:"00";return 60*+i*1e3+1e3*+s+(a.length===3?+a:10*+a)}var cr=/^((?:\[\d{2,}:\d{2}(?:\.\d{2,3})?\])+)(.*)$/,dr=/^\[(.+?):(.*?)\]$/;function ut(t){for(var r=[],n=t.split(`
`),i=0,s=n.length;i<s;i+=1){var a=n[i],c=a.match(cr);if(c===null){var l=a.match(dr);if(l===null)r.push({lineNumber:i,raw:a,type:te.INVALID});else{var d=l[1],p=l[2],x={lineNumber:i,raw:a,type:te.METADATA,key:d,value:p};r.push(x)}}else for(var h=0,f=c[1].split("][");h<f.length;h++){var b=f[h],y={lineNumber:i,raw:a,type:te.LYRIC,startMillisecond:lr(b.replace(/[[\]]/g,"")),content:c[2]};r.push(y)}}return r}typeof SuppressedError=="function"&&SuppressedError;const ht="react-lrc-line",ur={outline:"none",boxSizing:"border-box",scrollBehavior:"smooth",overflow:"auto"};var hr=o.memo(o.forwardRef(function({style:t,...r},n){const i=o.useMemo(()=>({...ur,...t}),[t]);return e.jsx("div",{...r,style:i,ref:n})}));const pr={height:"50%"};var mr=o.memo(function(){return e.jsx("div",{style:pr})});function Se(t,r=100){let n=0;return(...i)=>{const s=Date.now();if(s-n>=r)return n=s,t(...i)}}const fr=[" ","ArrowUp","ArrowDown"];function se(t){const r=o.useRef();return r.current=t,o.useCallback((...n)=>r.current(...n),[])}const pt=e.jsx(mr,{});var mt=o.forwardRef(function({lines:t,lineRenderer:r,currentMillisecond:n=-1,verticalSpace:i=!1,recoverAutoScrollInterval:s=5e3,recoverAutoScrollSingal:a=!1,onLineUpdate:c,onAutoScrollChange:l,onWheel:d,onKeyDown:p,onPointerDown:x,onPointerUp:h,onPointerMove:f,...b},y){const k=o.useRef(null),T=function(u,L){let _=0;for(const{length:w}=u;_<=w;_+=1){const $=u[_];if(!$||$.startMillisecond>L)break}return _-1}(t,n),{autoScroll:E,onWheel:P,onKeyDown:S,onPointerDown:A,onPointerUp:M,onPointerMove:N}=(({recoverAutoScrollInterval:u,recoverAutoScrollSingal:L,onAutoScrollChange:_})=>{const[w,$]=o.useState(!0),z=o.useRef(),F=o.useCallback(()=>{globalThis.clearTimeout(z.current),$(!1),z.current=globalThis.setTimeout(()=>$(!0),u)},[u]),V=o.useRef(!1),X=o.useCallback(()=>{V.current=!0},[]),C=o.useCallback(()=>{V.current=!1},[]),q=o.useMemo(()=>Se(()=>{V.current&&F()}),[F]),G=o.useMemo(()=>Se(J=>{fr.includes(J.key)&&F()}),[F]),Y=o.useMemo(()=>Se(F),[F]);return o.useEffect(()=>{$(!0)},[L]),o.useEffect(()=>{_&&_({autoScroll:w})},[w,_]),o.useEffect(()=>()=>globalThis.clearTimeout(z.current),[]),{autoScroll:w,onWheel:Y,onKeyDown:G,onPointerDown:X,onPointerUp:C,onPointerMove:q}})({recoverAutoScrollInterval:s,recoverAutoScrollSingal:a,onAutoScrollChange:l});(({root:u,autoScroll:L,lineIndex:_,lines:w,verticalSpace:$})=>{const z=o.useRef(new Map),F=o.useCallback(()=>{if(!u)return;const V=z.current.get(_);u.scrollTop=V?V.offsetTop-.5*u.clientHeight+V.height/2:0},[_,u]);o.useLayoutEffect(()=>{if(u){const V=()=>{const C=new Map,q=u.querySelectorAll(`.${ht}`);for(let G=0,{length:Y}=q;G<Y;G+=1){const J=q[G];C.set(G,{height:J.clientHeight,offsetTop:J.offsetTop})}z.current=C};V();const X=new ar(function(C,q=300){let G;return(...Y)=>{globalThis.clearTimeout(G),G=globalThis.setTimeout(()=>C(Y),q)}}(V));return X.observe(u),()=>X.disconnect()}},[u,w,$]),o.useLayoutEffect(()=>{L&&F()},[L,F,w,$])})({root:k.current,autoScroll:E,lineIndex:T,lines:t,verticalSpace:i}),o.useEffect(()=>{c&&c({index:T,line:t[T]??null})},[c,T,t]),o.useImperativeHandle(y,()=>k.current);const j=se(u=>(P(),d&&d(u))),g=se(u=>(S(u),p&&p(u))),O=se(u=>(A(),x?.(u))),R=se(u=>(M(),h?.(u))),I=se(u=>(N(),f?.(u))),m=o.useMemo(()=>t.map((u,L)=>e.jsx("div",{className:ht,children:r({index:L,active:T===L,line:u})},u.id)),[T,r,t]);return e.jsxs(hr,{tabIndex:-1,...b,onWheel:j,onKeyDown:g,onPointerDown:O,onPointerUp:R,onPointerMove:I,ref:k,children:[i?pt:null,m,i?pt:null]})});function Me(){return Math.random().toString(36).substring(2,8)}var gr=o.forwardRef(({lrc:t,...r},n)=>{const i=function(s){return o.useMemo(()=>ut(s).filter(a=>a.type===te.LYRIC).map(a=>({id:Me(),lineNumber:a.lineNumber,raw:a.raw,startMillisecond:a.startMillisecond,content:a.content})).sort((a,c)=>a.startMillisecond-c.startMillisecond),[s])}(t);return e.jsx(mt,{...r,lines:i,ref:n})});o.forwardRef(function({lrcs:t,...r},n){const i=(s=>o.useMemo(()=>{const a=new Map;for(const c of s){const l=ut(c).filter(d=>d.type===te.LYRIC);for(const d of l){const p=a.get(d.startMillisecond)||{id:Me(),startMillisecond:d.startMillisecond,children:[]};p.children.push({id:Me(),lineNumber:d.lineNumber,raw:d.raw,content:d.content}),a.set(d.startMillisecond,p)}}return[...a.values()].sort((c,l)=>c.startMillisecond-l.startMillisecond)},[s.length,...s]))(t);return e.jsx(mt,{...r,lines:i,ref:n})});const Te="_addLyricsButton_t4mvl_1",le="_lyricsTransitionContainer_t4mvl_96",xr=jt(v)(({theme:t})=>({height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",position:"relative"})),br=o.memo(({lyricsData:t,loading:r,currentTrack:n,dominantColor:i,onOpenEditor:s,onOpenTimestampEditor:a})=>{const{getCurrentTimeRaw:c}=re();ue();const l=de("(min-width:1200px)"),{signal:d}=function(){const[b,y]=o.useState(!1);return{signal:b,recoverAutoScrollImmediately:o.useCallback(()=>y(k=>!k),[])}}(),p=o.useRef(null),[x,h]=o.useState(0);o.useEffect(()=>{const b=()=>{p.current&&h(p.current.clientHeight)};return b(),window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b)}},[]);const f=i?`rgba(${Math.min(255,i.r+50)}, ${Math.min(255,i.g+50)}, ${Math.min(255,i.b+50)}, 1)`:"#ffffff";if(r)return e.jsx(v,{className:le,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ae,{size:46,thickness:4,sx:{color:f,boxShadow:"0 0 20px rgba(0,0,0,0.2)"}})});if(!t)return e.jsxs(v,{className:le,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"0 20px",textAlign:"center"},children:[e.jsx(D,{variant:"h6",sx:{color:"rgba(255, 255, 255, 0.9)",mb:3,fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif',fontWeight:600,fontSize:"1.3rem",letterSpacing:"-0.01em"},children:"\u041D\u0435\u0442 \u0442\u0435\u043A\u0441\u0442\u0430 \u043F\u0435\u0441\u043D\u0438 \u0434\u043B\u044F \u044D\u0442\u043E\u0433\u043E \u0442\u0440\u0435\u043A\u0430"}),e.jsx(ee,{variant:"outlined",className:Te,onClick:s,sx:{color:"#fff","&:hover":{borderColor:f}},children:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0435\u043A\u0441\u0442"})]});if(t.has_synced_lyrics&&t.synced_lyrics&&Array.isArray(t.synced_lyrics)){const b=t.synced_lyrics.filter(S=>S&&S.text?.trim()&&S.startTimeMs!==void 0);if(b.length===0)return e.jsxs(v,{className:le,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"0 20px",textAlign:"center"},children:[e.jsx(D,{variant:"h6",sx:{color:"rgba(255, 255, 255, 0.9)",mb:3,fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif',fontWeight:600,fontSize:"1.3rem",letterSpacing:"-0.01em"},children:"\u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0439 \u0442\u0435\u043A\u0441\u0442 \u043D\u0435 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u0441\u0442\u0440\u043E\u043A"}),e.jsx(ee,{variant:"outlined",className:Te,onClick:s,sx:{color:"#fff","&:hover":{borderColor:f}},children:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0442\u0435\u043A\u0441\u0442"})]});const{lrcContent:y,linesMap:k}=(S=>{let A="";const M={};return[...S].sort((N,j)=>N.startTimeMs-j.startTimeMs).forEach((N,j)=>{if(N.startTimeMs!==void 0&&N.text){const g=N.startTimeMs,O=Math.floor(g/6e4),R=Math.floor(g%6e4/1e3),I=Math.floor(g%1e3/10),m=j,u=`[${O.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}.${I.toString().padStart(2,"0")}]`;A+=`${u}[id:${m}]${N.text}
`,M[m]={startTimeMs:N.startTimeMs,text:N.text,index:j}}}),{lrcContent:A,linesMap:M}})(b),T=x?Math.floor(x/2):300,E=({index:S,active:A,line:M})=>{const N=M.content.match(/\[id:(\d+)\](.*)/),j=N?parseInt(N[1]):null,g=N?N[2]:M.content,O=1e3*c();let R=-1,I=null;for(const[$,z]of Object.entries(k))z.startTimeMs<=O&&(I=parseInt($),R=z.index);const m=j===I;let u=0;if(j!==null&&I!==null){const $=k[j]?.index||S,z=k[I]?.index||R;u=Math.abs($-z)}else u=Math.abs(S-R);const L=Math.min(4,.8*u),_=Math.max(.4,1-.12*u),w=(m?1:.94)-(m?0:Math.min(.06,.012*u));return e.jsx(D,{variant:m?"h4":"h5",className:"_lrcLine_t4mvl_47 "+(m?"_active_t4mvl_56":""),sx:{fontSize:m?l?"2rem":"1.8rem":l?"1.4rem":"1.3rem",fontWeight:m?700:500,color:m?f:"#ffffff",opacity:_,transition:"all 1.2s cubic-bezier(0.19, 1, 0.22, 1)",textAlign:"left",letterSpacing:m?"-0.02em":"-0.01em",lineHeight:1.3,filter:`blur(${L}px)`,transform:`scale(${w})`,transformOrigin:"left center",whiteSpace:"pre-line",padding:"8px 0",textShadow:m?`0 2px 10px rgba(${i?.r||0}, ${i?.g||0}, ${i?.b||0}, 0.3)`:"none"},children:g})},P={height:"100%",width:"100%",overflow:"auto",padding:0,paddingLeft:"10px",textAlign:"left","::-webkit-scrollbar":{width:0},scrollbarWidth:"none",willChange:"transform",scrollBehavior:"smooth","--vertical-space":`${T}px`};return e.jsx(xr,{className:le,ref:p,children:e.jsx(gr,{lrc:y,lineRenderer:E,currentMillisecond:1e3*c(),recoverAutoScrollInterval:3e3,recoverAutoScrollSingal:d,verticalSpace:T,style:P,className:"_lrcContainer_t4mvl_21"})})}return e.jsxs(v,{className:le,sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",padding:"20px 30px",overflowY:"auto","::-webkit-scrollbar":{width:0},scrollbarWidth:"none"},children:[!t.has_synced_lyrics&&e.jsx(D,{variant:"h5",sx:{color:"rgba(255, 255, 255, 0.9)",textAlign:"left",mb:2,fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif',fontWeight:700,fontSize:"1.6rem",letterSpacing:"-0.02em"},children:n?.lyrics?"\u0422\u0435\u043A\u0441\u0442 \u043F\u0435\u0441\u043D\u0438":"\u041D\u0435\u0442 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0433\u043E \u0442\u0435\u043A\u0441\u0442\u0430"}),t.lyrics&&!t.has_synced_lyrics&&e.jsx(v,{sx:{width:"100%",maxWidth:"95%"},children:e.jsx(D,{variant:"body1",sx:{whiteSpace:"pre-line",lineHeight:1.8,fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.9)",textAlign:"left",fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif',fontWeight:500},children:t.lyrics})}),!t.lyrics&&!t.has_synced_lyrics&&e.jsx(v,{sx:{textAlign:"center",width:"100%",mt:2},children:e.jsx(ee,{variant:"outlined",onClick:s,className:Te,sx:{mt:2,color:"#fff","&:hover":{borderColor:f}},children:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0435\u043A\u0441\u0442"})}),t.lyrics&&!t.has_synced_lyrics&&e.jsx(v,{sx:{textAlign:"center",width:"100%",mt:4},children:e.jsx(ee,{variant:"outlined",onClick:a,startIcon:e.jsx(Oe,{}),className:"_syncButton_t4mvl_1",sx:{color:"#fff","&:hover":{borderColor:f}},children:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044E"})})]})}),K={container:"_container_4d9sa_1",header:"_header_4d9sa_13",title:"_title_4d9sa_18",alert:"_alert_4d9sa_26",infoAlert:"_infoAlert_4d9sa_31",textField:"_textField_4d9sa_43",actions:"_actions_4d9sa_65",secondaryButton:"_secondaryButton_4d9sa_77",cancelButton:"_cancelButton_4d9sa_92",saveButton:"_saveButton_4d9sa_105"},vr=({lyricsData:t,currentTrack:r,onCancel:n,dominantColor:i,onShowLyrics:s,onShowSnackbar:a,onOpenTimestampEditor:c})=>{const[l,d]=o.useState(""),[p,x]=o.useState(!1),[h,f]=o.useState(""),[b,y]=o.useState(null),[k,T]=o.useState(!1),E=o.useRef(null);o.useEffect(()=>{t?.has_lyrics&&t.lyrics&&d(t.lyrics)},[t]);const P=()=>i?`rgb(${i})`:"#ff2d55",S=()=>{y(null)};return e.jsxs("div",{className:K.container,children:[e.jsx("div",{className:K.header,children:e.jsx(D,{className:K.title,children:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0442\u0435\u043A\u0441\u0442\u0430"})}),h&&e.jsx(ie,{severity:"error",variant:"filled",className:K.alert,children:h}),e.jsx(ie,{severity:"info",icon:e.jsx(Ct,{}),variant:"outlined",className:K.infoAlert,children:"\u0412\u044B \u043C\u043E\u0436\u0435\u0442\u0435 \u043D\u0430\u0439\u0442\u0438 \u0442\u0435\u043A\u0441\u0442\u044B \u043F\u0435\u0441\u0435\u043D \u043D\u0430 Genius \u0438\u043B\u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u0445. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0441\u043E\u0431\u043B\u044E\u0434\u0430\u0439\u0442\u0435 \u0430\u0432\u0442\u043E\u0440\u0441\u043A\u0438\u0435 \u043F\u0440\u0430\u0432\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0438 \u0442\u0435\u043A\u0441\u0442\u043E\u0432."}),e.jsx(wt,{multiline:!0,fullWidth:!0,variant:"outlined",value:l,onChange:A=>{d(A.target.value)},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043A\u0441\u0442 \u043F\u0435\u0441\u043D\u0438 \u0437\u0434\u0435\u0441\u044C...",className:K.textField,InputProps:{classes:{root:K.inputRoot,focused:K.inputFocused}},sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.15)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.3)"},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:`${P()} !important`,borderWidth:"1px"}}}),e.jsxs("div",{className:K.actions,children:[e.jsx(ee,{variant:"outlined",onClick:A=>{y(A.currentTarget)},startIcon:e.jsx(Oe,{}),className:K.secondaryButton,style:{borderColor:i?`rgba(${i}, 0.15)`:"rgba(255, 45, 85, 0.15)",color:P(),backgroundColor:"transparent"},children:"\u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044F"}),e.jsxs("div",{children:[e.jsx(ee,{onClick:n,className:K.cancelButton,children:"\u041E\u0442\u043C\u0435\u043D\u0430"}),e.jsx(ee,{variant:"contained",onClick:async()=>{if(r?.id)if(l.trim()){x(!0),f("");try{const A=await fetch(`/api/music/${r.id}/lyrics/upload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lyrics:l,source_url:"manually_added"})}),M=await A.json();A.ok?(a("\u0422\u0435\u043A\u0441\u0442 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D","success"),s()):(f(M.error||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0442\u0435\u043A\u0441\u0442"),M.warning&&a(M.warning,"warning"))}catch{f("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438 \u0442\u0435\u043A\u0441\u0442\u0430. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.")}finally{x(!1)}}else f("\u0422\u0435\u043A\u0441\u0442 \u043F\u0435\u0441\u043D\u0438 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C");else f("\u0422\u0440\u0435\u043A \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D")},disabled:p||k,startIcon:p?e.jsx(Ae,{size:16,color:"inherit"}):e.jsx(kt,{}),className:K.saveButton,style:{backgroundColor:P(),boxShadow:i?`0 4px 12px rgba(${i}, 0.3)`:void 0},children:p?"\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435...":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"})]})]}),e.jsxs(St,{anchorEl:b,open:!!b,onClose:S,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{style:{backgroundColor:"rgba(25, 25, 25, 0.95)",backdropFilter:"blur(12px)",border:"1px solid rgba(255, 255, 255, 0.12)",borderRadius:"12px",color:"white",minWidth:"250px"}},children:[e.jsxs(Le,{onClick:()=>{if(r?.id&&l.trim())try{const A=l.split(`
`).map(O=>O.trim()).filter(O=>O.length>0);let M="[ti:"+(r.title||"Unknown Title")+`]
`;M+="[ar:"+(r.artist||"Unknown Artist")+`]
`,M+="[al:"+(r.album||"Unknown Album")+`]
`,M+=`[by:\u041A-\u041A\u043E\u043D\u043D\u0435\u043A\u0442 \u0410\u0432\u0442\u043E-\u0413\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u044F LRC]

`,A.forEach(O=>{M+="[00:00.00]"+O+`
`});const N=new Blob([M],{type:"text/plain"}),j=URL.createObjectURL(N),g=document.createElement("a");g.href=j,g.download=`${r.artist} - ${r.title}.lrc`,a("\u0421\u043A\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u0435 \u0448\u0430\u0431\u043B\u043E\u043D\u0430 LRC \u0434\u043B\u044F \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438","info"),g.click(),setTimeout(()=>{URL.revokeObjectURL(j)},2e3),S()}catch{f("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u0448\u0430\u0431\u043B\u043E\u043D\u0430 \u0434\u043B\u044F \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438")}else f("\u041D\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E \u0442\u0435\u043A\u0441\u0442\u0430 \u0434\u043B\u044F \u0441\u043A\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u044F")},style:{padding:"12px","&:hover":{backgroundColor:"rgba(255,255,255,0.05)"}},children:[e.jsx(Mt,{style:{marginRight:"12px",fontSize:"1.2rem",color:"rgba(255,255,255,0.7)"}}),e.jsx(D,{variant:"body2",children:"\u0421\u043A\u0430\u0447\u0430\u0442\u044C LRC \u0448\u0430\u0431\u043B\u043E\u043D \u0434\u043B\u044F \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438"})]}),e.jsxs(Le,{onClick:()=>{E.current&&E.current.click(),S()},style:{padding:"12px","&:hover":{backgroundColor:"rgba(255,255,255,0.05)"}},children:[e.jsx(Tt,{style:{marginRight:"12px",fontSize:"1.2rem",color:"rgba(255,255,255,0.7)"}}),e.jsx(D,{variant:"body2",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044E (LRC/JSON)"})]})]}),e.jsx("input",{type:"file",ref:E,onChange:A=>{const M=A.target.files[0];M&&(E.current&&(E.current.value=""),(async N=>{if(N&&r?.id){T(!0),f("");try{const j=new FormData;j.append("file",N);const g=await fetch(`/api/music/${r.id}/lyrics/upload`,{method:"POST",body:j});if(!g.ok){const O=await g.json();throw new Error(O.error||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u0430\u0439\u043B \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438")}await g.json(),a("\u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u044F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u0430","success"),s()}catch(j){f(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0444\u0430\u0439\u043B\u0430: ${j.message}`),a(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0430\u0446\u0438\u0438: ${j.message}`,"error")}finally{T(!1)}}else f("\u041D\u0435\u0442 \u0444\u0430\u0439\u043B\u0430 \u0434\u043B\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u043B\u0438 \u0442\u0440\u0435\u043A \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D")})(M))},accept:".lrc,.json",style:{display:"none"}})]})},yr=({lyricsData:t,currentTrack:r,onCancel:n,dominantColor:i,onShowLyrics:s,onShowSnackbar:a})=>e.jsxs("div",{className:"_container_pl0uq_1",children:[e.jsxs("div",{className:"_header_pl0uq_13",children:[e.jsx(D,{className:"_title_pl0uq_18",children:"\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0442\u0430\u0439\u043C\u043A\u043E\u0434\u043E\u0432"}),e.jsxs(D,{className:"_subtitle_pl0uq_27",children:["\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u0441\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0433\u043E \u0442\u0435\u043A\u0441\u0442\u0430 \u0434\u043B\u044F ",r?.title]})]}),e.jsxs(v,{className:"_content_pl0uq_33",children:[e.jsx(D,{className:"_message_pl0uq_45",children:"\u042D\u0442\u0430 \u0444\u0443\u043D\u043A\u0446\u0438\u044F \u0431\u0443\u0434\u0435\u0442 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0430 \u0432 \u0431\u043B\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043C\u044F!"}),e.jsx(D,{className:"_description_pl0uq_52",children:"\u0421\u0438\u043D\u0445\u0440\u043E\u043D\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0439 \u0442\u0435\u043A\u0441\u0442 \u043F\u043E\u0437\u0432\u043E\u043B\u044F\u0435\u0442 \u043F\u043E\u0434\u0441\u0432\u0435\u0447\u0438\u0432\u0430\u0442\u044C \u0441\u0442\u0440\u043E\u043A\u0438 \u0432 \u0442\u0430\u043A\u0442 \u0441 \u043C\u0443\u0437\u044B\u043A\u043E\u0439, \u0441\u043E\u0437\u0434\u0430\u0432\u0430\u044F \u044D\u0444\u0444\u0435\u043A\u0442 \u043F\u043E\u0433\u0440\u0443\u0436\u0435\u043D\u0438\u044F \u043A\u0430\u043A \u0432 Apple Music."})]}),e.jsx("div",{className:"_actions_pl0uq_61",children:e.jsx(ee,{onClick:n,startIcon:e.jsx(Nt,{}),className:"_backButton_pl0uq_67",style:{color:i?`rgb(${i})`:"#d0bcff",borderColor:i?`rgba(${i}, 0.15)`:"rgba(255, 45, 85, 0.15)",backgroundColor:"rgba(0, 0, 0, 0.2)"},children:"\u0412\u0435\u0440\u043D\u0443\u0442\u044C\u0441\u044F \u043A \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0443 \u0442\u0435\u043A\u0441\u0442\u0430"})})]}),U={dialogContent:"_dialogContent_1sfen_22",contentContainer:"_contentContainer_1sfen_30",controlsSideContainer:"_controlsSideContainer_1sfen_49",controlsSideContainerCentered:"_controlsSideContainerCentered_1sfen_60",fadeGradientBottom:"_fadeGradientBottom_1sfen_68",contentSideContainer:"_contentSideContainer_1sfen_103",playerContainer:"_playerContainer_1sfen_181",topControlsContainer:"_topControlsContainer_1sfen_189",bottomControlsContainer:"_bottomControlsContainer_1sfen_200",belowCoverContainer:"_belowCoverContainer_1sfen_211",belowCoverTitle:"_belowCoverTitle_1sfen_215",belowCoverArtists:"_belowCoverArtists_1sfen_220",contentHide:"_contentHide_1sfen_1",contentShow:"_contentShow_1sfen_1"},ft=({open:t,onClose:r,...n})=>{const[i,s]=o.useState(null),[a,c]=o.useState(!1),[l,d]=o.useState(!1),[p,x]=o.useState(!1),[h,f]=o.useState(!1),[b,y]=o.useState(null),[k,T]=o.useState(!1),[E,P]=o.useState(""),S=ue();de("(min-width:960px)");const A=de("(max-width:600px)"),M=Re(),[N,j]=o.useState({open:!1,message:"",severity:"success"}),{currentTrack:g,currentSection:O,playlistTracks:R,playTrack:I}=re(),m=o.useMemo(()=>O&&O.startsWith("playlist_")&&R[O]||[],[O,R]),u=o.useCallback(()=>{f(C=>!C),c(!1),d(!1),x(!1)},[]),L=o.useCallback(C=>{I&&O&&I(C,O)},[I,O]);o.useEffect(()=>{g?.cover_path&&Ie(g.cover_path||"/static/uploads/system/album_placeholder.jpg",C=>{s(C)})},[g]),o.useEffect(()=>{g?.id&&t&&(T(!0),g.lyricsData?(y(g.lyricsData),T(!1),(g.lyricsData.has_synced_lyrics||g.lyricsData.has_lyrics)&&c(!0)):fetch(`/api/music/${g.id}/lyrics`).then(C=>C.json()).then(C=>{y(C),T(!1),g&&(g.lyricsData=C),(C.has_synced_lyrics||C.has_lyrics)&&c(!0)}).catch(C=>{T(!1)}))},[g,t]),o.useEffect(()=>{t||c(!1)},[t]);const _=o.useCallback(()=>{c(C=>!C),d(!1),x(!1),f(!1)},[]),w=o.useCallback(()=>{d(!0),x(!1)},[]),$=o.useCallback(()=>{x(!0),d(!1)},[]),z=(C,q)=>{q!=="clickaway"&&j(G=>({...G,open:!1}))};o.useEffect(()=>{const C=()=>{document.body.style.overflow="",document.body.style.touchAction="",document.body.classList.remove("fullscreen-player-active")};return t?(document.body.style.overflow="hidden",document.body.style.touchAction="none",document.body.classList.add("fullscreen-player-active")):(C(),setTimeout(C,300)),C},[t]);const F=o.useMemo(()=>e.jsx(Fe,{track:g,dominantColor:i}),[g,i]);o.useMemo(()=>e.jsx(Ht,{onClose:r,onToggleLyrics:_,onOpenLyricsEditor:w,showLyrics:a,showLyricsEditor:l,dominantColor:i}),[r,_,w,a,l,i]);const V=o.useMemo(()=>e.jsx(it,{dominantColor:i}),[i]),X=()=>h?e.jsx(_r,{tracks:m,currentTrack:g,dominantColor:i,onPlayTrack:L}):!a||l||p?l?e.jsx(vr,{lyricsData:b,currentTrack:g,onCancel:()=>d(!1),dominantColor:i,onShowLyrics:()=>{d(!1),c(!0)},onShowSnackbar:(C,q)=>{j({open:!0,message:C,severity:q})},onOpenTimestampEditor:$}):p?e.jsx(yr,{lyricsData:b,currentTrack:g,lyricsText:E,onCancel:()=>{x(!1),d(!0)},dominantColor:i,onShowLyrics:()=>{x(!1),c(!0)},onShowSnackbar:(C,q)=>{j({open:!0,message:C,severity:q})}}):e.jsx(Fe,{track:g,dominantColor:i}):e.jsx(br,{lyricsData:b,loading:k,currentTrack:g,dominantColor:i,onOpenEditor:w,onOpenTimestampEditor:$});return g?e.jsxs(e.Fragment,{children:[e.jsx($t,{fullScreen:!0,open:t,onClose:r,children:e.jsxs(Et,{className:U.dialogContent,children:[e.jsx(qt,{cover:g?.cover_path,dominantColor:i}),e.jsx(v,{className:U.fadeGradientTop}),e.jsx(v,{className:U.fadeGradientBottom}),e.jsx(v,{className:U.contentContainer,children:A?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:U.topControlsContainer,children:e.jsxs(v,{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(B,{onClick:r,children:e.jsx(It,{})}),e.jsxs(v,{display:"flex",children:[e.jsx(B,{onClick:w,sx:{color:l?S.palette.primary.main:"inherit",backgroundColor:l?"rgba(255, 255, 255, 0.2)":"transparent",mr:1},children:e.jsx(De,{})}),e.jsx(B,{onClick:_,sx:{color:a?S.palette.primary.main:"inherit",backgroundColor:a?"rgba(255, 255, 255, 0.2)":"transparent",mr:1},children:e.jsx(ye,{})}),m.length>0&&e.jsx(B,{onClick:u,sx:{color:h?S.palette.primary.main:"inherit",backgroundColor:h?"rgba(255, 255, 255, 0.2)":"transparent"},children:e.jsx(Be,{})})]})]})}),e.jsxs(v,{className:U.playerContainer,sx:{pt:8,pb:20},children:[e.jsxs(v,{sx:{padding:"0px 16px",marginBottom:"0",display:a||h?"none":"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"75%",width:"100%"},children:[e.jsx(v,{sx:{position:"relative",width:"80%",maxWidth:"500px",aspectRatio:"1/1",borderRadius:"12px",overflow:"hidden",boxShadow:i?`0 10px 30px rgba(${i.r}, ${i.g}, ${i.b}, 0.3), 0 30px 60px rgba(0,0,0,0.4)`:"0 10px 30px rgba(0,0,0,0.3), 0 30px 60px rgba(0,0,0,0.4)",animation:"appleMusicPulse 4s infinite alternate cubic-bezier(0.455, 0.03, 0.515, 0.955)"},children:e.jsx("img",{src:g?.cover_path||"/static/uploads/system/album_placeholder.jpg",alt:g?.title||"Album Cover",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",aspectRatio:"1/1"}})}),e.jsxs(v,{className:U.belowCoverContainer,sx:{textAlign:"center",width:"100%",animation:"appleSlideUp 0.4s 0.2s ease-out forwards"},children:[e.jsx(D,{variant:"h6",className:U.belowCoverTitle,sx:{fontSize:"24px",fontWeight:700,color:"#ffffff",textShadow:"0 2px 4px rgba(0,0,0,0.3)",textAlign:"center",width:"100%",letterSpacing:"-0.02em",fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif'},children:g?.title||"Untitled"}),e.jsx(v,{className:U.belowCoverArtists,sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",padding:"0 8px",color:"rgba(255,255,255,0.8)",fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif',fontWeight:500,fontSize:"18px"},children:g?.artist&&g.artist.split(",").map((C,q,G)=>e.jsxs(Q.Fragment,{children:[e.jsx(D,{component:"span",sx:{cursor:"pointer",color:"rgba(255,255,255,0.8)",fontWeight:500,transition:"all 0.2s","&:hover":{color:"#ffffff",textDecoration:"underline"},px:.5,py:.25,fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif'},onClick:()=>(async Y=>{if(Y&&Y.trim()!==""){Y=Y.trim();try{const J=await Pe.get(`/api/search/artists?query=${encodeURIComponent(Y)}`);if(J.data&&J.data.artists&&J.data.artists.length>0){const $e=J.data.artists.find(gt=>gt.name.toLowerCase()===Y.toLowerCase());if($e)return void M(`/artist/${$e.id}`);M(`/artist/${J.data.artists[0].id}`)}else j({open:!0,message:`\u0410\u0440\u0442\u0438\u0441\u0442 "${Y}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D`,severity:"warning"})}catch{j({open:!0,message:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435 \u0430\u0440\u0442\u0438\u0441\u0442\u0430",severity:"error"})}}})(C.trim()),children:C.trim()}),q<G.length-1&&e.jsx(D,{component:"span",sx:{color:"rgba(255,255,255,0.5)",mx:.5,fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif'},children:","})]},q))})]})]}),e.jsx(v,{sx:{position:"absolute",left:0,right:0,top:a||h?"10px":"60px",bottom:"140px",overflow:"hidden",display:a||l||p||h?"flex":"none",flexDirection:"column",justifyContent:"center",pointerEvents:a||l||p||h?"auto":"none",zIndex:10,paddingRight:"15px",paddingLeft:"10px"},children:X()})]}),e.jsx(v,{className:U.bottomControlsContainer,children:e.jsx(v,{sx:{p:2,pb:a||l||p||h?2:9.5,transition:"padding 0.3s ease-in-out"},children:e.jsx(it,{})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(v,{className:`${U.controlsSideContainer} ${a||l||p||h?"":U.controlsSideContainerCentered}`,sx:{transition:"all 0.4s cubic-bezier(0.17, 0.67, 0.3, 0.98)"},children:[F,e.jsxs(v,{sx:{display:"flex",justifyContent:"center",mb:2},children:[e.jsx(B,{onClick:_,sx:{color:a?S.palette.primary.main:"inherit",backgroundColor:a?"rgba(255, 255, 255, 0.2)":"transparent",mx:1},children:e.jsx(ye,{})}),e.jsx(B,{onClick:w,sx:{color:l?S.palette.primary.main:"inherit",backgroundColor:l?"rgba(255, 255, 255, 0.2)":"transparent",mx:1},children:e.jsx(De,{})}),m.length>0&&e.jsx(B,{onClick:u,sx:{color:h?S.palette.primary.main:"inherit",backgroundColor:h?"rgba(255, 255, 255, 0.2)":"transparent",mx:1},children:e.jsx(Be,{})})]}),V]}),e.jsx(v,{className:`${U.contentSideContainer} ${a||l||p||h?"animated-content-show":"animated-content-hide"}`,sx:{opacity:a||l||p||h?1:0,maxWidth:a||l||p||h?"60%":"0%",visibility:a||l||p||h?"visible":"hidden",animation:a||l||p||h?`${U.contentShow} 0.4s cubic-bezier(0.17, 0.67, 0.3, 0.98) forwards`:`${U.contentHide} 0.4s cubic-bezier(0.17, 0.67, 0.3, 0.98) forwards`},children:X()})]})})]})}),e.jsx(ve,{open:N.open,autoHideDuration:6e3,onClose:z,children:e.jsx(ie,{onClose:z,severity:N.severity,sx:{width:"100%"},children:N.message})})]}):null},_r=({tracks:t=[],currentTrack:r,dominantColor:n,onPlayTrack:i})=>{const s=ue(),a=c=>r&&r.id===c.id;return t&&t.length!==0?e.jsxs(v,{sx:{width:"100%"},children:[e.jsx(D,{variant:"h6",sx:{mb:2,fontWeight:600,color:"white",textShadow:"0 1px 3px rgba(0,0,0,0.3)",textAlign:"center"},children:"\u0422\u0440\u0435\u043A\u0438 \u043F\u043B\u0435\u0439\u043B\u0438\u0441\u0442\u0430"}),e.jsx(At,{sx:{maxHeight:"70vh",overflow:"auto",pr:2,pl:1,"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(255,255,255,0.1)",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:s.palette.primary.main,borderRadius:"4px"}},children:t.map((c,l)=>e.jsxs(Ot,{button:!0,onClick:()=>i(c),sx:{borderRadius:"8px",mb:.5,backgroundColor:a(c)?`rgba(${n?.r||0}, ${n?.g||0}, ${n?.b||0}, 0.4)`:"rgba(255,255,255,0.05)","&:hover":{backgroundColor:a(c)?`rgba(${n?.r||0}, ${n?.g||0}, ${n?.b||0}, 0.6)`:"rgba(255,255,255,0.12)"}},children:[e.jsx(v,{sx:{display:"flex",alignItems:"center",width:"24px",mr:1,flexShrink:0},children:a(c)?e.jsx(Ft,{sx:{color:s.palette.primary.main}}):e.jsx(D,{sx:{color:"rgba(255,255,255,0.7)"},children:l+1})}),e.jsx(Lt,{sx:{minWidth:40},children:e.jsx(zt,{variant:"rounded",sx:{width:32,height:32},src:c.cover_path,children:e.jsx(ye,{})})}),e.jsx(Rt,{primary:c.title,secondary:c.artist,primaryTypographyProps:{noWrap:!0,color:a(c)?s.palette.primary.main:"white",fontWeight:a(c)?600:400},secondaryTypographyProps:{noWrap:!0,color:"rgba(255,255,255,0.7)"}})]},c.id))})]}):e.jsx(v,{sx:{textAlign:"center",p:3,color:"white"},children:e.jsx(D,{variant:"h6",children:"\u0412 \u044D\u0442\u043E\u043C \u043F\u043B\u0435\u0439\u043B\u0438\u0441\u0442\u0435 \u043D\u0435\u0442 \u0442\u0440\u0435\u043A\u043E\u0432"})})},jr=Ie,Cr=ze(Dt)(({theme:t,covercolor:r})=>({position:"fixed",bottom:65,left:0,right:0,zIndex:t.zIndex.appBar-1,backgroundColor:r?`rgba(${r}, 0.35)`:"rgba(10, 10, 10, 0.6)",backdropFilter:"blur(30px)",boxShadow:"0 -2px 15px rgba(0, 0, 0, 0.25)",padding:t.spacing(.5,1,.5,1),display:"flex",flexDirection:"column",borderTopLeftRadius:12,borderTopRightRadius:12,borderTop:"1px solid rgba(255, 255, 255, 0.07)",borderLeft:"1px solid rgba(255, 255, 255, 0.07)",borderRight:"1px solid rgba(255, 255, 255, 0.07)","&.hidden":{display:"none !important",opacity:0,pointerEvents:"none",visibility:"hidden"},"&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:r?`radial-gradient(ellipse at top, rgba(${r}, 0.3) 0%, rgba(10, 10, 10, 0.1) 70%)`:"none",opacity:.6,pointerEvents:"none",borderTopLeftRadius:12,borderTopRightRadius:12}}));ze(Bt)(({theme:t,covercolor:r})=>({height:2,borderRadius:0,backgroundColor:"rgba(255, 255, 255, 0.2)","& .MuiLinearProgress-bar":{borderRadius:0,backgroundColor:r?`rgba(${r}, 1)`:t.palette.primary.main}}));const Ne=o.memo(({icon:t,onClick:r,ariaLabel:n,disabled:i=!1})=>e.jsx(B,{onClick:r,size:"small","aria-label":n,disabled:i,sx:{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:t})),wr=o.memo(({title:t,artist:r,onClick:n})=>e.jsxs(v,{sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden",cursor:"pointer"},onClick:n,children:[e.jsx(D,{variant:"body2",noWrap:!0,sx:{fontWeight:"medium",color:"white"},children:t||"Unknown Title"}),e.jsx(D,{variant:"caption",noWrap:!0,sx:{color:"rgba(255, 255, 255, 0.7)"},children:r||"Unknown Artist"})]})),kr=o.memo(()=>{const t=ue(),{themeSettings:r}=o.useContext(Pt),{currentTrack:n,isPlaying:i,togglePlay:s,nextTrack:a,prevTrack:c,likeTrack:l,currentTime:d,duration:p,seekTo:x,getCurrentTimeRaw:h,getDurationRaw:f,audioRef:b}=re(),y=o.useRef(0),[k,T]=o.useState(!1),[E,P]=o.useState(null),[S,A]=o.useState({open:!1,message:"",severity:"success"});if(o.useMemo(()=>{try{const m=document.getElementById("global-player-current-time");if(m&&m.textContent)return m.textContent;if(typeof h=="function"){const u=h();return oe(typeof u=="number"?u:0)}return"0:00"}catch{return"0:00"}},[h]),o.useMemo(()=>{try{const m=document.getElementById("global-player-duration");if(m&&m.textContent)return m.textContent;if(typeof f=="function"){const u=f();return oe(typeof u=="number"?u:0)}return"0:00"}catch{return"0:00"}},[f]),o.useEffect(()=>{let m=!0;const u=()=>{try{if(!m)return;const _=document.getElementById("mobile-current-time"),w=document.getElementById("mobile-duration"),$=document.getElementById("mobile-player-progress");_&&window.audioTiming&&window.audioTiming.formattedCurrentTime&&(_.textContent=window.audioTiming.formattedCurrentTime),w&&window.audioTiming&&window.audioTiming.formattedDuration&&(w.textContent=window.audioTiming.formattedDuration),$&&window.audioTiming&&typeof window.audioTiming.progress=="number"&&($.style.width=`${window.audioTiming.progress}%`,y.current=window.audioTiming.progress),m&&requestAnimationFrame(u)}catch{m&&requestAnimationFrame(u)}},L=requestAnimationFrame(u);return()=>{m=!1,cancelAnimationFrame(L)}},[]),o.useEffect(()=>{},[]),o.useEffect(()=>{n?.cover_path&&jr(n.cover_path||"/static/uploads/system/album_placeholder.jpg",m=>{P(m)})},[n]),o.useEffect(()=>{if(b?.current){const m=b.current.currentTime||0,u=b.current.duration||0;if(u>0){y.current=m/u*100;const L=document.getElementById("mobile-player-progress");L&&(L.style.width=`${y.current}%`)}}},[b]),o.useEffect(()=>{p>0&&(y.current=d/p*100)},[d,p]),!n)return null;const M=o.useCallback(m=>{if(m&&m.stopPropagation(),n?.id)try{const u=m.currentTarget;u.style.transform="scale(1.3)",setTimeout(()=>{u.style.transform="scale(1)"},150),l(n.id).then(L=>{}).catch(L=>{})}catch{}},[n,l]);o.useCallback(m=>{if(m.stopPropagation(),!n)return;const u=`${window.location.origin}/music/track/${n.id}`;N(u)},[n]);const N=o.useCallback(m=>{navigator.clipboard.writeText(m).then(()=>{A({open:!0,message:"\u0421\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u0442\u0440\u0435\u043A \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430",severity:"success"})}).catch(u=>{A({open:!0,message:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u0441\u044B\u043B\u043A\u0443",severity:"error"})})},[]),j=o.useCallback((m,u)=>{u!=="clickaway"&&A(L=>({...L,open:!1}))},[]),g=o.useCallback(()=>{T(!0)},[]),O=o.useCallback(()=>{T(!1)},[]),R=o.useCallback((m,u)=>{m.stopPropagation();try{u()}catch{}},[]);o.useCallback(m=>R(m,c),[R,c]);const I=o.useCallback(m=>R(m,s),[R,s]);return o.useCallback(m=>R(m,a),[R,a]),e.jsxs(Q.Fragment,{children:[e.jsxs(Cr,{elevation:0,covercolor:E,sx:{display:k?"none":"flex"},className:k?"hidden":"",children:[e.jsx("div",{style:{height:2,width:"100%",backgroundColor:"rgba(255, 255, 255, 0.2)",marginTop:"-4px",marginBottom:"6px",position:"relative"},children:e.jsx("div",{id:"mobile-player-progress",style:{position:"absolute",top:0,left:0,height:"100%",width:`${y.current}%`,backgroundColor:E?`rgba(${E}, 1)`:t.palette.primary.main,transition:"none"}})}),e.jsxs(v,{onClick:g,sx:{display:"flex",alignItems:"center",cursor:"pointer",position:"relative",padding:"2px 0"},children:[e.jsxs("div",{style:{display:"none"},children:[e.jsx("span",{id:"mobile-current-time",children:"0:00"}),e.jsx("span",{id:"mobile-duration",children:"0:00"})]}),e.jsxs(v,{sx:{display:"flex",alignItems:"center",width:"100%",WebkitTapHighlightColor:"transparent"},children:[e.jsx(v,{component:"img",src:Wt(n?.cover_path||"","album"),alt:n?.title||"",sx:{width:40,height:40,borderRadius:1,objectFit:"cover",border:"1px solid rgba(255, 255, 255, 0.1)",marginRight:1.5}}),e.jsx(wr,{title:n?.title,artist:n?.artist,onClick:g}),e.jsxs(v,{sx:{display:"flex",alignItems:"center",ml:"auto"},children:[e.jsx(Ne,{icon:i?e.jsx(Ce,{size:30}):e.jsx(we,{size:30}),onClick:I,ariaLabel:i?"Pause":"Play"}),e.jsx(Ne,{icon:n?.is_liked?e.jsx(je,{size:20,color:E?`rgba(${E}, 1)`:"#ff2d55"}):e.jsx(_e,{size:20}),onClick:M,ariaLabel:"Toggle like"}),e.jsx(Ne,{icon:e.jsx(Yt,{size:20}),onClick:g,ariaLabel:"Open fullscreen player"})]})]})]})]}),e.jsx(ft,{open:k,onClose:O}),e.jsx(ve,{open:S.open&&!k,autoHideDuration:3e3,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{bottom:70},children:e.jsx(ie,{onClose:j,severity:S.severity,sx:{width:"100%"},children:S.message})})]})});export{ft as F,Ze as I,kr as M,Xe as a,Qe as b,Ke as c,Ye as d,Je as e,oe as f,Ve as g,Ce as h,we as i,Ge as j,je as k,_e as l,Kt as m,Gt as n};
