const d=(e="album",a=300,l=300)=>{const o=document.createElement("canvas");o.width=a,o.height=l;const i=o.getContext("2d"),c={liked:{colors:["#ff5252","#d32f2f"],shape:"radial"},all:{colors:["#3f51b5","#1a237e"],shape:"linear"},new:{colors:["#43a047","#1b5e20"],shape:"linear"},random:{colors:["#7b1fa2","#4a148c"],shape:"radial"},album:{colors:["#424242","#212121"],shape:"linear"},playlist:{colors:["#546e7a","#263238"],shape:"linear"}},n=c[e]||c.album;let h;if(h=n.shape==="radial"?i.createRadialGradient(a/2,l/2,0,a/2,l/2,a/1.5):i.createLinearGradient(0,0,a,l),h.addColorStop(0,n.colors[0]),h.addColorStop(1,n.colors[1]),i.fillStyle=h,i.fillRect(0,0,a,l),e==="liked"){i.fillStyle="rgba(255, 255, 255, 0.2)",i.beginPath();const t=a/2,r=a/2,s=l/2;i.moveTo(r,s-t/4),i.bezierCurveTo(r,s-t/2,r-t/2,s-t/2,r-t/2,s-t/4),i.bezierCurveTo(r-t/2,s+t/4,r,s+t/2,r,s+t/2),i.bezierCurveTo(r,s+t/2,r+t/2,s+t/4,r+t/2,s-t/4),i.bezierCurveTo(r+t/2,s-t/2,r,s-t/2,r,s-t/4),i.fill()}else if(e==="random")for(let t=0;t<8;t++)i.fillStyle=`rgba(255, 255, 255, ${.2*Math.random()})`,i.beginPath(),i.arc(Math.random()*a,Math.random()*l,Math.random()*a/8+10,0,2*Math.PI),i.fill();else if(e==="new"){i.fillStyle="rgba(255, 255, 255, 0.2)";const t=a/6,r=a/2-t/2,s=l/2-t/2;i.fillRect(r-t,s+t/2-t/6,3*t,t/3),i.fillRect(r+t/2-t/6,s-t,t/3,3*t)}else if(e==="all")for(let t=0;t<5;t++)i.fillStyle=`rgba(255, 255, 255, ${.1+.02*t})`,i.fillRect(a/4,l/3+t*l/15,a/2,l/30);else for(let t=0;t<3;t++)i.fillStyle=`rgba(255, 255, 255, ${.1-.03*t})`,i.fillRect(a/4,l/4+t*l/12,a/2,l/15);return o.toDataURL("image/jpeg",.9)},y=(e,a="album")=>{if(!e||e===""||typeof e!="string")return d(a||"album");!e||e.startsWith("/")||e.startsWith("http")||(e="/"+e);try{if(e&&(e.includes("/uploads/system/")||e.includes("/static/uploads/system/"))){const l={"like_playlist.jpg":d("liked"),"all_tracks.jpg":d("all"),"random_tracks.jpg":d("random"),"album_placeholder.jpg":d("album"),"playlist_placeholder.jpg":d("playlist")};for(const[o,i]of Object.entries(l))if(e.includes(o))return e}return e}catch{return d(a||"album")}},$=(e,a)=>{const l=new Image;l.crossOrigin="Anonymous",l.onload=()=>{const o=document.createElement("canvas"),i=o.getContext("2d");o.width=l.width,o.height=l.height,i.drawImage(l,0,0);const c=l.width/2,n=l.height/2,h=i.getImageData(c,n,1,1).data;a(`${h[0]}, ${h[1]}, ${h[2]}`)},l.onerror=()=>{a(null)},l.src=e},m=new Map,v=async(e,a={})=>{const{quality:l=.85,maxWidth:o=1920,cacheResults:i=!0}=a,c=`${e}-${o}-${l}`;if(i&&m.has(c))return m.get(c);if(!e||e.startsWith("http")&&!e.includes(window.location.host)||!R(e)){const n={src:e,width:0,height:0};return i&&m.set(c,n),n}try{const n=await C(e),{naturalWidth:h,naturalHeight:t}=n;if(h<=o){const b={src:e,width:h,height:t};return i&&m.set(c,b),b}const r=document.createElement("canvas"),s=r.getContext("2d"),f=h/t,u=o,p=Math.round(u/f);r.width=u,r.height=p,s.drawImage(n,0,0,u,p);const x=g()?"image/webp":"image/jpeg",w={src:r.toDataURL(x,l),width:u,height:p};return i&&m.set(c,w),w}catch{return{src:e,width:0,height:0}}},C=e=>new Promise((a,l)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>a(o),o.onerror=i=>l(i),o.src=e}),R=e=>{if(!e)return!1;const a=e.toLowerCase();return[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".tiff",".avif"].some(l=>a.endsWith(l))||a.includes("/image/")||a.includes("image_url=")},g=()=>{if(g.cached!==void 0)return g.cached;const e=document.createElement("canvas");return e.getContext&&e.getContext("2d")?g.cached=e.toDataURL("image/webp").indexOf("data:image/webp")===0:g.cached=!1,g.cached},j=(e=300,a=150,l="",o="#e0e0e0",i="#666666")=>{try{const c=document.createElement("canvas");c.width=e,c.height=a;const n=c.getContext("2d");if(n.fillStyle=o,n.fillRect(0,0,e,a),l){n.fillStyle=i,n.font=`bold ${Math.floor(a/10)}px Arial, sans-serif`,n.textAlign="center",n.textBaseline="middle";const t=.8*e;let r=l,s=n.measureText(r).width;if(s>t){let f=r.length;for(;s>t&&f>0;)f--,r=r.substring(0,f)+"...",s=n.measureText(r).width}n.fillText(r,e/2,a/2)}const h=`${e}\xD7${a}`;return n.font=`${Math.floor(a/20)}px Arial, sans-serif`,n.fillText(h,e/2,a-Math.floor(a/15)),c.toDataURL("image/png")}catch{return`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${a}' viewBox='0 0 ${e} ${a}'%3E%3Crect width='${e}' height='${a}' fill='%23e0e0e0'/%3E%3Ctext x='50%25' y='50%25' font-family='Arial' font-size='16' text-anchor='middle' fill='%23666666'%3E${e}\xD7${a}%3C/text%3E%3C/svg%3E`}};export{y as a,$ as e,j as g,v as o};
