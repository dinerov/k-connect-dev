{"version":3,"file":"MessengerPage.DflbkRuK.js","sources":["../../node_modules/@mui/icons-material/Refresh.js","../../src/components/Messenger/ChatItem.js","../../src/components/Messenger/SearchUsers.js","../../node_modules/@mui/icons-material/PersonSearch.js","../../src/components/Messenger/ChatList.js","../../src/components/Messenger/MessageInput.js","../../node_modules/@mui/icons-material/ZoomOut.js","../../node_modules/@mui/icons-material/RotateLeft.js","../../node_modules/@mui/icons-material/RotateRight.js","../../src/components/SimpleImageViewerMes.js","../../src/components/Messenger/TypingIndicator.js","../../src/components/Messenger/ChatWindow.js","../../src/components/Messenger/MessageItem.js","../../src/hooks/useIntersectionObserver.js","../../src/pages/Messenger/MessengerPage.js"],"sourcesContent":["\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z\"\n}), 'Refresh');","import React, { useMemo, memo, useEffect, useState } from 'react';\nimport { useMessenger } from '../../contexts/MessengerContext';\n\nconst ChatItem = ({ \n  chat, \n  isActive, \n  unreadCount, \n  onClick, \n  currentUserId,\n  onlineUsers\n}) => {\n  const { getUserInfo } = useMessenger();\n  const [otherUserDetails, setOtherUserDetails] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  \n  \n  const otherMember = useMemo(() => {\n    if (chat.is_group) return null;\n    \n    \n    if (!chat.members || !Array.isArray(chat.members) || chat.members.length === 0) {\n      console.error(`Chat ${chat.id} has no valid members array:`, chat);\n      return null;\n    }\n    \n    console.log(`Finding other member for chat ${chat.id}. Current user: ${currentUserId}. Members:`, chat.members);\n    \n    \n    const other = chat.members.find(member => {\n      \n      const memberId = member.user_id || member.id || (member.user && member.user.id);\n      \n      \n      if (!memberId) {\n        console.warn(`Member without ID found in chat ${chat.id}:`, member);\n      }\n      \n      return memberId && memberId !== currentUserId;\n    });\n    \n    if (!other) {\n      console.error(`Could not find other member in chat ${chat.id}. Members:`, chat.members);\n    } else {\n      console.log(`Found other member in chat ${chat.id}:`, other);\n    }\n    \n    return other;\n  }, [chat, currentUserId]);\n  \n  \n  useEffect(() => {\n    if (chat.is_group || !otherMember) return;\n    \n    const loadUserDetails = async () => {\n      \n      const otherUserId = otherMember.user_id || otherMember.id || (otherMember.user && otherMember.user.id);\n      \n      if (!otherUserId) {\n        console.error(`Cannot find valid user ID for other member in chat ${chat.id}:`, otherMember);\n        return;\n      }\n      \n      if (!isLoading && !otherUserDetails) {\n        setIsLoading(true);\n        try {\n          console.log(`Loading details for user ${otherUserId} in chat ${chat.id}`);\n          const userInfo = await getUserInfo(otherUserId);\n          if (userInfo) {\n            console.log(`Got details for user ${otherUserId}:`, userInfo.name);\n            setOtherUserDetails(userInfo);\n          } else {\n            console.warn(`No user info returned for ${otherUserId}`);\n          }\n        } catch (err) {\n          console.error(`Error loading user info for ${otherUserId}:`, err);\n        } finally {\n          setIsLoading(false);\n        }\n      }\n    };\n    \n    loadUserDetails();\n  }, [chat, otherMember, getUserInfo, isLoading, otherUserDetails]);\n  \n  \n  const title = useMemo(() => {\n    \n    if (chat.is_group) {\n      return chat.title || '–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç';\n    }\n    \n    \n    if (!otherMember) {\n      console.error(`Personal chat ${chat.id} has no other member:`, chat);\n      return `–ß–∞—Ç ${chat.id}`;\n    }\n    \n    \n    const otherUserId = otherMember.user_id || otherMember.id || (otherMember.user && otherMember.user.id);\n    \n    \n    if (otherUserDetails) {\n      return otherUserDetails.name || otherUserDetails.username || `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${otherUserId}`;\n    }\n    \n    \n    const memberName = otherMember.name \n      || (otherMember.user && otherMember.user.name)\n      || otherMember.username\n      || (otherMember.user && otherMember.user.username);\n    \n    if (memberName && memberName !== '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') {\n      return memberName;\n    }\n    \n    \n    if (isLoading) {\n      return '–ó–∞–≥—Ä—É–∑–∫–∞...';\n    }\n    \n    \n    return `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${otherUserId}`;\n  }, [chat, otherMember, otherUserDetails, isLoading]);\n  \n  \n  const isOnline = useMemo(() => {\n    if (chat.is_group || !otherMember) return false;\n    \n    const otherUserId = otherMember.user_id || otherMember.id || (otherMember.user && otherMember.user.id);\n    if (!otherUserId) return false;\n    \n    return !!onlineUsers[otherUserId];\n  }, [chat, otherMember, onlineUsers]);\n  \n  \n  const lastMessagePreview = useMemo(() => {\n    const message = chat.last_message;\n    if (!message) return '';\n    \n    \n    let senderName = '';\n    \n    \n    if (message.sender_id === currentUserId) {\n      senderName = '–í—ã';\n    } \n    \n    else if (!chat.is_group) {\n      \n      senderName = '';\n    }\n    \n    else {\n      \n      if (otherMember && message.sender_id === (otherMember.user_id || otherMember.id)) {\n        senderName = otherUserDetails?.name || otherMember.name || '–£—á–∞—Å—Ç–Ω–∏–∫';\n      }\n      \n      else {\n        const sender = chat.members?.find(\n          member => (member.user_id || member.id) === message.sender_id\n        );\n        \n        if (sender) {\n          senderName = sender.name || (sender.user && sender.user.name) || message.sender_name || '–£—á–∞—Å—Ç–Ω–∏–∫';\n        } else {\n          senderName = message.sender_name || '–£—á–∞—Å—Ç–Ω–∏–∫';\n        }\n      }\n    }\n    \n    \n    const senderPrefix = chat.is_group && message.sender_id !== currentUserId\n      ? `${senderName}: `\n      : '';\n    \n    \n    switch (message.message_type) {\n      case 'text':\n        return `${senderPrefix}${message.content}`;\n      case 'photo':\n        return `${senderPrefix}üì∑ –§–æ—Ç–æ`;\n      case 'video':\n        return `${senderPrefix}üé¨ –í–∏–¥–µ–æ`;\n      case 'audio':\n        return `${senderPrefix}üéµ –ê—É–¥–∏–æ`;\n      case 'file':\n        return `${senderPrefix}üìé –§–∞–π–ª: ${message.original_filename || '—Ñ–∞–π–ª'}`;\n      default:\n        return `${senderPrefix}–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ`;\n    }\n  }, [chat, currentUserId, otherMember, otherUserDetails]);\n  \n  \n  const lastMessageTime = useMemo(() => {\n    const message = chat.last_message;\n    if (!message) return '';\n    \n    try {\n      \n      if (typeof message.created_at === 'string' && /^\\d{1,2}:\\d{2}$/.test(message.created_at)) {\n        return message.created_at;\n      }\n      \n      \n      if (typeof message.created_at === 'string' && /^\\d{1,2}\\s+\\w+$/.test(message.created_at)) {\n        return message.created_at;\n      }\n      \n      \n      const date = message.created_at instanceof Date ? message.created_at : new Date(message.created_at);\n      if (isNaN(date.getTime())) {\n        console.error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:', message.created_at);\n        \n        return typeof message.created_at === 'string' ? message.created_at : '';\n      }\n      \n      const now = new Date();\n      \n      \n      const dateString = date.toLocaleDateString();\n      const nowString = now.toLocaleDateString();\n      \n      \n      const yesterday = new Date(now);\n      yesterday.setDate(now.getDate() - 1);\n      const yesterdayString = yesterday.toLocaleDateString();\n      \n      \n      if (dateString === nowString) {\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n      }\n      \n      \n      if (dateString === yesterdayString) {\n        return '–í—á–µ—Ä–∞';\n      }\n      \n      \n      return date.toLocaleDateString([], { day: '2-digit', month: '2-digit' });\n    } catch (e) {\n      console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', e);\n      \n      return typeof message.created_at === 'string' ? message.created_at : '';\n    }\n  }, [chat]);\n  \n  \n  const avatarLetter = title?.[0]?.toUpperCase() || '?';\n  \n  \n  console.log(`ChatItem ${chat.id} render:`, { \n    title, \n    avatar: chat.avatar, \n    is_group: chat.is_group\n  });\n  \n  return (\n    <div \n      className={`chat-item ${isActive ? 'active' : ''} ${unreadCount > 0 ? 'unread' : ''}`}\n      onClick={onClick}\n    >\n      <div className=\"chat-avatar-container\">\n        <div className=\"chat-avatar\">\n          {chat.avatar ? (\n            <img \n              src={chat.avatar} \n              alt={title} \n              style={{\n                objectFit: 'cover',\n                \n                ...(chat.avatar.toLowerCase().endsWith('.gif') && {\n                  objectFit: 'contain',\n                  background: 'transparent'\n                })\n              }}\n            />\n          ) : (\n            <div className=\"avatar-placeholder\">\n              {avatarLetter}\n            </div>\n          )}\n        </div>\n        {isOnline && (\n          <span \n            className=\"online-indicator\" \n            style={{ \n              position: 'absolute',\n              bottom: '2px',\n              right: '2px',\n              width: '12px',\n              height: '12px',\n              borderRadius: '50%',\n              backgroundColor: '#4CAF50',\n              border: '2px solid var(--background-color, #1A1A1A)',\n              zIndex: 2\n            }}\n          />\n        )}\n      </div>\n      \n      <div className=\"chat-info\">\n        <div className=\"chat-title-row\">\n          <h4 className=\"chat-title\">\n            {title}\n            {chat.encrypted && <span className=\"encrypted-badge\">üîí</span>}\n          </h4>\n          <span className=\"chat-time\">{lastMessageTime}</span>\n        </div>\n        \n        <div className=\"chat-preview-row\">\n          <p className=\"last-message\">{lastMessagePreview}</p>\n          \n          {unreadCount > 0 && (\n            <span className=\"unread-counter\">{unreadCount}</span>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n\nexport default memo(ChatItem); ","import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useMessenger } from '../../contexts/MessengerContext';\n\nconst SearchUsers = ({ onClose }) => {\n  const { \n    searchUsers, \n    createPersonalChat,\n    setActiveChat,\n    getChatDetails\n  } = useMessenger();\n  \n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [creating, setCreating] = useState(false);\n  const searchTimeout = useRef(null);\n  \n  \n  useEffect(() => {\n    if (query.trim().length < 2) {\n      setResults([]);\n      return;\n    }\n    \n    \n    if (searchTimeout.current) {\n      clearTimeout(searchTimeout.current);\n    }\n    \n    \n    searchTimeout.current = setTimeout(async () => {\n      setLoading(true);\n      setError(null);\n      \n      try {\n        const users = await searchUsers(query);\n        setResults(users);\n      } catch (err) {\n        console.error('Error searching users:', err);\n        setError('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');\n      } finally {\n        setLoading(false);\n      }\n    }, 300); \n    \n    \n    return () => {\n      if (searchTimeout.current) {\n        clearTimeout(searchTimeout.current);\n      }\n    };\n  }, [query, searchUsers]);\n  \n  \n  const handleStartChat = useCallback(async (userId, existingChatId = null) => {\n    if (creating) return;\n    \n    try {\n      setCreating(true);\n      \n      let chatId;\n      \n      if (existingChatId) {\n        \n        const chatDetails = await getChatDetails(existingChatId);\n        chatId = chatDetails?.id || null;\n      } else {\n        \n        chatId = await createPersonalChat(userId);\n      }\n      \n      if (chatId) {\n        \n        setActiveChat(chatId);\n        \n        onClose();\n      }\n    } catch (err) {\n      console.error('Error starting chat:', err);\n      setError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —á–∞—Ç');\n    } finally {\n      setCreating(false);\n    }\n  }, [createPersonalChat, setActiveChat, onClose, getChatDetails, creating]);\n  \n  \n  const renderResults = () => {\n    if (loading) {\n      return <div className=\"search-loading\">–ü–æ–∏—Å–∫...</div>;\n    }\n    \n    if (error) {\n      return <div className=\"search-error\">{error}</div>;\n    }\n    \n    if (results.length === 0) {\n      if (query.trim().length >= 2) {\n        return <div className=\"search-empty\">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>;\n      }\n      return <div className=\"search-hint\">–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>;\n    }\n    \n    return (\n      <div className=\"search-results\">\n        {results.map(user => (\n          <div key={user.id} className=\"search-user-item\">\n            <div className=\"user-avatar\">\n              {user.name?.[0]?.toUpperCase() || user.username?.[0]?.toUpperCase() || 'U'}\n            </div>\n            \n            <div className=\"user-info\">\n              <div className=\"user-name\">{user.name}</div>\n              <div className=\"user-username\">@{user.username}</div>\n            </div>\n            \n            <button\n              className=\"start-chat-btn\"\n              onClick={() => handleStartChat(user.id, user.existing_chat_id)}\n              disabled={creating}\n            >\n              {user.has_chat ? '–û—Ç–∫—Ä—ã—Ç—å' : '–ù–∞–ø–∏—Å–∞—Ç—å'}\n            </button>\n          </div>\n        ))}\n      </div>\n    );\n  };\n  \n  return (\n    <div className=\"search-users\">\n      <div className=\"search-header\">\n        <h3>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>\n      </div>\n      \n      <div className=\"search-input-container\">\n        <input\n          type=\"text\"\n          className=\"search-input\"\n          placeholder=\"–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ –ª–æ–≥–∏–Ω...\"\n          value={query}\n          onChange={(e) => setQuery(e.target.value)}\n          autoFocus\n        />\n        {query && (\n          <button\n            className=\"clear-search\"\n            onClick={() => setQuery('')}\n          >\n            √ó\n          </button>\n        )}\n      </div>\n      \n      {renderResults()}\n    </div>\n  );\n};\n\nexport default SearchUsers; ","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)([/*#__PURE__*/(0, _jsxRuntime.jsx)(\"circle\", {\n  cx: \"10\",\n  cy: \"8\",\n  r: \"4\"\n}, \"0\"), /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M10.35 14.01C7.62 13.91 2 15.27 2 18v2h9.54c-2.47-2.76-1.23-5.89-1.19-5.99m9.08 4.01c.36-.59.57-1.28.57-2.02 0-2.21-1.79-4-4-4s-4 1.79-4 4 1.79 4 4 4c.74 0 1.43-.22 2.02-.57L20.59 22 22 20.59zM16 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2\"\n}, \"1\")], 'PersonSearch');","import React, { useState, useEffect, useCallback, memo, useRef } from 'react';\nimport { useMessenger } from '../../contexts/MessengerContext';\nimport ChatItem from './ChatItem';\nimport SearchUsers from './SearchUsers';\nimport IconButton from '@mui/material/IconButton';\nimport PersonSearchIcon from '@mui/icons-material/PersonSearch';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\nimport ClearIcon from '@mui/icons-material/Clear';\n\nconst ChatList = ({ onSelectChat }) => {\n  const { \n    chats, \n    loading, \n    activeChat, \n    setActiveChat,\n    unreadCounts,\n    refreshChats,\n    onlineUsers,\n    user\n  } = useMessenger();\n  \n  const [searchMode, setSearchMode] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [filteredChats, setFilteredChats] = useState([]);\n  const initialLoadRef = useRef(false);\n  \n  \n  useEffect(() => {\n    if (!initialLoadRef.current) {\n      initialLoadRef.current = true;\n      console.log('ChatList: Force refreshing chats on initial render');\n      refreshChats();\n      \n      \n      const handleVisibilityChange = () => {\n        if (document.visibilityState === 'visible') {\n          console.log('ChatList: Window became visible, refreshing chats...');\n          refreshChats();\n        }\n      };\n      \n      \n      document.addEventListener('visibilitychange', handleVisibilityChange);\n      \n      \n      const refreshTimer = setInterval(() => {\n        if (document.visibilityState === 'visible') {\n          console.log('ChatList: Running periodic refresh to ensure updated avatars');\n          refreshChats();\n        }\n      }, 30000); \n      \n      return () => {\n        clearInterval(refreshTimer);\n        document.removeEventListener('visibilitychange', handleVisibilityChange);\n      };\n    }\n  }, [refreshChats]);\n  \n  \n  useEffect(() => {\n    if (!searchQuery.trim()) {\n      setFilteredChats(chats);\n      return;\n    }\n    \n    const query = searchQuery.toLowerCase();\n    const filtered = chats.filter(chat => {\n      \n      if (chat.title && chat.title.toLowerCase().includes(query)) {\n        return true;\n      }\n      \n      \n      if (!chat.is_group && chat.members) {\n        const otherMember = chat.members.find(member => member.user_id !== user?.id);\n        if (otherMember && (\n          (otherMember.name && otherMember.name.toLowerCase().includes(query)) ||\n          (otherMember.username && otherMember.username.toLowerCase().includes(query))\n        )) {\n          return true;\n        }\n      }\n      \n      \n      if (chat.last_message && \n          chat.last_message.message_type === 'text' && \n          chat.last_message.content &&\n          chat.last_message.content.toLowerCase().includes(query)) {\n        return true;\n      }\n      \n      return false;\n    });\n    \n    setFilteredChats(filtered);\n  }, [searchQuery, chats, user]);\n  \n  \n  const toggleSearchMode = useCallback(() => {\n    setSearchMode(prev => !prev);\n    \n    if (searchMode) {\n      setSearchQuery('');\n    }\n  }, [searchMode]);\n  \n  \n  const handleChatSelect = useCallback((chatId) => {\n    console.log('ChatList: Handling chat selection for chat ID:', chatId);\n    \n    setActiveChat(chatId);\n    \n    \n    if (onSelectChat) {\n      console.log('ChatList: Calling external onSelectChat handler');\n      onSelectChat();\n    }\n  }, [setActiveChat, onSelectChat]);\n  \n  \n  const handleRefreshChats = useCallback(() => {\n    refreshChats();\n  }, [refreshChats]);\n  \n  \n  const renderHeader = () => {\n    return (\n      <div className=\"chat-list-header\">\n        <h2>–°–æ–æ–±—â–µ–Ω–∏—è</h2>\n        <div className=\"header-actions\">\n          <IconButton \n            size=\"small\"\n            color={searchMode ? \"primary\" : \"default\"}\n            onClick={toggleSearchMode}\n            title={searchMode ? \"–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–∞—Ç–∞–º\" : \"–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"}\n          >\n            {searchMode ? <ArrowBackIcon /> : <PersonSearchIcon />}\n          </IconButton>\n          <IconButton \n            size=\"small\"\n            onClick={handleRefreshChats}\n            title=\"–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤\"\n          >\n            <RefreshIcon />\n          </IconButton>\n        </div>\n      </div>\n    );\n  };\n  \n  \n  const renderSearch = () => {\n    if (searchMode) {\n      return <SearchUsers onClose={toggleSearchMode} />;\n    }\n    \n    return (\n      <div className=\"chat-search\">\n        <input\n          type=\"text\"\n          placeholder=\"–ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º...\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n        />\n        {searchQuery && (\n          <IconButton\n            size=\"small\"\n            onClick={() => setSearchQuery('')}\n            sx={{ padding: '4px' }}\n            title=\"–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫\"\n          >\n            <ClearIcon fontSize=\"small\" />\n          </IconButton>\n        )}\n      </div>\n    );\n  };\n  \n  \n  const renderContent = () => {\n    if (loading) {\n      return <div className=\"chat-list-loading\">–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤...</div>;\n    }\n    \n    if (filteredChats.length === 0) {\n      return (\n        <div className=\"chat-list-empty\">\n          {searchQuery\n            ? '–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É'\n            : '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —á–∞—Ç–æ–≤. –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –±–µ—Å–µ–¥—É.'}\n        </div>\n      );\n    }\n    \n    return (\n      <div className=\"chat-list-items\">\n        {filteredChats.map(chat => (\n          <ChatItem\n            key={chat.id}\n            chat={chat}\n            isActive={activeChat?.id === chat.id}\n            unreadCount={unreadCounts[chat.id] || 0}\n            onClick={() => handleChatSelect(chat.id)}\n            currentUserId={user?.id}\n            onlineUsers={onlineUsers}\n          />\n        ))}\n      </div>\n    );\n  };\n  \n  return (\n    <div className=\"chat-list\">\n      {renderHeader()}\n      {renderSearch()}\n      {!searchMode && renderContent()}\n    </div>\n  );\n};\n\nexport default memo(ChatList); ","import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport IconButton from '@mui/material/IconButton';\nimport SendIcon from '@mui/icons-material/Send';\nimport AttachFileIcon from '@mui/icons-material/AttachFile';\nimport PhotoIcon from '@mui/icons-material/Photo';\nimport CloseIcon from '@mui/icons-material/Close';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Box from '@mui/material/Box';\n\nconst MessageInput = ({ \n  onSendMessage, \n  onTyping,\n  onFileUpload,\n  replyTo,\n  onCancelReply\n}) => {\n  const [message, setMessage] = useState('');\n  const [isUploading, setIsUploading] = useState(false);\n  const [typingTimeout, setTypingTimeout] = useState(null);\n  const fileInputRef = useRef(null);\n  const textareaRef = useRef(null);\n  \n  \n  useEffect(() => {\n    return () => {\n      if (typingTimeout) {\n        clearTimeout(typingTimeout);\n        \n        onTyping(false);\n      }\n    };\n  }, [typingTimeout, onTyping]);\n  \n  \n  useEffect(() => {\n    if (replyTo && textareaRef.current) {\n      textareaRef.current.focus();\n    }\n  }, [replyTo]);\n  \n  \n  const handleSendMessage = useCallback(() => {\n    if (!message.trim() && !isUploading) return;\n    \n    const currentMessage = message;\n    \n    \n    const messageToSend = currentMessage;\n    \n    \n    \n    setMessage(' ');\n    \n    \n    setTimeout(() => {\n      \n      setMessage('');\n      \n      \n      if (textareaRef.current) {\n        textareaRef.current.focus();\n      }\n      \n      \n      onSendMessage(messageToSend);\n    }, 10);\n    \n    \n    if (typingTimeout) {\n      clearTimeout(typingTimeout);\n      setTypingTimeout(null);\n    }\n    \n    onTyping(false);\n  }, [message, onSendMessage, typingTimeout, onTyping, isUploading]);\n  \n  \n  const handleKeyDown = useCallback((e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  }, [handleSendMessage]);\n  \n  \n  const handleMessageChange = useCallback((e) => {\n    const newMessage = e.target.value;\n    setMessage(newMessage);\n    \n    \n    if (newMessage.trim() && !typingTimeout) {\n      onTyping(true);\n      \n      \n      const timeout = setTimeout(() => {\n        onTyping(false);\n        setTypingTimeout(null);\n      }, 3000);\n      \n      setTypingTimeout(timeout);\n    } else if (!newMessage.trim() && typingTimeout) {\n      clearTimeout(typingTimeout);\n      onTyping(false);\n      setTypingTimeout(null);\n    } else if (typingTimeout) {\n      \n      clearTimeout(typingTimeout);\n      const timeout = setTimeout(() => {\n        onTyping(false);\n        setTypingTimeout(null);\n      }, 3000);\n      \n      setTypingTimeout(timeout);\n    }\n  }, [onTyping, typingTimeout]);\n  \n  \n  const triggerFileUpload = useCallback(() => {\n    \n    if (fileInputRef.current) {\n      fileInputRef.current.setAttribute('data-upload-type', 'photo');\n      fileInputRef.current.click();\n    }\n  }, []);\n  \n  \n  const handleFileChange = useCallback((e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n    \n    const uploadType = 'photo';\n    \n    \n    if (file.size > 50 * 1024 * 1024) {\n      alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 50MB');\n      return;\n    }\n    \n    \n    const fileType = file.type.split('/')[0];\n    if (fileType !== 'image') {\n      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');\n      return;\n    }\n    \n    \n    setIsUploading(true);\n    \n    \n    onFileUpload(file, uploadType)\n      .finally(() => {\n        setIsUploading(false);\n        \n        if (fileInputRef.current) {\n          fileInputRef.current.value = '';\n        }\n      });\n  }, [onFileUpload]);\n  \n  \n  const renderReplyInfo = () => {\n    if (!replyTo) return null;\n    \n    let previewContent = '';\n    if (replyTo.message_type === 'text') {\n      previewContent = replyTo.content.length > 30 \n        ? replyTo.content.substring(0, 30) + '...'\n        : replyTo.content;\n    } else if (replyTo.message_type === 'photo') {\n      previewContent = 'üì∑ –§–æ—Ç–æ';\n    } else if (replyTo.message_type === 'video') {\n      previewContent = 'üé¨ –í–∏–¥–µ–æ';\n    } else if (replyTo.message_type === 'audio') {\n      previewContent = 'üéµ –ê—É–¥–∏–æ';\n    } else {\n      previewContent = 'üìé –§–∞–π–ª';\n    }\n    \n    return (\n      <Box\n        sx={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          padding: '8px 12px',\n          marginBottom: '4px',\n          borderRadius: '12px 12px 0 0',\n          backgroundColor: '#252525',\n          borderLeft: '2px solid #D0BCFF'\n        }}\n      >\n        <div className=\"reply-text\" style={{ color: '#d8d8d8' }}>\n          <div style={{ fontSize: '13px', fontWeight: 'bold', color: '#D0BCFF' }}>\n            {replyTo.sender_name}\n          </div>\n          <div style={{ fontSize: '13px' }}>{previewContent}</div>\n        </div>\n        <IconButton \n          size=\"small\" \n          onClick={onCancelReply}\n          sx={{ \n            color: '#6b6b6b',\n            padding: '4px'\n          }}\n        >\n          <CloseIcon fontSize=\"small\" />\n        </IconButton>\n      </Box>\n    );\n  };\n  \n  return (\n    <Box\n      sx={{\n        borderTop: '1px solid #2C2C2C',\n        padding: '8px',\n        backgroundColor: '#121212',\n        display: 'flex',\n        flexDirection: 'column',\n        position: 'relative'\n      }}\n    >\n      {renderReplyInfo()}\n      \n      <Box\n        sx={{\n          display: 'flex',\n          alignItems: 'center',\n          backgroundColor: '#1C1C1C',\n          borderRadius: '18px',\n          padding: '0 4px'\n        }}\n      >\n        <IconButton \n          size=\"small\"\n          onClick={triggerFileUpload}\n          sx={{ \n            color: '#D0BCFF', \n            padding: '8px',\n            '&:hover': { \n              color: '#D0BCFF'\n            }\n          }}\n        >\n          <PhotoIcon fontSize=\"small\" />\n        </IconButton>\n        \n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"image/*\"\n          onChange={handleFileChange}\n          style={{ display: 'none' }}\n        />\n        \n        <textarea\n          ref={textareaRef}\n          value={message}\n          onChange={handleMessageChange}\n          onKeyDown={handleKeyDown}\n          placeholder=\"–°–æ–æ–±—â–µ–Ω–∏–µ...\"\n          disabled={isUploading}\n          style={{\n            border: 'none',\n            backgroundColor: 'transparent',\n            color: '#ffffff',\n            resize: 'none',\n            outline: 'none',\n            margin: '0',\n            flex: 1,\n            minHeight: '20px',\n            maxHeight: '80px',\n            fontSize: '14px',\n            fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif',\n            alignContent: 'center'\n          }}\n        />\n        \n        <IconButton \n          size=\"small\"\n          onClick={handleSendMessage}\n          disabled={!message.trim() && !isUploading}\n          sx={{\n            color: message.trim() ? '#D0BCFF' : '#3a3a3a',\n            padding: '8px',\n            '&:hover': { \n              color: message.trim() ? '#D0BCFF' : '#3a3a3a'\n            }\n          }}\n        >\n          {isUploading ? (\n            <CircularProgress size={18} color=\"inherit\" />\n          ) : (\n            <SendIcon fontSize=\"small\" />\n          )}\n        </IconButton>\n      </Box>\n    </Box>\n  );\n};\n\nexport default React.memo(MessageInput); ","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z\"\n}), 'ZoomOut');","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47M6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47m1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93\"\n}), 'RotateLeft');","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M15.55 5.55 11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03m3.89-2.42 1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48\"\n}), 'RotateRight');","import React, { useState, useEffect } from 'react';\nimport { IconButton } from '@mui/material';\nimport CloseIcon from '@mui/icons-material/Close';\nimport ZoomInIcon from '@mui/icons-material/ZoomIn';\nimport ZoomOutIcon from '@mui/icons-material/ZoomOut';\nimport RotateLeftIcon from '@mui/icons-material/RotateLeft';\nimport RotateRightIcon from '@mui/icons-material/RotateRight';\n\n/**\n * –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞\n */\nconst SimpleImageViewerMes = ({ src, onClose }) => {\n  const [scale, setScale] = useState(1);\n  const [rotation, setRotation] = useState(0);\n  const [isDragging, setIsDragging] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  \n  // –ó–∞–∫—Ä—ã—Ç–∏–µ –Ω–∞ Escape\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n    \n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [onClose]);\n  \n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑—É–º–∞ –∏ –ø–æ–≤–æ—Ä–æ—Ç–∞\n  const zoomIn = () => setScale(prev => Math.min(prev + 0.25, 3));\n  const zoomOut = () => setScale(prev => Math.max(prev - 0.25, 0.5));\n  const rotateLeft = () => setRotation(prev => prev - 90);\n  const rotateRight = () => setRotation(prev => prev + 90);\n  \n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n  const handleMouseDown = (e) => {\n    if (scale <= 1) return;\n    \n    setIsDragging(true);\n    setDragStart({\n      x: e.clientX - position.x,\n      y: e.clientY - position.y\n    });\n  };\n  \n  const handleMouseMove = (e) => {\n    if (!isDragging) return;\n    \n    setPosition({\n      x: e.clientX - dragStart.x,\n      y: e.clientY - dragStart.y\n    });\n  };\n  \n  const handleMouseUp = () => {\n    setIsDragging(false);\n  };\n  \n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤\n  const handleTouchStart = (e) => {\n    if (scale <= 1) return;\n    \n    setIsDragging(true);\n    setDragStart({\n      x: e.touches[0].clientX - position.x,\n      y: e.touches[0].clientY - position.y\n    });\n  };\n  \n  const handleTouchMove = (e) => {\n    if (!isDragging) return;\n    \n    setPosition({\n      x: e.touches[0].clientX - dragStart.x,\n      y: e.touches[0].clientY - dragStart.y\n    });\n  };\n  \n  const handleTouchEnd = () => {\n    setIsDragging(false);\n  };\n  \n  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑—É–º –∏ –≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ –¥–≤–æ–π–Ω–æ–º—É –∫–ª–∏–∫—É/—Ç–∞–ø—É\n  const handleDoubleClick = () => {\n    setScale(1);\n    setRotation(0);\n    setPosition({ x: 0, y: 0 });\n  };\n  \n  return (\n    <div \n      className=\"simple-image-viewer-overlay\"\n      onClick={onClose}\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundColor: 'rgba(0, 0, 0, 0.95)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 10000,\n        cursor: isDragging ? 'grabbing' : 'grab'\n      }}\n    >\n      <img \n        src={src} \n        alt=\"–ü—Ä–æ—Å–º–æ—Ç—Ä\" \n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n        onDoubleClick={handleDoubleClick}\n        onClick={(e) => e.stopPropagation()}\n        style={{ \n          maxWidth: '90%', \n          maxHeight: '90%', \n          objectFit: 'contain',\n          transform: `scale(${scale}) rotate(${rotation}deg) translate(${position.x / scale}px, ${position.y / scale}px)`,\n          transition: isDragging ? 'none' : 'transform 0.2s ease',\n          cursor: isDragging ? 'grabbing' : 'grab'\n        }} \n      />\n      \n      {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}\n      <div \n        className=\"image-viewer-controls\"\n        onClick={(e) => e.stopPropagation()}\n        style={{\n          position: 'absolute',\n          bottom: '20px',\n          display: 'flex',\n          gap: '10px',\n          background: 'rgba(0, 0, 0, 0.6)',\n          padding: '8px',\n          borderRadius: '24px',\n          backdropFilter: 'blur(8px)'\n        }}\n      >\n        <IconButton onClick={zoomIn} size=\"small\" sx={{ color: 'white' }}>\n          <ZoomInIcon />\n        </IconButton>\n        <IconButton onClick={zoomOut} size=\"small\" sx={{ color: 'white' }}>\n          <ZoomOutIcon />\n        </IconButton>\n        <IconButton onClick={rotateLeft} size=\"small\" sx={{ color: 'white' }}>\n          <RotateLeftIcon />\n        </IconButton>\n        <IconButton onClick={rotateRight} size=\"small\" sx={{ color: 'white' }}>\n          <RotateRightIcon />\n        </IconButton>\n      </div>\n      \n      {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è */}\n      <IconButton\n        sx={{\n          position: 'absolute',\n          top: '20px',\n          right: '20px',\n          color: 'white',\n          backgroundColor: 'rgba(0, 0, 0, 0.6)',\n          '&:hover': {\n            backgroundColor: 'rgba(0, 0, 0, 0.8)',\n          }\n        }}\n        onClick={onClose}\n      >\n        <CloseIcon />\n      </IconButton>\n    </div>\n  );\n};\n\nexport default SimpleImageViewerMes; ","import React, { memo } from 'react';\n\nconst TypingIndicator = ({ userIds = [], chatMembers = [] }) => {\n  if (!userIds.length) return null;\n  \n  \n  const typingUserNames = userIds.map(userId => {\n    const member = chatMembers.find(m => m.user_id === parseInt(userId));\n    return member?.name || member?.username || '–ö—Ç–æ-—Ç–æ';\n  });\n  \n  \n  let typingText = '';\n  if (typingUserNames.length === 1) {\n    typingText = `${typingUserNames[0]} –ø–µ—á–∞—Ç–∞–µ—Ç...`;\n  } else if (typingUserNames.length === 2) {\n    typingText = `${typingUserNames[0]} –∏ ${typingUserNames[1]} –ø–µ—á–∞—Ç–∞—é—Ç...`;\n  } else if (typingUserNames.length > 2) {\n    typingText = `${typingUserNames.length} —á–µ–ª–æ–≤–µ–∫ –ø–µ—á–∞—Ç–∞—é—Ç...`;\n  }\n  \n  return (\n    <div className=\"typing-indicator\">\n      <div className=\"typing-animation\">\n        <span className=\"dot\"></span>\n        <span className=\"dot\"></span>\n        <span className=\"dot\"></span>\n      </div>\n      <span className=\"typing-text\">{typingText}</span>\n    </div>\n  );\n};\n\nexport default memo(TypingIndicator); ","import React, { useState, useEffect, useRef, useCallback, memo, useMemo } from 'react';\nimport { useMessenger } from '../../contexts/MessengerContext';\nimport MessageInput from './MessageInput';\nimport MessageItem from './MessageItem';\nimport TypingIndicator from './TypingIndicator';\nimport useIntersectionObserver from '../../hooks/useIntersectionObserver';\nimport { Menu, MenuItem, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, Button, Box, Typography, TextField, IconButton, Avatar, List, ListItem, ListItemIcon, ListItemText, ListItemAvatar } from '@mui/material';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport PersonIcon from '@mui/icons-material/Person';\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { ArrowBack, Info, Link, Close } from '@mui/icons-material';\nimport EditIcon from '@mui/icons-material/Edit';\n\nconst MemoizedMessageItem = memo(MessageItem);\n\nconst ModeratorBanner = () => {\n  return (\n    <div className=\"moderator-banner\">\n      <div className=\"moderator-banner-content\">\n        <i className=\"fas fa-shield-alt mr-2\"></i>\n        <span>\n          <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –í—ã –æ–±—â–∞–µ—Ç–µ—Å—å —Å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –±—É–¥—å—Ç–µ –≤–µ–∂–ª–∏–≤—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã. –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –ø–æ–º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã.\n        </span>\n      </div>\n      <style jsx>{`\n        .moderator-banner {\n          background-color:rgb(26 26 26);\n          border-left: 4px solidrgb(131, 59, 246);\n          padding: 10px 15px;\n          margin-bottom: 15px;\n          border-radius: 4px;\n          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n          position: sticky;\n          top: -16px;\n          z-index: 100;\n        }\n        .moderator-banner-content {\n          display: flex;\n          align-items: center;\n          font-size: 14px;\n          color:rgb(167, 109, 187);\n        }\n        .moderator-banner-content i {\n          font-size: 18px;\n          color:rgba(178, 59, 246, 0.83);\n          margin-right: 8px;\n        }\n      `}</style>\n    </div>\n  );\n};\n\nconst ChatWindow = ({ backAction, isMobile, currentChat, setCurrentChat }) => {\n  const { \n    activeChat, \n    messages, \n    loadMessages, \n    hasMoreMessages,\n    loadingMessages,\n    typingUsers,\n    sendTextMessage,\n    sendTypingIndicator,\n    decryptMessage,\n    uploadFile,\n    user,\n    onlineUsers,\n    deleteChat\n  } = useMessenger();\n  \n  const navigate = useNavigate();\n  const [replyTo, setReplyTo] = useState(null);\n  const messagesEndRef = useRef(null);\n  const loadMoreTriggerRef = useRef(null);\n  const messagesContainerRef = useRef(null);\n  const [isAtBottom, setIsAtBottom] = useState(true);\n  const [autoScrollEnabled, setAutoScrollEnabled] = useState(true);\n  const chatIdRef = useRef(null);\n  const typingTimestampRef = useRef(null);\n  \n  const [anchorEl, setAnchorEl] = useState(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  \n  const [hasModeratorMessages, setHasModeratorMessages] = useState(false);\n  \n  const [groupInfoOpen, setGroupInfoOpen] = useState(false);\n  const [snackbarOpen, setSnackbarOpen] = useState(false);\n  const [snackbarMessage, setSnackbarMessage] = useState('');\n  \n  const API_URL = 'https://k-connect.ru/apiMes';\n  const BASE_URL = 'https://k-connect.ru';\n  \n  const handleOpenMenu = (event) => {\n    setAnchorEl(event.currentTarget);\n  };\n  \n  const handleCloseMenu = () => {\n    setAnchorEl(null);\n  };\n  \n  const handleOpenProfile = () => {\n    if (!activeChat || activeChat.is_group) return;\n    \n    const otherUser = activeChat.members?.find(member => {\n      const memberId = member.user_id || member.id;\n      return memberId !== user?.id;\n    });\n    \n    if (otherUser) {\n      navigate(`/profile/${otherUser.username}`);\n    }\n    \n    handleCloseMenu();\n  };\n  \n  const handleOpenDeleteDialog = () => {\n    handleCloseMenu();\n    setDeleteDialogOpen(true);\n  };\n  \n  const handleCloseDeleteDialog = () => {\n    setDeleteDialogOpen(false);\n  };\n  \n  const handleDeleteChat = async () => {\n    if (activeChat) {\n      const result = await deleteChat(activeChat.id);\n      \n      if (result.success) {\n        console.log(`–ß–∞—Ç ${activeChat.id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω`);\n        \n        if (isMobile && backAction) {\n          backAction();\n        }\n      } else {\n        console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —á–∞—Ç–∞: ${result.error}`);\n      }\n    }\n    \n    setDeleteDialogOpen(false);\n  };\n  \n  useEffect(() => {\n    if (activeChat?.id) {\n      chatIdRef.current = activeChat.id;\n    }\n  }, [activeChat]);\n  \n  useEffect(() => {\n    let mounted = true;\n    \n    if (activeChat?.id && (!messages[activeChat.id] || messages[activeChat.id].length === 0)) {\n      console.log(`ChatWindow: Loading messages for chat ${activeChat.id}, is_group=${activeChat.is_group}`, \n        { chat: activeChat, messagesState: messages });\n      \n      const timer = setTimeout(() => {\n        if (mounted && chatIdRef.current === activeChat.id) {\n          console.log(`ChatWindow: Executing loadMessages for chat ${activeChat.id}`);\n          loadMessages(activeChat.id);\n          \n          if (activeChat.is_group) {\n            setTimeout(() => {\n              if (mounted && chatIdRef.current === activeChat.id && \n                  (!messages[activeChat.id] || messages[activeChat.id].length === 0)) {\n                console.log(`ChatWindow: Retry loading messages for group chat ${activeChat.id}`);\n                loadMessages(activeChat.id);\n              }\n            }, 1500);\n          }\n        }\n      }, 100);\n      \n      return () => {\n        mounted = false;\n        clearTimeout(timer);\n      };\n    }\n    \n    return () => {\n      mounted = false;\n    };\n  }, [activeChat, loadMessages, messages]);\n  \n  useEffect(() => {\n    if (activeChat && messages[activeChat.id]) {\n      const apiHasModeratorMessages = messages[activeChat.id].hasModeratorMessages;\n      \n      if (apiHasModeratorMessages !== undefined) {\n        setHasModeratorMessages(apiHasModeratorMessages);\n      } else {\n        const hasModerator = messages[activeChat.id].some(message => \n          message.is_from_moderator || \n          (activeChat.members && activeChat.members.some(member => \n            member.id === message.sender_id && member.is_moderator\n          ))\n        );\n        setHasModeratorMessages(hasModerator);\n      }\n    } else {\n      setHasModeratorMessages(false);\n    }\n  }, [activeChat, messages]);\n  \n  const scrollToBottom = useCallback((smooth = false) => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ \n        behavior: smooth ? 'smooth' : 'auto',\n        block: 'end'\n      });\n    }\n  }, []);\n  \n  useEffect(() => {\n    if (activeChat && messages[activeChat.id] && autoScrollEnabled) {\n      setTimeout(() => {\n      scrollToBottom();\n      }, 100);\n    }\n  }, [activeChat, messages, scrollToBottom, autoScrollEnabled]);\n  \n  useEffect(() => {\n    if (activeChat && messages[activeChat.id]) {\n      setTimeout(() => {\n        scrollToBottom();\n        setAutoScrollEnabled(true);\n      }, 100);\n    }\n  }, [activeChat?.id]);\n  \n  const handleScroll = useCallback(() => {\n    if (messagesContainerRef.current) {\n      const { scrollHeight, scrollTop, clientHeight } = messagesContainerRef.current;\n      const scrolledToBottom = Math.abs(scrollHeight - scrollTop - clientHeight) < 50;\n      setIsAtBottom(scrolledToBottom);\n      \n      if (scrolledToBottom && !autoScrollEnabled) {\n        setAutoScrollEnabled(true);\n      } \n      \n      else if (!scrolledToBottom && autoScrollEnabled) {\n        setAutoScrollEnabled(false);\n      }\n    }\n  }, [autoScrollEnabled]);\n  \n  const throttledScrollHandler = useCallback(() => {\n    let isThrottled = false;\n    \n    return () => {\n      if (!isThrottled) {\n        handleScroll();\n        isThrottled = true;\n        \n        setTimeout(() => {\n          isThrottled = false;\n        }, 200);\n      }\n    };\n  }, [handleScroll]);\n  \n  useEffect(() => {\n    const container = messagesContainerRef.current;\n    const throttled = throttledScrollHandler();\n    \n    if (container) {\n      container.addEventListener('scroll', throttled);\n      return () => container.removeEventListener('scroll', throttled);\n    }\n  }, [throttledScrollHandler]);\n  \n  const hasMoreMessagesForChat = activeChat && \n                               hasMoreMessages && \n                               Object.prototype.hasOwnProperty.call(hasMoreMessages, activeChat.id) && \n                               hasMoreMessages[activeChat.id];\n                               \n  useIntersectionObserver({\n    target: loadMoreTriggerRef,\n    onIntersect: () => {\n      if (activeChat && hasMoreMessagesForChat && !loadingMessages) {\n        const container = messagesContainerRef.current;\n        if (container) {\n          const scrollHeight = container.scrollHeight;\n          const scrollPosition = container.scrollTop;\n          \n          loadMessages(activeChat.id).then(() => {\n            setTimeout(() => {\n              if (container) {\n                const newScrollHeight = container.scrollHeight;\n                const addedHeight = newScrollHeight - scrollHeight;\n                \n                container.scrollTop = scrollPosition + addedHeight;\n              }\n            }, 100); \n          });\n        } else {\n          loadMessages(activeChat.id);\n        }\n      }\n    },\n    enabled: !!activeChat && hasMoreMessagesForChat && !loadingMessages,\n    threshold: 0.5,\n    rootMargin: '100px'\n  });\n  \n  const handleSendMessage = useCallback(async (text) => {\n    if (!activeChat || !text.trim()) return;\n    \n    try {\n      const replyToId = replyTo ? replyTo.id : null;\n      await sendTextMessage(activeChat.id, text, replyToId);\n      \n      setReplyTo(null);\n      \n      setTimeout(() => scrollToBottom(true), 100);\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);\n    }\n  }, [activeChat, replyTo, sendTextMessage, scrollToBottom]);\n  \n  const handleFileUpload = useCallback(async (file, type) => {\n    if (!activeChat || !file) return;\n    \n    try {\n      const replyToId = replyTo ? replyTo.id : null;\n      await uploadFile(activeChat.id, file, type, replyToId);\n      \n      setReplyTo(null);\n      \n      setTimeout(() => scrollToBottom(true), 100);\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', error);\n    }\n  }, [activeChat, replyTo, uploadFile, scrollToBottom]);\n  \n  const handleTyping = useCallback((isTyping) => {\n    if (!activeChat) return;\n    \n    if (isTyping) {\n      const now = new Date().getTime();\n      const lastTypingEvent = typingTimestampRef.current || 0;\n      \n      if (now - lastTypingEvent > 2000) {\n        sendTypingIndicator(activeChat.id, isTyping);\n        typingTimestampRef.current = now;\n      }\n    } else {\n      sendTypingIndicator(activeChat.id, isTyping);\n    }\n  }, [activeChat, sendTypingIndicator]);\n  \n  const renderTypingIndicator = useCallback(() => {\n    if (!activeChat || !typingUsers[activeChat.id]) return null;\n    \n    const typingUserIds = Object.keys(typingUsers[activeChat.id]);\n    if (typingUserIds.length === 0) return null;\n    \n    return <TypingIndicator userIds={typingUserIds} chatMembers={activeChat.members} />;\n  }, [activeChat, typingUsers]);\n  \n  const renderScrollToBottom = () => {\n    if (isAtBottom) return null;\n    \n    return (\n      <button \n        className=\"scroll-to-bottom\"\n        onClick={() => {\n          setAutoScrollEnabled(true);\n          scrollToBottom(true);\n        }}\n      >\n        ‚Üì\n      </button>\n    );\n  };\n  \n  const getChatTitle = useCallback(() => {\n    if (!activeChat) return '–ß–∞—Ç';\n    \n    if (activeChat.is_group || activeChat.chat_type === 'group') {\n      return activeChat.title || '–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç';\n    } else {\n      const otherMember = activeChat.members?.find(member => {\n        const memberId = member.user_id || member.id;\n        \n        const memberIdStr = memberId ? String(memberId) : null;\n        const currentUserIdStr = user?.id ? String(user.id) : null;\n        \n        return memberIdStr && currentUserIdStr && memberIdStr !== currentUserIdStr;\n      });\n      \n      if (otherMember) {\n        return otherMember.name || otherMember.username || activeChat.title || '–õ–∏—á–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞';\n      }\n      \n      return activeChat.title || '–õ–∏—á–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞';\n    }\n  }, [activeChat, user]);\n  \n  const getChatAvatar = useCallback(() => {\n    if (!activeChat) return null;\n    \n    if (activeChat.is_group || activeChat.chat_type === 'group') {\n      return activeChat.avatar || null;\n    } else {\n      const otherMember = activeChat.members?.find(member => {\n        const memberId = member.user_id || member.id;\n        \n        const memberIdStr = memberId ? String(memberId) : null;\n        const currentUserIdStr = user?.id ? String(user.id) : null;\n        \n        return memberIdStr && currentUserIdStr && memberIdStr !== currentUserIdStr;\n      });\n      \n      if (otherMember) {\n        const otherUserId = otherMember.user_id || otherMember.id;\n        const photo = otherMember.photo || otherMember.avatar;\n        \n        if (photo && otherUserId && typeof photo === 'string') {\n          if (!photo.startsWith('/') && !photo.startsWith('http') && !photo.startsWith('/static/')) {\n            console.log(`ChatWindow: —Å—Ç—Ä–æ–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∞–≤–∞—Ç–∞—Ä–∞ –¥–ª—è ${otherUserId}`);\n            return `/static/uploads/avatar/${otherUserId}/${photo}`;\n          }\n        }\n        \n        return otherMember.avatar || otherMember.photo || null;\n      }\n      \n      return activeChat.avatar || null;\n    }\n  }, [activeChat, user]);\n\n  const getAvatarLetter = useCallback(() => {\n    const title = getChatTitle();\n    return title?.[0]?.toUpperCase() || '?';\n  }, [getChatTitle]);\n  \n  const chatMessages = activeChat ? (messages[activeChat.id] || []) : [];\n  const memoizedMessages = React.useMemo(() => {\n    if (!activeChat) return [];\n    \n    return chatMessages.map((message) => (\n      <MemoizedMessageItem \n        key={message.id}\n        message={message}\n        isCurrentUser={message.sender_id === user?.id}\n        decryptedContent={activeChat?.encrypted ? decryptMessage(message, activeChat.id) : message.content}\n        onReply={() => setReplyTo(message)}\n        replyMessage={message.reply_to_id ? chatMessages.find(m => m.id === message.reply_to_id) : null}\n        chatMembers={activeChat?.members}\n      />\n    ));\n  }, [chatMessages, user, activeChat, decryptMessage, setReplyTo]);\n  \n  const formatLastActive = (dateObject) => {\n    if (!dateObject) return \"–ù–µ –≤ —Å–µ—Ç–∏\";\n    \n    try {\n      if (typeof dateObject === 'string' && /^\\d{1,2}:\\d{2}$/.test(dateObject)) {\n        const today = new Date();\n        const options = {\n          month: 'long',\n          day: 'numeric'\n        };\n        const formattedDate = today.toLocaleDateString('ru-RU', options);\n        return `–ë—ã–ª${isFemale ? '–∞' : ''} –≤ —Å–µ—Ç–∏ ${formattedDate} –≤ ${dateObject}`;\n      }\n      \n      if (typeof dateObject === 'string' && /^\\d{1,2}\\s+\\w+$/.test(dateObject)) {\n        return `–ë—ã–ª${isFemale ? '–∞' : ''} –≤ —Å–µ—Ç–∏ ${dateObject}`;\n      }\n      \n      const date = dateObject instanceof Date ? dateObject : new Date(dateObject);\n      if (isNaN(date.getTime())) {\n        console.error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:', dateObject);\n        \n        return typeof dateObject === 'string' \n          ? `–ë—ã–ª${isFemale ? '–∞' : ''} –≤ —Å–µ—Ç–∏ ${dateObject}` \n          : \"–ù–µ –≤ —Å–µ—Ç–∏\";\n      }\n      \n      const now = new Date();\n      \n      const diffMs = now - date;\n      \n      const diffMins = Math.floor(diffMs / 60000);\n      const diffHours = Math.floor(diffMins / 60);\n      const diffDays = Math.floor(diffHours / 24);\n      \n      if (diffMins < 1) return '–í —Å–µ—Ç–∏';\n      if (diffMins < 60) return `–ë—ã–ª${isFemale ? '–∞' : ''} –≤ —Å–µ—Ç–∏ ${diffMins} –º–∏–Ω. –Ω–∞–∑–∞–¥`;\n      if (diffHours < 24) return `–ë—ã–ª${isFemale ? '–∞' : ''} –≤ —Å–µ—Ç–∏ ${diffHours} —á. –Ω–∞–∑–∞–¥`;\n      if (diffDays < 7) return `–ë—ã–ª${isFemale ? '–∞' : ''} –≤ —Å–µ—Ç–∏ ${diffDays} –¥–Ω. –Ω–∞–∑–∞–¥`;\n      \n      const options = {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: false\n      };\n      \n      return `–ë—ã–ª${isFemale ? '–∞' : ''} –≤ —Å–µ—Ç–∏ ${date.toLocaleString('ru-RU', options)}`;\n    } catch (e) {\n      console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', e, dateObject);\n      \n      return typeof dateObject === 'string' \n        ? `–ë—ã–ª${isFemale ? '–∞' : ''} –≤ —Å–µ—Ç–∏ ${dateObject}` \n        : \"–ù–µ –≤ —Å–µ—Ç–∏\";\n    }\n  };\n  \n  const otherUser = useMemo(() => {\n    if (!activeChat || activeChat.is_group || !activeChat.members) return null;\n    \n    return activeChat.members.find(member => {\n      const memberId = member.user_id || member.id;\n      \n      const memberIdStr = memberId ? String(memberId) : null;\n      const currentUserIdStr = user?.id ? String(user.id) : null;\n      \n      return memberIdStr && currentUserIdStr && memberIdStr !== currentUserIdStr;\n    });\n  }, [activeChat, user]);\n  \n  const isFemale = useMemo(() => {\n    if (!otherUser) return false;\n    \n    if (otherUser.gender) {\n      return otherUser.gender === 'female';\n    }\n    \n    const name = otherUser.name || '';\n    return name.endsWith('–∞') || name.endsWith('—è');\n  }, [otherUser]);\n  \n  const userStatus = useMemo(() => {\n    if (!otherUser) return '–ù–µ –≤ —Å–µ—Ç–∏';\n    \n    if (onlineUsers[otherUser.user_id || otherUser.id]) {\n      return '–í —Å–µ—Ç–∏';\n    }\n    \n    if (otherUser.last_active) {\n      return formatLastActive(otherUser.last_active);\n    }\n    \n    return '–ù–µ –≤ —Å–µ—Ç–∏';\n  }, [otherUser, onlineUsers]);\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è\n  const handleCopyInviteLink = async () => {\n    try {\n      const response = await axios.post(`${API_URL}/messenger/chats/${activeChat.id}/invite`);\n      if (response.data.success) {\n        const inviteLink = `${window.location.origin}/messenger/join/${response.data.invite_link}`;\n        await navigator.clipboard.writeText(inviteLink);\n        setSnackbarMessage('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');\n        setSnackbarOpen(true);\n      }\n    } catch (error) {\n      console.error('Error generating invite link:', error);\n      setSnackbarMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏');\n      setSnackbarOpen(true);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞ –≥—Ä—É–ø–ø—ã\n  const handleGroupAvatarChange = async (event) => {\n    const file = event.target.files[0];\n    if (!file) return;\n\n    const formData = new FormData();\n    formData.append('avatar', file);\n\n    try {\n      const response = await axios.post(`${API_URL}/messenger/chats/${activeChat.id}/update`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      if (response.data.success) {\n        setCurrentChat(prev => ({\n          ...prev,\n          avatar: response.data.avatar\n        }));\n        setSnackbarMessage('–ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω');\n        setSnackbarOpen(true);\n      }\n    } catch (error) {\n      console.error('Error updating group avatar:', error);\n      setSnackbarMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞');\n      setSnackbarOpen(true);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã\n  const handleGroupTitleChange = async (newTitle) => {\n    try {\n      const response = await axios.post(`${API_URL}/messenger/chats/${activeChat.id}/update`, {\n        title: newTitle\n      });\n      if (response.data.success) {\n        setCurrentChat(prev => ({\n          ...prev,\n          title: newTitle\n        }));\n        setSnackbarMessage('–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω–æ');\n        setSnackbarOpen(true);\n      }\n    } catch (error) {\n      console.error('Error updating group title:', error);\n      setSnackbarMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è');\n      setSnackbarOpen(true);\n    }\n  };\n\n  const isCurrentUserAdmin = activeChat && activeChat.members && user && activeChat.members.some(m => m.user_id === user.id && m.role === 'admin');\n  const [editTitle, setEditTitle] = useState(\"\");\n  const [editingTitle, setEditingTitle] = useState(false);\n\n  useEffect(() => {\n    if (groupInfoOpen && activeChat?.title) {\n      setEditTitle(activeChat.title);\n      setEditingTitle(false);\n    }\n  }, [groupInfoOpen, activeChat?.title]);\n\n  if (!activeChat) {\n    return (\n      <div className=\"chat-window chat-window-empty\">\n        <div className=\"empty-state\">\n          <h3>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π</h3>\n          <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —á–∞—Ç —Å–ª–µ–≤–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</p>\n        </div>\n      </div>\n    );\n  }\n  \n  return (\n    <Box sx={{ \n      display: 'flex', \n      flexDirection: 'column',\n      height: '100%',\n      bgcolor: 'background.paper'\n    }}>\n      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ */}\n      <Box sx={{ \n        display: 'flex', \n        alignItems: 'center', \n        p: 2, \n        borderBottom: '1px solid',\n        borderColor: 'divider',\n        bgcolor: 'background.paper'\n      }}>\n        {isMobile && (\n          <IconButton \n            onClick={backAction}\n            sx={{ mr: 2 }}\n          >\n            <ArrowBack />\n          </IconButton>\n        )}\n        \n        <Avatar \n          src={getChatAvatar() ? `${BASE_URL}${getChatAvatar()}` : undefined}\n          alt={getChatTitle()}\n          sx={{ \n            width: 40, \n            height: 40, \n            mr: 2,\n            cursor: 'pointer'\n          }}\n          onClick={() => {\n            if (activeChat?.is_group) {\n              setGroupInfoOpen(true);\n            }\n          }}\n        >\n          {getAvatarLetter()}\n        </Avatar>\n        \n        <Box sx={{ flex: 1 }}>\n          <Typography variant=\"subtitle1\" noWrap>\n            {getChatTitle()}\n          </Typography>\n          {!activeChat.is_group && activeChat.chat_type !== 'group' && (\n            <Typography variant=\"caption\" color=\"text.secondary\">\n              {userStatus}\n            </Typography>\n          )}\n          {activeChat.is_group && (\n            <Typography variant=\"caption\" color=\"text.secondary\">\n              {activeChat.members?.length || 0} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n            </Typography>\n          )}\n          {activeChat.encrypted && <Typography variant=\"caption\" color=\"text.secondary\">üîí</Typography>}\n        </Box>\n        \n        <IconButton onClick={(e) => handleOpenMenu(e)}>\n          <MoreVertIcon />\n        </IconButton>\n        \n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onClose={handleCloseMenu}\n          PaperProps={{\n            sx: {\n              backgroundColor: 'rgba(10, 10, 10, 0.75)',\n              color: '#fff',\n              boxShadow: '0 8px 32px 0 rgba(0,0,0,0.37)',\n              backdropFilter: 'blur(12px)',\n              WebkitBackdropFilter: 'blur(12px)',\n              borderRadius: isMobile ? 0 : 3,\n              border: '1px solid rgba(40,40,40,0.5)',\n              minWidth: 180,\n              p: 0.5\n            }\n          }}\n        >\n          {!activeChat?.is_group && (\n            <MenuItem onClick={handleOpenProfile}>\n              <PersonIcon fontSize=\"small\" style={{ marginRight: '8px' }} />\n              –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n            </MenuItem>\n          )}\n          <MenuItem onClick={handleOpenDeleteDialog}>\n            <DeleteIcon fontSize=\"small\" style={{ marginRight: '8px' }} />\n            –£–¥–∞–ª–∏—Ç—å —á–∞—Ç\n          </MenuItem>\n        </Menu>\n      </Box>\n\n      {/* –î–∏–∞–ª–æ–≥ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≥—Ä—É–ø–ø–µ */}\n      <Dialog\n        fullScreen={isMobile}\n        open={groupInfoOpen}\n        onClose={() => setGroupInfoOpen(false)}\n        maxWidth=\"sm\"\n        fullWidth\n        PaperProps={{\n          sx: {\n            backgroundColor: 'rgba(10, 10, 10, 0.75)',\n            color: '#fff',\n            boxShadow: '0 8px 32px 0 rgba(0,0,0,0.37)',\n            backdropFilter: 'blur(12px)',\n            WebkitBackdropFilter: 'blur(12px)',\n            borderRadius: isMobile ? 0 : 3,\n            border: '1px solid rgba(40,40,40,0.5)'\n          }\n        }}\n      >\n        <DialogTitle sx={{ bgcolor: 'transparent', color: '#fff' }}>\n          <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n            <Typography variant=\"h6\">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–µ</Typography>\n            <IconButton onClick={() => setGroupInfoOpen(false)}>\n              <Close />\n            </IconButton>\n          </Box>\n        </DialogTitle>\n        <DialogContent sx={{ bgcolor: 'transparent', color: '#fff' }}>\n          <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 2, my: 2 }}>\n            <Avatar\n              src={getChatAvatar() ? `${BASE_URL}${getChatAvatar()}` : undefined}\n              alt={getChatTitle()}\n              sx={{ width: 100, height: 100, cursor: 'pointer' }}\n              onClick={() => document.getElementById('groupAvatarInput').click()}\n            >\n              {getAvatarLetter()}\n            </Avatar>\n            <input\n              type=\"file\"\n              id=\"groupAvatarInput\"\n              accept=\"image/*\"\n              style={{ display: 'none' }}\n              onChange={handleGroupAvatarChange}\n            />\n            <TextField\n              fullWidth\n              label=\"–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\"\n              value={editingTitle ? editTitle : activeChat?.title || ''}\n              onChange={e => setEditTitle(e.target.value)}\n              variant=\"outlined\"\n              disabled={!isCurrentUserAdmin || !editingTitle}\n              InputProps={{\n                endAdornment: isCurrentUserAdmin && !editingTitle ? (\n                  <IconButton size=\"small\" onClick={() => setEditingTitle(true)}>\n                    <EditIcon fontSize=\"small\" />\n                  </IconButton>\n                ) : null\n              }}\n            />\n            {isCurrentUserAdmin && editingTitle && (\n              <Box sx={{ display: 'flex', gap: 1, mt: 1 }}>\n                <Button\n                  variant=\"contained\"\n                  size=\"small\"\n                  onClick={async () => {\n                    await handleGroupTitleChange(editTitle);\n                    setEditingTitle(false);\n                  }}\n                  disabled={!editTitle.trim()}\n                >\n                  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n                </Button>\n                <Button size=\"small\" onClick={() => { setEditTitle(activeChat.title); setEditingTitle(false); }}>–û—Ç–º–µ–Ω–∞</Button>\n              </Box>\n            )}\n          </Box>\n          <Typography variant=\"h6\" sx={{ mt: 2, mb: 1 }}>–£—á–∞—Å—Ç–Ω–∏–∫–∏</Typography>\n          <List>\n            {activeChat?.members?.map((member) => (\n              <ListItem key={member.user_id}>\n                <ListItemAvatar>\n                  <Avatar src={member.avatar ? `${BASE_URL}${member.avatar}` : undefined}>\n                    {member.name?.[0]}\n                  </Avatar>\n                </ListItemAvatar>\n                <ListItemText \n                  primary={member.name || member.username || `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${member.user_id}`}\n                  secondary={member.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–£—á–∞—Å—Ç–Ω–∏–∫'}\n                />\n              </ListItem>\n            ))}\n          </List>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setGroupInfoOpen(false)}>–ó–∞–∫—Ä—ã—Ç—å</Button>\n          <Button \n            onClick={() => {\n              handleCopyInviteLink();\n              setGroupInfoOpen(false);\n            }}\n            startIcon={<Link />}\n          >\n            –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É\n          </Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π */}\n      <Box sx={{ \n        flex: 1, \n        overflow: 'auto',\n        p: 2,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 1\n      }}>\n        {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ –µ—Å–ª–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä –ò–õ–ò –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ */}\n        {(\n          (activeChat?.chat_type === 'personal' && \n           activeChat?.members?.some(member => member.id !== user?.id && member.is_moderator)) ||\n          hasModeratorMessages\n        ) && <ModeratorBanner />}\n        \n        {/* –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –≤–≤–µ—Ä—Ö */}\n        {hasMoreMessagesForChat && (\n          <div \n            ref={loadMoreTriggerRef} \n            className=\"load-more-trigger\"\n          >\n            {loadingMessages && (\n              <div className=\"loading-more\">\n                <div className=\"loading-spinner-small\"></div>\n                <span>–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</span>\n              </div>\n            )}\n          </div>\n        )}\n        \n        {/* –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π */}\n        <div className=\"messages-list\">\n          {memoizedMessages}\n        </div>\n        \n        {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä \"–ü–µ—á–∞—Ç–∞–µ—Ç...\" */}\n        {renderTypingIndicator()}\n        \n        {/* –ù–µ–≤–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–Ω–∏–∑ */}\n        <div ref={messagesEndRef} />\n      </Box>\n      \n      {/* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–Ω–∏–∑ */}\n      {renderScrollToBottom()}\n      \n      {/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è */}\n      <MessageInput \n        onSendMessage={handleSendMessage}\n        onTyping={handleTyping}\n        onFileUpload={handleFileUpload}\n        replyTo={replyTo}\n        onCancelReply={() => setReplyTo(null)}\n      />\n    </Box>\n  );\n};\n\nexport default memo(ChatWindow); ","import React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { formatDistanceToNow } from 'date-fns';\nimport { ru } from 'date-fns/locale';\nimport { useMessenger } from '../../contexts/MessengerContext';\nimport { \n  IconButton, \n  Menu, \n  MenuItem, \n  Dialog, \n  DialogActions, \n  DialogContent, \n  DialogContentText, \n  DialogTitle, \n  Button, \n  Snackbar, \n  Alert,\n  Box,\n  Typography\n} from '@mui/material';\nimport ReplyIcon from '@mui/icons-material/Reply';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\nimport DoneIcon from '@mui/icons-material/Done';\nimport DoneAllIcon from '@mui/icons-material/DoneAll';\nimport SimpleImageViewer from '../../components/SimpleImageViewerMes';\n\n\nconst MessageItem = ({ \n  message, \n  isCurrentUser, \n  decryptedContent,\n  onReply,\n  replyMessage,\n  chatMembers = [],\n  showDateSeparator = false,\n  dateSeparatorText = ''\n}) => {\n  const [showActions, setShowActions] = useState(false);\n  const { getFileUrl, avatarCache, getAvatarUrl, deleteMessage } = useMessenger();\n  const [lightboxOpen, setLightboxOpen] = useState(false);\n  const [lightboxImage, setLightboxImage] = useState(null);\n  const [menuAnchorEl, setMenuAnchorEl] = useState(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [error, setError] = useState(null);\n  const messageRef = useRef(null);\n  const messagesContainerRef = useRef(null);\n  \n  \n  useEffect(() => {\n    messagesContainerRef.current = document.querySelector('.messages-list');\n  }, []);\n  \n  \n  const handleOpenMenu = (event) => {\n    event.stopPropagation();\n    setMenuAnchorEl(event.currentTarget);\n  };\n  \n  const handleCloseMenu = () => {\n    setMenuAnchorEl(null);\n  };\n  \n  const handleOpenDeleteDialog = (e) => {\n    e.stopPropagation();\n    handleCloseMenu();\n    setDeleteDialogOpen(true);\n  };\n  \n  const handleCloseDeleteDialog = () => {\n    setDeleteDialogOpen(false);\n  };\n  \n  const handleDeleteMessage = async () => {\n    if (message && message.id) {\n      setIsDeleting(true);\n      setDeleteDialogOpen(false);\n      \n      \n      const messagesContainer = messagesContainerRef.current;\n      const scrollTop = messagesContainer?.scrollTop;\n      const scrollHeight = messagesContainer?.scrollHeight;\n      \n      try {\n        \n        const result = await deleteMessage(message.id);\n        \n        if (result && result.success) {\n          \n          if (messageRef.current) {\n            messageRef.current.classList.add('deleting');\n            \n            \n            setTimeout(() => {\n              if (messageRef.current) {\n                messageRef.current.style.opacity = '0';\n                messageRef.current.style.transform = 'scale(0.8)';\n                messageRef.current.style.maxHeight = '0';\n                messageRef.current.style.marginTop = '0';\n                messageRef.current.style.marginBottom = '0';\n                messageRef.current.style.padding = '0';\n                \n                \n                setTimeout(() => {\n                  if (messagesContainer) {\n                    \n                    const newScrollHeight = messagesContainer.scrollHeight;\n                    const heightDiff = scrollHeight - newScrollHeight;\n                    \n                    \n                    if (heightDiff > 0 && scrollTop) {\n                      messagesContainer.scrollTop = scrollTop - heightDiff;\n                    } else if (scrollTop) {\n                      messagesContainer.scrollTop = scrollTop;\n                    }\n                  }\n                }, 50);\n              }\n            }, 50);\n          }\n          console.log(`–°–æ–æ–±—â–µ–Ω–∏–µ ${message.id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ`);\n        } else {\n          \n          console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ${result?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);\n          setError(result?.error || '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');\n          setIsDeleting(false);\n        }\n      } catch (err) {\n        console.error('–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', err);\n        setError('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');\n        setIsDeleting(false);\n      }\n    }\n  };\n\n  const handleCloseError = () => {\n    setError(null);\n  };\n  \n  \n  const getSenderInfo = useCallback((senderId) => {\n    if (!chatMembers.length) return { name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', avatar: null };\n    \n    \n    if (message.sender?.avatar) {\n      return {\n        name: message.sender.name || message.sender.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',\n        avatar: message.sender.avatar\n      };\n    }\n    \n    const member = chatMembers.find(m => {\n      const memberId = m.user_id || m.id;\n      return memberId === senderId;\n    });\n    \n    if (!member) return { name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', avatar: null };\n    \n    \n    let avatarUrl = null;\n    if (avatarCache && avatarCache[senderId]) {\n      avatarUrl = avatarCache[senderId];\n    } \n    \n    else if (member.avatar || member.photo) {\n      if (getAvatarUrl) {\n        avatarUrl = getAvatarUrl(senderId, member.avatar || member.photo);\n      } else {\n        \n        const photoPath = member.avatar || member.photo;\n        if (photoPath?.startsWith('/static/')) {\n          avatarUrl = photoPath;\n        } else {\n          avatarUrl = `/static/uploads/avatar/${senderId}/${photoPath}`;\n        }\n      }\n    }\n    \n    return { \n      name: member.name || member.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',\n      avatar: avatarUrl\n    };\n  }, [chatMembers, message.sender, avatarCache, getAvatarUrl]);\n  \n  \n  const getSenderName = useCallback((senderId) => {\n    return getSenderInfo(senderId).name;\n  }, [getSenderInfo]);\n  \n  \n  const getSenderAvatar = useCallback((senderId) => {\n    return getSenderInfo(senderId).avatar;\n  }, [getSenderInfo]);\n  \n  \n  const handleOpenLightbox = (imageUrl) => {\n    setLightboxImage(imageUrl);\n    setLightboxOpen(true);\n  };\n\n  \n  const handleCloseLightbox = () => {\n    setLightboxOpen(false);\n  };\n\n  \n  const handlePhotoClick = (e, photoUrl) => {\n    e.stopPropagation(); \n    handleOpenLightbox(photoUrl);\n  };\n  \n  \n  const formatMessageTime = (timestamp) => {\n    try {\n      \n      if (typeof timestamp === 'string') {\n        \n        if (/^\\d{1,2}:\\d{2}$/.test(timestamp)) {\n          return timestamp;\n        }\n        \n        \n        if (/^\\d{1,2}\\s+\\w+$/.test(timestamp)) {\n          return timestamp;\n        }\n        \n        \n      }\n      \n      \n      const date = timestamp instanceof Date ? timestamp : new Date(timestamp);\n      if (isNaN(date.getTime())) {\n        console.error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:', timestamp);\n        \n        return typeof timestamp === 'string' ? timestamp : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n      }\n      \n      const now = new Date();\n      \n      \n      const dateLocal = date.toLocaleDateString();\n      const nowLocal = now.toLocaleDateString();\n      \n      \n      if (dateLocal === nowLocal) {\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n      }\n      \n      \n      const weekAgo = new Date(now);\n      weekAgo.setDate(now.getDate() - 7);\n      \n      if (date > weekAgo) {\n        return formatDistanceToNow(date, { addSuffix: true, locale: ru });\n      }\n      \n      \n      return date.toLocaleString([], { \n        day: 'numeric',\n        month: 'short',\n        hour: '2-digit', \n        minute: '2-digit' \n      });\n    } catch (e) {\n      console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', e, timestamp);\n      \n      return typeof timestamp === 'string' ? timestamp : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n    }\n  };\n  \n  \n  const renderMessageContent = () => {\n    const timeElement = (\n      <span className=\"message-time-inline\">\n        {formatMessageTime(message.created_at)}\n        {renderReadStatus()}\n      </span>\n    );\n\n    switch (message.message_type) {\n      case 'text':\n        \n        const isLongMessage = decryptedContent.length > 30;\n        \n        return (\n          <div className=\"message-text-container\" \n               style={{ \n                 flexDirection: isLongMessage ? 'column' : 'row',\n                 alignItems: isLongMessage ? 'flex-end' : 'flex-end',\n                 flexWrap: 'nowrap',\n                 justifyContent: 'space-between'\n               }}>\n            <p className=\"message-text\" style={{ \n              whiteSpace: 'pre-wrap', \n              wordBreak: 'break-all',\n          overflowWrap: 'break-word',\n              display: isLongMessage ? 'block' : 'inline',\n              textAlign: 'left',\n              width: isLongMessage ? '100%' : 'auto',\n              marginRight: isLongMessage ? '0' : '8px'\n            }}>{decryptedContent}</p>\n            {timeElement}\n          </div>\n        );\n        \n      case 'photo':\n        const photoUrl = message.photo_url || getFileUrl(message.chat_id, message.content);\n        console.log(`Photo attachment URL for message ${message.id}:`, photoUrl);\n        console.log(`Original content path:`, message.content);\n        \n        \n        const isGif = message.mime_type === 'image/gif' || \n                      (message.content && message.content.toLowerCase().endsWith('.gif'));\n                      \n        return (\n          <div className=\"message-content-wrapper\">\n            <div className=\"message-photo\" onClick={(e) => e.stopPropagation()}>\n            <img \n              src={photoUrl} \n              alt=\"–§–æ—Ç–æ\" \n              loading=\"lazy\"\n                onClick={(e) => handlePhotoClick(e, photoUrl)}\n              style={{\n                objectFit: 'contain',\n                maxWidth: '100%',\n                  imageRendering: isGif ? 'auto' : 'auto',\n                  cursor: 'pointer',\n                  position: 'relative',\n                  zIndex: 5\n              }}\n            />\n            </div>\n            <span className=\"message-time-inline\" style={{ alignSelf: 'flex-end' }}>\n              {formatMessageTime(message.created_at)}\n              {renderReadStatus()}\n            </span>\n          </div>\n        );\n        \n      case 'video':\n        const videoUrl = getFileUrl(message.chat_id, message.content);\n        console.log(`Video attachment URL for message ${message.id}:`, videoUrl);\n        return (\n          <div className=\"message-content-wrapper\">\n          <div className=\"message-video\">\n            <video \n              controls \n              preload=\"metadata\"\n              src={videoUrl}\n            />\n            </div>\n            <span className=\"message-time-inline\" style={{ alignSelf: 'flex-end' }}>\n              {formatMessageTime(message.created_at)}\n              {renderReadStatus()}\n            </span>\n          </div>\n        );\n        \n      case 'audio':\n        const audioUrl = getFileUrl(message.chat_id, message.content);\n        console.log(`Audio attachment URL for message ${message.id}:`, audioUrl);\n        return (\n          <div className=\"message-content-wrapper\">\n          <div className=\"message-audio\">\n            <audio \n              controls\n              preload=\"metadata\"\n              src={audioUrl}\n            />\n            </div>\n            <span className=\"message-time-inline\" style={{ alignSelf: 'flex-end' }}>\n              {formatMessageTime(message.created_at)}\n              {renderReadStatus()}\n            </span>\n          </div>\n        );\n        \n      case 'file':\n        const fileUrl = getFileUrl(message.chat_id, message.content);\n        console.log(`File attachment URL for message ${message.id}:`, fileUrl);\n        return (\n          <div className=\"message-content-wrapper\">\n          <div className=\"message-file\">\n            <a \n              href={fileUrl}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"file-link\"\n            >\n              <span className=\"file-icon\">üìÑ</span>\n              <span className=\"file-details\">\n                <span className=\"file-name\">{message.original_filename}</span>\n                <span className=\"file-size\">{formatFileSize(message.file_size)}</span>\n              </span>\n            </a>\n            </div>\n            <span className=\"message-time-inline\" style={{ alignSelf: 'flex-end' }}>\n              {formatMessageTime(message.created_at)}\n              {renderReadStatus()}\n            </span>\n          </div>\n        );\n        \n      default:\n        return (\n          <div className=\"message-text-container\">\n            <p className=\"message-text\">–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è</p>\n            {timeElement}\n          </div>\n        );\n    }\n  };\n  \n  \n  const formatFileSize = (bytes) => {\n    if (!bytes) return '';\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    if (bytes === 0) return '0 Byte';\n    const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));\n    return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];\n  };\n  \n  \n  const renderReplyContent = () => {\n    if (!replyMessage) return null;\n    \n    const replySenderName = getSenderName(replyMessage.sender_id);\n    let previewContent = '';\n    \n    switch (replyMessage.message_type) {\n      case 'text':\n        previewContent = replyMessage.content.length > 30 \n          ? replyMessage.content.substring(0, 15) + '...'\n          : replyMessage.content;\n        break;\n      case 'photo':\n        previewContent = 'üì∑ –§–æ—Ç–æ';\n        break;\n      case 'video':\n        previewContent = 'üé¨ –í–∏–¥–µ–æ';\n        break;\n      case 'audio':\n        previewContent = 'üéµ –ê—É–¥–∏–æ';\n        break;\n      default:\n        previewContent = 'üìé –§–∞–π–ª';\n    }\n    \n    return (\n      <div className=\"replied-message\">\n        <span className=\"reply-sender\">{replySenderName}</span>\n        <span className=\"reply-content\">{previewContent}</span>\n      </div>\n    );\n  };\n  \n  \n  const renderReadStatus = () => {\n    if (!isCurrentUser) return null;\n    \n    \n    const isRead = (message.read_by && message.read_by.length > 0) || \n                  (message.read_count && message.read_count > 0);\n    \n    return (\n      <span className={`read-status ${isRead ? 'read' : 'unread'}`} style={{ display: 'inline-flex', alignItems: 'center', height: '12px' }}>\n        {isRead ? <DoneAllIcon sx={{ fontSize: 14 }} /> : <DoneIcon sx={{ fontSize: 14 }} />}\n      </span>\n    );\n  };\n  \n  \n  const senderAvatar = getSenderAvatar(message.sender_id);\n  \n  \n  const isGroupChat = chatMembers && chatMembers.length > 2;\n  \n  return (\n    <>\n      {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–∞—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */}\n      {showDateSeparator && (\n        <div className=\"date-separator\">\n          <span>{dateSeparatorText}</span>\n        </div>\n      )}\n      \n      <div \n        ref={messageRef}\n        className={`message-item ${isCurrentUser ? 'my-message' : 'their-message'} ${isDeleting ? 'deleting' : ''}`}\n        style={{\n          transition: 'opacity 0.3s ease, transform 0.3s ease, max-height 0.3s ease, margin 0.3s ease, padding 0.3s ease',\n          opacity: isDeleting ? 0 : 1,\n          transform: isDeleting ? 'scale(0.8)' : 'scale(1)',\n          position: 'relative'\n        }}\n        onMouseEnter={() => setShowActions(true)}\n        onMouseLeave={() => setShowActions(false)}\n    >\n      <div className=\"message-container\">\n        {!isCurrentUser && isGroupChat && (\n          <div className=\"message-avatar\">\n            {senderAvatar ? (\n              <img src={senderAvatar} alt={message.sender_name || 'Avatar'} />\n            ) : (\n              <div className=\"avatar-placeholder\">\n                {(message.sender_name?.charAt(0) || 'U').toUpperCase()}\n              </div>\n            )}\n          </div>\n        )}\n        \n        <div className=\"message-content\">\n          {!isCurrentUser && isGroupChat && (\n            <div className=\"message-sender\">{message.sender_name || getSenderName(message.sender_id)}</div>\n          )}\n          \n            {message.reply_to_id && renderReplyContent()}\n          \n          <div className=\"message-bubble\">\n            {renderMessageContent()}\n            </div>\n          </div>\n          \n          {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º - –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É */}\n          <div className={`message-actions ${showActions ? 'visible' : ''}`} onClick={(e) => e.stopPropagation()}>\n            <IconButton \n              size=\"small\" \n              onClick={(e) => {\n                e.stopPropagation();\n                onReply && onReply(message);\n              }}\n              className=\"action-button reply-button\"\n            >\n              <ReplyIcon fontSize=\"small\" />\n            </IconButton>\n            \n            {/* –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */}\n            {isCurrentUser && (\n              <IconButton\n                size=\"small\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleOpenDeleteDialog(e);\n                }}\n                className=\"action-button delete-button\"\n              >\n                <DeleteIcon fontSize=\"small\" />\n              </IconButton>\n            )}\n          </div>\n        </div>\n      </div>\n      \n      {/* –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è - —É–ª—É—á—à–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å */}\n      <Dialog\n        open={deleteDialogOpen}\n        onClose={handleCloseDeleteDialog}\n        PaperProps={{\n          sx: {\n            borderRadius: '16px',\n            bgcolor: 'background.paper',\n            backgroundImage: 'linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))',\n            boxShadow: '0 8px 20px rgba(0, 0, 0, 0.2)',\n            border: '1px solid rgba(255, 255, 255, 0.12)',\n            overflow: 'hidden',\n            maxWidth: '360px',\n            width: '90%'\n          }\n        }}\n      >\n        <DialogTitle sx={{ \n          borderBottom: '1px solid rgba(255, 255, 255, 0.08)',\n          py: 2,\n          px: 3 \n        }}>\n          <Typography variant=\"h6\" component=\"div\" sx={{ fontWeight: 600, color: 'primary.main' }}>\n            –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n          </Typography>\n        </DialogTitle>\n        <DialogContent sx={{ py: 3, px: 3 }}>\n          <DialogContentText sx={{ color: 'text.primary', mb: 1 }}>\n            –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?\n          </DialogContentText>\n          <DialogContentText sx={{ color: 'text.secondary', fontSize: '0.875rem' }}>\n            –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions sx={{ \n          px: 2, \n          py: 2,\n          borderTop: '1px solid rgba(255, 255, 255, 0.08)',\n          justifyContent: 'space-between'\n        }}>\n          <Button \n            onClick={handleCloseDeleteDialog} \n            variant=\"outlined\"\n            sx={{\n              borderRadius: '20px',\n              px: 2,\n              fontSize: '0.875rem',\n              textTransform: 'none',\n              fontWeight: 500\n            }}\n          >\n            –û—Ç–º–µ–Ω–∞\n          </Button>\n          <Button \n            onClick={handleDeleteMessage} \n            color=\"error\" \n            variant=\"contained\"\n            sx={{\n              borderRadius: '20px',\n              px: 2,\n              fontSize: '0.875rem',\n              textTransform: 'none',\n              fontWeight: 500,\n              boxShadow: '0 4px 12px rgba(211, 47, 47, 0.25)'\n            }}\n            autoFocus\n          >\n            –£–¥–∞–ª–∏—Ç—å\n          </Button>\n        </DialogActions>\n      </Dialog>\n      \n      {/* –ü—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */}\n      {lightboxOpen && lightboxImage && (\n        <SimpleImageViewer\n          src={lightboxImage}\n          onClose={handleCloseLightbox}\n        />\n      )}\n      \n      {/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ */}\n      <Snackbar \n        open={!!error} \n        autoHideDuration={6000} \n        onClose={handleCloseError}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert \n          onClose={handleCloseError} \n          severity=\"error\" \n          sx={{ \n            width: '100%',\n            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',\n            borderRadius: '12px',\n            border: '1px solid rgba(211, 47, 47, 0.2)'\n          }}\n        >\n          {error}\n        </Alert>\n      </Snackbar>\n    </>\n  );\n};\n\nexport default MessageItem; ","import { useEffect, useRef } from 'react';\n\n/**\n * –•—É–∫ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Å –æ–±–ª–∞—Å—Ç—å—é –≤–∏–¥–∏–º–æ—Å—Ç–∏\n * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∏ –ø–æ–¥–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞\n */\nconst useIntersectionObserver = ({\n  target, // ref —ç–ª–µ–º–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å\n  onIntersect, // callback, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏\n  threshold = 0.1, // –ø–æ—Ä–æ–≥ –≤–∏–¥–∏–º–æ—Å—Ç–∏ (0-1)\n  rootMargin = '0px', // –æ—Ç—Å—Ç—É–ø—ã –æ—Ç root —ç–ª–µ–º–µ–Ω—Ç–∞\n  enabled = true, // –≤–∫–ª—é—á–µ–Ω –ª–∏ observer\n  debounceTime = 300  // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –¥–µ–±–∞—É–Ω—Å–∞\n}) => {\n  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∞–π–º–µ—Ä –¥–µ–±–∞—É–Ω—Å–∞\n  const debounceRef = useRef(null);\n\n  useEffect(() => {\n    if (!enabled || !target.current) {\n      return;\n    }\n    \n    // –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –¥–µ–±–∞—É–Ω—Å–æ–º\n    const handleIntersect = (entries) => {\n      const [entry] = entries;\n      \n      if (entry.isIntersecting) {\n        // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–∞–π–º–µ—Ä –µ—Å–ª–∏ –µ—Å—Ç—å\n        if (debounceRef.current) {\n          clearTimeout(debounceRef.current);\n        }\n        \n        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä\n        debounceRef.current = setTimeout(() => {\n          onIntersect();\n          debounceRef.current = null;\n        }, debounceTime);\n      }\n    };\n    \n    const observer = new IntersectionObserver(handleIntersect, {\n      threshold,\n      rootMargin,\n    });\n    \n    observer.observe(target.current);\n    \n    return () => {\n      if (debounceRef.current) {\n        clearTimeout(debounceRef.current);\n      }\n      observer.disconnect();\n    };\n  }, [target, enabled, threshold, rootMargin, onIntersect, debounceTime]);\n};\n\nexport default useIntersectionObserver; ","import React, { useContext, useEffect, useState } from 'react';\nimport { Box, Typography, CircularProgress, Button, Dialog, DialogTitle, DialogContent, DialogActions, TextField, List, ListItem, ListItemAvatar, ListItemText, Avatar, Checkbox, IconButton, Menu, MenuItem, ListItemIcon, Snackbar } from '@mui/material';\nimport { MessengerProvider } from '../../contexts/MessengerContext';\nimport { AuthContext } from '../../context/AuthContext';\nimport ChatList from '../../components/Messenger/ChatList';\nimport ChatWindow from '../../components/Messenger/ChatWindow';\nimport useMediaQuery from '@mui/material/useMediaQuery';\nimport { useTheme } from '@mui/material/styles';\nimport SEO from '../../components/SEO';\nimport '../../styles/messenger.css';\nimport axios from 'axios';\nimport AddIcon from '@mui/icons-material/Add';\nimport CloseIcon from '@mui/icons-material/Close';\nimport { ArrowBack, MoreVert, Info, Link, Delete, Edit } from '@mui/icons-material';\n\nconst MessengerPage = () => {\n  const theme = useTheme();\n  const authContext = useContext(AuthContext);\n  const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\n  const [showSidebar, setShowSidebar] = React.useState(true);\n  const [slideIn, setSlideIn] = React.useState(false);\n  const [forcedSessionKey, setForcedSessionKey] = useState(null);\n  const [isLoadingSessionKey, setIsLoadingSessionKey] = useState(false);\n  const [currentChat, setCurrentChat] = useState(null);\n  const [chatMenuAnchor, setChatMenuAnchor] = useState(null);\n  const [groupInfoOpen, setGroupInfoOpen] = useState(false);\n  const [snackbarOpen, setSnackbarOpen] = useState(false);\n  const [snackbarMessage, setSnackbarMessage] = useState('');\n  \n  // –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã\n  const [createGroupOpen, setCreateGroupOpen] = useState(false);\n  const [groupTitle, setGroupTitle] = useState('');\n  const [selectedUsers, setSelectedUsers] = useState([]);\n  const [followers, setFollowers] = useState([]);\n  const [following, setFollowing] = useState([]);\n  const [loadingUsers, setLoadingUsers] = useState(false);\n  const [activeTab, setActiveTab] = useState('followers'); // 'followers' –∏–ª–∏ 'following'\n  \n  // –ù–∞–π—Ç–∏ –º–µ—Å—Ç–æ, –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ –ø–æ–ª–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞\n  const isCurrentUserAdmin = currentChat && currentChat.members && authContext.user && currentChat.members.some(m => m.user_id === authContext.user.id && m.role === 'admin');\n  const [editTitle, setEditTitle] = useState(\"\");\n  const [editingTitle, setEditingTitle] = useState(false);\n  \n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è cookie –ø–æ –∏–º–µ–Ω–∏\n  const getCookie = (name) => {\n    const value = `; ${document.cookie}`;\n    const parts = value.split(`; ${name}=`);\n    if (parts.length === 2) return parts.pop().split(';').shift();\n    return null;\n  };\n  \n  // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n  const sessionKeyCookie = getCookie('session_key') || getCookie('jwt') || getCookie('token');\n  const jwtToken = localStorage.getItem('token') || sessionKeyCookie;\n  \n  // –ü–æ–ª—É—á–∞–µ–º –∫–ª—é—á –∏–∑ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n  const sessionKey = authContext.sessionKey || authContext.session_key || \n                    localStorage.getItem('session_key') || sessionKeyCookie || \n                    forcedSessionKey || jwtToken;\n  \n  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ —á–µ—Ä–µ–∑ –ø—É—Ç—å /apiMes/ (–±—É–¥–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ NGINX)\n  const API_URL = 'https://k-connect.ru/apiMes';\n  const MAIN_API_URL = 'https://k-connect.ru/api';\n  const BASE_URL = 'https://k-connect.ru';\n  \n  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫\n  useEffect(() => {\n    if (createGroupOpen && authContext.user) {\n      setLoadingUsers(true);\n      Promise.all([\n        axios.get(`${MAIN_API_URL}/users/${authContext.user.username}/followers`),\n        axios.get(`${MAIN_API_URL}/users/${authContext.user.username}/following`)\n      ])\n        .then(([followersRes, followingRes]) => {\n          // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–∫–∏ –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –æ—Ç–≤–µ—Ç–∞\n          setFollowers(followersRes.data.followers || []);\n          setFollowing(followingRes.data.following || []);\n        })\n        .catch(error => {\n          console.error('Error loading users:', error);\n        })\n        .finally(() => {\n          setLoadingUsers(false);\n        });\n    }\n  }, [createGroupOpen, authContext.user]);\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã\n  const handleCreateGroup = async () => {\n    if (!groupTitle.trim() || selectedUsers.length === 0) return;\n\n    try {\n      const response = await axios.post(`${API_URL}/messenger/chats/group`, {\n        title: groupTitle,\n        member_ids: selectedUsers.map(user => user.id),\n        is_group: true // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π —á—Ç–æ —ç—Ç–æ –≥—Ä—É–ø–ø–æ–≤–∞—è –±–µ—Å–µ–¥–∞\n      });\n\n      if (response.data.success) {\n        setCreateGroupOpen(false);\n        setGroupTitle('');\n        setSelectedUsers([]);\n        // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤\n        window.location.reload();\n      } else {\n        console.error('Error creating group:', response.data.error);\n      }\n    } catch (error) {\n      console.error('Error creating group:', error.response?.data || error);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  const handleUserSelect = (user) => {\n    setSelectedUsers(prev => {\n      const isSelected = prev.some(u => u.id === user.id);\n      if (isSelected) {\n        return prev.filter(u => u.id !== user.id);\n      } else {\n        return [...prev, user];\n      }\n    });\n  };\n  \n  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º session_key —Å —Å–µ—Ä–≤–µ—Ä–∞, –µ—Å–ª–∏ –Ω–µ—Ç\n  useEffect(() => {\n    if (!sessionKey && authContext.isAuthenticated && authContext.user && !isLoadingSessionKey) {\n      console.log(\"–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º session_key —Å —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é...\");\n      setIsLoadingSessionKey(true);\n      \n      (async () => {\n        try {\n          const response = await axios.get(`${API_URL}/auth/get-session-key`, {\n            withCredentials: true,\n            headers: {\n              'Authorization': `Bearer ${jwtToken}`,\n              'Cache-Control': 'no-cache'\n            }\n          });\n          \n          if (response.data?.session_key) {\n            console.log(\"–ü–æ–ª—É—á–∏–ª–∏ session_key –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:\", response.data.session_key);\n            localStorage.setItem('session_key', response.data.session_key);\n            setForcedSessionKey(response.data.session_key);\n          }\n        } catch (err) {\n          console.error(\"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è session_key:\", err);\n          \n          // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º JWT –∫–∞–∫ session_key\n          if (jwtToken && !localStorage.getItem('session_key')) {\n            console.log(\"–ò—Å–ø–æ–ª—å–∑—É–µ–º JWT –∫–∞–∫ session_key\");\n            localStorage.setItem('session_key', jwtToken);\n            setForcedSessionKey(jwtToken);\n          }\n        } finally {\n          setIsLoadingSessionKey(false);\n        }\n      })();\n    }\n  }, [authContext.isAuthenticated, authContext.user, jwtToken, sessionKey, isLoadingSessionKey, API_URL]);\n  \n  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–±–æ—á–∏–π –∫–ª—é—á –≤ localStorage, –µ—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –µ–≥–æ –∏–∑ –∫—É–∫–∏\n  useEffect(() => {\n    if (sessionKeyCookie && !localStorage.getItem('session_key')) {\n      localStorage.setItem('session_key', sessionKeyCookie);\n      console.log('MessengerPage: Saved session key from cookie to localStorage');\n    }\n  }, [sessionKeyCookie]);\n  \n  // Check if user is a channel (channels cannot use messenger)\n  const isChannel = authContext.user?.type === 'channel';\n  \n  // Debug\n  useEffect(() => {\n    console.log('Auth Context:', authContext);\n    console.log('User Type:', authContext.user?.type);\n    console.log('Session Key from Auth Context:', authContext.sessionKey || authContext.session_key);\n    console.log('Session Key from localStorage:', localStorage.getItem('session_key'));\n    console.log('Session Key from cookie:', sessionKeyCookie);\n    console.log('JWT Token:', jwtToken);\n    console.log('Forced Session Key:', forcedSessionKey);\n    console.log('Final Session Key:', sessionKey);\n    console.log('API URL:', API_URL);\n  }, [authContext, sessionKey, sessionKeyCookie, jwtToken, forcedSessionKey, API_URL]);\n  \n  // –ï—Å–ª–∏ –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–ª–∏ –∫–ª—é—á–∞ —Å–µ—Å—Å–∏–∏\n  if (authContext.loading || isLoadingSessionKey) {\n    return (\n      <Box sx={{ \n        display: 'flex', \n        justifyContent: 'center', \n        alignItems: 'center', \n        minHeight: '70vh' \n      }}>\n        <CircularProgress />\n      </Box>\n    );\n  }\n  \n  // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∫–∞–Ω–∞–ª–æ–º, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏\n  if (isChannel) {\n    return (\n      <Box sx={{\n        display: 'flex',\n        flexDirection: 'column',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '70vh'\n      }}>\n        <Typography variant=\"h6\" color=\"error\" gutterBottom>\n          –§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞\n        </Typography>\n        <Typography variant=\"body1\">\n          –ö–∞–Ω–∞–ª—ã –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä. –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.\n        </Typography>\n      </Box>\n    );\n  }\n  \n  // –ï—Å–ª–∏ –Ω–µ—Ç –∫–ª—é—á–∞ —Å–µ—Å—Å–∏–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –∏ –≤—ã–≤–æ–¥ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n  if (!sessionKey) {\n    return (\n      <Box sx={{\n        display: 'flex',\n        flexDirection: 'column',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '70vh'\n      }}>\n        <Typography variant=\"h6\" gutterBottom>\n          –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n        </Typography>\n        <Typography variant=\"body1\" mb={2}>\n          –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è\n        </Typography>\n        \n      </Box>\n    );\n  }\n\n  // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∏–±–æ —Å–ø–∏—Å–æ–∫, –ª–∏–±–æ —á–∞—Ç\n  const handleChatSelect = () => {\n    if (isMobile) {\n      console.log('Handling chat selection - setting slideIn to TRUE');\n      // –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–º slideIn, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ\n      setSlideIn(true);\n      // –í–∞–∂–Ω–æ: –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å–∫—Ä—ã–≤–∞–µ–º sidebar –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ\n      setTimeout(() => {\n        setShowSidebar(false);\n      }, 50); // –ú–∞–ª–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏\n    }\n  };\n  \n  const handleBackToList = () => {\n    if (isMobile) {\n      // First start slide out animation\n      setSlideIn(false);\n      // Only show sidebar after animation completes\n      setTimeout(() => {\n        setShowSidebar(true);\n      }, 300); // Match transition time\n    }\n  };\n  \n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è\n  const handleCopyInviteLink = async () => {\n    try {\n      const response = await axios.post(`${API_URL}/messenger/chats/${currentChat.id}/invite`);\n      if (response.data.success) {\n        const inviteLink = `${window.location.origin}/messenger/join/${response.data.invite_link}`;\n        await navigator.clipboard.writeText(inviteLink);\n        setSnackbarMessage('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');\n        setSnackbarOpen(true);\n      }\n    } catch (error) {\n      console.error('Error generating invite link:', error);\n      setSnackbarMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏');\n      setSnackbarOpen(true);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞ –≥—Ä—É–ø–ø—ã\n  const handleGroupAvatarChange = async (event) => {\n    const file = event.target.files[0];\n    if (!file) return;\n\n    const formData = new FormData();\n    formData.append('avatar', file);\n\n    try {\n      const response = await axios.post(`${API_URL}/messenger/chats/${currentChat.id}/update`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      if (response.data.success) {\n        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Ç–µ\n        setCurrentChat(prev => ({\n          ...prev,\n          avatar: response.data.avatar\n        }));\n        setSnackbarMessage('–ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω');\n        setSnackbarOpen(true);\n      }\n    } catch (error) {\n      console.error('Error updating group avatar:', error);\n      setSnackbarMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞');\n      setSnackbarOpen(true);\n    }\n  };\n\n  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã\n  const handleGroupTitleChange = async (newTitle) => {\n    try {\n      const response = await axios.post(`${API_URL}/messenger/chats/${currentChat.id}/update`, {\n        title: newTitle\n      });\n      if (response.data.success) {\n        setCurrentChat(prev => ({\n          ...prev,\n          title: newTitle\n        }));\n        setSnackbarMessage('–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω–æ');\n        setSnackbarOpen(true);\n      }\n    } catch (error) {\n      console.error('Error updating group title:', error);\n      setSnackbarMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è');\n      setSnackbarOpen(true);\n    }\n  };\n\n  return (\n    <Box sx={{ mt: 2.5 }}>\n      <SEO \n        title=\"–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä\" \n        description=\"–û–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ —á–∞—Ç—ã –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ö-–ö–æ–Ω–Ω–µ–∫—Ç\"\n      />\n      \n      <MessengerProvider>\n        <Box sx={{ \n          display: 'flex', \n          flexDirection: { xs: 'column', md: 'row' },\n          height: { xs: 'calc(100vh - 120px)', md: 'calc(100vh - 104px)' },\n          maxWidth: '1400px',\n          mx: 'auto',\n          mt: 1,\n          mb: 2, \n          overflow: 'hidden',\n          bgcolor: 'content.main',\n          borderRadius: 2,\n          position: 'relative'\n        }}>\n          {/* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–æ —Å–ø–∏—Å–∫–æ–º —á–∞—Ç–æ–≤ */}\n          <Box sx={{ \n            width: { xs: '100%', md: '350px' },\n            borderRight: { md: `1px solid ${theme.palette.divider}` },\n            display: isMobile && !showSidebar ? 'none' : 'block',\n            height: '100%',\n            overflow: 'hidden'\n          }}>\n            {/* –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã */}\n            <Box sx={{ p: 2, display: 'flex', justifyContent: 'center' }}>\n              <Button\n                variant=\"contained\"\n                startIcon={<AddIcon />}\n                onClick={() => setCreateGroupOpen(true)}\n                fullWidth\n              >\n                –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É\n              </Button>\n            </Box>\n            \n            {/* –Ø–≤–Ω–æ –ø–µ—Ä–µ–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —á–∞—Ç–∞ */}\n            <ChatList onSelectChat={handleChatSelect} />\n          </Box>\n          \n          {/* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å —á–∞—Ç–æ–º */}\n          {isMobile ? (\n            <Box \n              id=\"mobile-chat-container\"\n              className={`messenger-main ${slideIn ? 'slide-in' : 'slide-out'}`}\n              sx={{ \n                display: 'block',\n                transform: slideIn ? 'translateX(0%) !important' : 'translateX(100%) !important',\n                transition: 'transform 0.3s ease-in-out',\n                position: 'fixed',\n                top: 0,\n                left: 0,\n                right: 0,\n                bottom: 0,\n                width: '100%',\n                height: '100vh',\n                zIndex: 1300,\n                backgroundColor: theme.palette.background.paper,\n                overflowX: 'hidden',  \n                maxWidth: '100vw',\n                WebkitOverflowScrolling: 'touch',\n                touchAction: 'manipulation',\n              }}\n            >\n              <ChatWindow backAction={handleBackToList} isMobile={isMobile} />\n            </Box>\n          ) : (\n            <Box sx={{ \n              flex: 1, \n              display: 'flex',\n              flexDirection: 'column',\n              height: '100%',\n              overflow: 'hidden'\n            }}>\n              <ChatWindow />\n            </Box>\n          )}\n        </Box>\n      </MessengerProvider>\n\n      {/* –î–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã */}\n      <Dialog \n        open={createGroupOpen} \n        onClose={() => setCreateGroupOpen(false)}\n        maxWidth=\"sm\"\n        fullWidth\n        PaperProps={{\n          sx: {\n            backgroundColor: 'rgba(10, 10, 10, 0.75)',\n            color: '#fff',\n            boxShadow: '0 8px 32px 0 rgba(0,0,0,0.37)',\n            backdropFilter: 'blur(12px)',\n            WebkitBackdropFilter: 'blur(12px)',\n            borderRadius: isMobile ? 0 : 3,\n            border: '1px solid rgba(40,40,40,0.5)'\n          }\n        }}\n      >\n        <DialogTitle sx={{ bgcolor: 'transparent', color: '#fff' }}>\n          –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É\n          <IconButton\n            aria-label=\"close\"\n            onClick={() => setCreateGroupOpen(false)}\n            sx={{ position: 'absolute', right: 8, top: 8 }}\n          >\n            <CloseIcon />\n          </IconButton>\n        </DialogTitle>\n        <DialogContent sx={{ bgcolor: 'transparent', color: '#fff' }}>\n          <TextField\n            autoFocus\n            margin=\"dense\"\n            label=\"–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\"\n            fullWidth\n            value={groupTitle}\n            onChange={(e) => setGroupTitle(e.target.value)}\n            sx={{ mb: 2 }}\n          />\n          \n          <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 2 }}>\n            <Button \n              color={activeTab === 'followers' ? 'primary' : 'inherit'}\n              onClick={() => setActiveTab('followers')}\n            >\n              –ü–æ–¥–ø–∏—Å—á–∏–∫–∏\n            </Button>\n            <Button \n              color={activeTab === 'following' ? 'primary' : 'inherit'}\n              onClick={() => setActiveTab('following')}\n            >\n              –ü–æ–¥–ø–∏—Å–∫–∏\n            </Button>\n          </Box>\n\n          {loadingUsers ? (\n            <Box sx={{ display: 'flex', justifyContent: 'center', p: 3 }}>\n              <CircularProgress />\n            </Box>\n          ) : (\n            <List sx={{ maxHeight: 400, overflow: 'auto' }}>\n              {(activeTab === 'followers' ? followers : following).map((user) => (\n                <ListItem\n                  key={user.id}\n                  secondaryAction={\n                    <Checkbox\n                      edge=\"end\"\n                      checked={selectedUsers.some(u => u.id === user.id)}\n                      onChange={() => handleUserSelect(user)}\n                    />\n                  }\n                >\n                  <ListItemAvatar>\n                    <Avatar \n                      src={user.photo ? `${BASE_URL}/static/uploads/avatar/${user.id}/${user.photo}` : undefined}\n                      alt={user.name}\n                    >\n                      {user.name?.[0]}\n                    </Avatar>\n                  </ListItemAvatar>\n                  <ListItemText\n                    primary={user.name || user.username}\n                    secondary={user.username}\n                  />\n                </ListItem>\n              ))}\n            </List>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setCreateGroupOpen(false)}>–û—Ç–º–µ–Ω–∞</Button>\n          <Button \n            onClick={handleCreateGroup}\n            variant=\"contained\"\n            disabled={!groupTitle.trim() || selectedUsers.length === 0}\n          >\n            –°–æ–∑–¥–∞—Ç—å\n          </Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* –ù–∞–π—Ç–∏ –º–µ—Å—Ç–æ, –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ –ø–æ–ª–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞ */}\n      {currentChat && currentChat.is_group && (\n        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n          {editingTitle ? (\n            <>\n              <TextField\n                value={editTitle}\n                onChange={e => setEditTitle(e.target.value)}\n                size=\"small\"\n                disabled={!isCurrentUserAdmin}\n              />\n              <Button\n                onClick={async () => {\n                  await handleGroupTitleChange(editTitle);\n                  setEditingTitle(false);\n                }}\n                disabled={!isCurrentUserAdmin || !editTitle.trim()}\n                size=\"small\"\n                variant=\"contained\"\n              >\n                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n              </Button>\n              <Button onClick={() => setEditingTitle(false)} size=\"small\">–û—Ç–º–µ–Ω–∞</Button>\n            </>\n          ) : (\n            <>\n              <Typography variant=\"h6\">{currentChat.title}</Typography>\n              {isCurrentUserAdmin && (\n                <IconButton size=\"small\" onClick={() => { setEditTitle(currentChat.title); setEditingTitle(true); }}>\n                  <Edit fontSize=\"small\" />\n                </IconButton>\n              )}\n            </>\n          )}\n        </Box>\n      )}\n    </Box>\n  );\n};\n\nexport default MessengerPage; "],"names":["_interopRequireDefault","require$$0","Object","defineProperty","Refresh","value","default","_createSvgIcon","_jsxRuntime","require$$2","jsx","d","memo","ChatItem","chat","isActive","unreadCount","onClick","currentUserId","onlineUsers","getUserInfo","useMessenger","otherUserDetails","setOtherUserDetails","useState","isLoading","setIsLoading","otherMember","useMemo","is_group","members","Array","isArray","length","find","member","memberId","user_id","id","user","useEffect","async","otherUserId","userInfo","err","loadUserDetails","title","name","username","memberName","isOnline","lastMessagePreview","message","last_message","senderName","sender_id","sender","sender_name","senderPrefix","message_type","content","original_filename","lastMessageTime","created_at","test","date","Date","isNaN","getTime","now","dateString","toLocaleDateString","nowString","yesterday","setDate","getDate","yesterdayString","toLocaleTimeString","hour","minute","day","month","e","avatarLetter","toUpperCase","jsxs","className","children","avatar","src","alt","style","objectFit","toLowerCase","endsWith","background","position","bottom","right","width","height","borderRadius","backgroundColor","border","zIndex","encrypted","SearchUsers","onClose","searchUsers","createPersonalChat","setActiveChat","getChatDetails","query","setQuery","results","setResults","loading","setLoading","error","setError","creating","setCreating","searchTimeout","useRef","trim","current","clearTimeout","setTimeout","users","handleStartChat","useCallback","userId","existingChatId","chatId","chatDetails","type","placeholder","onChange","target","autoFocus","map","existing_chat_id","disabled","has_chat","PersonSearch","cx","cy","r","ChatList","onSelectChat","chats","activeChat","unreadCounts","refreshChats","searchMode","setSearchMode","searchQuery","setSearchQuery","filteredChats","setFilteredChats","initialLoadRef","handleVisibilityChange","document","visibilityState","addEventListener","refreshTimer","setInterval","clearInterval","removeEventListener","filtered","filter","includes","toggleSearchMode","prev","handleChatSelect","handleRefreshChats","renderHeader","IconButton","size","color","ArrowBackIcon","PersonSearchIcon","RefreshIcon","sx","padding","ClearIcon","fontSize","MessageInput$1","React","MessageInput","onSendMessage","onTyping","onFileUpload","replyTo","onCancelReply","setMessage","isUploading","setIsUploading","typingTimeout","setTypingTimeout","fileInputRef","textareaRef","focus","handleSendMessage","messageToSend","handleKeyDown","key","shiftKey","preventDefault","handleMessageChange","newMessage","timeout","triggerFileUpload","setAttribute","click","handleFileChange","file","files","alert","split","finally","Box","borderTop","display","flexDirection","renderReplyInfo","previewContent","substring","alignItems","justifyContent","marginBottom","borderLeft","fontWeight","CloseIcon","PhotoIcon","ref","accept","onKeyDown","resize","outline","margin","flex","minHeight","maxHeight","fontFamily","alignContent","CircularProgress","SendIcon","ZoomOut","RotateLeft","RotateRight","SimpleImageViewerMes","scale","setScale","rotation","setRotation","isDragging","setIsDragging","setPosition","x","y","dragStart","setDragStart","window","zoomIn","handleMouseUp","top","left","cursor","onMouseDown","clientX","clientY","onMouseMove","onMouseUp","onMouseLeave","onTouchStart","touches","onTouchMove","onTouchEnd","handleTouchEnd","onDoubleClick","handleDoubleClick","stopPropagation","maxWidth","transform","transition","gap","backdropFilter","Math","min","ZoomInIcon","zoomOut","max","ZoomOutIcon","rotateLeft","RotateLeftIcon","rotateRight","RotateRightIcon","TypingIndicator","userIds","chatMembers","typingUserNames","m","parseInt","typingText","MemoizedMessageItem","MessageItem","isCurrentUser","decryptedContent","onReply","replyMessage","showDateSeparator","dateSeparatorText","showActions","setShowActions","getFileUrl","avatarCache","getAvatarUrl","deleteMessage","lightboxOpen","setLightboxOpen","lightboxImage","setLightboxImage","menuAnchorEl","setMenuAnchorEl","deleteDialogOpen","setDeleteDialogOpen","isDeleting","setIsDeleting","messageRef","messagesContainerRef","querySelector","handleCloseDeleteDialog","handleCloseError","getSenderInfo","senderId","avatarUrl","photo","photoPath","startsWith","getSenderName","getSenderAvatar","formatMessageTime","timestamp","weekAgo","formatDistanceToNow","addSuffix","locale","ru","toLocaleString","formatFileSize","bytes","i","floor","log","round","pow","renderReadStatus","isRead","read_by","read_count","DoneAllIcon","DoneIcon","senderAvatar","isGroupChat","opacity","onMouseEnter","charAt","reply_to_id","renderReplyContent","replySenderName","renderMessageContent","timeElement","isLongMessage","flexWrap","whiteSpace","wordBreak","overflowWrap","textAlign","marginRight","photoUrl","photo_url","chat_id","mime_type","handlePhotoClick","imageRendering","alignSelf","videoUrl","controls","preload","audioUrl","fileUrl","href","rel","file_size","ReplyIcon","handleOpenDeleteDialog","DeleteIcon","Dialog","open","PaperProps","bgcolor","backgroundImage","boxShadow","overflow","DialogTitle","borderBottom","py","px","Typography","variant","component","DialogContent","DialogContentText","mb","DialogActions","Button","textTransform","messagesContainer","scrollTop","scrollHeight","result","success","classList","add","marginTop","newScrollHeight","heightDiff","SimpleImageViewer","handleCloseLightbox","Snackbar","autoHideDuration","anchorOrigin","vertical","horizontal","Alert","severity","ModeratorBanner","ChatWindow","backAction","isMobile","currentChat","setCurrentChat","messages","loadMessages","hasMoreMessages","loadingMessages","typingUsers","sendTextMessage","sendTypingIndicator","decryptMessage","uploadFile","deleteChat","navigate","useNavigate","setReplyTo","messagesEndRef","loadMoreTriggerRef","isAtBottom","setIsAtBottom","autoScrollEnabled","setAutoScrollEnabled","chatIdRef","typingTimestampRef","anchorEl","setAnchorEl","hasModeratorMessages","setHasModeratorMessages","groupInfoOpen","setGroupInfoOpen","snackbarOpen","setSnackbarOpen","snackbarMessage","setSnackbarMessage","API_URL","BASE_URL","handleCloseMenu","mounted","timer","apiHasModeratorMessages","undefined","hasModerator","some","is_from_moderator","is_moderator","scrollToBottom","smooth","scrollIntoView","behavior","block","handleScroll","clientHeight","scrolledToBottom","abs","throttledScrollHandler","isThrottled","container","throttled","hasMoreMessagesForChat","prototype","hasOwnProperty","call","useIntersectionObserver","onIntersect","threshold","rootMargin","enabled","debounceTime","debounceRef","observer","IntersectionObserver","entries","entry","isIntersecting","observe","disconnect","scrollPosition","then","addedHeight","text","replyToId","handleFileUpload","handleTyping","isTyping","renderTypingIndicator","typingUserIds","keys","getChatTitle","chat_type","memberIdStr","String","currentUserIdStr","getChatAvatar","getAvatarLetter","chatMessages","memoizedMessages","otherUser","isFemale","gender","userStatus","last_active","dateObject","today","options","formattedDate","diffMs","diffMins","diffHours","diffDays","year","hour12","formatLastActive","isCurrentUserAdmin","role","editTitle","setEditTitle","editingTitle","setEditingTitle","p","borderColor","mr","ArrowBack","Avatar","noWrap","currentTarget","MoreVertIcon","Menu","Boolean","WebkitBackdropFilter","minWidth","MenuItem","handleOpenProfile","PersonIcon","fullScreen","fullWidth","Close","my","getElementById","event","formData","FormData","append","response","axios","post","headers","data","TextField","label","InputProps","endAdornment","EditIcon","mt","newTitle","handleGroupTitleChange","List","ListItem","ListItemAvatar","ListItemText","primary","secondary","inviteLink","location","origin","invite_link","navigator","clipboard","writeText","handleCopyInviteLink","startIcon","Link","MessengerPage","theme","useTheme","authContext","useContext","AuthContext","useMediaQuery","breakpoints","down","showSidebar","setShowSidebar","slideIn","setSlideIn","forcedSessionKey","setForcedSessionKey","isLoadingSessionKey","setIsLoadingSessionKey","chatMenuAnchor","setChatMenuAnchor","createGroupOpen","setCreateGroupOpen","groupTitle","setGroupTitle","selectedUsers","setSelectedUsers","followers","setFollowers","following","setFollowing","loadingUsers","setLoadingUsers","activeTab","setActiveTab","getCookie","parts","cookie","pop","shift","sessionKeyCookie","jwtToken","localStorage","getItem","sessionKey","session_key","MAIN_API_URL","Promise","all","get","followersRes","followingRes","catch","isAuthenticated","withCredentials","Authorization","setItem","isChannel","gutterBottom","SEO","description","MessengerProvider","xs","md","mx","borderRight","palette","divider","AddIcon","paper","overflowX","WebkitOverflowScrolling","touchAction","handleBackToList","secondaryAction","Checkbox","edge","checked","u","handleUserSelect","member_ids","reload","Fragment","Edit"],"mappings":"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","x_google_ignoreList":[0,3,6,7,8]}