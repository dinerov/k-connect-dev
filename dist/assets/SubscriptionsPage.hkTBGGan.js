import{b as me,g as we,j as r,h as ye,i as p,w as se,T as D,v as je,t as ne,s as G,o as te,S as O,k as be,P as Ie,a3 as _e}from"./vendor-mui.08p3AH88.js";import{e as ve,r as o,u as Pe}from"./vendor-router.BRqU_Zs2.js";import{a as w,m as Se}from"./vendor.CL98q8z6.js";import{A as ke,b as $e,P as Ce}from"./index.CdVNWeFt.js";import{A as We}from"./ArrowBack.DeCcUwS3.js";import{P as Te}from"./PersonRemove.3f-UhM3t.js";import"./vendor-react.DF-_cTkv.js";const he=G(Ie)(({theme:h})=>({display:"flex",alignItems:"center",padding:h.spacing(2),marginBottom:h.spacing(1.5),borderRadius:h.spacing(1.5),transition:"all 0.2s ease",height:80,overflow:"hidden","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 12px rgba(0, 0, 0, 0.1)"}})),ze=G(p)(({theme:h})=>({display:"flex",justifyContent:"center",alignItems:"center",padding:h.spacing(4),height:100})),Ae=G(p)(({theme:h})=>({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:h.spacing(4),textAlign:"center",minHeight:150})),xe=G(({text:h,maxLength:g,variant:l,component:H,...Y})=>{const m=h&&h.length>g,d=m?`${h.substring(0,g)}...`:h;return r.jsx(_e,{title:m?h:"",arrow:!0,placement:"top",children:r.jsx(D,{variant:l,component:H,...Y,children:d||"\u041D\u0435\u0442 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u044F"})})})(({theme:h})=>({whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"})),Me=({tabIndex:h=0})=>{const{username:g}=ve(),{user:l}=o.useContext(ke),H=Pe(),Y=me(),m=we(Y.breakpoints.down("sm")),[d,pe]=o.useState(h),[I,y]=o.useState([]),[_,j]=o.useState([]),[v,b]=o.useState([]),[P,$]=o.useState(!1),[S,C]=o.useState(!1),[k,W]=o.useState(!1),[q,T]=o.useState(1),[J,z]=o.useState(1),[K,A]=o.useState(1),[N,M]=o.useState(!0),[Q,R]=o.useState(!0),[U,E]=o.useState(!0),[V,F]=o.useState(null),[L,B]=o.useState({}),[u,x]=o.useState({followersInProgress:!1,followingInProgress:!1,friendsInProgress:!1,profileInProgress:!1}),f=o.useRef({followers:{},following:{},friends:{},profile:{}}),ae=o.useRef(null),ie=o.useCallback(async()=>{try{const e=g||l?.username;if(!e||l&&e===l.username)return void F(l);if(f.current.profile[e])return void F(f.current.profile[e]);if(u.profileInProgress)return;x(a=>({...a,profileInProgress:!0}));const s=await w.get(`/api/users/${e}`);f.current.profile[e]=s.data,F(s.data)}catch{}finally{x(e=>({...e,profileInProgress:!1}))}},[g,l]),oe=o.useCallback(async()=>{try{const e=g||l?.username;if(!e||u.followersInProgress)return;const s=`${e}_1`;if(f.current.followers[s]){const t=f.current.followers[s],c=(t.followers||[]).filter(i=>!i.is_friend);return y(c),M(t.has_next||!1),void T(2)}$(!0),x(t=>({...t,followersInProgress:!0}));const a=await w.get(`/api/users/${e}/followers`,{params:{page:1,per_page:20}});f.current.followers[s]=a.data;const n=(a.data.followers||[]).filter(t=>!t.is_friend);y(n),M(a.data.has_next||!1),T(2)}catch{}finally{$(!1),x(e=>({...e,followersInProgress:!1}))}},[g,l]),le=o.useCallback(async()=>{try{const e=g||l?.username;if(!e||u.followingInProgress)return;const s=`${e}_1`;if(f.current.following[s]){const n=f.current.following[s];return j(n.following||[]),R(n.has_next||!1),void z(2)}C(!0),x(n=>({...n,followingInProgress:!0}));const a=await w.get(`/api/users/${e}/following`,{params:{page:1,per_page:20}});f.current.following[s]=a.data,j(a.data.following||[]),R(a.data.has_next||!1),z(2)}catch{}finally{C(!1),x(e=>({...e,followingInProgress:!1}))}},[g,l]),ce=o.useCallback(async()=>{try{const e=g||l?.username;if(!e||u.friendsInProgress)return;const s=`${e}_1`;if(f.current.friends[s]){const n=f.current.friends[s];return b(n.friends||[]),E(n.has_next||!1),void A(2)}W(!0),x(n=>({...n,friendsInProgress:!0}));const a=await w.get(`/api/profile/${e}/friends`,{params:{page:1,per_page:20}});f.current.friends[s]=a.data,b(a.data.friends||[]),E(a.data.has_next||!1),A(2)}catch{}finally{W(!1),x(e=>({...e,friendsInProgress:!1}))}},[g,l]),fe=o.useCallback(async()=>{try{const e=g||l?.username;if(P||u.followersInProgress)return;const s=`${e}_${q}`;if(f.current.followers[s]){const t=f.current.followers[s],c=(t.followers||[]).filter(i=>!i.is_friend);return y(i=>[...i,...c]),M(t.has_next||!1),void T(i=>i+1)}$(!0),x(t=>({...t,followersInProgress:!0}));const a=await w.get(`/api/users/${e}/followers`,{params:{page:q,per_page:20}});f.current.followers[s]=a.data;const n=(a.data.followers||[]).filter(t=>!t.is_friend);y(t=>[...t,...n]),M(a.data.has_next||!1),T(t=>t+1)}catch{}finally{$(!1),x(e=>({...e,followersInProgress:!1}))}},[g,l,q,P,u.followersInProgress]),de=o.useCallback(async()=>{try{const e=g||l?.username;if(S||u.followingInProgress)return;const s=`${e}_${J}`;if(f.current.following[s]){const n=f.current.following[s];return j(t=>[...t,...n.following||[]]),R(n.has_next||!1),void z(t=>t+1)}C(!0),x(n=>({...n,followingInProgress:!0}));const a=await w.get(`/api/users/${e}/following`,{params:{page:J,per_page:20}});f.current.following[s]=a.data,j(n=>[...n,...a.data.following||[]]),R(a.data.has_next||!1),z(n=>n+1)}catch{}finally{C(!1),x(e=>({...e,followingInProgress:!1}))}},[g,l,J,S,u.followingInProgress]),ge=o.useCallback(async()=>{try{const e=g||l?.username;if(k||u.friendsInProgress)return;const s=`${e}_${K}`;if(f.current.friends[s]){const n=f.current.friends[s];return b(t=>[...t,...n.friends||[]]),E(n.has_next||!1),void A(t=>t+1)}W(!0),x(n=>({...n,friendsInProgress:!0}));const a=await w.get(`/api/profile/${e}/friends`,{params:{page:K,per_page:20}});f.current.friends[s]=a.data,b(n=>[...n,...a.data.friends||[]]),E(a.data.has_next||!1),A(n=>n+1)}catch{}finally{W(!1),x(e=>({...e,friendsInProgress:!1}))}},[g,l,K,k,u.friendsInProgress]);o.useEffect(()=>{ie()},[g,l,ie]),o.useEffect(()=>{d!==0||v.length!==0||u.friendsInProgress?d!==1||I.length!==0||u.followersInProgress?d!==2||_.length!==0||u.followingInProgress||le():oe():ce()},[d,g,I.length,_.length,v.length,oe,le,ce,u]),o.useEffect(()=>{let e=null;const s=new IntersectionObserver(n=>{n[0].isIntersecting&&(e&&clearTimeout(e),e=setTimeout(()=>{d!==0||!U||k||u.friendsInProgress?d!==1||!N||P||u.followersInProgress?d!==2||!Q||S||u.followingInProgress||de():fe():ge()},300))},{threshold:.5}),a=ae.current;return a&&s.observe(a),()=>{a&&s.unobserve(a),e&&clearTimeout(e)}},[d,N,Q,U,P,S,k,fe,de,ge,u]);const ue=()=>{f.current.followers={},f.current.following={},f.current.friends={}},X=e=>{const s=e.is_following,a=l&&e.id===l.id;e.account_type;let n=e.photo;return!n||n.startsWith("http")||n.startsWith("/")||(n=`/static/uploads/avatar/${e.id}/${n}`),r.jsx(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:r.jsxs(he,{children:[r.jsxs(p,{sx:{display:"flex",alignItems:"center",flexGrow:1,minWidth:0,flexShrink:1},children:[r.jsx(be,{src:n||"/static/uploads/avatar/system/avatar.png",alt:e.name||e.username,sx:{width:50,height:50,minWidth:50,marginRight:2,border:"2px solid",borderColor:"primary.main"}}),r.jsxs(p,{sx:{minWidth:0,flex:1,flexShrink:1},children:[r.jsxs(p,{sx:{display:"flex",alignItems:"center"},children:[r.jsx(xe,{text:e.name||e.username,maxLength:15,variant:"subtitle1",component:"a",href:`/profile/${e.username}`,sx:{color:"text.primary",textDecoration:"none","&:hover":{color:"primary.main"},flexShrink:1,minWidth:0}}),e.is_verified&&r.jsx($e,{sx:{ml:.5,fontSize:16,color:"primary.main",flexShrink:0}})]}),r.jsx(xe,{text:e.about,maxLength:25,variant:"body2",component:"div",sx:{color:"text.secondary",flexShrink:1,minWidth:0}})]})]}),!a&&l&&l.account_type!=="channel"&&r.jsx(p,{sx:{ml:2,flexShrink:0},children:s?r.jsx(se,{onClick:()=>(async t=>{try{B(c=>({...c,[t]:!0})),(await w.post("/api/profile/unfollow",{unfollowed_id:t})).data.success&&(y(c=>c.map(i=>i.id===t?{...i,is_following:!1}:i)),j(c=>c.map(i=>i.id===t?{...i,is_following:!1}:i)),b(c=>c.map(i=>i.id===t?{...i,is_following:!1}:i)),ue())}catch{}finally{B(c=>({...c,[t]:!1}))}})(e.id),disabled:L[e.id],color:"primary",size:"small",children:L[e.id]?r.jsx(te,{size:24}):r.jsx(Te,{})}):r.jsx(se,{onClick:()=>(async t=>{try{B(c=>({...c,[t]:!0})),(await w.post("/api/profile/follow",{followed_id:t})).data.success&&(y(c=>c.map(i=>i.id===t?{...i,is_following:!0}:i)),j(c=>c.map(i=>i.id===t?{...i,is_following:!0}:i)),b(c=>c.map(i=>i.id===t?{...i,is_following:!0}:i)),ue())}catch{}finally{B(c=>({...c,[t]:!1}))}})(e.id),disabled:L[e.id],color:"primary",size:"small",children:L[e.id]?r.jsx(te,{size:24}):r.jsx(Ce,{})})})]})},e.id)},Z=()=>Array(3).fill(0).map((e,s)=>r.jsx(he,{children:r.jsxs(p,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[r.jsx(O,{variant:"circular",width:50,height:50,sx:{mr:2,flexShrink:0}}),r.jsxs(p,{sx:{flex:1,minWidth:0},children:[r.jsx(O,{variant:"text",width:120}),r.jsx(O,{variant:"text",width:200})]}),r.jsx(O,{variant:"circular",width:40,height:40,sx:{flexShrink:0}})]})},s)),ee=e=>{let s="";switch(e){case"followers":s="\u041D\u0435\u0442 \u043F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u043E\u0432";break;case"friends":s="\u041D\u0435\u0442 \u0434\u0440\u0443\u0437\u0435\u0439";break;case"following":s="\u041D\u0435\u0442 \u043F\u043E\u0434\u043F\u0438\u0441\u043E\u043A";break;default:s="\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E"}return r.jsxs(Ae,{children:[r.jsx(D,{variant:"body1",color:"text.secondary",children:s}),e==="friends"&&r.jsx(D,{variant:"body2",color:"text.secondary",sx:{mt:1,maxWidth:300},children:"\u0414\u0440\u0443\u0437\u044C\u044F \u2014 \u044D\u0442\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0438, \u0441 \u043A\u043E\u0442\u043E\u0440\u044B\u043C\u0438 \u0443 \u0432\u0430\u0441 \u0432\u0437\u0430\u0438\u043C\u043D\u044B\u0435 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0438"})]})},re=e=>{switch(e){case"followers":return"\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0438";case"friends":return"\u0414\u0440\u0443\u0437\u044C\u044F";case"following":return"\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0438";default:return""}};return r.jsxs(ye,{maxWidth:"md",sx:{py:4},children:[r.jsxs(p,{sx:{mb:4,display:"flex",alignItems:"center"},children:[r.jsx(se,{onClick:()=>H(-1),sx:{mr:2},color:"primary",children:r.jsx(We,{})}),r.jsx(D,{variant:"h5",component:"h1",children:V?`${V.username} \xB7 ${V.account_type==="channel"?"\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0438":"\u0421\u043E\u0446\u0438\u0430\u043B\u044C\u043D\u044B\u0435 \u0441\u0432\u044F\u0437\u0438"}`:"\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0438 \u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0438"})]}),r.jsx(p,{sx:{borderBottom:1,borderColor:"divider",mb:3,"& .MuiTabs-flexContainer":{justifyContent:m?"space-between":"flex-start"}},children:r.jsxs(je,{value:d,onChange:(e,s)=>{pe(s)},variant:m?"fullWidth":"standard",sx:{"& .MuiTab-root":{color:"text.secondary","&.Mui-selected":{color:"primary.main"},textTransform:"none",fontSize:m?"0.875rem":"1rem",fontWeight:500,minWidth:m?0:100,flexGrow:m?1:0,padding:m?"12px 8px":"12px 16px"},"& .MuiTabs-indicator":{backgroundColor:"primary.main",height:3}},children:[r.jsx(ne,{label:re("friends")}),r.jsx(ne,{label:re("followers")}),r.jsx(ne,{label:re("following")})]})}),r.jsx(p,{role:"tabpanel",hidden:d!==0,children:d===0&&r.jsx(r.Fragment,{children:k&&v.length===0?Z():v.length>0?v.map(e=>X(e)):ee("friends")})}),r.jsx(p,{role:"tabpanel",hidden:d!==1,children:d===1&&r.jsx(r.Fragment,{children:P&&I.length===0?Z():I.length>0?I.map(e=>X(e)):ee("followers")})}),r.jsx(p,{role:"tabpanel",hidden:d!==2,children:d===2&&r.jsx(r.Fragment,{children:S&&_.length===0?Z():_.length>0?_.map(e=>X(e)):ee("following")})}),(d===0&&U||d===1&&N||d===2&&Q)&&r.jsx(ze,{ref:ae,children:r.jsx(te,{size:40})})]})};export{Me as default};
