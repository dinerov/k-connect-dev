import{j as a,h as _,i as f,T as d,a5 as k,o as S,O as g,P as j,Q as y,a7 as w,k as C,U as b,ad as E,V as z}from"./vendor-mui.08p3AH88.js";import{r as c,u as A,a as I}from"./vendor-router.BRqU_Zs2.js";import{a as v}from"./vendor.CL98q8z6.js";import{b as M}from"./dateUtils.JaLtthGQ.js";import{E as $}from"./ExpandLess.DNDWbxvJ.js";import{E as O}from"./ExpandMore.Ch98balh.js";import{P,g as T,F}from"./index.CdVNWeFt.js";import{R as N}from"./Reply.De_n_WzJ.js";import"./vendor-react.DF-_cTkv.js";const R=t=>{switch(t){case"comment_like":case"reply_like":case"post_like":return a.jsx(F,{fontSize:"small",color:"error"});case"comment":return a.jsx(T,{fontSize:"small",color:"primary"});case"reply":return a.jsx(N,{fontSize:"small",color:"primary"});case"follow":return a.jsx(P,{fontSize:"small",color:"primary"});default:return null}},W=({notifications:t,onNotificationClick:l})=>{const[p,h]=c.useState(!1);if(!Array.isArray(t)||t.length===0)return null;const n=t[0];if(!n||typeof n!="object")return null;const o=t.length,m=t.some(e=>!e.is_read),x=n.sender_user?.name||"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C",u=n.sender_user?.avatar_url||(n.sender_user?.id?`/static/uploads/avatar/${n.sender_user.id}/${n.sender_user.photo||"avatar.png"}`:"/static/uploads/avatar/system/avatar.png");return a.jsxs(j,{elevation:1,sx:{mb:2,overflow:"hidden",bgcolor:m?"rgba(140, 82, 255, 0.03)":"background.paper",border:m?"1px solid rgba(140, 82, 255, 0.1)":"1px solid rgba(255, 255, 255, 0.1)"},children:[a.jsxs(y,{button:!0,onClick:()=>{h(!p)},sx:{py:1.5,"&:hover":{bgcolor:"rgba(255, 255, 255, 0.05)"}},children:[a.jsx(w,{children:a.jsx(C,{src:u,alt:x,sx:{width:40,height:40},onError:e=>{e.currentTarget&&(e.currentTarget.src="/static/uploads/avatar/system/avatar.png")},children:x[0]})}),a.jsx(b,{primary:a.jsx(d,{variant:"subtitle2",children:x}),secondary:a.jsx(d,{variant:"body2",color:"text.secondary",children:o>1?`${o} \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439`:n.message||"\u041D\u043E\u0432\u043E\u0435 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0435"})}),o>1&&(p?a.jsx($,{}):a.jsx(O,{}))]}),a.jsx(E,{in:p,timeout:"auto",unmountOnExit:!0,children:a.jsx(g,{component:"div",disablePadding:!0,children:t.map((e,r)=>a.jsxs(I.Fragment,{children:[a.jsxs(y,{button:!0,sx:{pl:4,py:1.5,bgcolor:e.is_read?"transparent":"rgba(140, 82, 255, 0.05)"},onClick:()=>l(e),children:[a.jsx(f,{sx:{display:"flex",alignItems:"center",mr:1},children:R(e.type)}),a.jsx(b,{primary:a.jsx(d,{variant:"body2",children:e.message||"\u041D\u043E\u0432\u043E\u0435 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0435"}),secondary:a.jsx(d,{variant:"caption",color:"text.secondary",children:e.created_at?M(e.created_at):"\u0422\u043E\u043B\u044C\u043A\u043E \u0447\u0442\u043E"})})]}),r<t.length-1&&a.jsx(z,{component:"li"})]},e.id||r))})})]})},B=()=>{const[t,l]=c.useState([]),[p,h]=c.useState(!0),[n,o]=c.useState(0),m=A();c.useEffect(()=>{const r=async()=>{try{const s=await v.get("/api/notifications");s.data&&Array.isArray(s.data.notifications)?(l(s.data.notifications),o(s.data.unread_count||0)):(l([]),o(0))}catch{l([]),o(0)}finally{h(!1)}};r();const i=setInterval(r,9e4);return()=>clearInterval(i)},[]);const x=async r=>{if(r&&r.id)try{await v.post(`/api/notifications/${r.id}/read`),l(i=>i.map(s=>s.id===r.id?{...s,is_read:!0}:s)),o(i=>Math.max(0,i-1)),r.link&&m(r.link)}catch{}},u=c.useMemo(()=>t.filter(r=>r&&r.sender_user&&r.sender_user.id).reduce((r,i)=>{const s=i.sender_user.id;return r[s]||(r[s]=[]),r[s].push(i),r},{}),[t]),e=c.useMemo(()=>Object.values(u),[u]);return a.jsxs(_,{maxWidth:"md",sx:{pt:3,pb:4,minHeight:"calc(100vh - 64px)"},children:[a.jsxs(f,{sx:{mb:3,display:"flex",alignItems:"center",gap:2},children:[a.jsx(d,{variant:"h5",component:"h1",children:"\u0423\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F"}),n>0&&a.jsx(k,{badgeContent:n,color:"error",sx:{"& .MuiBadge-badge":{fontSize:"0.8rem",height:"22px",minWidth:"22px"}}})]}),p?a.jsx(f,{sx:{display:"flex",justifyContent:"center",py:4},children:a.jsx(S,{})}):e.length>0?a.jsx(g,{sx:{p:0},children:e.map((r,i)=>a.jsx(W,{notifications:r,onNotificationClick:x},r[0].sender_user.id||i))}):a.jsx(j,{sx:{p:4,textAlign:"center",borderRadius:2,bgcolor:"background.paper"},children:a.jsx(d,{color:"text.secondary",children:"\u0423 \u0432\u0430\u0441 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439"})})]})};export{B as default};
